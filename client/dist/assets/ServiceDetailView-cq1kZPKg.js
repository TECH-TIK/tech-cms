import{a as e,r as a,o as s,b as i,e as l,g as n,i as t,C as r,n as c,t as d,F as u,k as o,u as v,m as f,f as p}from"./vendor-CVE7zuiC.js";import{u as m,a as b,A as g,l as y,_ as h}from"./index-x2FPk4fV.js";import"./utils-CG2kLDjF.js";const I={id:"service-detail"},E={class:"service-detail-header"},D={class:"header-content"},w={class:"service-title-section"},k={class:"service-icon-large"},S={class:"service-info"},_={class:"service-meta"},C={class:"service-type"},R={class:"service-actions"},A=["disabled"],T={key:0,class:"loading-container"},V={key:1,class:"error-container"},L={class:"error-message"},H={key:2,class:"service-content"},x={class:"service-overview"},N={class:"overview-card"},F={class:"info-grid"},j={class:"info-item"},q={class:"info-item"},K={class:"info-item"},P={class:"info-item"},$={class:"info-item"},z={key:0,class:"info-item"},B={class:"service-configuration"},G={class:"config-card"},M={class:"config-content"},U={key:0,class:"config-item"},J={class:"config-value"},O={key:1,class:"config-item"},Q={class:"config-value"},W={key:2,class:"config-item"},X={class:"config-value"},Y={key:3,class:"config-item"},Z={class:"config-value"},ee={class:"service-billing"},ae={class:"billing-card"},se={class:"billing-content"},ie={class:"billing-item"},le={class:"price"},ne={class:"billing-item"},te={class:"billing-item"},re={class:"service-history"},ce={class:"history-card"},de={class:"history-content"},ue={key:0,class:"no-history"},oe={key:1,class:"history-list"},ve={class:"history-icon"},fe={class:"history-details"},pe={class:"history-title"},me={class:"history-description"},be={class:"history-date"},ge=h(e({__name:"ServiceDetailView",setup(e){const h=f(),ge=v(),ye=m(),he=b(),Ie=a(!0),Ee=a(null),De=a(null),we=a([]),ke=a(!1),Se=()=>{ge.push("/services")},_e=async()=>{var e,a;try{Ie.value=!0,Ee.value=null;const e=parseInt(h.params.id);if(!e)throw new Error("ID de service invalide");const a=await g.routes.client.service.getById(e);De.value=a.data,await Le(e)}catch(s){y.error("[SERVICE] Erreur lors du chargement du service",{serviceId:h.params.id,error:s}),Ee.value=(null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||"Erreur lors du chargement du service"}finally{Ie.value=!1}},Ce=e=>({active:"status-active",suspended:"status-suspended",terminated:"status-terminated",pending:"status-pending"}[e||""]||"status-unknown"),Re=e=>({active:"Actif",suspended:"Suspendu",terminated:"Terminé",pending:"En attente"}[e||""]||"Inconnu"),Ae=e=>({created:"fas fa-plus-circle",activated:"fas fa-play-circle",suspended:"fas fa-pause-circle",terminated:"fas fa-stop-circle",modified:"fas fa-edit",payment:"fas fa-credit-card"}[e]||"fas fa-info-circle"),Te=e=>e?new Date(e).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",Ve=e=>{var a,s;const i=parseInt(h.params.id),l=parseInt(String((null==(s=null==(a=e.data)?void 0:a.service)?void 0:s.id)||"0"));if("service"===e.entity_type&&l===i){switch(y.info("[SERVICE DETAIL] Événement service reçu",{event:e,serviceId:i,action:e.action}),ke.value=!0,e.data.service&&(De.value={...De.value,...e.data.service},y.info("[SERVICE DETAIL] Service mis à jour en temps réel",{serviceId:i,updatedService:De.value})),e.action){case"service_delete":y.warn("[SERVICE DETAIL] Service supprimé - redirection",{serviceId:i}),ge.push("/services");break;case"service_update":Le(i)}setTimeout(()=>{ke.value=!1},1e3)}},Le=async e=>{try{const a=await g.routes.client.service.getHistory(e);we.value=a.data||[]}catch(a){y.warn("[SERVICE DETAIL] Impossible de charger l'historique du service",{serviceId:e,error:a})}};return s(async()=>{await _e(),await(async()=>{var e;const a=null==(e=he.user)?void 0:e.id,s=parseInt(h.params.id);if(!a)return void y.error("[SERVICE DETAIL] ID client manquant - abandon initialisation temps réel",{user:he.user});if(!s)return void y.error("[SERVICE DETAIL] ID service invalide - abandon initialisation temps réel",{serviceId:h.params.id});const i=`service-detail-${s}`;if(ye.initialized)await ye.subscribeToDashboardEvents(a),ye.registerDashboardHandler(i,Ve),y.info("[SERVICE DETAIL] Handler temps réel enregistré",{handlerKey:i,clientId:a,serviceId:s});else{const e=ye.$subscribe((l,n)=>{n.initialized&&(ye.subscribeToDashboardEvents(a).then(()=>{ye.registerDashboardHandler(i,Ve),y.info("[SERVICE DETAIL] Handler temps réel enregistré (après initialisation)",{handlerKey:i,clientId:a,serviceId:s})}),e())})}})()}),i(()=>{(()=>{const e=parseInt(h.params.id);if(e){const a=`service-detail-${e}`;ye.unregisterDashboardHandler(a),y.info("[SERVICE DETAIL] Handler temps réel supprimé",{handlerKey:a,serviceId:e})}})()}),(e,a)=>{var s,i,v,f,m,b,g,y;return p(),l("div",I,[n("div",E,[n("div",D,[n("button",{class:"btn btn-outline btn-sm back-btn",onClick:Se},a[0]||(a[0]=[n("i",{class:"fas fa-arrow-left"},null,-1),r(" Retour aux services ")])),n("div",w,[n("div",k,[n("i",{class:c((y=null==(s=De.value)?void 0:s.type,{web_hosting:"fas fa-globe",vps:"fas fa-server",dedicated:"fas fa-hdd",database:"fas fa-database",email:"fas fa-envelope",domain:"fas fa-link"}[y||""]||"fas fa-cog"))},null,2)]),n("div",S,[n("h1",null,d((null==(i=De.value)?void 0:i.name)||"Chargement..."),1),n("div",_,[n("span",C,d(null==(v=De.value)?void 0:v.type),1),n("span",{class:c(Ce(null==(f=De.value)?void 0:f.status))},d(Re(null==(m=De.value)?void 0:m.status)),3)])])])]),n("div",R,[a[2]||(a[2]=n("button",{class:"btn btn-outline btn-sm"},[n("i",{class:"fas fa-download"}),r(" Exporter ")],-1)),n("button",{class:"btn btn-primary",disabled:"active"!==(null==(b=De.value)?void 0:b.status)},a[1]||(a[1]=[n("i",{class:"fas fa-cog"},null,-1),r(" Gérer le service ")]),8,A)])]),Ie.value?(p(),l("div",T,a[3]||(a[3]=[n("div",{class:"loading-spinner"},[n("i",{class:"fas fa-spinner fa-spin"}),n("p",null,"Chargement des détails du service...")],-1)]))):Ee.value?(p(),l("div",V,[n("div",L,[a[5]||(a[5]=n("i",{class:"fas fa-exclamation-triangle"},null,-1)),a[6]||(a[6]=n("h3",null,"Erreur de chargement",-1)),n("p",null,d(Ee.value),1),n("button",{class:"btn btn-primary",onClick:_e},a[4]||(a[4]=[n("i",{class:"fas fa-refresh"},null,-1),r(" Réessayer ")]))])])):De.value?(p(),l("div",H,[n("div",x,[n("div",N,[a[13]||(a[13]=n("h2",null,[n("i",{class:"fas fa-info-circle"}),r(" Informations générales ")],-1)),n("div",F,[n("div",j,[a[7]||(a[7]=n("label",null,"Nom du service",-1)),n("span",null,d(De.value.name),1)]),n("div",q,[a[8]||(a[8]=n("label",null,"Type",-1)),n("span",null,d(De.value.type),1)]),n("div",K,[a[9]||(a[9]=n("label",null,"Statut",-1)),n("span",{class:c(Ce(De.value.status))},d(Re(De.value.status)),3)]),n("div",P,[a[10]||(a[10]=n("label",null,"Date de création",-1)),n("span",null,d(Te(De.value.created_at)),1)]),n("div",$,[a[11]||(a[11]=n("label",null,"Dernière modification",-1)),n("span",null,d(Te(De.value.updated_at)),1)]),De.value.notes?(p(),l("div",z,[a[12]||(a[12]=n("label",null,"Description",-1)),n("span",null,d(De.value.notes),1)])):t("",!0)])])]),n("div",B,[n("div",G,[a[18]||(a[18]=n("h2",null,[n("i",{class:"fas fa-cogs"}),r(" Configuration ")],-1)),n("div",M,[De.value.hostname?(p(),l("div",U,[a[14]||(a[14]=n("label",null,"Nom d'hôte",-1)),n("span",J,d(De.value.hostname),1)])):t("",!0),De.value.username?(p(),l("div",O,[a[15]||(a[15]=n("label",null,"Nom d'utilisateur",-1)),n("span",Q,d(De.value.username),1)])):t("",!0),De.value.port?(p(),l("div",W,[a[16]||(a[16]=n("label",null,"Port",-1)),n("span",X,d(De.value.port),1)])):t("",!0),De.value.database_name?(p(),l("div",Y,[a[17]||(a[17]=n("label",null,"Base de données",-1)),n("span",Z,d(De.value.database_name),1)])):t("",!0)])])]),n("div",ee,[n("div",ae,[a[22]||(a[22]=n("h2",null,[n("i",{class:"fas fa-credit-card"}),r(" Facturation ")],-1)),n("div",se,[n("div",ie,[a[19]||(a[19]=n("label",null,"Prix mensuel",-1)),n("span",le,d((g=De.value.monthly_price,g?new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(g):"N/A")),1)]),n("div",ne,[a[20]||(a[20]=n("label",null,"Prochaine facturation",-1)),n("span",null,d(Te(De.value.next_billing_date)),1)]),n("div",te,[a[21]||(a[21]=n("label",null,"Cycle de facturation",-1)),n("span",null,d(De.value.billing_cycle||"Mensuel"),1)])])])]),n("div",re,[n("div",ce,[a[24]||(a[24]=n("h2",null,[n("i",{class:"fas fa-history"}),r(" Historique récent ")],-1)),n("div",de,[0===we.value.length?(p(),l("div",ue,a[23]||(a[23]=[n("i",{class:"fas fa-clock"},null,-1),n("p",null,"Aucun historique disponible",-1)]))):(p(),l("div",oe,[(p(!0),l(u,null,o(we.value,e=>(p(),l("div",{key:e.id,class:"history-item"},[n("div",ve,[n("i",{class:c(Ae(e.type))},null,2)]),n("div",fe,[n("div",pe,d(e.title),1),n("div",me,d(e.description),1),n("div",be,d(Te(e.created_at)),1)])]))),128))]))])])])])):t("",!0)])}}}),[["__scopeId","data-v-fb70b97c"]]);export{ge as default};
