import{r as e,d as t,c as s,w as a,o as i,a as n,b as r,e as o,f as l,t as c,g as u,h as d,i as p,j as m,k as v,F as h,l as f,m as g,n as y,u as b,p as _,q as k,s as w,v as S,x as E,y as C,z as T,A,B as I,C as R,D as x,E as O,G as P,H as N,I as M,J as D,K as L,L as U,M as q,N as V,O as $,T as j,P as F,Q as G,R as B,S as H}from"./vendor-BjbmScxp.js";import{a as W,c as z,b as K,d as J,e as Y,f as X,g as Q,r as Z,h as ee,i as te,j as se,k as ae}from"./utils-v4Bay8ci.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();async function ie(e,t,s={}){try{await fetch("/api/v1/admin/log",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({level:e,message:t,context:{...s,url:window.location.href}})})}catch(a){}}const ne={info:(e,t)=>{ie("info",e,t)},debug:(e,t)=>{},warn:(e,t)=>{ie("warning",e,t)},error:(e,t)=>{ie("error",e,t)}},re=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,oe=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,le=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function ce(e,t){if(!("__proto__"===e||"constructor"===e&&t&&"object"==typeof t&&"prototype"in t))return t}function ue(e,t){if(null==e)return;let s=e;for(let a=0;a<t.length;a++){if(null==s||null==s[t[a]])return;s=s[t[a]]}return s}function de(e,t,s){if(0===s.length)return t;const a=s[0];return s.length>1&&(t=de("object"==typeof e&&null!==e&&Object.prototype.hasOwnProperty.call(e,a)?e[a]:Number.isInteger(Number(s[1]))?[]:{},t,Array.prototype.slice.call(s,1))),Number.isInteger(Number(a))&&Array.isArray(e)?e.slice()[a]:Object.assign({},e,{[a]:t})}function pe(e,t){if(null==e||0===t.length)return e;if(1===t.length){if(null==e)return e;if(Number.isInteger(t[0])&&Array.isArray(e))return Array.prototype.slice.call(e,0).splice(t[0],1);const s={};for(const t in e)s[t]=e[t];return delete s[t[0]],s}if(null==e[t[0]]){if(Number.isInteger(t[0])&&Array.isArray(e))return Array.prototype.concat.call([],e);const s={};for(const t in e)s[t]=e[t];return s}return de(e,pe(e[t[0]],Array.prototype.slice.call(t,1)),[t[0]])}function me(e,t){return t.map(e=>e.split(".")).map(t=>[t,ue(e,t)]).filter(e=>void 0!==e[1]).reduce((e,t)=>de(e,t[1],t[0]),{})}function ve(e,t){return t.map(e=>e.split(".")).reduce((e,t)=>pe(e,t),e)}function he(e,{storage:t,serializer:s,key:a,debug:i,pick:n,omit:r,beforeHydrate:o,afterHydrate:l},c,u=!0){try{u&&(null==o||o(c));const i=t.getItem(a);if(i){const t=s.deserialize(i),a=n?me(t,n):t,o=r?ve(a,r):a;e.$patch(o)}u&&(null==l||l(c))}catch(d){}}function fe(e,{storage:t,serializer:s,key:a,debug:i,pick:n,omit:r}){try{const i=n?me(e,n):e,o=r?ve(i,r):i,l=s.serialize(o);t.setItem(a,l)}catch(o){}}var ge=function(e={}){return function(t){!function(e,t,s){const{pinia:a,store:i,options:{persist:n=s}}=e;if(!n)return;if(!(i.$id in a.state.value)){const e=a._s.get(i.$id.replace("__hot:",""));return void(e&&Promise.resolve().then(()=>e.$persist()))}const r=(Array.isArray(n)?n:!0===n?[{}]:[n]).map(t);i.$hydrate=({runHooks:t=!0}={})=>{r.forEach(s=>{he(i,s,e,t)})},i.$persist=()=>{r.forEach(e=>{fe(i.$state,e)})},r.forEach(t=>{he(i,t,e),i.$subscribe((e,s)=>fe(s,t),{detached:!0})})}(t,s=>({key:(e.key?e.key:e=>e)(s.key??t.store.$id),debug:s.debug??e.debug??!1,serializer:s.serializer??e.serializer??{serialize:e=>JSON.stringify(e),deserialize:e=>function(e,t={}){if("string"!=typeof e)return e;if('"'===e[0]&&'"'===e[e.length-1]&&-1===e.indexOf("\\"))return e.slice(1,-1);const s=e.trim();if(s.length<=9)switch(s.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!le.test(e)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(re.test(e)||oe.test(e)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,ce)}return JSON.parse(e)}catch(a){if(t.strict)throw a;return e}}(e)},storage:s.storage??e.storage??window.localStorage,beforeHydrate:s.beforeHydrate,afterHydrate:s.afterHydrate,pick:s.pick,omit:s.omit}),e.auto??!1)}}();const ye=W.create({baseURL:"",headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:3e5});ye.interceptors.request.use(e=>{const t=G0();return t.user&&t.user.token&&(e.headers.Authorization=`Bearer ${t.user.token}`),e});const be={auth:{login:(e,t)=>ye.post("/api/v1/auth/login",{email:e,password:t}),register:e=>ye.post("/api/v1/auth/register",e),logout:()=>ye.post("/api/v1/auth/logout"),refreshToken:()=>ye.post("/api/v1/auth/refresh"),getAuthUser:()=>ye.get("/api/v1/auth/user"),me:()=>ye.get("/api/v1/auth/check"),forgotPassword:e=>ye.post("/api/v1/auth/forgot-password",{email:e}),resetPassword:(e,t,s)=>ye.post("/api/v1/auth/reset-password",{token:e,password:t,password_confirmation:s})},realtime:{getToken:()=>ye.get("/api/v1/realtime/token")},admin:{product:{list:e=>ye.get("/api/v1/admin/products",{params:e}),get:e=>ye.get(`/api/v1/admin/products/${e}`),create:e=>ye.post("/api/v1/admin/products",e),update:(e,t)=>ye.put(`/api/v1/admin/products/${e}`,t),delete:e=>ye.delete(`/api/v1/admin/products/${e}`),search:e=>ye.get("/api/v1/admin/products/search",{params:{q:e}}),import:e=>ye.post("/api/v1/admin/products/import",e),export:e=>ye.get("/api/v1/admin/products/export",{params:e})},productGroup:{list:e=>ye.get("/api/v1/admin/product-groups",{params:e}),get:e=>ye.get(`/api/v1/admin/product-groups/${e}`),create:e=>ye.post("/api/v1/admin/product-groups",e),update:(e,t)=>ye.put(`/api/v1/admin/product-groups/${e}`,t),delete:e=>ye.delete(`/api/v1/admin/product-groups/${e}`),getProducts:e=>ye.get(`/api/v1/admin/product-groups/${e}/products`)},productDraft:{list:e=>ye.get("/api/v1/admin/product-drafts",{params:e}),get:e=>ye.get(`/api/v1/admin/product-drafts/${e}`),getLatest:()=>ye.get("/api/v1/admin/product-drafts/latest"),create:e=>ye.post("/api/v1/admin/product-drafts",e),update:(e,t)=>ye.put(`/api/v1/admin/product-drafts/${e}`,t),delete:e=>ye.delete(`/api/v1/admin/product-drafts/${e}`),publish:e=>ye.post(`/api/v1/admin/product-drafts/${e}/publish`)},productModule:{getConfigOptions:()=>ye.get("/api/v1/admin/product-modules/config-options"),getModulePlans:()=>ye.get("/api/v1/admin/product-modules/plans"),testConnection:e=>ye.post("/api/v1/admin/product-modules/test-connection",e)},client:{list:e=>ye.get("/api/v1/admin/clients",{params:e}),get:e=>ye.get(`/api/v1/admin/clients/${e}`),create:e=>ye.post("/api/v1/admin/clients",e),update:(e,t)=>ye.put(`/api/v1/admin/clients/${e}`,t),delete:e=>ye.delete(`/api/v1/admin/clients/${e}`)},service:{list:e=>ye.get("/api/v1/admin/services",{params:e}),get:e=>ye.get(`/api/v1/admin/services/${e}`),create:e=>ye.post("/api/v1/admin/services",e),update:(e,t)=>ye.put(`/api/v1/admin/services/${e}`,t),delete:e=>ye.delete(`/api/v1/admin/services/${e}`),changeStatus:(e,t)=>{const s="string"==typeof t?{status:t}:t;return ye.put(`/api/v1/admin/services/${e}/status`,s)},getStats:()=>ye.get("/api/v1/admin/services/stats"),getClientServices:e=>ye.get(`/api/v1/admin/clients/${e}/services`),provision:(e,t)=>ye.post(`/api/v1/admin/services/${e}/provision`,t),changePassword:(e,t)=>ye.post(`/api/v1/admin/services/${e}/password`,t),checkStatus:e=>ye.get(`/api/v1/admin/services/${e}/status`)},invoice:{list:e=>ye.get("/api/v1/admin/invoices",{params:e}),get:e=>ye.get(`/api/v1/admin/invoices/${e}`),create:e=>ye.post("/api/v1/admin/invoices",e),update:(e,t)=>ye.put(`/api/v1/admin/invoices/${e}`,t),delete:e=>ye.delete(`/api/v1/admin/invoices/${e}`),markAsPaid:(e,t={})=>ye.put(`/api/v1/admin/invoices/${e}/mark-paid`,t)},payment:{list:(e={})=>ye.get("/api/v1/admin/payments",{params:e}),get:e=>ye.get(`/api/v1/admin/payments/${e}`),create:e=>ye.post("/api/v1/admin/payments",e),update:(e,t)=>ye.put(`/api/v1/admin/payments/${e}`,t),delete:e=>ye.delete(`/api/v1/admin/payments/${e}`),refund:(e,t="")=>ye.post(`/api/v1/admin/payments/${e}/refund`,{reason:t})},subscription:{list:e=>ye.get("/api/v1/admin/subscriptions",{params:e}),get:e=>ye.get(`/api/v1/admin/subscriptions/${e}`),getByClient:e=>ye.get(`/api/v1/admin/subscriptions/client/${e}`),getByStatus:e=>ye.get(`/api/v1/admin/subscriptions/status/${e}`),create:e=>ye.post("/api/v1/admin/subscriptions",e),update:(e,t)=>ye.put(`/api/v1/admin/subscriptions/${e}`,t),delete:e=>ye.delete(`/api/v1/admin/subscriptions/${e}`),cancel:(e,t="")=>ye.post(`/api/v1/admin/subscriptions/${e}/cancel`,t?{reason:t}:{}),renew:e=>ye.post(`/api/v1/admin/subscriptions/${e}/renew`)},ticket:{list:e=>ye.get("/api/v1/admin/tickets",{params:e}),get:(e,t)=>ye.get(`/api/v1/admin/tickets/${e}`,{params:t}),getByStatus:e=>ye.get(`/api/v1/admin/tickets/status/${e}`),getByPriority:e=>ye.get(`/api/v1/admin/tickets/priority/${e}`),getByDepartment:e=>ye.get(`/api/v1/admin/tickets/department/${e}`),getByAssignee:e=>ye.get(`/api/v1/admin/tickets/assigned/${e}`),create:e=>ye.post("/api/v1/admin/tickets",e),update:(e,t)=>ye.put(`/api/v1/admin/tickets/${e}`,t),delete:e=>ye.delete(`/api/v1/admin/tickets/${e}`),addReply:(e,t)=>ye.post(`/api/v1/admin/tickets/${e}/replies`,t),close:e=>ye.post(`/api/v1/admin/tickets/${e}/close`),reopen:e=>ye.post(`/api/v1/admin/tickets/${e}/reopen`),departments:{list:()=>ye.get("/api/v1/admin/ticket-departments"),get:e=>ye.get(`/api/v1/admin/ticket-departments/${e}`),create:e=>ye.post("/api/v1/admin/ticket-departments",e),update:(e,t)=>ye.put(`/api/v1/admin/ticket-departments/${e}`,t),delete:e=>ye.delete(`/api/v1/admin/ticket-departments/${e}`)},assignments:{assign:(e,t)=>ye.post(`/api/v1/admin/tickets/${e}/assign`,t),unassign:e=>ye.post(`/api/v1/admin/tickets/${e}/unassign`),getTicketAssignments:e=>ye.get(`/api/v1/admin/tickets/${e}/assignments`),getAdminAssignments:e=>ye.get(`/api/v1/admins/${e}/assigned-tickets`)}},admins:{list:e=>ye.get("/api/v1/admins",{params:e}),get:e=>ye.get(`/api/v1/admins/${e}`),create:e=>ye.post("/api/v1/admins",e),update:(e,t)=>ye.put(`/api/v1/admins/${e}`,t),delete:e=>ye.delete(`/api/v1/admins/${e}`)},system:{dashboard:{getStats:()=>ye.get("/api/v1/admin/dashboard/stats"),getActivity:()=>ye.get("/api/v1/admin/dashboard/activity"),getRevenue:()=>ye.get("/api/v1/admin/dashboard/revenue")},settings:{getGeneralSettings:()=>ye.get("/api/v1/admin/settings/general"),updateGeneralSettings:e=>ye.post("/api/v1/admin/settings/general",e),getSecuritySettings:()=>ye.get("/api/v1/admin/settings/security"),updateSecuritySettings:e=>ye.post("/api/v1/admin/settings/security",e),getBillingSettings:()=>ye.get("/api/v1/admin/settings/billing"),updateBillingSettings:e=>ye.post("/api/v1/admin/settings/billing",e),getIntegrationSettings:()=>ye.get("/api/v1/admin/settings/integration"),updateIntegrationSettings:e=>ye.post("/api/v1/admin/settings/integration",e),getNotificationSettings:()=>ye.get("/api/v1/admin/settings/notifications"),updateNotificationSettings:e=>ye.post("/api/v1/admin/settings/notifications",e),getLicense:()=>ye.get("/api/v1/admin/settings/license"),updateLicense:e=>ye.post("/api/v1/admin/settings/license",e),testSmtpConnection:()=>ye.post("/api/v1/admin/settings/integrations/smtp/test"),testEmailNotification:()=>ye.post("/api/v1/admin/settings/notifications/test-email"),generateApiKey:()=>ye.post("/api/v1/admin/settings/security/api-keys"),deleteApiKey:e=>ye.delete(`/api/v1/admin/settings/security/api-keys/${e}`),listWebhooks:()=>ye.get("/api/v1/admin/settings/webhooks"),createWebhook:e=>ye.post("/api/v1/admin/settings/webhooks",e),updateWebhook:(e,t)=>ye.put(`/api/v1/admin/settings/webhooks/${e}`,t),deleteWebhook:e=>ye.delete(`/api/v1/admin/settings/webhooks/${e}`),testWebhook:e=>ye.post(`/api/v1/admin/settings/webhooks/${e}/test`),toggleWebhookStatus:(e,t)=>ye.patch(`/api/v1/admin/settings/webhooks/${e}/status`,{active:t}),getAutomationSettings:e=>ye.get("/api/v1/admin/settings/automation",{params:e?{group:e}:void 0}),updateAutomationSettings:(e,t)=>ye.post("/api/v1/admin/settings/automation",e,{params:t?{group:t}:void 0})},license:{getLicenseInfo:()=>ye.get("/api/v1/admin/settings/license"),activateLicense:e=>ye.post("/api/v1/admin/settings/license/activate",{licenseKey:e}),checkLicense:()=>ye.get("/api/v1/admin/license/check")},notifications:{list:()=>ye.get("/api/v1/admin/notifications"),markAsRead:e=>ye.post("/api/v1/admin/notifications/read",e),delete:e=>ye.delete(`/api/v1/admin/notifications/${e}`)},automation:{getCronJobs:()=>ye.get("/api/v1/admin/cron-jobs"),getCronJobLogs:e=>ye.get(`/api/v1/admin/cron-jobs/${e}/logs`),runCronJob:e=>ye.post(`/api/v1/admin/cron-jobs/${e}/run`),toggleCronJob:e=>ye.post(`/api/v1/admin/cron-jobs/${e}/toggle`),getSettings:()=>ye.get("/api/v1/admin/settings/automation"),saveSettings:e=>ye.post("/api/v1/admin/settings/automation",e),getCronStatus:()=>ye.get("/api/v1/admin/settings/cron-status")},users:{list:()=>ye.get("/api/v1/admin/users"),get:e=>ye.get(`/api/v1/admin/users/${e}`),create:e=>ye.post("/api/v1/admin/users",e),update:(e,t)=>ye.put(`/api/v1/admin/users/${e}`,t),delete:e=>ye.delete(`/api/v1/admin/users/${e}`),getRoles:()=>ye.get("/api/v1/admin/users/roles"),assignRole:(e,t)=>ye.post(`/api/v1/admin/users/${e}/roles`,t)},server:{list:()=>ye.get("/api/v1/admin/settings/servers"),get:e=>ye.get(`/api/v1/admin/servers/${e}`),create:e=>ye.post("/api/v1/admin/settings/servers",e),update:(e,t)=>ye.put(`/api/v1/admin/settings/servers/${e}`,t),delete:e=>ye.delete(`/api/v1/admin/settings/servers/${e}`),test:e=>ye.post(`/api/v1/admin/settings/servers/${e}/test`),testNew:e=>ye.post("/api/v1/admin/settings/servers/test",e),getStats:e=>ye.get(`/api/v1/admin/settings/servers/${e}/stats`),getPlans:e=>ye.get(`/api/v1/admin/settings/servers/${e}/plans`),getVirtualizorOptions:e=>ye.get(`/api/v1/admin/settings/servers/${e}/virtualizor-options`),getProxmoxOptions:e=>ye.get(`/api/v1/admin/settings/servers/${e}/proxmox-options`)},module:{list:(e="all")=>ye.get(`/api/v1/admin/modules?type=${e}`),getDetails:(e,t)=>ye.get(`/api/v1/admin/modules/details?type=${e}&name=${t}`),getProductConfigFields:(e,t)=>ye.get(`/api/v1/admin/modules/product-config-fields?type=${e}&name=${t}`),getTemplates:(e,t)=>ye.get(`/api/v1/admin/modules/templates?type=${e}&name=${t}`),validateProductConfig:e=>ye.post("/api/v1/admin/modules/validate-product-config",e),test:e=>ye.post("/api/v1/admin/modules/test",e),activate:e=>ye.post("/api/v1/admin/modules/activate",e),deactivate:e=>ye.post("/api/v1/admin/modules/deactivate",e),updateConfig:e=>ye.post("/api/v1/admin/modules/config",e)},updates:{check:()=>ye.get("/api/v1/admin/updates/check"),download:e=>ye.post("/api/v1/admin/updates/download",e),install:e=>ye.post("/api/v1/admin/updates/install",e),rollback:e=>ye.post("/api/v1/admin/updates/rollback",e),checkRequirements:()=>ye.get("/api/v1/admin/updates/requirements"),listBackups:()=>ye.get("/api/v1/admin/updates/backups"),history:e=>ye.get("/api/v1/admin/updates/history",{params:e}),getSettings:()=>ye.get("/api/v1/admin/updates/settings"),updateSettings:e=>ye.put("/api/v1/admin/updates/settings",e),validateToken:e=>ye.post("/api/v1/admin/updates/validate-token",e),cleanup:e=>ye.post("/api/v1/admin/updates/cleanup",e||{})}}}},_e={get client(){return ye},routes:be,setAuthToken(e){e?ye.defaults.headers.common.Authorization=`Bearer ${e}`:delete ye.defaults.headers.common.Authorization},setLanguage(e){ye.defaults.headers.common["Accept-Language"]=e}},ke=W.create({baseURL:"",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},withCredentials:!0});ke.interceptors.request.use(e=>{var t;return ne.debug("[AXIOS] Requête sortante",{method:null==(t=e.method)?void 0:t.toUpperCase(),url:e.url}),e.url&&(e.url=e.url.replace(/([^:]\/)\/+/g,"$1")),e},e=>(ne.error("[AXIOS] Erreur de requête",{error:e}),Promise.reject(e)));let we=!1;ke.interceptors.response.use(e=>(ne.debug("[AXIOS] Réponse reçue",{status:e.status,url:e.config.url}),e),async e=>{var t,s,a,i,n;ne.error("[AXIOS] Erreur de réponse",{status:null==(t=e.response)?void 0:t.status,url:e.config.url,error:e});const r=G0();return 401===(null==(s=e.response)?void 0:s.status)&&(ne.warn("[AXIOS] Erreur 401 détectée",{url:e.config.url}),(null==(a=e.config.url)?void 0:a.includes("/auth/check"))||(null==(i=e.config.url)?void 0:i.includes("/auth/login"))||(null==(n=e.config.url)?void 0:n.includes("/auth/logout"))||we||(ne.info("[AXIOS] Déconnexion requise"),we=!0,await r.logout(),we=!1,F0.push("/login"))),Promise.reject(e)});var Se,Ee={exports:{}};
/*@license Copyright 2015-2022 Ably Real-time Ltd (ably.com)

Ably JavaScript Library v2.9.0
https://github.com/ably/ably-js

Released under the Apache Licence v2.0*/var Ce=Se?Ee.exports:(Se=1,Ee.exports=(()=>{var e,t={},s={exports:t},a=Object.defineProperty,i=Object.defineProperties,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,d=(e,t,s)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,p=(e,t)=>{for(var s in t||(t={}))c.call(t,s)&&d(e,s,t[s]);if(l)for(var s of l(t))u.call(t,s)&&d(e,s,t[s]);return e},m=(e,t)=>i(e,r(t)),v=(e,t)=>{for(var s in t)a(e,s,{get:t[s],enumerable:!0})},h={};v(h,{ErrorInfo:()=>E,Realtime:()=>sa,Rest:()=>Cs,default:()=>Za,makeProtocolMessageFromDeserialized:()=>ps,msgpack:()=>Ya}),s.exports=(e=h,((e,t,s,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of o(t))c.call(e,r)||r===s||a(e,r,{get:()=>t[r],enumerable:!(i=n(t,r))||i.enumerable});return e})(a({},"__esModule",{value:!0}),e));var f=class{},g=void 0!==z?z:"undefined"!=typeof window?window:self;function y(e,t){return`${e}`.padStart(t?3:2,"0")}function b(e){return f.Config.logTimestamps?function(t){const s=new Date;e(y(s.getHours())+":"+y(s.getMinutes())+":"+y(s.getSeconds())+"."+y(s.getMilliseconds(),1)+" "+t)}:function(t){e(t)}}var _=class e{constructor(){this.deprecated=(e,t)=>{this.deprecationWarning(`${e} is deprecated and will be removed in a future version. ${t}`)},this.shouldLog=e=>e<=this.logLevel,this.setLog=(e,t)=>{void 0!==e&&(this.logLevel=e),void 0!==t&&(this.logHandler=this.logErrorHandler=t)},this.logLevel=e.defaultLogLevel,this.logHandler=e.defaultLogHandler,this.logErrorHandler=e.defaultLogErrorHandler}static initLogHandlers(){const[t,s]=(()=>{var e;let t,s;return"function"==typeof(null==(e=null==g?void 0:g.console)?void 0:e.log)?(t=function(...e){},s=console.warn?function(...e){}:t):t=s=function(){},[t,s].map(b)})();this.defaultLogHandler=t,this.defaultLogErrorHandler=s,this.defaultLogger=new e}static logActionNoStrip(e,t,s,a){e.logAction(t,s,a)}logAction(e,t,s){this.shouldLog(e)&&(1===e?this.logErrorHandler:this.logHandler)("Ably: "+t+": "+s,e)}renamedClientOption(e,t){this.deprecationWarning(`The \`${e}\` client option has been renamed to \`${t}\`. Please update your code to use \`${t}\` instead. \`${e}\` will be removed in a future version.`)}renamedMethod(e,t,s){this.deprecationWarning(`\`${e}\`’s \`${t}\` method has been renamed to \`${s}\`. Please update your code to use \`${s}\` instead. \`${t}\` will be removed in a future version.`)}deprecationWarning(e){this.shouldLog(1)&&this.logErrorHandler(`Ably: Deprecation warning - ${e}`,1)}};_.defaultLogLevel=1,_.LOG_NONE=0,_.LOG_ERROR=1,_.LOG_MAJOR=2,_.LOG_MINOR=3,_.LOG_MICRO=4,_.logAction=(e,t,s,a)=>{_.logActionNoStrip(e,t,s,a)};var k=_,w={};function S(e){let t="["+e.constructor.name;return e.message&&(t+=": "+e.message),e.statusCode&&(t+="; statusCode="+e.statusCode),e.code&&(t+="; code="+e.code),e.cause&&(t+="; cause="+X(e.cause)),!e.href||e.message&&e.message.indexOf("help.ably.io")>-1||(t+="; see "+e.href+" "),t+="]",t}v(w,{Format:()=>H,allSame:()=>B,allToLowerCase:()=>re,allToUpperCase:()=>oe,arrChooseN:()=>se,arrDeleteValue:()=>V,arrEquals:()=>he,arrIntersect:()=>U,arrIntersectOb:()=>q,arrPopRandomElement:()=>W,arrWithoutValue:()=>$,cheapRandStr:()=>ee,containsValue:()=>D,copy:()=>A,createMissingPluginError:()=>fe,dataSizeBytes:()=>Z,decodeBody:()=>ie,encodeBody:()=>ne,ensureArray:()=>I,forInOwnNonNullProperties:()=>G,getBackoffCoefficient:()=>le,getGlobalObject:()=>de,getJitterCoefficient:()=>ce,getRetryTime:()=>ue,inherits:()=>M,inspectBody:()=>Q,inspectError:()=>X,intersect:()=>L,isEmpty:()=>x,isErrorInfoOrPartialErrorInfo:()=>Y,isNil:()=>O,isObject:()=>R,keysArray:()=>j,matchDerivedChannel:()=>me,mixin:()=>T,parseQueryString:()=>J,prototypicalClone:()=>N,randomString:()=>te,shallowClone:()=>P,shallowEquals:()=>pe,throwMissingPluginError:()=>ge,toBase64:()=>ve,toQueryString:()=>K,valuesArray:()=>F,whenPromiseSettles:()=>ae,withTimeoutAsync:()=>ye});var E=class e extends Error{constructor(t,s,a,i){super(t),void 0!==Object.setPrototypeOf&&Object.setPrototypeOf(this,e.prototype),this.code=s,this.statusCode=a,this.cause=i}toString(){return S(this)}static fromValues(t){const{message:s,code:a,statusCode:i}=t;if("string"!=typeof s||"number"!=typeof a||"number"!=typeof i)throw new Error("ErrorInfo.fromValues(): invalid values: "+f.Config.inspect(t));const n=Object.assign(new e(s,a,i),t);return n.code&&!n.href&&(n.href="https://help.ably.io/error/"+n.code),n}},C=class e extends Error{constructor(t,s,a,i){super(t),void 0!==Object.setPrototypeOf&&Object.setPrototypeOf(this,e.prototype),this.code=s,this.statusCode=a,this.cause=i}toString(){return S(this)}static fromValues(t){const{message:s,code:a,statusCode:i}=t;if("string"!=typeof s||!O(a)&&"number"!=typeof a||!O(i)&&"number"!=typeof i)throw new Error("PartialErrorInfo.fromValues(): invalid values: "+f.Config.inspect(t));const n=Object.assign(new e(s,a,i),t);return n.code&&!n.href&&(n.href="https://help.ably.io/error/"+n.code),n}};function T(e,...t){for(let s=0;s<t.length;s++){const a=t[s];if(!a)break;for(const t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e}function A(e){return T({},e)}function I(e){return O(e)?[]:Array.isArray(e)?e:[e]}function R(e){return"[object Object]"==Object.prototype.toString.call(e)}function x(e){for(const t in e)return!1;return!0}function O(e){return null==e}function P(e){const t=new Object;for(const s in e)t[s]=e[s];return t}function N(e,t){class s{}s.prototype=e;const a=new s;return t&&T(a,t),a}var M=function(e,t){f.Config.inherits?f.Config.inherits(e,t):(e.super_=t,e.prototype=N(t.prototype,{constructor:e}))};function D(e,t){for(const s in e)if(e[s]==t)return!0;return!1}function L(e,t){return Array.isArray(t)?U(e,t):q(e,t)}function U(e,t){const s=[];for(let a=0;a<e.length;a++){const i=e[a];-1!=t.indexOf(i)&&s.push(i)}return s}function q(e,t){const s=[];for(let a=0;a<e.length;a++){const i=e[a];i in t&&s.push(i)}return s}function V(e,t){const s=e.indexOf(t),a=-1!=s;return a&&e.splice(s,1),a}function $(e,t){const s=e.slice();return V(s,t),s}function j(e,t){const s=[];for(const a in e)t&&!Object.prototype.hasOwnProperty.call(e,a)||s.push(a);return s}function F(e,t){const s=[];for(const a in e)t&&!Object.prototype.hasOwnProperty.call(e,a)||s.push(e[a]);return s}function G(e,t){for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&e[s]&&t(s)}function B(e,t){if(0===e.length)return!0;const s=e[0][t];return e.every(function(e){return e[t]===s})}var H=(e=>(e.msgpack="msgpack",e.json="json",e))(H||{});function W(e){return e.splice((t=e,Math.floor(Math.random()*t.length)),1)[0];var t}function K(e){const t=[];if(e)for(const s in e)t.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t.length?"?"+t.join("&"):""}function J(e){let t;const s=/([^?&=]+)=?([^&]*)/g,a={};for(;t=s.exec(e);)a[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return a}function Y(e){return"object"==typeof e&&null!==e&&(e instanceof E||e instanceof C)}function X(e){var t,s;return e instanceof Error||"ErrorInfo"===(null==(t=null==e?void 0:e.constructor)?void 0:t.name)||"PartialErrorInfo"===(null==(s=null==e?void 0:e.constructor)?void 0:s.name)?e.toString():f.Config.inspect(e)}function Q(e){return f.BufferUtils.isBuffer(e)?e.toString():"string"==typeof e?e:f.Config.inspect(e)}function Z(e){if(f.BufferUtils.isBuffer(e))return f.BufferUtils.byteLength(e);if("string"==typeof e)return f.Config.stringByteSize(e);if("number"==typeof e)return 8;if("boolean"==typeof e)return 1;throw new Error("Expected input of Utils.dataSizeBytes to be a string, a number, a boolean or a buffer, but was: "+typeof e)}function ee(){return String(Math.random()).substr(2)}var te=async e=>{const t=await f.Config.getRandomArrayBuffer(e);return f.BufferUtils.base64Encode(t)};function se(e,t){const s=Math.min(t,e.length),a=e.slice(),i=[];for(let n=0;n<s;n++)i.push(W(a));return i}function ae(e,t){e.then(e=>{null==t||t(null,e)}).catch(e=>{null==t||t(e)})}function ie(e,t,s){return"msgpack"==s?(t||ge("MsgPack"),t.decode(e)):JSON.parse(String(e))}function ne(e,t,s){return"msgpack"==s?(t||ge("MsgPack"),t.encode(e,!0)):JSON.stringify(e)}function re(e){return e.map(function(e){return e&&e.toLowerCase()})}function oe(e){return e.map(function(e){return e&&e.toUpperCase()})}function le(e){return Math.min((e+2)/3,2)}function ce(){return 1-.2*Math.random()}function ue(e,t){return e*le(t)*ce()}function de(){return void 0!==z?z:"undefined"!=typeof window?window:self}function pe(e,t){return Object.keys(e).every(s=>e[s]===t[s])&&Object.keys(t).every(s=>t[s]===e[s])}function me(e){const t=e.match(/^(\[([^?]*)(?:(.*))\])?(.+)$/);if(!t||!t.length||t.length<5)throw new E("regex match failed",400,40010);if(t[2])throw new E(`cannot use a derived option with a ${t[2]} channel`,400,40010);return{qualifierParam:t[3]||"",channelName:t[4]}}function ve(e){const t=f.BufferUtils,s=t.utf8Encode(e);return t.base64Encode(s)}function he(e,t){return e.length===t.length&&e.every(function(e,s){return e===t[s]})}function fe(e){return new E(`${e} plugin not provided`,40019,400)}function ge(e){throw fe(e)}async function ye(e,t=5e3,s="Timeout expired"){const a=new E(s,5e4,500);return Promise.race([e,new Promise((e,s)=>setTimeout(()=>s(a),t))])}var be="2.9.0",_e={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:1e4,httpMaxRetryDuration:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,webSocketConnectTimeout:1e4,webSocketSlowTimeout:4e3},httpMaxRetryCount:3,maxMessageSize:65536,version:be,protocolVersion:3,agent:"ably-js/"+be,getHost:ke,getPort:function(e,t){return t||e.tls?e.tlsPort:e.port},getHttpScheme:function(e){return e.tls?"https://":"http://"},environmentFallbackHosts:we,getFallbackHosts:Se,getHosts:function(e,t){const s=[e.restHost].concat(Se(e));return t?s.map(t=>ke(e,t,!0)):s},checkHost:Ee,objectifyOptions:function(e,t,s,a,i){if(void 0===e){const e=t?`${s} must be initialized with either a client options object, an Ably API key, or an Ably Token`:`${s} must be initialized with a client options object`;throw k.logAction(a,k.LOG_ERROR,`${s}()`,e),new Error(e)}let n;if("string"==typeof e)if(-1==e.indexOf(":")){if(!t){const e=`${s} cannot be initialized with just an Ably Token; you must provide a client options object with a \`plugins\` property. (Set this Ably Token as the object’s \`token\` property.)`;throw k.logAction(a,k.LOG_ERROR,`${s}()`,e),new Error(e)}n={token:e}}else{if(!t){const e=`${s} cannot be initialized with just an Ably API key; you must provide a client options object with a \`plugins\` property. (Set this Ably API key as the object’s \`key\` property.)`;throw k.logAction(a,k.LOG_ERROR,`${s}()`,e),new Error(e)}n={key:e}}else n=e;return i&&(n=m(p({},n),{plugins:p(p({},i),n.plugins)})),n},normaliseOptions:function(e,t,s){const a=null!=s?s:k.defaultLogger;"function"==typeof e.recover&&!0===e.closeOnUnload&&(k.logAction(a,k.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),e.recover=void 0),"closeOnUnload"in e||(e.closeOnUnload=!e.recover),"queueMessages"in e||(e.queueMessages=!0);const i=e.environment&&String(e.environment).toLowerCase()||_e.ENVIRONMENT,n=!i||"production"===i;e.fallbackHosts||e.restHost||e.realtimeHost||e.port||e.tlsPort||(e.fallbackHosts=n?_e.FALLBACK_HOSTS:we(i));const r=e.restHost||(n?_e.REST_HOST:i+"-"+_e.REST_HOST),o=function(e,t,s,a){return e.realtimeHost?e.realtimeHost:e.restHost?(k.logAction(a,k.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+e.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+e.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),e.restHost):t?_e.REALTIME_HOST:s+"-"+_e.REALTIME_HOST}(e,n,i,a);(e.fallbackHosts||[]).concat(r,o).forEach(Ee),e.port=e.port||_e.PORT,e.tlsPort=e.tlsPort||_e.TLS_PORT,"tls"in e||(e.tls=!0);const l=function(e){const t={};for(const s in _e.TIMEOUTS)t[s]=e[s]||_e.TIMEOUTS[s];return t}(e);e.useBinaryProtocol=!!t&&("useBinaryProtocol"in e?f.Config.supportsBinary&&e.useBinaryProtocol:f.Config.preferBinary);const c={};e.clientId&&(c["X-Ably-ClientId"]=f.BufferUtils.base64Encode(f.BufferUtils.utf8Encode(e.clientId))),"idempotentRestPublishing"in e||(e.idempotentRestPublishing=!0);let u=null,d=e.connectivityCheckUrl;if(e.connectivityCheckUrl){let[t,s]=e.connectivityCheckUrl.split("?");u=s?J(s):{},-1===t.indexOf("://")&&(t="https://"+t),d=t}let v=e.wsConnectivityCheckUrl;return v&&-1===v.indexOf("://")&&(v="wss://"+v),m(p({},e),{realtimeHost:o,restHost:r,maxMessageSize:e.maxMessageSize||_e.maxMessageSize,timeouts:l,connectivityCheckParams:u,connectivityCheckUrl:d,wsConnectivityCheckUrl:v,headers:c})},defaultGetHeaders:function(e,{format:t=Ie.format,protocolVersion:s=Ie.protocolVersion}={}){return{accept:Ae[t],"X-Ably-Version":s.toString(),"Ably-Agent":Ce(e)}},defaultPostHeaders:function(e,{format:t=Ie.format,protocolVersion:s=Ie.protocolVersion}={}){let a;return{accept:a=Ae[t],"content-type":a,"X-Ably-Version":s.toString(),"Ably-Agent":Ce(e)}}};function ke(e,t,s){return t=s?t==e.restHost&&e.realtimeHost||t||e.realtimeHost:t||e.restHost}function we(e){return[e+"-a-fallback.ably-realtime.com",e+"-b-fallback.ably-realtime.com",e+"-c-fallback.ably-realtime.com",e+"-d-fallback.ably-realtime.com",e+"-e-fallback.ably-realtime.com"]}function Se(e){const t=e.fallbackHosts,s=void 0!==e.httpMaxRetryCount?e.httpMaxRetryCount:_e.httpMaxRetryCount;return t?se(t,s):[]}function Ee(e){if("string"!=typeof e)throw new E("host must be a string; was a "+typeof e,4e4,400);if(!e.length)throw new E("host must not be zero-length",4e4,400)}function Ce(e){let t=_e.agent;if(e.agents)for(var s in e.agents)t+=" "+s+"/"+e.agents[s];return t}function Te(e,t,s){const a=s||{};if(a.cipher){e||ge("Crypto");const s=e.getCipher(a.cipher,t);a.cipher=s.cipherParams,a.channelCipher=s.cipher}else"cipher"in a&&(a.cipher=void 0,a.channelCipher=null);return a}var Ae={json:"application/json",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack",text:"text/plain"},Ie={format:"json",protocolVersion:_e.protocolVersion},Re=_e,xe=class e{constructor(e,t){this.logger=e,this.members=t||[]}call(e,t){for(const a of this.members)if(a)try{a(e,t)}catch(s){k.logAction(this.logger,k.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+s+"; stack = "+s.stack)}}push(...e){this.members.push(...e)}createPromise(){return new Promise((e,t)=>{this.push((s,a)=>{s?t(s):e(a)})})}resolveAll(e){this.call(null,e)}rejectAll(e){this.call(e)}static create(t,s){const a=new e(t,s);return Object.assign((e,t)=>a.call(e,t),{push:e=>a.push(e),createPromise:()=>a.createPromise(),resolveAll:e=>a.resolveAll(e),rejectAll:e=>a.rejectAll(e)})}},Oe=(e=>(e.Get="get",e.Delete="delete",e.Post="post",e.Put="put",e.Patch="patch",e))(Oe||{}),Pe=Oe,Ne=(e=>(e[e.Success=200]="Success",e[e.NoContent=204]="NoContent",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.Forbidden=403]="Forbidden",e[e.RequestTimeout=408]="RequestTimeout",e[e.InternalServerError=500]="InternalServerError",e))(Ne||{}),Me=Ne,De=Math.pow(2,17);function Le(e){return Y(e)?(e.code||(403===e.statusCode?e.code=40300:(e.code=40170,e.statusCode=401)),e):new E(X(e),e.code||40170,e.statusCode||401)}function Ue(e){if(!e)return"";"string"==typeof e&&(e=JSON.parse(e));const t=Object.create(null),s=j(e,!0);if(!s)return"";s.sort();for(let a=0;a<s.length;a++)t[s[a]]=e[s[a]].sort();return JSON.stringify(t)}function qe(e,t){if(e.authCallback)k.logAction(t,k.LOG_MINOR,"Auth()","using token auth with authCallback");else if(e.authUrl)k.logAction(t,k.LOG_MINOR,"Auth()","using token auth with authUrl");else if(e.key)k.logAction(t,k.LOG_MINOR,"Auth()","using token auth with client-side signing");else{if(!e.tokenDetails){const e="authOptions must include valid authentication parameters";throw k.logAction(t,k.LOG_ERROR,"Auth()",e),new Error(e)}k.logAction(t,k.LOG_MINOR,"Auth()","using token auth with supplied token only")}}function Ve(e){return e.useTokenAuth||!function(e){return"useTokenAuth"in e&&!e.useTokenAuth}(e)&&(e.authCallback||e.authUrl||e.token||e.tokenDetails)}var $e=0,je=class{constructor(e,t){if(this.authOptions={},this.client=e,this.tokenParams=t.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,Ve(t))(function(e){return!e.key&&!e.authCallback&&!e.authUrl})(t)&&k.logAction(this.logger,k.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(t.defaultTokenParams,t),qe(this.authOptions,this.logger);else{if(!t.key){const e="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw k.logAction(this.logger,k.LOG_ERROR,"Auth()",e),new E(e,40160,401)}k.logAction(this.logger,k.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(t)}}get logger(){return this.client.logger}async authorize(e,t){if(t&&t.key&&this.authOptions.key!==t.key)throw new E("Unable to update auth options with incompatible key",40102,401);try{let s=await this._forceNewToken(null!=e?e:null,null!=t?t:null);return this.client.connection?new Promise((e,t)=>{this.client.connection.connectionManager.onAuthUpdated(s,(s,a)=>s?t(s):e(a))}):s}catch(s){throw this.client.connection&&s.statusCode===Me.Forbidden&&this.client.connection.connectionManager.actOnErrorFromAuthorize(s),s}}async _forceNewToken(e,t){this.tokenDetails=null,this._saveTokenOptions(e,t),qe(this.authOptions,this.logger);try{return this._ensureValidAuthCredentials(!0)}finally{delete this.tokenParams.timestamp,delete this.authOptions.queryTime}}async requestToken(e,t){const s=t||this.authOptions,a=e||A(this.tokenParams);let i,n=this.client;if(s.authCallback)k.logAction(this.logger,k.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),i=s.authCallback;else if(s.authUrl)k.logAction(this.logger,k.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),i=(e,t)=>{const a=T({accept:"application/json, text/plain"},s.authHeaders),i=s.authMethod&&"post"===s.authMethod.toLowerCase();let n;const r=s.authUrl.indexOf("?");r>-1&&(n=J(s.authUrl.slice(r)),s.authUrl=s.authUrl.slice(0,r),i||(s.authParams=T(n,s.authParams)));const o=T({},s.authParams||{},e),l=e=>{var s,a;let i=null!=(s=e.body)?s:null,n=null;if(e.error)k.logAction(this.logger,k.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+X(e.error));else{const t=null!=(a=e.headers["content-type"])?a:null;n=Array.isArray(t)?t.join(", "):t,k.logAction(this.logger,k.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+n+"; body: "+Q(i))}if(e.error)return void t(e.error,null);if(e.unpacked)return void t(null,i);if(f.BufferUtils.isBuffer(i)&&(i=i.toString()),!n)return void t(new E("authUrl response is missing a content-type header",40170,401),null);const r=n.indexOf("application/json")>-1,o=n.indexOf("text/plain")>-1||n.indexOf("application/jwt")>-1;if(r||o){if(r){if(i.length>De)return void t(new E("authUrl response exceeded max permitted length",40170,401),null);try{i=JSON.parse(i)}catch(l){return void t(new E("Unexpected error processing authURL response; err = "+l.message,40170,401),null)}}t(null,i,n)}else t(new E("authUrl responded with unacceptable content-type "+n+", should be either text/plain, application/jwt or application/json",40170,401),null)};if(k.logAction(this.logger,k.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+s.authUrl+"; Params: "+JSON.stringify(o)+"; method: "+(i?"POST":"GET")),i){const e=a||{};e["content-type"]="application/x-www-form-urlencoded";const t=K(o).slice(1);ae(this.client.http.doUri(Pe.Post,s.authUrl,e,t,n),(e,t)=>l(e||t))}else ae(this.client.http.doUri(Pe.Get,s.authUrl,a||{},null,o),(e,t)=>l(e||t))};else{if(!s.key){const e="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";throw k.logAction(this.logger,k.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),new E(e,40171,403)}k.logAction(this.logger,k.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),i=(e,t)=>{ae(this.createTokenRequest(e,s),(e,s)=>t(e,null!=s?s:null))}}"capability"in a&&(a.capability=Ue(a.capability));const r=(e,t)=>{const a="/keys/"+e.keyName+"/requestToken",i=Re.defaultPostHeaders(this.client.options);s.requestHeaders&&T(i,s.requestHeaders),k.logAction(this.logger,k.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+a+"; Token params: "+JSON.stringify(e)),ae(this.client.http.do(Pe.Post,function(e){return n.baseUri(e)+a},i,JSON.stringify(e),null),(e,s)=>e?t(e):t(s.error,s.body,s.unpacked))};return new Promise((e,t)=>{let n=!1,o=this.client.options.timeouts.realtimeRequestTimeout,l=setTimeout(()=>{n=!0;const e="Token request callback timed out after "+o/1e3+" seconds";k.logAction(this.logger,k.LOG_ERROR,"Auth.requestToken()",e),t(new E(e,40170,401))},o);i(a,(a,i,o)=>{if(n)return;if(clearTimeout(l),a)return k.logAction(this.logger,k.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+X(a)),void t(Le(a));if("string"==typeof i)return void(0===i.length?t(new E("Token string is empty",40170,401)):i.length>De?t(new E("Token string exceeded max permitted length (was "+i.length+" bytes)",40170,401)):"undefined"===i||"null"===i?t(new E("Token string was literal null/undefined",40170,401)):"{"!==i[0]||o&&o.indexOf("application/jwt")>-1?e({token:i}):t(new E("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)));if("object"!=typeof i||null===i){const e="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof i;return k.logAction(this.logger,k.LOG_ERROR,"Auth.requestToken()",e),void t(new E(e,40170,401))}const c=JSON.stringify(i).length;if(c>De&&!s.suppressMaxLengthCheck)t(new E("Token request/details object exceeded max permitted stringified size (was "+c+" bytes)",40170,401));else if("issued"in i)e(i);else{if(!("keyName"in i)){const e="Expected token request callback to call back with a token string, token request object, or token details object";return k.logAction(this.logger,k.LOG_ERROR,"Auth.requestToken()",e),void t(new E(e,40170,401))}r(i,(s,a,i)=>{if(s)return k.logAction(this.logger,k.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+X(s)),void t(Le(s));i||(a=JSON.parse(a)),k.logAction(this.logger,k.LOG_MINOR,"Auth.getToken()","token received"),e(a)})}})})}async createTokenRequest(e,t){t=t||this.authOptions,e=e||A(this.tokenParams);const s=t.key;if(!s)throw new E("No key specified",40101,403);const a=s.split(":"),i=a[0],n=a[1];if(!n)throw new E("Invalid key specified",40101,403);if(""===e.clientId)throw new E("clientId can’t be an empty string",40012,400);"capability"in e&&(e.capability=Ue(e.capability));const r=T({keyName:i},e),o=e.clientId||"",l=e.ttl||"",c=e.capability||"";r.timestamp||(r.timestamp=await this._getTimestamp(t&&t.queryTime));const u=r.nonce||(r.nonce=("000000"+Math.floor(1e16*Math.random())).slice(-16)),d=r.timestamp,p=r.keyName+"\n"+l+"\n"+c+"\n"+o+"\n"+d+"\n"+u+"\n";return r.mac=r.mac||((e,t)=>{const s=f.BufferUtils,a=s.utf8Encode(e),i=s.utf8Encode(t),n=s.hmacSha256(a,i);return s.base64Encode(n)})(p,n),k.logAction(this.logger,k.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),r}async getAuthParams(){if("basic"==this.method)return{key:this.key};{let e=await this._ensureValidAuthCredentials(!1);if(!e)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");return{access_token:e.token}}}async getAuthHeaders(){if("basic"==this.method)return{authorization:"Basic "+this.basicKey};{const e=await this._ensureValidAuthCredentials(!1);if(!e)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");return{authorization:"Bearer "+ve(e.token)}}}_saveBasicOptions(e){this.method="basic",this.key=e.key,this.basicKey=ve(e.key),this.authOptions=e||{},"clientId"in e&&this._userSetClientId(e.clientId)}_saveTokenOptions(e,t){this.method="token",e&&(this.tokenParams=e),t&&(t.token&&(t.tokenDetails="string"==typeof t.token?{token:t.token}:t.token),t.tokenDetails&&(this.tokenDetails=t.tokenDetails),"clientId"in t&&this._userSetClientId(t.clientId),this.authOptions=t)}async _ensureValidAuthCredentials(e){const t=this.tokenDetails;if(t){if(this._tokenClientIdMismatch(t.clientId))throw new E("Mismatch between clientId in token ("+t.clientId+") and current clientId ("+this.clientId+")",40102,403);if(!this.client.isTimeOffsetSet()||!t.expires||t.expires>=this.client.getTimestampUsingOffset())return k.logAction(this.logger,k.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+t.expires),t;k.logAction(this.logger,k.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}const s=(this.waitingForTokenRequest||(this.waitingForTokenRequest=xe.create(this.logger))).createPromise();if(null!==this.currentTokenRequestId&&!e)return s;const a=this.currentTokenRequestId=$e++;let i,n=null;try{i=await this.requestToken(this.tokenParams,this.authOptions)}catch(o){n=o}if(this.currentTokenRequestId>a)return k.logAction(this.logger,k.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one"),s;this.currentTokenRequestId=null;const r=this.waitingForTokenRequest;return this.waitingForTokenRequest=null,n?(null==r||r.rejectAll(n),s):(null==r||r.resolveAll(this.tokenDetails=i),s)}_userSetClientId(e){if("string"!=typeof e&&null!==e)throw new E("clientId must be either a string or null",40012,400);if("*"===e)throw new E('Can’t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);{const t=this._uncheckedSetClientId(e);if(t)throw t}}_uncheckedSetClientId(e){if(this._tokenClientIdMismatch(e)){const t="Unexpected clientId mismatch: client has "+this.clientId+", requested "+e,s=new E(t,40102,401);return k.logAction(this.logger,k.LOG_ERROR,"Auth._uncheckedSetClientId()",t),s}return this.clientId=this.tokenParams.clientId=e,null}_tokenClientIdMismatch(e){return!(!this.clientId||"*"===this.clientId||!e||"*"===e||this.clientId===e)}static isTokenErr(e){return e.code&&e.code>=40140&&e.code<40150}revokeTokens(e,t){return this.client.rest.revokeTokens(e,t)}async _getTimestamp(e){return this.client.getTimestamp(e||!!this.authOptions.queryTime)}};function Fe(e){const t=[];if(e)for(const s in e)t.push(s+"="+e[s]);return t.join("&")}function Ge(e,t){return e+(t?"?":"")+Fe(t)}var Be=class{constructor(e){this.client=e,this.platformHttp=new f.Http(e),this.checkConnectivity=this.platformHttp.checkConnectivity?()=>this.platformHttp.checkConnectivity():void 0}get logger(){var e,t;return null!=(t=null==(e=this.client)?void 0:e.logger)?t:k.defaultLogger}get supportsAuthHeaders(){return this.platformHttp.supportsAuthHeaders}get supportsLinkHeaders(){return this.platformHttp.supportsLinkHeaders}_getHosts(e){const t=e.connection,s=t&&t.connectionManager.host;return s?[s].concat(Re.getFallbackHosts(e.options)):Re.getHosts(e.options)}async do(e,t,s,a,i){try{const n=this.client;if(!n)return{error:new E("http.do called without client",5e4,500)};const r="function"==typeof t?t:function(e){return n.baseUri(e)+t},o=n._currentFallback;if(o){if(o.validUntil>Date.now()){const l=await this.doUri(e,r(o.host),s,a,i);return l.error&&this.platformHttp.shouldFallback(l.error)?(n._currentFallback=null,this.do(e,t,s,a,i)):l}n._currentFallback=null}const l=this._getHosts(n);if(1===l.length)return this.doUri(e,r(l[0]),s,a,i);let c=null;const u=async(t,o)=>{const l=t.shift();c=null!=c?c:new Date;const d=await this.doUri(e,r(l),s,a,i);return d.error&&this.platformHttp.shouldFallback(d.error)&&t.length?Date.now()-c.getTime()>n.options.timeouts.httpMaxRetryDuration?{error:new E(`Timeout for trying fallback hosts retries. Total elapsed time exceeded the ${n.options.timeouts.httpMaxRetryDuration}ms limit`,50003,500)}:u(t,!0):(o&&(n._currentFallback={host:l,validUntil:Date.now()+n.options.timeouts.fallbackRetryTimeout}),d)};return u(l)}catch(n){return{error:new E(`Unexpected error in Http.do: ${X(n)}`,500,5e4)}}}async doUri(e,t,s,a,i){try{!function(e,t,s,a,i){i.shouldLog(k.LOG_MICRO)&&k.logActionNoStrip(i,k.LOG_MICRO,"Http."+e+"()","Sending; "+Ge(t,a)+"; Body"+(f.BufferUtils.isBuffer(s)?" (Base64): "+f.BufferUtils.base64Encode(s):": "+s))}(e,t,a,i,this.logger);const n=await this.platformHttp.doUri(e,t,s,a,i);return this.logger.shouldLog(k.LOG_MICRO)&&function(e,t,s,a,i){e.error?k.logActionNoStrip(i,k.LOG_MICRO,"Http."+t+"()","Received Error; "+Ge(s,a)+"; Error: "+X(e.error)):k.logActionNoStrip(i,k.LOG_MICRO,"Http."+t+"()","Received; "+Ge(s,a)+"; Headers: "+Fe(e.headers)+"; StatusCode: "+e.statusCode+"; Body"+(f.BufferUtils.isBuffer(e.body)?" (Base64): "+f.BufferUtils.base64Encode(e.body):": "+e.body))}(n,e,t,i,this.logger),n}catch(n){return{error:new E(`Unexpected error in Http.doUri: ${X(n)}`,500,5e4)}}}};function He(e,t,s){let a,i,n;for(let r=0;r<e.length;r++)if(a=e[r],s&&(a=a[s]),Array.isArray(a)){for(;-1!==(i=a.indexOf(t));)a.splice(i,1);s&&0===a.length&&delete e[r][s]}else if(R(a))for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&Array.isArray(a[n])&&He([a],t,n)}var We=class{constructor(e){this.logger=e,this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}on(...e){if(1===e.length){const t=e[0];if("function"!=typeof t)throw new Error("EventListener.on(): Invalid arguments: "+f.Config.inspect(e));this.any.push(t)}if(2===e.length){const[t,s]=e;if("function"!=typeof s)throw new Error("EventListener.on(): Invalid arguments: "+f.Config.inspect(e));if(O(t))this.any.push(s);else if(Array.isArray(t))t.forEach(e=>{this.on(e,s)});else{if("string"!=typeof t)throw new Error("EventListener.on(): Invalid arguments: "+f.Config.inspect(e));(this.events[t]||(this.events[t]=[])).push(s)}}}off(...e){if(0==e.length||O(e[0])&&O(e[1]))return this.any=[],this.events=Object.create(null),this.anyOnce=[],void(this.eventsOnce=Object.create(null));const[t,s]=e;let a=null,i=null;if(1!==e.length&&s){if("function"!=typeof s)throw new Error("EventEmitter.off(): invalid arguments:"+f.Config.inspect(e));[i,a]=[t,s]}else"function"==typeof t?a=t:i=t;if(a&&O(i))He([this.any,this.events,this.anyOnce,this.eventsOnce],a);else if(Array.isArray(i))i.forEach(e=>{this.off(e,a)});else{if("string"!=typeof i)throw new Error("EventEmitter.off(): invalid arguments:"+f.Config.inspect(e));a?He([this.events,this.eventsOnce],a,i):(delete this.events[i],delete this.eventsOnce[i])}}listeners(e){if(e){const t=this.events[e]||[];return this.eventsOnce[e]&&Array.prototype.push.apply(t,this.eventsOnce[e]),t.length?t:null}return this.any.length?this.any:null}emit(e,...t){const s={event:e},a=[];this.anyOnce.length&&(Array.prototype.push.apply(a,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(a,this.any);const i=this.eventsOnce[e];i&&(Array.prototype.push.apply(a,i),delete this.eventsOnce[e]);const n=this.events[e];n&&Array.prototype.push.apply(a,n),a.forEach(e=>{!function(e,t,s,a){try{s.apply(t,a)}catch(i){k.logAction(e,k.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+i+"; stack = "+(i&&i.stack))}}(this.logger,s,e,t)})}once(...e){const t=e.length;if(0===t||1===t&&"function"!=typeof e[0]){const t=e[0];return new Promise(e=>{this.once(t,e)})}const[s,a]=e;if(1===e.length&&"function"==typeof s)this.anyOnce.push(s);else if(O(s)){if("function"!=typeof a)throw new Error("EventEmitter.once(): Invalid arguments:"+f.Config.inspect(e));this.anyOnce.push(a)}else if(Array.isArray(s)){const t=this,i=function(){const n=Array.prototype.slice.call(arguments);if(s.forEach(function(e){t.off(e,i)}),"function"!=typeof a)throw new Error("EventEmitter.once(): Invalid arguments:"+f.Config.inspect(e));a.apply(this,n)};s.forEach(function(e){t.on(e,i)})}else{if("string"!=typeof s)throw new Error("EventEmitter.once(): Invalid arguments:"+f.Config.inspect(e));const t=this.eventsOnce[s]||(this.eventsOnce[s]=[]);if(a){if("function"!=typeof a)throw new Error("EventEmitter.once(): Invalid arguments:"+f.Config.inspect(e));t.push(a)}}}async whenState(e,t){if("string"!=typeof e||"string"!=typeof t)throw new Error("whenState requires a valid state String argument");return e===t?null:this.once(e)}},ze={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18,OBJECT:19,OBJECT_SYNC:20,ANNOTATION:21},Ke=[];Object.keys(ze).forEach(function(e){Ke[ze[e]]=e});var Je={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,HAS_OBJECTS:128,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19,ANNOTATION_PUBLISH:1<<21,ANNOTATION_SUBSCRIBE:1<<22,OBJECT_SUBSCRIBE:1<<24,OBJECT_PUBLISH:1<<25},Ye=Object.keys(Je);Je.MODE_ALL=Je.PRESENCE|Je.PUBLISH|Je.SUBSCRIBE|Je.PRESENCE_SUBSCRIBE|Je.ANNOTATION_PUBLISH|Je.ANNOTATION_SUBSCRIBE|Je.OBJECT_SUBSCRIBE|Je.OBJECT_PUBLISH;var Xe=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE","ANNOTATION_PUBLISH","ANNOTATION_SUBSCRIBE","OBJECT_SUBSCRIBE","OBJECT_PUBLISH"];function Qe(e,t,s){if(s&&s.cipher){e||ge("Crypto");const a=e.getCipher(s.cipher,t);return{cipher:a.cipherParams,channelCipher:a.cipher}}return null!=s?s:{}}async function Ze(e,t,s){let a=s.channelCipher,i=e,n=t?t+"/":"";f.BufferUtils.isBuffer(i)||(i=f.BufferUtils.utf8Encode(String(i)),n+="utf-8/");const r=await a.encrypt(i);return n=n+"cipher+"+a.algorithm,{data:r,encoding:n}}async function et(e,t){const s="string"==typeof e.data||f.BufferUtils.isBuffer(e.data)||null===e.data||void 0===e.data,{data:a,encoding:i}=tt(e.data,e.encoding,s);return e.data=a,e.encoding=i,null!=t&&t.cipher?async function(e,t){const{data:s,encoding:a}=await Ze(e.data,e.encoding,t);return e.data=s,e.encoding=a,e}(e,t):e}function tt(e,t,s){if(s)return{data:e,encoding:t};if(R(e)||Array.isArray(e))return{data:JSON.stringify(e),encoding:t?t+"/json":"json"};throw new E("Data type is unsupported",40013,400)}async function st(e,t){const{data:s,encoding:a,error:i}=await at(e.data,e.encoding,t);if(e.data=s,e.encoding=a,i)throw i}async function at(e,t,s){const a=function(e){return e&&e.channelOptions?e:{channelOptions:e,plugins:{},baseEncodedPreviousPayload:void 0}}(s);let i,n=e,r=e,o=t;if(t){const e=t.split("/");let s,c=e.length,u="";try{for(;(s=c)>0;){const t=e[--c].match(/([-\w]+)(\+([\w-]+))?/);if(!t)break;switch(u=t[1],u){case"base64":r=f.BufferUtils.base64Decode(String(r)),s==e.length&&(n=r);continue;case"utf-8":r=f.BufferUtils.utf8Decode(r);continue;case"json":r=JSON.parse(r);continue;case"cipher":if(null!=a.channelOptions&&a.channelOptions.cipher&&a.channelOptions.channelCipher){const e=t[3],s=a.channelOptions.channelCipher;if(e!=s.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");r=await s.decrypt(r);continue}throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!a.plugins||!a.plugins.vcdiff)throw new E("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if("undefined"==typeof Uint8Array)throw new E("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{let e=a.baseEncodedPreviousPayload;"string"==typeof e&&(e=f.BufferUtils.utf8Encode(e));const t=f.BufferUtils.toBuffer(e);r=f.BufferUtils.toBuffer(r),r=f.BufferUtils.arrayBufferViewToBuffer(a.plugins.vcdiff.decode(r,t)),n=r}catch(l){throw new E("Vcdiff delta decode failed with "+l,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(l){const e=l;i=new E(`Error processing the ${u} encoding, decoder returned ‘${e.message}’`,e.code||40013,400)}finally{o=s<=0?null:e.slice(0,s).join("/")}}return i?{error:i,data:r,encoding:o}:(a.baseEncodedPreviousPayload=n,{data:r,encoding:o})}function it(...e){const t=e.length>0?"json":"msgpack",{data:s,encoding:a}=nt(this.data,this.encoding,t);return Object.assign({},this,{encoding:a,data:s})}function nt(e,t,s){return e&&f.BufferUtils.isBuffer(e)?"msgpack"===s?{data:f.BufferUtils.toBuffer(e),encoding:t}:{data:f.BufferUtils.base64Encode(e),encoding:t?t+"/base64":"base64"}:{data:e,encoding:t}}var rt={encryptData:Ze,encodeData:tt,encodeDataForWire:nt,decodeData:at};function ot(e){const{id:t,connectionId:s,timestamp:a}=e;let i;switch(e.action){case ze.MESSAGE:i=e.messages;break;case ze.PRESENCE:case ze.SYNC:i=e.presence;break;case ze.ANNOTATION:i=e.annotations;break;case ze.OBJECT:case ze.OBJECT_SYNC:i=e.state;break;default:throw new E("Unexpected action "+e.action,4e4,400)}for(let n=0;n<i.length;n++){const e=i[n];e.connectionId||(e.connectionId=s),e.timestamp||(e.timestamp=a),t&&!e.id&&(e.id=t+":"+n)}}function lt(e,t){let s="["+t;for(const a in e)"data"===a?"string"==typeof e.data?s+="; data="+e.data:f.BufferUtils.isBuffer(e.data)?s+="; data (buffer)="+f.BufferUtils.base64Encode(e.data):void 0!==e.data&&(s+="; data (json)="+JSON.stringify(e.data)):!a||"extras"!==a&&"operation"!==a?void 0!==e[a]&&(s+="; "+a+"="+e[a]):s+="; "+a+"="+JSON.stringify(e[a]);return s+="]",s}var ct=class{},ut=class{constructor(e){var t,s,a,i,n,r,o,l,c,u;this.Platform=f,this.ErrorInfo=E,this.Logger=k,this.Defaults=Re,this.Utils=w,this.EventEmitter=We,this.MessageEncoding=rt,this._additionalHTTPRequestImplementations=null!=(t=e.plugins)?t:null,this.logger=new k,this.logger.setLog(e.logLevel,e.logHandler),k.logAction(this.logger,k.LOG_MICRO,"BaseClient()","initialized with clientOptions "+f.Config.inspect(e)),this._MsgPack=null!=(a=null==(s=e.plugins)?void 0:s.MsgPack)?a:null;const d=this.options=Re.normaliseOptions(e,this._MsgPack,this.logger);if(d.key){const e=d.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!e){const e="invalid key parameter";throw k.logAction(this.logger,k.LOG_ERROR,"BaseClient()",e),new E(e,40400,404)}d.keyName=e[1],d.keySecret=e[2]}if("clientId"in d){if("string"!=typeof d.clientId&&null!==d.clientId)throw new E("clientId must be either a string or null",40012,400);if("*"===d.clientId)throw new E('Can’t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}k.logAction(this.logger,k.LOG_MINOR,"BaseClient()","started; version = "+Re.version),this._currentFallback=null,this.serverTimeOffset=null,this.http=new Be(this),this.auth=new je(this,d),this._rest=(null==(i=e.plugins)?void 0:i.Rest)?new e.plugins.Rest(this):null,this._Crypto=null!=(r=null==(n=e.plugins)?void 0:n.Crypto)?r:null,this.__FilteredSubscriptions=null!=(l=null==(o=e.plugins)?void 0:o.MessageInteractions)?l:null,this._Annotations=null!=(u=null==(c=e.plugins)?void 0:c.Annotations)?u:null}get rest(){return this._rest||ge("Rest"),this._rest}get _FilteredSubscriptions(){return this.__FilteredSubscriptions||ge("MessageInteractions"),this.__FilteredSubscriptions}get channels(){return this.rest.channels}get push(){return this.rest.push}device(){var e;return(null==(e=this.options.plugins)?void 0:e.Push)&&this.push.LocalDevice||ge("Push"),this._device||(this._device=this.push.LocalDevice.load(this)),this._device}baseUri(e){return Re.getHttpScheme(this.options)+e+":"+Re.getPort(this.options,!1)}async stats(e){return this.rest.stats(e)}async time(e){return this.rest.time(e)}async request(e,t,s,a,i,n){return this.rest.request(e,t,s,a,i,n)}batchPublish(e){return this.rest.batchPublish(e)}batchPresence(e){return this.rest.batchPresence(e)}setLog(e){this.logger.setLog(e.level,e.handler)}async getTimestamp(e){return!this.isTimeOffsetSet()&&e?this.time():this.getTimestampUsingOffset()}getTimestampUsingOffset(){return Date.now()+(this.serverTimeOffset||0)}isTimeOffsetSet(){return null!==this.serverTimeOffset}};ut.Platform=f;var dt=ut,pt=class e{toJSON(){var e,t,s;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:null==(e=this.push)?void 0:e.recipient,state:null==(t=this.push)?void 0:t.state,error:null==(s=this.push)?void 0:s.error}}}toString(){var e,t,s,a;let i="[DeviceDetails";return this.id&&(i+="; id="+this.id),this.platform&&(i+="; platform="+this.platform),this.formFactor&&(i+="; formFactor="+this.formFactor),this.clientId&&(i+="; clientId="+this.clientId),this.metadata&&(i+="; metadata="+this.metadata),this.deviceIdentityToken&&(i+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),(null==(e=this.push)?void 0:e.recipient)&&(i+="; push.recipient="+JSON.stringify(this.push.recipient)),(null==(t=this.push)?void 0:t.state)&&(i+="; push.state="+this.push.state),(null==(s=this.push)?void 0:s.error)&&(i+="; push.error="+JSON.stringify(this.push.error)),(null==(a=this.push)?void 0:a.metadata)&&(i+="; push.metadata="+this.push.metadata),i+="]",i}static toRequestBody(e,t,s){return ne(e,t,s)}static fromResponseBody(t,s,a){return a&&(t=ie(t,s,a)),Array.isArray(t)?e.fromValuesArray(t):e.fromValues(t)}static fromValues(t){return t.error=t.error&&E.fromValues(t.error),Object.assign(new e,t)}static fromLocalDevice(t){return Object.assign(new e,t)}static fromValuesArray(t){const s=t.length,a=new Array(s);for(let i=0;i<s;i++)a[i]=e.fromValues(t[i]);return a}};async function mt(e,t,s,a){return e.http.supportsAuthHeaders?a(T(await e.auth.getAuthHeaders(),t),s):a(t,T(await e.auth.getAuthParams(),s))}var vt=class e{static async get(t,s,a,i,n,r){return e.do(Pe.Get,t,s,null,a,i,n,null!=r&&r)}static async delete(t,s,a,i,n,r){return e.do(Pe.Delete,t,s,null,a,i,n,r)}static async post(t,s,a,i,n,r,o){return e.do(Pe.Post,t,s,a,i,n,r,o)}static async patch(t,s,a,i,n,r,o){return e.do(Pe.Patch,t,s,a,i,n,r,o)}static async put(t,s,a,i,n,r,o){return e.do(Pe.Put,t,s,a,i,n,r,o)}static async do(e,t,s,a,i,n,r,o){r&&((n=n||{}).envelope=r);const l=t.logger;let c=await mt(t,i,n,async function i(n,r){var o;if(l.shouldLog(k.LOG_MICRO)){let i=a;if((null==(o=n["content-type"])?void 0:o.indexOf("msgpack"))>0)try{t._MsgPack||ge("MsgPack"),i=t._MsgPack.decode(a)}catch(u){k.logAction(l,k.LOG_MICRO,"Resource."+e+"()","Sending MsgPack Decoding Error: "+X(u))}k.logAction(l,k.LOG_MICRO,"Resource."+e+"()","Sending; "+Ge(s,r)+"; Body: "+i)}const c=await t.http.do(e,s,n,a,r);return c.error&&je.isTokenErr(c.error)?(await t.auth.authorize(null,null),mt(t,n,r,i)):{err:c.error,body:c.body,headers:c.headers,unpacked:c.unpacked,statusCode:c.statusCode}});if(r&&(c=function(e,t,s){if(e.err&&!e.body)return{err:e.err};if(e.statusCode===Me.NoContent)return m(p({},e),{body:[],unpacked:!0});let a=e.body;if(!e.unpacked)try{a=ie(a,t,s)}catch(o){return Y(o)?{err:o}:{err:new C(X(o),null)}}if(!a)return{err:new C("unenvelope(): Response body is missing",null)};const{statusCode:i,response:n,headers:r}=a;if(void 0===i)return m(p({},e),{body:a,unpacked:!0});if(i<200||i>=300){let t=n&&n.error||e.err;return t||(t=new Error("Error in unenveloping "+a),t.statusCode=i),{err:t,body:n,headers:r,unpacked:!0,statusCode:i}}return{err:e.err,body:n,headers:r,unpacked:!0,statusCode:i}}(c,t._MsgPack,r)),l.shouldLog(k.LOG_MICRO)&&function(e,t,s,a,i){e.err?k.logAction(i,k.LOG_MICRO,"Resource."+t+"()","Received Error; "+Ge(s,a)+"; Error: "+X(e.err)):k.logAction(i,k.LOG_MICRO,"Resource."+t+"()","Received; "+Ge(s,a)+"; Headers: "+Fe(e.headers)+"; StatusCode: "+e.statusCode+"; Body: "+(f.BufferUtils.isBuffer(e.body)?" (Base64): "+f.BufferUtils.base64Encode(e.body):": "+f.Config.inspect(e.body)))}(c,e,s,n,l),o){if(c.err)throw c.err;{const e=p({},c);return delete e.err,e}}return c}};function ht(e){const t=e.match(/^\.\/(\w+)\?(.*)$/);return t&&t[2]&&J(t[2])}var ft=class{constructor(e,t,s){this.resource=e,this.items=t,this._relParams=s}async first(){if(this.hasFirst())return this.get(this._relParams.first);throw new E("No link to the first page of results",40400,404)}async current(){if(this.hasCurrent())return this.get(this._relParams.current);throw new E("No link to the current page of results",40400,404)}async next(){return this.hasNext()?this.get(this._relParams.next):null}hasFirst(){return null!=this._relParams&&"first"in this._relParams}hasCurrent(){return null!=this._relParams&&"current"in this._relParams}hasNext(){return null!=this._relParams&&"next"in this._relParams}isLast(){return!this.hasNext()}async get(e){const t=this.resource,s=await vt.get(t.client,t.path,t.headers,e,t.envelope,!1);return t.handlePage(s)}},gt=class extends ft{constructor(e,t,s,a,i,n){super(e,t,i),this.statusCode=a,this.success=a<300&&a>=200,this.headers=s,this.errorCode=n&&n.code,this.errorMessage=n&&n.message}toJSON(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}}},yt=class{constructor(e,t,s,a,i,n){this.client=e,this.path=t,this.headers=s,this.envelope=null!=a?a:null,this.bodyHandler=i,this.useHttpPaginatedResponse=n||!1}get logger(){return this.client.logger}async get(e){const t=await vt.get(this.client,this.path,this.headers,e,this.envelope,!1);return this.handlePage(t)}async delete(e){const t=await vt.delete(this.client,this.path,this.headers,e,this.envelope,!1);return this.handlePage(t)}async post(e,t){const s=await vt.post(this.client,this.path,t,this.headers,e,this.envelope,!1);return this.handlePage(s)}async put(e,t){const s=await vt.put(this.client,this.path,t,this.headers,e,this.envelope,!1);return this.handlePage(s)}async patch(e,t){const s=await vt.patch(this.client,this.path,t,this.headers,e,this.envelope,!1);return this.handlePage(s)}async handlePage(e){if(e.err&&(t=e.err,s=e.body,!this.useHttpPaginatedResponse||!s&&"number"!=typeof t.code))throw k.logAction(this.logger,k.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+X(e.err)),e.err;var t,s;let a,i,n;try{a=e.statusCode==Me.NoContent?[]:await this.bodyHandler(e.body,e.headers||{},e.unpacked)}catch(r){throw e.err||r}return e.headers&&(i=e.headers.Link||e.headers.link)&&(n=function(e){"string"==typeof e&&(e=e.split(","));const t={};for(let s=0;s<e.length;s++){const a=e[s].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(a){const e=ht(a[1]);e&&(t[a[2]]=e)}}return t}(i)),this.useHttpPaginatedResponse?new gt(this,a,e.headers||{},e.statusCode,n,e.err):new ft(this,a,n)}},bt=class e{toJSON(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}}toString(){let e="[PushChannelSubscription";return this.channel&&(e+="; channel="+this.channel),this.deviceId&&(e+="; deviceId="+this.deviceId),this.clientId&&(e+="; clientId="+this.clientId),e+="]",e}static fromResponseBody(t,s,a){return a&&(t=ie(t,s,a)),Array.isArray(t)?e.fromValuesArray(t):e.fromValues(t)}static fromValues(t){return Object.assign(new e,t)}static fromValuesArray(t){const s=t.length,a=new Array(s);for(let i=0;i<s;i++)a[i]=e.fromValues(t[i]);return a}};bt.toRequestBody=ne;var _t=bt,kt=class{constructor(e){this.client=e,this.deviceRegistrations=new wt(e),this.channelSubscriptions=new St(e)}async publish(e,t){const s=this.client,a=s.options.useBinaryProtocol?"msgpack":"json",i=Re.defaultPostHeaders(s.options,{format:a}),n={},r=T({recipient:e},t);T(i,s.options.headers),s.options.pushFullWait&&T(n,{fullWait:"true"});const o=ne(r,s._MsgPack,a);await vt.post(s,"/push/publish",o,i,n,null,!0)}},wt=class{constructor(e){this.client=e}async save(e){const t=this.client,s=pt.fromValues(e),a=t.options.useBinaryProtocol?"msgpack":"json",i=Re.defaultPostHeaders(t.options,{format:a}),n={};T(i,t.options.headers),t.options.pushFullWait&&T(n,{fullWait:"true"});const r=ne(s,t._MsgPack,a),o=await vt.put(t,"/push/deviceRegistrations/"+encodeURIComponent(e.id),r,i,n,null,!0);return pt.fromResponseBody(o.body,t._MsgPack,o.unpacked?void 0:a)}async get(e){const t=this.client,s=t.options.useBinaryProtocol?"msgpack":"json",a=Re.defaultGetHeaders(t.options,{format:s}),i=e.id||e;if("string"!=typeof i||!i.length)throw new E("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400);T(a,t.options.headers);const n=await vt.get(t,"/push/deviceRegistrations/"+encodeURIComponent(i),a,{},null,!0);return pt.fromResponseBody(n.body,t._MsgPack,n.unpacked?void 0:s)}async list(e){const t=this.client,s=t.options.useBinaryProtocol?"msgpack":"json",a=this.client.http.supportsLinkHeaders?void 0:s,i=Re.defaultGetHeaders(t.options,{format:s});return T(i,t.options.headers),new yt(t,"/push/deviceRegistrations",i,a,async function(e,a,i){return pt.fromResponseBody(e,t._MsgPack,i?void 0:s)}).get(e)}async remove(e){const t=this.client,s=t.options.useBinaryProtocol?"msgpack":"json",a=Re.defaultGetHeaders(t.options,{format:s}),i={},n=e.id||e;if("string"!=typeof n||!n.length)throw new E("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400);T(a,t.options.headers),t.options.pushFullWait&&T(i,{fullWait:"true"}),await vt.delete(t,"/push/deviceRegistrations/"+encodeURIComponent(n),a,i,null,!0)}async removeWhere(e){const t=this.client,s=t.options.useBinaryProtocol?"msgpack":"json",a=Re.defaultGetHeaders(t.options,{format:s});T(a,t.options.headers),t.options.pushFullWait&&T(e,{fullWait:"true"}),await vt.delete(t,"/push/deviceRegistrations",a,e,null,!0)}},St=class e{constructor(t){this.remove=e.prototype.removeWhere,this.client=t}async save(e){const t=this.client,s=_t.fromValues(e),a=t.options.useBinaryProtocol?"msgpack":"json",i=Re.defaultPostHeaders(t.options,{format:a}),n={};T(i,t.options.headers),t.options.pushFullWait&&T(n,{fullWait:"true"});const r=ne(s,t._MsgPack,a),o=await vt.post(t,"/push/channelSubscriptions",r,i,n,null,!0);return _t.fromResponseBody(o.body,t._MsgPack,o.unpacked?void 0:a)}async list(e){const t=this.client,s=t.options.useBinaryProtocol?"msgpack":"json",a=this.client.http.supportsLinkHeaders?void 0:s,i=Re.defaultGetHeaders(t.options,{format:s});return T(i,t.options.headers),new yt(t,"/push/channelSubscriptions",i,a,async function(e,a,i){return _t.fromResponseBody(e,t._MsgPack,i?void 0:s)}).get(e)}async removeWhere(e){const t=this.client,s=t.options.useBinaryProtocol?"msgpack":"json",a=Re.defaultGetHeaders(t.options,{format:s});T(a,t.options.headers),t.options.pushFullWait&&T(e,{fullWait:"true"}),await vt.delete(t,"/push/channelSubscriptions",a,e,null,!0)}async listChannels(e){const t=this.client,s=t.options.useBinaryProtocol?"msgpack":"json",a=this.client.http.supportsLinkHeaders?void 0:s,i=Re.defaultGetHeaders(t.options,{format:s});return T(i,t.options.headers),t.options.pushFullWait&&T(e,{fullWait:"true"}),new yt(t,"/push/channels",i,a,async function(e,a,i){const n=!i&&s?ie(e,t._MsgPack,s):e;for(let t=0;t<n.length;t++)n[t]=String(n[t]);return n}).get(e)}},Et=class{constructor(e){var t;this.client=e,this.admin=new kt(e),f.Config.push&&(null==(t=e.options.plugins)?void 0:t.Push)&&(this.stateMachine=new e.options.plugins.Push.ActivationStateMachine(e),this.LocalDevice=e.options.plugins.Push.localDeviceFactory(pt))}async activate(e,t){await new Promise((s,a)=>{var i;(null==(i=this.client.options.plugins)?void 0:i.Push)?this.stateMachine?this.stateMachine.activatedCallback?a(new E("Activation already in progress",4e4,400)):(this.stateMachine.activatedCallback=e=>{e?a(e):s()},this.stateMachine.updateFailedCallback=t,this.stateMachine.handleEvent(new this.client.options.plugins.Push.CalledActivate(this.stateMachine,e))):a(new E("This platform is not supported as a target of push notifications",4e4,400)):a(fe("Push"))})}async deactivate(e){await new Promise((t,s)=>{var a;(null==(a=this.client.options.plugins)?void 0:a.Push)?this.stateMachine?this.stateMachine.deactivatedCallback?s(new E("Deactivation already in progress",4e4,400)):(this.stateMachine.deactivatedCallback=e=>{e?s(e):t()},this.stateMachine.handleEvent(new this.client.options.plugins.Push.CalledDeactivate(this.stateMachine,e))):s(new E("This platform is not supported as a target of push notifications",4e4,400)):s(fe("Push"))})}},Ct=["absent","present","enter","leave","update"];async function Tt(e,t,s,a){const i=Qe(t,e,null!=a?a:null);return Rt.fromValues(s).decode(i,e)}async function At(e,t){return Promise.all(e.map(function(e){return async function(e,t){return Rt.fromValues(e).decode(t.channelOptions,t.logger)}(e,t)}))}var It=class e extends ct{isSynthesized(){return!this.id||!this.connectionId||this.id.substring(this.connectionId.length,0)!==this.connectionId}parseId(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");const e=this.id.split(":");return{connectionId:e[0],msgSerial:parseInt(e[1],10),index:parseInt(e[2],10)}}async encode(e){return et(Object.assign(new Rt,this,{action:Ct.indexOf(this.action||"present")}),e)}static fromValues(t){return Object.assign(new e,t)}static fromValuesArray(t){return t.map(t=>e.fromValues(t))}static fromData(t){return t instanceof e?t:e.fromValues({data:t})}toString(){return lt(this,"PresenceMessage")}},Rt=class e extends ct{toJSON(...e){return it.call(this,...e)}static fromValues(t){return Object.assign(new e,t)}static fromValuesArray(t){return t.map(t=>e.fromValues(t))}async decode(e,t){const s=Object.assign(new It,m(p({},this),{action:Ct[this.action]}));try{await st(s,e)}catch(a){k.logAction(t,k.LOG_ERROR,"WirePresenceMessage.decode()",X(a))}return s}toString(){return lt(this,"WirePresenceMessage")}},xt=It,Ot=class{constructor(e){this.channel=e}get logger(){return this.channel.logger}async get(e){k.logAction(this.logger,k.LOG_MICRO,"RestPresence.get()","channel = "+this.channel.name);const t=this.channel.client,s=t.options.useBinaryProtocol?"msgpack":"json",a=this.channel.client.http.supportsLinkHeaders?void 0:s,i=Re.defaultGetHeaders(t.options,{format:s});return T(i,t.options.headers),new yt(t,this.channel.client.rest.presenceMixin.basePath(this),i,a,async(e,a,i)=>At(i?e:ie(e,t._MsgPack,s),this.channel)).get(e)}async history(e){return k.logAction(this.logger,k.LOG_MICRO,"RestPresence.history()","channel = "+this.channel.name),this.channel.client.rest.presenceMixin.history(this,e)}},Pt=["message.create","message.update","message.delete","meta","message.summary"];function Nt(e){let t=0;return e.name&&(t+=e.name.length),e.clientId&&(t+=e.clientId.length),e.extras&&(t+=JSON.stringify(e.extras).length),e.data&&(t+=Z(e.data)),t}async function Mt(e,t,s,a){const i=Qe(t,e,null!=a?a:null);return $t.fromValues(s).decode(i,e)}async function Dt(e,t){return Promise.all(e.map(function(e){return async function(e,t){return $t.fromValues(e).decode(t.channelOptions,t.logger)}(e,t)}))}async function Lt(e,t){return Promise.all(e.map(e=>e.encode(t)))}var Ut=ne;function qt(e){let t,s=0;for(let a=0;a<e.length;a++)t=e[a],s+=t.size||(t.size=Nt(t));return s}var Vt=class e extends ct{expandFields(){"message.create"===this.action&&(this.version&&!this.serial&&(this.serial=this.version),this.timestamp&&!this.createdAt&&(this.createdAt=this.timestamp))}async encode(e){return et(Object.assign(new $t,this,{action:Pt.indexOf(this.action||"message.create")}),e)}static fromValues(t){return Object.assign(new e,t)}static fromValuesArray(t){return t.map(t=>e.fromValues(t))}toString(){return lt(this,"Message")}},$t=class e extends ct{toJSON(...e){return it.call(this,...e)}static fromValues(t){return Object.assign(new e,t)}static fromValuesArray(t){return t.map(t=>e.fromValues(t))}async decodeWithErr(e,t){const s=Object.assign(new Vt,m(p({},this),{action:(a=this.action,Pt[a||0]||"unknown")}));var a;let i;try{await st(s,e)}catch(n){k.logAction(t,k.LOG_ERROR,"WireMessage.decode()",X(n)),i=n}return s.expandFields(),{decoded:s,err:i}}async decode(e,t){const{decoded:s}=await this.decodeWithErr(e,t);return s}toString(){return lt(this,"WireMessage")}},jt=Vt,Ft=class{constructor(e,t,s){var a,i;this._annotations=null,k.logAction(e.logger,k.LOG_MINOR,"RestChannel()","started; name = "+t),this.name=t,this.client=e,this.presence=new Ot(this),this.channelOptions=Te(null!=(a=e._Crypto)?a:null,this.logger,s),(null==(i=e.options.plugins)?void 0:i.Push)&&(this._push=new e.options.plugins.Push.PushChannel(this)),e._Annotations&&(this._annotations=new e._Annotations.RestAnnotations(this))}get annotations(){return this._annotations||ge("Annotations"),this._annotations}get push(){return this._push||ge("Push"),this._push}get logger(){return this.client.logger}setOptions(e){var t;this.channelOptions=Te(null!=(t=this.client._Crypto)?t:null,this.logger,e)}async history(e){return k.logAction(this.logger,k.LOG_MICRO,"RestChannel.history()","channel = "+this.name),this.client.rest.channelMixin.history(this,e)}async publish(...e){const t=e[0],s=e[1];let a,i;if("string"==typeof t||null===t)a=[jt.fromValues({name:t,data:s})],i=e[2];else if(R(t))a=[jt.fromValues(t)],i=e[1];else{if(!Array.isArray(t))throw new E("The single-argument form of publish() expects a message object or an array of message objects",40013,400);a=jt.fromValuesArray(t),i=e[1]}i||(i={});const n=this.client,r=n.options,o=r.useBinaryProtocol?"msgpack":"json",l=n.options.idempotentRestPublishing,c=Re.defaultPostHeaders(n.options,{format:o});if(T(c,r.headers),l&&function(e){return e.every(function(e){return!e.id})}(a)){const e=await te(9);a.forEach(function(t,s){t.id=e+":"+s.toString()})}const u=await Lt(a,this.channelOptions),d=qt(u),p=r.maxMessageSize;if(d>p)throw new E(`Maximum size of messages that can be published at once exceeded (was ${d} bytes; limit is ${p} bytes)`,40009,400);await this._publish(Ut(u,n._MsgPack,o),c,i)}async _publish(e,t,s){await vt.post(this.client,this.client.rest.channelMixin.basePath(this)+"/messages",e,t,s,null,!0)}async status(){return this.client.rest.channelMixin.status(this)}},Gt=class e{constructor(e){this.entries=e&&e.entries||void 0,this.schema=e&&e.schema||void 0,this.appId=e&&e.appId||void 0,this.inProgress=e&&e.inProgress||void 0,this.unit=e&&e.unit||void 0,this.intervalId=e&&e.intervalId||void 0}static fromValues(t){return new e(t)}},Bt=class{static basePath(e){return"/channels/"+encodeURIComponent(e.name)}static history(e,t){const s=e.client,a=s.options.useBinaryProtocol?"msgpack":"json",i=e.client.http.supportsLinkHeaders?void 0:a,n=Re.defaultGetHeaders(s.options,{format:a});return T(n,s.options.headers),new yt(s,this.basePath(e)+"/messages",n,i,async function(t,i,n){return Dt(n?t:ie(t,s._MsgPack,a),e)}).get(t)}static async status(e){const t=e.client.options.useBinaryProtocol?"msgpack":"json",s=Re.defaultPostHeaders(e.client.options,{format:t});return(await vt.get(e.client,this.basePath(e),s,{},t,!0)).body}},Ht=class{static basePath(e){return Bt.basePath(e.channel)+"/presence"}static async history(e,t){const s=e.channel.client,a=s.options.useBinaryProtocol?"msgpack":"json",i=e.channel.client.http.supportsLinkHeaders?void 0:a,n=Re.defaultGetHeaders(s.options,{format:a});return T(n,s.options.headers),new yt(s,this.basePath(e)+"/history",n,i,async(t,i,n)=>At(n?t:ie(t,s._MsgPack,a),e.channel)).get(t)}},Wt=class{constructor(e){this.channelMixin=Bt,this.presenceMixin=Ht,this.Resource=vt,this.PaginatedResource=yt,this.DeviceDetails=pt,this.PushChannelSubscription=_t,this.client=e,this.channels=new zt(this.client),this.push=new Et(this.client)}async stats(e){const t=Re.defaultGetHeaders(this.client.options),s=this.client.options.useBinaryProtocol?"msgpack":"json",a=this.client.http.supportsLinkHeaders?void 0:s;return T(t,this.client.options.headers),new yt(this.client,"/stats",t,a,function(e,t,s){const a=s?e:JSON.parse(e);for(let i=0;i<a.length;i++)a[i]=Gt.fromValues(a[i]);return a}).get(e)}async time(e){const t=Re.defaultGetHeaders(this.client.options);this.client.options.headers&&T(t,this.client.options.headers);let{error:s,body:a,unpacked:i}=await this.client.http.do(Pe.Get,e=>this.client.baseUri(e)+"/time",t,null,e);if(s)throw s;i||(a=JSON.parse(a));const n=a[0];if(!n)throw new E("Internal error (unexpected result type from GET /time)",5e4,500);return this.client.serverTimeOffset=n-Date.now(),n}async request(e,t,s,a,i,n){var r;const[o,l,c]=(()=>this.client.options.useBinaryProtocol?(this.client._MsgPack||ge("MsgPack"),[this.client._MsgPack.encode,this.client._MsgPack.decode,"msgpack"]):[JSON.stringify,JSON.parse,"json"])(),u=this.client.http.supportsLinkHeaders?void 0:c;a=a||{};const d=e.toLowerCase(),p="get"==d?Re.defaultGetHeaders(this.client.options,{format:c,protocolVersion:s}):Re.defaultPostHeaders(this.client.options,{format:c,protocolVersion:s});"string"!=typeof i&&(i=null!=(r=o(i))?r:null),T(p,this.client.options.headers),n&&T(p,n);const m=new yt(this.client,t,p,u,async function(e,t,s){return I(s?e:l(e))},!0);if(!f.Http.methods.includes(d))throw new E("Unsupported method "+d,40500,405);return f.Http.methodsWithBody.includes(d)?m[d](a,i):m[d](a)}async batchPublish(e){let t,s;Array.isArray(e)?(t=e,s=!1):(t=[e],s=!0);const a=this.client.options.useBinaryProtocol?"msgpack":"json",i=Re.defaultPostHeaders(this.client.options,{format:a});this.client.options.headers&&T(i,this.client.options.headers);const n=ne(t,this.client._MsgPack,a),r=await vt.post(this.client,"/messages",n,i,{},null,!0),o=r.unpacked?r.body:ie(r.body,this.client._MsgPack,a);return s?o[0]:o}async batchPresence(e){const t=this.client.options.useBinaryProtocol?"msgpack":"json",s=Re.defaultPostHeaders(this.client.options,{format:t});this.client.options.headers&&T(s,this.client.options.headers);const a=e.join(","),i=await vt.get(this.client,"/presence",s,{channels:a},null,!0);return i.unpacked?i.body:ie(i.body,this.client._MsgPack,t)}async revokeTokens(e,t){if(Ve(this.client.options))throw new E("Cannot revoke tokens when using token auth",40162,401);const s=this.client.options.keyName;let a=null!=t?t:{};const i=p({targets:e.map(e=>`${e.type}:${e.value}`)},a),n=this.client.options.useBinaryProtocol?"msgpack":"json",r=Re.defaultPostHeaders(this.client.options,{format:n});this.client.options.headers&&T(r,this.client.options.headers);const o=ne(i,this.client._MsgPack,n),l=await vt.post(this.client,`/keys/${s}/revokeTokens`,o,r,{},null,!0);return l.unpacked?l.body:ie(l.body,this.client._MsgPack,n)}},zt=class{constructor(e){this.client=e,this.all=Object.create(null)}get(e,t){e=String(e);let s=this.all[e];return s?t&&s.setOptions(t):this.all[e]=s=new Ft(this.client,e,t),s}release(e){delete this.all[String(e)]}},Kt=class extends dt{constructor(e){super(Re.objectifyOptions(e,!1,"BaseRest",k.defaultLogger,{Rest:Wt}))}},Jt={Rest:Wt},Yt=class extends jt{static async fromEncoded(e,t){return Mt(k.defaultLogger,f.Crypto,e,t)}static async fromEncodedArray(e,t){return async function(e,t,s,a){return Promise.all(s.map(function(s){return Mt(e,t,s,a)}))}(k.defaultLogger,f.Crypto,e,t)}static fromValues(e){return jt.fromValues(e)}},Xt=class extends xt{static async fromEncoded(e,t){return Tt(k.defaultLogger,f.Crypto,e,t)}static async fromEncodedArray(e,t){return async function(e,t,s,a){return Promise.all(s.map(function(s){return Tt(e,t,s,a)}))}(k.defaultLogger,f.Crypto,e,t)}static fromValues(e){return xt.fromValues(e)}},Qt=["annotation.create","annotation.delete"];async function Zt(e,t,s){return ss.fromValues(t).decode(s||{},e)}async function es(e,t){return Promise.all(e.map(function(e){return async function(e,t){return ss.fromValues(e).decode(t.channelOptions,t.logger)}(e,t)}))}var ts=class e extends ct{async encode(){return et(Object.assign(new ss,this,{action:Qt.indexOf(this.action||"annotation.create")}),{})}static fromValues(t){return Object.assign(new e,t)}static fromValuesArray(t){return t.map(t=>e.fromValues(t))}toString(){return lt(this,"Annotation")}},ss=class e extends ct{toJSON(...e){return it.call(this,...e)}static fromValues(t){return Object.assign(new e,t)}static fromValuesArray(t){return t.map(t=>e.fromValues(t))}async decode(e,t){const s=Object.assign(new ts,m(p({},this),{action:Qt[this.action]}));try{await st(s,e)}catch(a){k.logAction(t,k.LOG_ERROR,"WireAnnotation.decode()",X(a))}return s}toString(){return lt(this,"WireAnnotation")}},as=ts,is=class extends as{static async fromEncoded(e,t){return Zt(k.defaultLogger,e,t)}static async fromEncodedArray(e,t){return async function(e,t,s){return Promise.all(t.map(function(t){return Zt(e,t,s)}))}(k.defaultLogger,e,t)}static fromValues(e){return as.fromValues(e)}};function ns(e){let t;switch(typeof e){case"string":t=e;break;case"object":t=e.serial}if(!t||"string"!=typeof t)throw new E("First argument of annotations.publish() must be either a Message (or at least an object with a string `serial` property) or a message serial (string)",40003,400);return t}function rs(e,t){const s=ns(e);if(!t||"object"!=typeof t)throw new E("Second argument of annotations.publish() must be an object (the intended annotation to publish)",40003,400);const a=as.fromValues(t);return a.messageSerial=s,a.action||(a.action="annotation.create"),a}function os(e,t){return e.client.rest.channelMixin.basePath(e)+"/messages/"+encodeURIComponent(t)+"/annotations"}var ls=class{constructor(e){this.channel=e}async publish(e,t){const s=rs(e,t),a=await s.encode(),i=this.channel.client,n=i.options.useBinaryProtocol?"msgpack":"json",r=Re.defaultPostHeaders(i.options,{format:n});T(r,i.options.headers);const o=ne([a],i._MsgPack,n);await vt.post(i,os(this.channel,s.messageSerial),o,r,{},null,!0)}async delete(e,t){return t.action="annotation.delete",this.publish(e,t)}async get(e,t){const s=this.channel.client,a=ns(e),i=s.options.useBinaryProtocol?"msgpack":"json",n=s.http.supportsLinkHeaders?void 0:i,r=Re.defaultGetHeaders(s.options,{format:i});return T(r,s.options.headers),new yt(s,os(this.channel,a),r,n,async(e,t,a)=>es(a?e:ie(e,s._MsgPack,i),this.channel)).get(t)}},cs=ne;function us(e){const t=[];if(e)for(let s=0;s<e.length;s++)t.push(e[s].toString());return"[ "+t.join(", ")+" ]"}function ds(e,t,s,a){let i,n,r,o,l;return e.error&&(i=E.fromValues(e.error)),e.messages&&(n=$t.fromValuesArray(e.messages)),t&&e.presence&&(r=t.WirePresenceMessage.fromValuesArray(e.presence)),s&&e.annotations&&(o=s.WireAnnotation.fromValuesArray(e.annotations)),a&&e.state&&(l=a.ObjectMessage.fromValuesArray(e.state,w,rt)),Object.assign(new hs,m(p({},e),{presence:r,messages:n,annotations:o,state:l,error:i}))}function ps(e){return t=>{var s;return ds(t,{WirePresenceMessage:Rt},{WireAnnotation:ss},null!=(s=null==e?void 0:e.ObjectsPlugin)?s:null)}}function ms(e){return Object.assign(new hs,e)}function vs(e,t,s,a){let i="[ProtocolMessage";void 0!==e.action&&(i+="; action="+Ke[e.action]||e.action);const n=["id","channel","channelSerial","connectionId","count","msgSerial","timestamp"];let r;for(let o=0;o<n.length;o++)r=n[o],void 0!==e[r]&&(i+="; "+r+"="+e[r]);if(e.messages&&(i+="; messages="+us($t.fromValuesArray(e.messages))),e.presence&&t&&(i+="; presence="+us(t.WirePresenceMessage.fromValuesArray(e.presence))),e.annotations&&s&&(i+="; annotations="+us(s.WireAnnotation.fromValuesArray(e.annotations))),e.state&&a&&(i+="; state="+us(a.ObjectMessage.fromValuesArray(e.state,w,rt))),e.error&&(i+="; error="+E.fromValues(e.error).toString()),e.auth&&e.auth.accessToken&&(i+="; token="+e.auth.accessToken),e.flags&&(i+="; flags="+Ye.filter(e.hasFlag).join(",")),e.params){let t="";G(e.params,function(s){t.length>0&&(t+="; "),t+=s+"="+e.params[s]}),t.length>0&&(i+="; params=["+t+"]")}return i+="]",i}var hs=class{constructor(){this.hasFlag=e=>(this.flags&Je[e])>0}setFlag(e){return this.flags=this.flags|Je[e]}getMode(){return(this.flags||0)&Je.MODE_ALL}encodeModesToFlags(e){e.forEach(e=>this.setFlag(e))}decodeModesFromFlags(){const e=[];return Xe.forEach(t=>{this.hasFlag(t)&&e.push(t)}),e.length>0?e:void 0}},fs=hs,gs=class{constructor(e,t,s,a,i){this.previous=e,this.current=t,"attached"===t&&(this.resumed=s,this.hasBacklog=a),i&&(this.reason=i)}},ys=function(){};function bs(e){const t=e||{},{agent:s}=t;return((e,t)=>{var s={};for(var a in e)c.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&l)for(var a of l(e))t.indexOf(a)<0&&u.call(e,a)&&(s[a]=e[a]);return s})(t,["agent"])}var _s=class e extends We{constructor(e,t,s){var a,i,n;super(e.logger),this._annotations=null,this._mode=0,this.retryCount=0,this.history=async function(e){k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name);const t=this.client.rest.channelMixin;if(e&&e.untilAttach){if("attached"!==this.state)throw new E("option untilAttach requires the channel to be attached",4e4,400);if(!this.properties.attachSerial)throw new E("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400);delete e.untilAttach,e.from_serial=this.properties.attachSerial}return t.history(this,e)},this.whenState=e=>We.prototype.whenState.call(this,e,this.state),k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel()","started; name = "+t),this.name=t,this.channelOptions=Te(null!=(a=e._Crypto)?a:null,this.logger,s),this.client=e,this._presence=e._RealtimePresence?new e._RealtimePresence.RealtimePresence(this):null,e._Annotations&&(this._annotations=new e._Annotations.RealtimeAnnotations(this)),this.connectionManager=e.connection.connectionManager,this.state="initialized",this.subscriptions=new We(this.logger),this.syncChannelSerial=void 0,this.properties={attachSerial:void 0,channelSerial:void 0},this.setOptions(s),this.errorReason=null,this._attachResume=!1,this._decodingContext={channelOptions:this.channelOptions,plugins:e.options.plugins||{},baseEncodedPreviousPayload:void 0},this._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},this._allChannelChanges=new We(this.logger),(null==(i=e.options.plugins)?void 0:i.Push)&&(this._push=new e.options.plugins.Push.PushChannel(this)),(null==(n=e.options.plugins)?void 0:n.Objects)&&(this._objects=new e.options.plugins.Objects.Objects(this))}get presence(){return this._presence||ge("RealtimePresence"),this._presence}get annotations(){return this._annotations||ge("Annotations"),this._annotations}get push(){return this._push||ge("Push"),this._push}get objects(){return this._objects||ge("Objects"),this._objects}invalidStateError(){return new E("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)}static processListenerArgs(e){return"function"==typeof(e=Array.prototype.slice.call(e))[0]&&e.unshift(null),e}async setOptions(e){var t;const s=this.channelOptions,a=function(e){if(e&&"params"in e&&!R(e.params))return new E("options.params must be an object",4e4,400);if(e&&"modes"in e){if(!Array.isArray(e.modes))return new E("options.modes must be an array",4e4,400);for(let t=0;t<e.modes.length;t++){const s=e.modes[t];if(!s||"string"!=typeof s||!Xe.includes(String.prototype.toUpperCase.call(s)))return new E("Invalid channel mode: "+s,4e4,400)}}}(e);if(a)throw a;if(this.channelOptions=Te(null!=(t=this.client._Crypto)?t:null,this.logger,e),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(e,s))return this.attachImpl(),new Promise((e,t)=>{this._allChannelChanges.once(["attached","update","detached","failed"],function(s){switch(this.event){case"update":case"attached":e();break;default:t(s.reason)}})})}_shouldReattachToSetOptions(e,t){if("attached"!==this.state&&"attaching"!==this.state)return!1;if(null==e?void 0:e.params){const s=bs(e.params),a=bs(t.params);if(Object.keys(s).length!==Object.keys(a).length)return!0;if(!pe(a,s))return!0}return!(!(null==e?void 0:e.modes)||t.modes&&he(e.modes,t.modes))}async publish(...e){let t;if(1==e.length)if(R(e[0]))t=[jt.fromValues(e[0])];else{if(!Array.isArray(e[0]))throw new E("The single-argument form of publish() expects a message object or an array of message objects",40013,400);t=jt.fromValuesArray(e[0])}else t=[jt.fromValues({name:e[0],data:e[1]})];const s=this.client.options.maxMessageSize,a=await Lt(t,this.channelOptions),i=qt(a);if(i>s)throw new E(`Maximum size of messages that can be published at once exceeded (was ${i} bytes; limit is ${s} bytes)`,40009,400);this.throwIfUnpublishableState(),k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+this.state+", message count = "+a.length);const n=ms({action:ze.MESSAGE,channel:this.name,messages:a});return this.sendMessage(n)}throwIfUnpublishableState(){if(!this.connectionManager.activeState())throw this.connectionManager.getError();if("failed"===this.state||"suspended"===this.state)throw this.invalidStateError()}onEvent(e){k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.onEvent()","received message");const t=this.subscriptions;for(let s=0;s<e.length;s++){const a=e[s];t.emit(a.name,a)}}async attach(){return"attached"===this.state?null:new Promise((e,t)=>{this._attach(!1,null,(s,a)=>s?t(s):e(a))})}_attach(e,t,s){s||(s=e=>{e&&k.logAction(this.logger,k.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+e.toString())});const a=this.connectionManager;a.activeState()?(("attaching"!==this.state||e)&&this.requestState("attaching",t),this.once(function(e){switch(this.event){case"attached":null==s||s(null,e);break;case"detached":case"suspended":case"failed":null==s||s(e.reason||a.getError()||new E("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":null==s||s(new E("Attach request superseded by a subsequent detach request",9e4,409))}})):s(a.getError())}attachImpl(){k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");const e=ms({action:ze.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this.channelOptions.modes&&e.encodeModesToFlags(oe(this.channelOptions.modes)),this._attachResume&&e.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(e.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(e).catch(ys)}async detach(){const e=this.connectionManager;if(!e.activeState())throw e.getError();switch(this.state){case"suspended":return void this.notifyState("detached");case"detached":return;case"failed":throw new E("Unable to detach; channel state = failed",90001,400);default:this.requestState("detaching");case"detaching":return new Promise((t,s)=>{this.once(function(a){switch(this.event){case"detached":t();break;case"attached":case"suspended":case"failed":s(a.reason||e.getError()||new E("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":s(new E("Detach request superseded by a subsequent attach request",9e4,409))}})})}}detachImpl(){k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");const e=ms({action:ze.DETACH,channel:this.name});this.sendMessage(e).catch(ys)}async subscribe(...t){const[s,a]=e.processListenerArgs(t);if("failed"===this.state)throw E.fromValues(this.invalidStateError());return s&&"object"==typeof s&&!Array.isArray(s)?this.client._FilteredSubscriptions.subscribeFilter(this,s,a):this.subscriptions.on(s,a),!1!==this.channelOptions.attachOnSubscribe?this.attach():null}unsubscribe(...t){var s;const[a,i]=e.processListenerArgs(t);"object"==typeof a&&!i||(null==(s=this.filteredSubscriptions)?void 0:s.has(i))?this.client._FilteredSubscriptions.getAndDeleteFilteredSubscriptions(this,a,i).forEach(e=>this.subscriptions.off(e)):this.subscriptions.off(a,i)}sync(){switch(this.state){case"initialized":case"detaching":case"detached":throw new C("Unable to sync to channel; not attached",4e4)}const e=this.connectionManager;if(!e.activeState())throw e.getError();const t=ms({action:ze.SYNC,channel:this.name});this.syncChannelSerial&&(t.channelSerial=this.syncChannelSerial),e.send(t)}async sendMessage(e){return new Promise((t,s)=>{this.connectionManager.send(e,this.client.options.queueMessages,e=>{e?s(e):t()})})}async sendPresence(e){const t=ms({action:ze.PRESENCE,channel:this.name,presence:e});return this.sendMessage(t)}sendState(e){const t=ms({action:ze.OBJECT,channel:this.name,state:e});return this.sendMessage(t)}async processMessage(e){e.action!==ze.ATTACHED&&e.action!==ze.MESSAGE&&e.action!==ze.PRESENCE&&e.action!==ze.OBJECT&&e.action!==ze.ANNOTATION||this.setChannelSerial(e.channelSerial);let t,s=!1;switch(e.action){case ze.ATTACHED:{this.properties.attachSerial=e.channelSerial,this._mode=e.getMode(),this.params=e.params||{};const t=e.decodeModesFromFlags();this.modes=t&&re(t)||void 0;const s=e.hasFlag("RESUMED"),a=e.hasFlag("HAS_PRESENCE"),i=e.hasFlag("HAS_BACKLOG"),n=e.hasFlag("HAS_OBJECTS");if("attached"===this.state){s||(this._presence&&this._presence.onAttached(a),this._objects&&this._objects.onAttached(n));const t=new gs(this.state,this.state,s,i,e.error);this._allChannelChanges.emit("update",t),s&&!this.channelOptions.updateOnAttached||this.emit("update",t)}else"detaching"===this.state?this.checkPendingState():this.notifyState("attached",e.error,s,a,i,n);break}case ze.DETACHED:{const t=e.error?E.fromValues(e.error):new E("Channel detached",90001,404);"detaching"===this.state?this.notifyState("detached",t):"attaching"===this.state?this.notifyState("suspended",t):"attached"!==this.state&&"suspended"!==this.state||this.requestState("attaching",t);break}case ze.SYNC:if(s=!0,t=this.syncChannelSerial=e.channelSerial,!e.presence)break;case ze.PRESENCE:{if(!e.presence)break;ot(e);const a=this.channelOptions;if(this._presence){const i=await Promise.all(e.presence.map(e=>e.decode(a,this.logger)));this._presence.setPresence(i,s,t)}break}case ze.OBJECT:case ze.OBJECT_SYNC:{if(!this._objects||!e.state)return;ot(e);const t=e.state,s=this.client.connection.connectionManager.getActiveTransportFormat();await Promise.all(t.map(e=>this.client._objectsPlugin.ObjectMessage.decode(e,this.client,this.logger,k,w,s))),e.action===ze.OBJECT?this._objects.handleObjectMessages(t):this._objects.handleObjectSyncMessages(t,e.channelSerial);break}case ze.MESSAGE:{if("attached"!==this.state)return void k.logAction(this.logger,k.LOG_MAJOR,"RealtimeChannel.processMessage()",'Message "'+e.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');ot(e);const t=e.messages,s=t[0],a=t[t.length-1];if(s.extras&&s.extras.delta&&s.extras.delta.from!==this._lastPayload.messageId){const t='Delta message decode failure - previous message not available for message "'+e.id+'" on this channel "'+this.name+'".';k.logAction(this.logger,k.LOG_ERROR,"RealtimeChannel.processMessage()",t),this._startDecodeFailureRecovery(new E(t,40018,400));break}let i=[];for(let e=0;e<t.length;e++){const{decoded:s,err:a}=await t[e].decodeWithErr(this._decodingContext,this.logger);if(i[e]=s,a)switch(a.code){case 40018:return void this._startDecodeFailureRecovery(a);case 40019:case 40021:return void this.notifyState("failed",a)}}this._lastPayload.messageId=a.id,this._lastPayload.protocolMessageChannelSerial=e.channelSerial,this.onEvent(i);break}case ze.ANNOTATION:{ot(e);const t=this.channelOptions;if(this._annotations){const s=await Promise.all((e.annotations||[]).map(e=>e.decode(t,this.logger)));this._annotations._processIncoming(s)}break}case ze.ERROR:{const t=e.error;t&&80016==t.code?this.checkPendingState():this.notifyState("failed",E.fromValues(t));break}default:k.logAction(this.logger,k.LOG_MAJOR,"RealtimeChannel.processMessage()","Protocol error: unrecognised message action ("+e.action+")")}}_startDecodeFailureRecovery(e){this._lastPayload.decodeFailureRecoveryInProgress||(k.logAction(this.logger,k.LOG_MAJOR,"RealtimeChannel.processMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,e,()=>{this._lastPayload.decodeFailureRecoveryInProgress=!1}))}onAttached(){k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)}notifyState(e,t,s,a,i,n){if(k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+e),this.clearStateTimer(),["detached","suspended","failed"].includes(e)&&(this.properties.channelSerial=null),e===this.state)return;this._presence&&this._presence.actOnChannelState(e,a,t),this._objects&&this._objects.actOnChannelState(e,n),"suspended"===e&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),t&&(this.errorReason=t);const r=new gs(this.state,e,s,i,t),o='Channel state for channel "'+this.name+'"',l=e+(t?"; reason: "+t:"");"failed"===e?k.logAction(this.logger,k.LOG_ERROR,o,l):k.logAction(this.logger,k.LOG_MAJOR,o,l),"attaching"!==e&&"suspended"!==e&&(this.retryCount=0),"attached"===e&&this.onAttached(),"attached"===e?this._attachResume=!0:"detaching"!==e&&"failed"!==e||(this._attachResume=!1),this.state=e,this._allChannelChanges.emit(e,r),this.emit(e,r)}requestState(e,t){k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+e),this.notifyState(e,t),this.checkPendingState()}checkPendingState(){if(this.connectionManager.state.sendEvents)switch(k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync()}else k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state)}timeoutPendingState(){switch(this.state){case"attaching":{const e=new E("Channel attach timed out",90007,408);this.notifyState("suspended",e);break}case"detaching":{const e=new E("Channel detach timed out",90007,408);this.notifyState("attached",e);break}default:this.checkPendingState()}}startStateTimerIfNotRunning(){this.stateTimer||(this.stateTimer=setTimeout(()=>{k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),this.stateTimer=null,this.timeoutPendingState()},this.client.options.timeouts.realtimeRequestTimeout))}clearStateTimer(){const e=this.stateTimer;e&&(clearTimeout(e),this.stateTimer=null)}startRetryTimer(){if(this.retryTimer)return;this.retryCount++;const e=ue(this.client.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(()=>{"suspended"===this.state&&this.connectionManager.state.sendEvents&&(this.retryTimer=null,k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),this.requestState("attaching"))},e)}cancelRetryTimer(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}getReleaseErr(){const e=this.state;return"initialized"===e||"detached"===e||"failed"===e?null:new E("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+e,90001,400)}setChannelSerial(e){k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+e+"; previous = "+this.properties.channelSerial),e&&(this.properties.channelSerial=e)}async status(){return this.client.rest.channelMixin.status(this)}},ks=class{constructor(e){this.channel=e,this.logger=e.logger,this.subscriptions=new We(this.logger)}async publish(e,t){const s=this.channel.name,a=rs(e,t),i=await a.encode();this.channel.throwIfUnpublishableState(),k.logAction(this.logger,k.LOG_MICRO,"RealtimeAnnotations.publish()","channelName = "+s+", sending annotation with messageSerial = "+a.messageSerial+", type = "+a.type);const n=ms({action:ze.ANNOTATION,channel:s,annotations:[i]});return this.channel.sendMessage(n)}async delete(e,t){return t.action="annotation.delete",this.publish(e,t)}async subscribe(...e){const t=_s.processListenerArgs(e),s=t[0],a=t[1],i=this.channel;if("failed"===i.state)throw E.fromValues(i.invalidStateError());if(this.subscriptions.on(s,a),!1!==this.channel.channelOptions.attachOnSubscribe&&await i.attach(),0===("attached"===this.channel.state&&this.channel._mode&Je.ANNOTATION_SUBSCRIBE))throw new E("You are trying to add an annotation listener, but you haven't requested the annotation_subscribe channel mode in ChannelOptions, so this won't do anything (we only deliver annotations to clients who have explicitly requested them)",93001,400)}unsubscribe(...e){const t=_s.processListenerArgs(e),s=t[0],a=t[1];this.subscriptions.off(s,a)}_processIncoming(e){for(const t of e)this.subscriptions.emit(t.type||"",t)}async get(e,t){return ls.prototype.get.call(this,e,t)}},ws=class e extends Kt{constructor(t){var s,a;if(!e._MsgPack)throw new Error("Expected DefaultRest._MsgPack to have been set");super(Re.objectifyOptions(t,!0,"Rest",k.defaultLogger,m(p({},Jt),{Crypto:null!=(s=e.Crypto)?s:void 0,MsgPack:null!=(a=e._MsgPack)?a:void 0,Annotations:{Annotation:as,WireAnnotation:ss,RealtimeAnnotations:ks,RestAnnotations:ls}})))}static get Crypto(){if(null===this._Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");return this._Crypto}static set Crypto(e){this._Crypto=e}};ws._Crypto=null,ws.Message=Yt,ws.PresenceMessage=Xt,ws.Annotation=is,ws._MsgPack=null,ws._Http=Be;var Ss,Es,Cs=ws,Ts=class extends We{constructor(e){super(e),this.messages=[]}count(){return this.messages.length}push(e){this.messages.push(e)}shift(){return this.messages.shift()}last(){return this.messages[this.messages.length-1]}copyAll(){return this.messages.slice()}append(e){this.messages.push.apply(this.messages,e)}prepend(e){this.messages.unshift.apply(this.messages,e)}completeMessages(e,t,s){k.logAction(this.logger,k.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+e+"; count = "+t),s=s||null;const a=this.messages;if(0===a.length)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");const i=a[0];if(i){const n=i.message.msgSerial,r=e+t;if(r>n){const e=a.splice(0,r-n);for(const t of e)t.callback(s)}0==a.length&&this.emit("idle")}}completeAllMessages(e){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,e)}resetSendAttempted(){for(let e of this.messages)e.sendAttempted=!1}clear(){k.logAction(this.logger,k.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")}},As=class{constructor(e,t){this.message=e,this.callback=t,this.merged=!1;const s=e.action;this.sendAttempted=!1,this.ackRequired="number"==typeof s&&[ze.MESSAGE,ze.PRESENCE,ze.ANNOTATION,ze.OBJECT].includes(s)}},Is=class extends We{constructor(e){super(e.logger),this.transport=e,this.messageQueue=new Ts(this.logger),e.on("ack",(e,t)=>{this.onAck(e,t)}),e.on("nack",(e,t,s)=>{this.onNack(e,t,s)})}onAck(e,t){k.logAction(this.logger,k.LOG_MICRO,"Protocol.onAck()","serial = "+e+"; count = "+t),this.messageQueue.completeMessages(e,t)}onNack(e,t,s){k.logAction(this.logger,k.LOG_ERROR,"Protocol.onNack()","serial = "+e+"; count = "+t+"; err = "+X(s)),s||(s=new E("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(e,t,s)}onceIdle(e){const t=this.messageQueue;0!==t.count()?t.once("idle",e):e()}send(e){e.ackRequired&&this.messageQueue.push(e),this.logger.shouldLog(k.LOG_MICRO)&&k.logActionNoStrip(this.logger,k.LOG_MICRO,"Protocol.send()","sending msg; "+vs(e.message,this.transport.connectionManager.realtime._RealtimePresence,this.transport.connectionManager.realtime._Annotations,this.transport.connectionManager.realtime._objectsPlugin)),e.sendAttempted=!0,this.transport.send(e.message)}getTransport(){return this.transport}getPendingMessages(){return this.messageQueue.copyAll()}clearPendingMessages(){return this.messageQueue.clear()}finish(){const e=this.transport;this.onceIdle(function(){e.disconnect()})}},Rs=class{constructor(e,t,s,a){this.previous=e,this.current=t,s&&(this.retryIn=s),a&&(this.reason=a)}},xs={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},Os={disconnected:()=>E.fromValues({statusCode:400,code:xs.DISCONNECTED,message:"Connection to server temporarily unavailable"}),suspended:()=>E.fromValues({statusCode:400,code:xs.SUSPENDED,message:"Connection to server unavailable"}),failed:()=>E.fromValues({statusCode:400,code:xs.FAILED,message:"Connection failed or disconnected by server"}),closing:()=>E.fromValues({statusCode:400,code:xs.CLOSING,message:"Connection closing"}),closed:()=>E.fromValues({statusCode:400,code:xs.CLOSED,message:"Connection closed"}),unknownConnectionErr:()=>E.fromValues({statusCode:500,code:xs.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"}),unknownChannelErr:()=>E.fromValues({statusCode:500,code:xs.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})},Ps=ms({action:ze.CLOSE}),Ns=ms({action:ze.DISCONNECT}),Ms=class extends We{constructor(e,t,s,a){super(e.logger),a&&(s.format=void 0,s.heartbeats=!0),this.connectionManager=e,this.auth=t,this.params=s,this.timeouts=s.options.timeouts,this.format=s.format,this.isConnected=!1,this.isFinished=!1,this.isDisposed=!1,this.maxIdleInterval=null,this.idleTimer=null,this.lastActivity=null}connect(){}close(){this.isConnected&&this.requestClose(),this.finish("closed",Os.closed())}disconnect(e){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",e||Os.disconnected())}fail(e){this.isConnected&&this.requestDisconnect(),this.finish("failed",e||Os.failed())}finish(e,t){var s;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout(null!=(s=this.idleTimer)?s:void 0),this.idleTimer=null,this.emit(e,t),this.dispose())}onProtocolMessage(e){switch(this.logger.shouldLog(k.LOG_MICRO)&&k.logActionNoStrip(this.logger,k.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+vs(e,this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),e.action){case ze.HEARTBEAT:k.logActionNoStrip(this.logger,k.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",e.id);break;case ze.CONNECTED:this.onConnect(e),this.emit("connected",e.error,e.connectionId,e.connectionDetails,e);break;case ze.CLOSED:this.onClose(e);break;case ze.DISCONNECTED:this.onDisconnect(e);break;case ze.ACK:this.emit("ack",e.msgSerial,e.count);break;case ze.NACK:this.emit("nack",e.msgSerial,e.count,e.error);break;case ze.SYNC:this.connectionManager.onChannelMessage(e,this);break;case ze.ACTIVATE:break;case ze.AUTH:ae(this.auth.authorize(),e=>{e&&k.logAction(this.logger,k.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+X(e))});break;case ze.ERROR:if(k.logAction(this.logger,k.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+f.Config.inspect(e.error)+(e.channel?", channel: "+e.channel:"")),void 0===e.channel){this.onFatalError(e);break}this.connectionManager.onChannelMessage(e,this);break;default:this.connectionManager.onChannelMessage(e,this)}}onConnect(e){if(this.isConnected=!0,!e.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");const t=e.connectionDetails.maxIdleInterval;t&&(this.maxIdleInterval=t+this.timeouts.realtimeRequestTimeout,this.onActivity())}onDisconnect(e){const t=e&&e.error;k.logAction(this.logger,k.LOG_MINOR,"Transport.onDisconnect()","err = "+X(t)),this.finish("disconnected",t)}onFatalError(e){const t=e&&e.error;k.logAction(this.logger,k.LOG_MINOR,"Transport.onFatalError()","err = "+X(t)),this.finish("failed",t)}onClose(e){const t=e&&e.error;k.logAction(this.logger,k.LOG_MINOR,"Transport.onClose()","err = "+X(t)),this.finish("closed",t)}requestClose(){k.logAction(this.logger,k.LOG_MINOR,"Transport.requestClose()",""),this.send(Ps)}requestDisconnect(){k.logAction(this.logger,k.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(Ns)}ping(e){const t={action:ze.HEARTBEAT};e&&(t.id=e),this.send(ms(t))}dispose(){k.logAction(this.logger,k.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()}onActivity(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=Date.now(),this.setIdleTimer(this.maxIdleInterval+100))}setIdleTimer(e){this.idleTimer||(this.idleTimer=setTimeout(()=>{this.onIdleTimerExpire()},e))}onIdleTimerExpire(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;const e=Date.now()-this.lastActivity,t=this.maxIdleInterval-e;if(t<=0){const t="No activity seen from realtime in "+e+"ms; assuming connection has dropped";k.logAction(this.logger,k.LOG_ERROR,"Transport.onIdleTimerExpire()",t),this.disconnect(new E(t,80003,408))}else this.setIdleTimer(t+100)}static tryConnect(e,t,s,a,i){const n=new e(t,s,a);let r;const o=function(e){clearTimeout(r),i({event:this.event,error:e})},l=t.options.timeouts.realtimeRequestTimeout;return r=setTimeout(()=>{n.off(["preconnect","disconnected","failed"]),n.dispose(),o.call({event:"disconnected"},new E("Timeout waiting for transport to indicate itself viable",5e4,500))},l),n.on(["failed","disconnected"],o),n.on("preconnect",function(){k.logAction(t.logger,k.LOG_MINOR,"Transport.tryConnect()","viable transport "+n),clearTimeout(r),n.off(["failed","disconnected"],o),i(null,n)}),n.connect(),n}static isAvailable(){throw new E("isAvailable not implemented for transport",5e4,500)}};(Es=Ss||(Ss={})).WebSocket="web_socket",Es.Comet="comet",Es.XhrPolling="xhr_polling";var Ds=void 0!==z?z:"undefined"!=typeof window?window:self,Ls=()=>{var e;return void 0!==f.WebStorage&&(null==(e=f.WebStorage)?void 0:e.localSupported)},Us=()=>{var e;return void 0!==f.WebStorage&&(null==(e=f.WebStorage)?void 0:e.sessionSupported)},qs=function(){},Vs="ably-transport-preference";function $s(e){try{return JSON.parse(e)}catch(t){return null}}var js=class{constructor(e,t,s,a){this.options=e,this.host=t,this.mode=s,this.connectionKey=a,this.format=e.useBinaryProtocol?"msgpack":"json"}getConnectParams(e){const t=e?A(e):{},s=this.options;switch(this.mode){case"resume":t.resume=this.connectionKey;break;case"recover":{const e=$s(s.recover);e&&(t.recover=e.connectionKey);break}}return void 0!==s.clientId&&(t.clientId=s.clientId),!1===s.echoMessages&&(t.echo="false"),void 0!==this.format&&(t.format=this.format),void 0!==this.stream&&(t.stream=this.stream),void 0!==this.heartbeats&&(t.heartbeats=this.heartbeats),t.v=Re.protocolVersion,t.agent=Ce(this.options),void 0!==s.transportParams&&T(t,s.transportParams),t}toString(){let e="[mode="+this.mode;return this.host&&(e+=",host="+this.host),this.connectionKey&&(e+=",connectionKey="+this.connectionKey),this.format&&(e+=",format="+this.format),e+="]",e}},Fs=class e extends We{constructor(e,t){super(e.logger),this.supportedTransports={},this.disconnectedRetryCount=0,this.pendingChannelMessagesState={isProcessing:!1,queue:[]},this.realtime=e,this.initTransports(),this.options=t;const s=t.timeouts,a=s.webSocketConnectTimeout+s.realtimeRequestTimeout;if(this.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:a,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:s.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:s.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:s.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},this.state=this.states.initialized,this.errorReason=null,this.queuedMessages=new Ts(this.logger),this.msgSerial=0,this.connectionDetails=void 0,this.connectionId=void 0,this.connectionKey=void 0,this.connectionStateTtl=s.connectionStateTtl,this.maxIdleInterval=null,this.transports=L(t.transports||Re.defaultTransports,this.supportedTransports),this.transportPreference=null,this.transports.includes(Ss.WebSocket)&&(this.webSocketTransportAvailable=!0),this.transports.includes(Ss.XhrPolling)?this.baseTransport=Ss.XhrPolling:this.transports.includes(Ss.Comet)&&(this.baseTransport=Ss.Comet),this.httpHosts=Re.getHosts(t),this.wsHosts=Re.getHosts(t,!0),this.activeProtocol=null,this.host=null,this.lastAutoReconnectAttempt=null,this.lastActivity=null,this.forceFallbackHost=!1,this.connectCounter=0,this.wsCheckResult=null,this.webSocketSlowTimer=null,this.webSocketGiveUpTimer=null,this.abandonedWebSocket=!1,k.logAction(this.logger,k.LOG_MINOR,"Realtime.ConnectionManager()","started"),k.logAction(this.logger,k.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(t.transports||Re.defaultTransports)+"]"),k.logAction(this.logger,k.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+this.transports+"]"),k.logAction(this.logger,k.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+this.httpHosts+"]"),!this.transports.length){const e="no requested transports available";throw k.logAction(this.logger,k.LOG_ERROR,"realtime.ConnectionManager()",e),new Error(e)}const i=f.Config.addEventListener;i&&(Us()&&"function"==typeof t.recover&&i("beforeunload",this.persistConnection.bind(this)),!0===t.closeOnUnload&&i("beforeunload",()=>{k.logAction(this.logger,k.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),this.requestState({state:"closing"})}),i("online",()=>{var e;this.state==this.states.disconnected||this.state==this.states.suspended?(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager caught browser ‘online’ event","reattempting connection"),this.requestState({state:"connecting"})):this.state==this.states.connecting&&(null==(e=this.pendingTransport)||e.off(),this.disconnectAllTransports(),this.startConnect())}),i("offline",()=>{this.state==this.states.connected&&(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager caught browser ‘offline’ event","disconnecting active transport"),this.disconnectAllTransports())}))}static supportedTransports(e){const t={supportedTransports:{}};return this.initTransports(e,t),t.supportedTransports}static initTransports(e,t){const s=p(p({},f.Transports.bundledImplementations),e);[Ss.WebSocket,...f.Transports.order].forEach(e=>{const a=s[e];a&&a.isAvailable()&&(t.supportedTransports[e]=a)})}initTransports(){e.initTransports(this.realtime._additionalTransportImplementations,this)}createTransportParams(e,t){return new js(this.options,e,t,this.connectionKey)}getTransportParams(e){(e=>{if(this.connectionKey)return void e("resume");if("string"==typeof this.options.recover)return void e("recover");const t=this.options.recover,s=this.getSessionRecoverData(),a=this.sessionRecoveryName();if(s&&"function"==typeof t)return k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data (recovery scope: "+a+")"),void t(s,t=>{t?(this.options.recover=s.recoveryKey,e("recover")):e("clean")});e("clean")})(t=>{const s=this.createTransportParams(null,t);if("recover"===t){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+this.options.recover);const e=$s(this.options.recover);e&&(this.msgSerial=e.msgSerial)}else k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+s.toString());e(s)})}tryATransport(e,t,s){k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+t),this.proposedTransport=Ms.tryConnect(this.supportedTransports[t],this,this.realtime.auth,e,(a,i)=>{const n=this.state;return n==this.states.closing||n==this.states.closed||n==this.states.failed?(i&&(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+n.state+" while we were attempting the transport; closing "+i),i.close()),void s(!0)):a?(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+t+" "+a.event+", err: "+a.error.toString()),void(!je.isTokenErr(a.error)||this.errorReason&&je.isTokenErr(this.errorReason)?"failed"===a.event?(this.notifyState({state:"failed",error:a.error}),s(!0)):"disconnected"===a.event&&(!(r=a.error).statusCode||!r.code||r.statusCode>=500||Object.values(xs).includes(r.code)?s(!1):(this.notifyState({state:this.states.connecting.failState,error:a.error}),s(!0))):(this.errorReason=a.error,ae(this.realtime.auth._forceNewToken(null,null),a=>{a?this.actOnErrorFromAuthorize(a):this.tryATransport(e,t,s)})))):(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+t+"; setting pending"),this.setTransportPending(i,e),void s(null,i));var r})}setTransportPending(e,t){const s=t.mode;k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+e+"; mode = "+s),this.pendingTransport=e,this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),e.once("connected",(t,a,i)=>{this.activateTransport(t,e,a,i),"recover"===s&&this.options.recover&&(delete this.options.recover,this.unpersistConnection())});const a=this;e.on(["disconnected","closed","failed"],function(t){a.deactivateTransport(e,this.event,t)}),this.emit("transport.pending",e)}activateTransport(e,t,s,a){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+t),e&&k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+e),s&&k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+s),a&&k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(a)),this.persistTransportPreference(t);const i=this.state,n=this.states.connected.state;if(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+i.state),i.state==this.states.closing.state||i.state==this.states.closed.state||i.state==this.states.failed.state)return k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),t.disconnect(),!1;if(delete this.pendingTransport,!t.isConnected)return k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+t+" since it appears to no longer be connected"),!1;const r=this.activeProtocol;this.activeProtocol=new Is(t),this.host=t.params.host;const o=a.connectionKey;if(o&&this.connectionKey!=o&&this.setConnection(s,a,!!e),this.onConnectionDetailsUpdate(a,t),f.Config.nextTick(()=>{t.on("connected",(e,s,a)=>{this.onConnectionDetailsUpdate(a,t),this.emit("update",new Rs(n,n,null,e))})}),i.state===this.states.connected.state?e&&(this.errorReason=this.realtime.connection.errorReason=e,this.emit("update",new Rs(n,n,null,e))):(this.notifyState({state:"connected",error:e}),this.errorReason=this.realtime.connection.errorReason=e||null),this.emit("transport.active",t),r)if(r.messageQueue.count()>0&&k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+r.transport.shortName+", new one is "+t.shortName+") finishing with "+r.messageQueue.count()+" messages still pending"),r.transport===t){const e="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+t.shortName+"; stack = "+(new Error).stack;k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.activateTransport()",e)}else r.finish();return!0}deactivateTransport(e,t,s){const a=this.activeProtocol,i=a&&a.getTransport()===e,n=e===this.pendingTransport,r=this.noTransportsScheduledForActivation();if(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+e),k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+t+(i?"; was active":n?"; was pending":"")+(r?"":"; another transport is scheduled for activation")),s&&s.message&&k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+s.message),i&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(a.getPendingMessages()),a.clearPendingMessages(),this.activeProtocol=this.host=null),this.emit("transport.inactive",e),i&&r||i&&"failed"===t||"closed"===t||null===a&&n){if("disconnected"===t&&s&&s.statusCode>500&&this.httpHosts.length>1)return this.unpersistTransportPreference(),this.forceFallbackHost=!0,void this.notifyState({state:t,error:s,retryImmediately:!0});const e="failed"===t&&je.isTokenErr(s)?"disconnected":t;return void this.notifyState({state:e,error:s})}}noTransportsScheduledForActivation(){return!this.pendingTransport||!this.pendingTransport.isConnected}setConnection(e,t,s){const a=this.connectionId;(a&&a!==e||!a&&s)&&(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==e&&k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=e,this.realtime.connection.key=this.connectionKey=t.connectionKey}clearConnection(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()}createRecoveryKey(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null}checkConnectionStateFreshness(){if(!this.lastActivity||!this.connectionId)return;const e=Date.now()-this.lastActivity;e>this.connectionStateTtl+this.maxIdleInterval&&(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+e+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}persistConnection(){if(Us()){const e=this.createRecoveryKey();e&&this.setSessionRecoverData({recoveryKey:e,disconnectedAt:Date.now(),location:Ds.location,clientId:this.realtime.auth.clientId})}}unpersistConnection(){this.clearSessionRecoverData()}getActiveTransportFormat(){var e;return null==(e=this.activeProtocol)?void 0:e.getTransport().format}getError(){if(this.errorReason){const e=C.fromValues(this.errorReason);return e.cause=this.errorReason,e}return this.getStateError()}getStateError(){var e,t;return null==(t=(e=Os)[this.state.state])?void 0:t.call(e)}activeState(){return this.state.queueEvents||this.state.sendEvents}enactStateChange(e){const t="Connection state",s=e.current+(e.reason?"; reason: "+e.reason:"");"failed"===e.current?k.logAction(this.logger,k.LOG_ERROR,t,s):k.logAction(this.logger,k.LOG_MAJOR,t,s),k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+e.current+"; reason = "+(e.reason&&e.reason.message));const a=this.state=this.states[e.current];e.reason&&(this.errorReason=e.reason,this.realtime.connection.errorReason=e.reason),(a.terminal||"suspended"===a.state)&&this.clearConnection(),this.emit("connectionstate",e)}startTransitionTimer(e){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+e.state),this.transitionTimer&&(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(()=>{this.transitionTimer&&(this.transitionTimer=null,k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager "+e.state+" timer expired","requesting new state: "+e.failState),this.notifyState({state:e.failState}))},e.retryDelay)}cancelTransitionTimer(){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)}startSuspendTimer(){this.suspendTimer||(this.suspendTimer=setTimeout(()=>{this.suspendTimer&&(this.suspendTimer=null,k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),this.states.connecting.failState="suspended",this.notifyState({state:"suspended"}))},this.connectionStateTtl))}checkSuspendTimer(e){"disconnected"!==e&&"suspended"!==e&&"connecting"!==e&&this.cancelSuspendTimer()}cancelSuspendTimer(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)}startRetryTimer(e){this.retryTimer=setTimeout(()=>{k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),this.retryTimer=null,this.requestState({state:"connecting"})},e)}cancelRetryTimer(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}startWebSocketSlowTimer(){this.webSocketSlowTimer=setTimeout(()=>{k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager WebSocket slow timer","checking connectivity"),this.checkWsConnectivity().then(()=>{k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager WebSocket slow timer","ws connectivity check succeeded"),this.wsCheckResult=!0}).catch(()=>{k.logAction(this.logger,k.LOG_MAJOR,"ConnectionManager WebSocket slow timer","ws connectivity check failed"),this.wsCheckResult=!1}),this.realtime.http.checkConnectivity&&ae(this.realtime.http.checkConnectivity(),(e,t)=>{e||!t?(k.logAction(this.logger,k.LOG_MAJOR,"ConnectionManager WebSocket slow timer","http connectivity check failed"),this.cancelWebSocketGiveUpTimer(),this.notifyState({state:"disconnected",error:new E("Unable to connect (network unreachable)",80003,404)})):k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager WebSocket slow timer","http connectivity check succeeded")})},this.options.timeouts.webSocketSlowTimeout)}cancelWebSocketSlowTimer(){this.webSocketSlowTimer&&(clearTimeout(this.webSocketSlowTimer),this.webSocketSlowTimer=null)}startWebSocketGiveUpTimer(e){this.webSocketGiveUpTimer=setTimeout(()=>{var t,s;this.wsCheckResult||(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager WebSocket give up timer","websocket connection took more than 10s; "+(this.baseTransport?"trying base transport":"")),this.baseTransport?(this.abandonedWebSocket=!0,null==(t=this.proposedTransport)||t.dispose(),null==(s=this.pendingTransport)||s.dispose(),this.connectBase(e,++this.connectCounter)):k.logAction(this.logger,k.LOG_MAJOR,"ConnectionManager WebSocket give up timer","websocket connectivity appears to be unavailable but no other transports to try"))},this.options.timeouts.webSocketConnectTimeout)}cancelWebSocketGiveUpTimer(){this.webSocketGiveUpTimer&&(clearTimeout(this.webSocketGiveUpTimer),this.webSocketGiveUpTimer=null)}notifyState(e){var t,s;const a=e.state,i="disconnected"===a&&(this.state===this.states.connected||e.retryImmediately||this.state===this.states.connecting&&e.error&&je.isTokenErr(e.error)&&!(this.errorReason&&je.isTokenErr(this.errorReason)));if(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+a+(i?"; will retry connection immediately":"")),a==this.state.state)return;if(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),this.checkSuspendTimer(e.state),"suspended"!==a&&"connected"!==a||(this.disconnectedRetryCount=0),this.state.terminal)return;const n=this.states[e.state];let r=n.retryDelay;"disconnected"===n.state&&(this.disconnectedRetryCount++,r=ue(n.retryDelay,this.disconnectedRetryCount));const o=new Rs(this.state.state,n.state,r,e.error||(null==(s=(t=Os)[n.state])?void 0:s.call(t)));if(i){const e=()=>{this.state===this.states.disconnected&&(this.lastAutoReconnectAttempt=Date.now(),this.requestState({state:"connecting"}))},t=this.lastAutoReconnectAttempt&&Date.now()-this.lastAutoReconnectAttempt+1;t&&t<1e3?(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+t+"ms ago, waiting another "+(1e3-t)+"ms before trying again"),setTimeout(e,1e3-t)):f.Config.nextTick(e)}else"disconnected"!==a&&"suspended"!==a||this.startRetryTimer(r);("disconnected"===a&&!i||"suspended"===a||n.terminal)&&f.Config.nextTick(()=>{this.disconnectAllTransports()}),"connected"!=a||this.activeProtocol||k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(o),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(a,o.reason),this.failQueuedMessages(o.reason))}requestState(e){var t,s;const a=e.state;if(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+a+"; current state: "+this.state.state),a==this.state.state)return;if(this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(a),"connecting"==a&&"connected"==this.state.state)return;if("closing"==a&&"closed"==this.state.state)return;const i=this.states[a],n=new Rs(this.state.state,i.state,null,e.error||(null==(s=(t=Os)[i.state])?void 0:s.call(t)));this.enactStateChange(n),"connecting"==a&&f.Config.nextTick(()=>{this.startConnect()}),"closing"==a&&this.closeImpl()}startConnect(){if(this.state!==this.states.connecting)return void k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);const e=this.realtime.auth,t=++this.connectCounter,s=()=>{this.checkConnectionStateFreshness(),this.getTransportParams(e=>{if("recover"===e.mode&&e.options.recover){const t=$s(e.options.recover);t&&this.realtime.channels.recoverChannels(t.channelSerials)}t===this.connectCounter&&this.connectImpl(e,t)})};if(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),"basic"===e.method)s();else{const a=e=>{t===this.connectCounter&&(e?this.actOnErrorFromAuthorize(e):s())};this.errorReason&&je.isTokenErr(this.errorReason)?ae(e._forceNewToken(null,null),a):ae(e._ensureValidAuthCredentials(!1),a)}}connectImpl(e,t){const s=this.state.state;if(s!==this.states.connecting.state)return void k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect, but was "+s);const a=this.getTransportPreference();a&&a===this.baseTransport&&this.webSocketTransportAvailable&&this.checkWsConnectivity().then(()=>{this.unpersistTransportPreference(),this.state===this.states.connecting&&(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.connectImpl():","web socket connectivity available, cancelling connection attempt with "+this.baseTransport),this.disconnectAllTransports(),this.connectWs(e,++this.connectCounter))}).catch(qs),a&&a===this.baseTransport||this.baseTransport&&!this.webSocketTransportAvailable?this.connectBase(e,t):this.connectWs(e,t)}connectWs(e,t){k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.connectWs()"),this.wsCheckResult=null,this.abandonedWebSocket=!1,this.startWebSocketSlowTimer(),this.startWebSocketGiveUpTimer(e),this.tryTransportWithFallbacks("web_socket",e,!0,t,()=>!1!==this.wsCheckResult&&!this.abandonedWebSocket)}connectBase(e,t){k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.connectBase()"),this.baseTransport?this.tryTransportWithFallbacks(this.baseTransport,e,!1,t,()=>!0):this.notifyState({state:"disconnected",error:new E("No transports left to try",8e4,404)})}tryTransportWithFallbacks(e,t,s,a,i){k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.tryTransportWithFallbacks()",e);const n=e=>{this.notifyState({state:this.states.connecting.failState,error:e})},r=s?this.wsHosts.slice():this.httpHosts.slice(),o=(e,t)=>{a===this.connectCounter&&(i()?t||e||c():t&&t.dispose())},l=r.shift();if(!l)return void n(new E("Unable to connect (no available host)",80003,404));t.host=l;const c=()=>{r.length?this.realtime.http.checkConnectivity?ae(this.realtime.http.checkConnectivity(),(s,l)=>{a===this.connectCounter&&i()&&(s?n(s):l?(t.host=W(r),this.tryATransport(t,e,o)):n(new E("Unable to connect (network unreachable)",80003,404)))}):n(new C("Internal error: Http.checkConnectivity not set",null,500)):n(new E("Unable to connect (and no more fallback hosts to try)",80003,404))};if(this.forceFallbackHost&&r.length)return this.forceFallbackHost=!1,void c();this.tryATransport(t,e,o)}closeImpl(){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),this.pendingTransport&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+this.pendingTransport),this.pendingTransport.close()),this.activeProtocol&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})}onAuthUpdated(e,t){var s;switch(this.state.state){case"connected":{k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport");const a=null==(s=this.activeProtocol)?void 0:s.getTransport();a&&a.onAuthUpdated&&a.onAuthUpdated(e);const i=ms({action:ze.AUTH,auth:{accessToken:e.token}});this.send(i);const n=()=>{this.off(r),t(null,e)},r=e=>{"failed"===e.current&&(this.off(n),this.off(r),t(e.reason||this.getStateError()))};this.once("connectiondetails",n),this.on("connectionstate",r);break}case"connecting":k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");const s=a=>{switch(a.current){case"connected":this.off(s),t(null,e);break;case"failed":case"closed":case"suspended":this.off(s),t(a.reason||this.getStateError())}};this.on("connectionstate",s),"connecting"===this.state.state?this.startConnect():this.requestState({state:"connecting"})}}}disconnectAllTransports(){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"),this.connectCounter++,this.pendingTransport&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+this.pendingTransport),this.pendingTransport.disconnect()),delete this.pendingTransport,this.proposedTransport&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting proposed transport: "+this.pendingTransport),this.proposedTransport.disconnect()),delete this.pendingTransport,this.activeProtocol&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())}send(e,t,s){s=s||qs;const a=this.state;if(a.sendEvents)return k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.send()","sending event"),void this.sendImpl(new As(e,s));if(!t||!a.queueEvents){const e="rejecting event, queueEvent was "+t+", state was "+a.state;return k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.send()",e),void s(this.errorReason||new E(e,9e4,400))}this.logger.shouldLog(k.LOG_MICRO)&&k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+vs(e,this.realtime._RealtimePresence,this.realtime._Annotations,this.realtime._objectsPlugin)),this.queue(e,s)}sendImpl(e){const t=e.message;e.ackRequired&&!e.sendAttempted&&(t.msgSerial=this.msgSerial++);try{this.activeProtocol.send(e)}catch(s){k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+s.stack)}}queue(e,t){k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.queue()","queueing event");const s=this.queuedMessages.last(),a=this.options.maxMessageSize;s&&!s.sendAttempted&&function(e,t,s){let a;if(e.channel!==t.channel)return!1;if((a=e.action)!==ze.PRESENCE&&a!==ze.MESSAGE)return!1;if(a!==t.action)return!1;const i=a===ze.PRESENCE?"presence":"messages",n=e[i].concat(t[i]);return!(qt(n)>s||!B(n,"clientId")||!n.every(function(e){return!e.id})||(e[i]=n,0))}(s.message,e,a)?(s.merged||(s.callback=xe.create(this.logger,[s.callback]),s.merged=!0),s.callback.push(t)):this.queuedMessages.push(new As(e,t))}sendQueuedMessages(){let e;for(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");e=this.queuedMessages.shift();)this.sendImpl(e)}queuePendingMessages(e){e&&e.length&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+e.length+" pending messages"),this.queuedMessages.prepend(e))}failQueuedMessages(e){const t=this.queuedMessages.count();t>0&&(k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+t+" queued messages, err = "+X(e)),this.queuedMessages.completeAllMessages(e))}onChannelMessage(e,t){this.pendingChannelMessagesState.queue.push({message:e,transport:t}),this.pendingChannelMessagesState.isProcessing||this.processNextPendingChannelMessage()}processNextPendingChannelMessage(){if(this.pendingChannelMessagesState.queue.length>0){this.pendingChannelMessagesState.isProcessing=!0;const e=this.pendingChannelMessagesState.queue.shift();this.processChannelMessage(e.message).catch(e=>{k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.processNextPendingChannelMessage() received error ",e)}).finally(()=>{this.pendingChannelMessagesState.isProcessing=!1,this.processNextPendingChannelMessage()})}}async processChannelMessage(e){await this.realtime.channels.processChannelMessage(e)}async ping(){var e;if("connected"!==this.state.state)throw new E("Unable to ping service; not connected",4e4,400);const t=null==(e=this.activeProtocol)?void 0:e.getTransport();if(!t)throw this.getStateError();k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.ping()","transport = "+t);const s=Date.now(),a=ee();return ye(new Promise(e=>{const i=n=>{n===a&&(t.off("heartbeat",i),e(Date.now()-s))};t.on("heartbeat",i),t.ping(a)}),this.options.timeouts.realtimeRequestTimeout,"Timeout waiting for heartbeat response")}abort(e){this.activeProtocol.getTransport().fail(e)}getTransportPreference(){var e,t;return this.transportPreference||Ls()&&(null==(t=null==(e=f.WebStorage)?void 0:e.get)?void 0:t.call(e,Vs))}persistTransportPreference(e){var t,s;this.transportPreference=e.shortName,Ls()&&(null==(s=null==(t=f.WebStorage)?void 0:t.set)||s.call(t,Vs,e.shortName))}unpersistTransportPreference(){var e,t;this.transportPreference=null,Ls()&&(null==(t=null==(e=f.WebStorage)?void 0:e.remove)||t.call(e,Vs))}actOnErrorFromAuthorize(e){if(40171===e.code)this.notifyState({state:"failed",error:e});else if(40102===e.code)this.notifyState({state:"failed",error:e});else if(e.statusCode===Me.Forbidden){const t="Client configured authentication provider returned 403; failing the connection";k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",t),this.notifyState({state:"failed",error:new E(t,80019,403,e)})}else{const t="Client configured authentication provider request failed";k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",t),this.notifyState({state:this.state.failState,error:new E(t,80019,401,e)})}}onConnectionDetailsUpdate(e,t){if(!e)return;this.connectionDetails=e,e.maxMessageSize&&(this.options.maxMessageSize=e.maxMessageSize);const s=e.clientId;if(s){const e=this.realtime.auth._uncheckedSetClientId(s);if(e)return k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",e.message),void t.fail(e)}const a=e.connectionStateTtl;a&&(this.connectionStateTtl=a),this.maxIdleInterval=e.maxIdleInterval,this.emit("connectiondetails",e)}checkWsConnectivity(){const e=this.options.wsConnectivityCheckUrl||Re.wsConnectivityCheckUrl,t=new f.Config.WebSocket(e);return new Promise((e,s)=>{let a=!1;t.onopen=()=>{a||(a=!0,e(),t.close())},t.onclose=t.onerror=()=>{a||(a=!0,s())}})}sessionRecoveryName(){return this.options.recoveryKeyStorageName||"ably-connection-recovery"}getSessionRecoverData(){var e,t;return Us()&&(null==(t=null==(e=f.WebStorage)?void 0:e.getSession)?void 0:t.call(e,this.sessionRecoveryName()))}setSessionRecoverData(e){var t,s;return Us()&&(null==(s=null==(t=f.WebStorage)?void 0:t.setSession)?void 0:s.call(t,this.sessionRecoveryName(),e))}clearSessionRecoverData(){var e,t;return Us()&&(null==(t=null==(e=f.WebStorage)?void 0:e.removeSession)?void 0:t.call(e,this.sessionRecoveryName()))}},Gs=class extends We{constructor(e,t){super(e.logger),this.whenState=e=>We.prototype.whenState.call(this,e,this.state),this.ably=e,this.connectionManager=new Fs(e,t),this.state=this.connectionManager.state.state,this.key=void 0,this.id=void 0,this.errorReason=null,this.connectionManager.on("connectionstate",e=>{const t=this.state=e.current;f.Config.nextTick(()=>{this.emit(t,e)})}),this.connectionManager.on("update",e=>{f.Config.nextTick(()=>{this.emit("update",e)})})}connect(){k.logAction(this.logger,k.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})}async ping(){return k.logAction(this.logger,k.LOG_MINOR,"Connection.ping()",""),this.connectionManager.ping()}close(){k.logAction(this.logger,k.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})}get recoveryKey(){return this.logger.deprecationWarning("The `Connection.recoveryKey` attribute has been replaced by the `Connection.createRecoveryKey()` method. Replace your usage of `recoveryKey` with the return value of `createRecoveryKey()`. `recoveryKey` will be removed in a future version."),this.createRecoveryKey()}createRecoveryKey(){return this.connectionManager.createRecoveryKey()}},Bs=class e extends dt{constructor(t){var s,a,i,n;if(super(Re.objectifyOptions(t,!1,"BaseRealtime",k.defaultLogger)),k.logAction(this.logger,k.LOG_MINOR,"Realtime()",""),"string"==typeof EdgeRuntime)throw new E('Ably.Realtime instance cannot be used in Vercel Edge runtime. If you are running Vercel Edge functions, please replace your "new Ably.Realtime()" with "new Ably.Rest()" and use Ably Rest API instead of the Realtime API. If you are server-rendering your application in the Vercel Edge runtime, please use the condition "if (typeof EdgeRuntime === \'string\')" to prevent instantiating Ably.Realtime instance during SSR in the Vercel Edge runtime.',4e4,400);this._additionalTransportImplementations=e.transportImplementationsFromPlugins(this.options.plugins),this._RealtimePresence=null!=(a=null==(s=this.options.plugins)?void 0:s.RealtimePresence)?a:null,this._objectsPlugin=null!=(n=null==(i=this.options.plugins)?void 0:i.Objects)?n:null,this.connection=new Gs(this,this.options),this._channels=new Ws(this),!1!==this.options.autoConnect&&this.connect()}static transportImplementationsFromPlugins(e){const t={};return(null==e?void 0:e.WebSocketTransport)&&(t[Ss.WebSocket]=e.WebSocketTransport),(null==e?void 0:e.XHRPolling)&&(t[Ss.XhrPolling]=e.XHRPolling),t}get channels(){return this._channels}connect(){k.logAction(this.logger,k.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()}close(){k.logAction(this.logger,k.LOG_MINOR,"Realtime.close()",""),this.connection.close()}};Bs.EventEmitter=We;var Hs=Bs,Ws=class extends We{constructor(e){super(e.logger),this.realtime=e,this.all=Object.create(null),e.connection.connectionManager.on("transport.active",()=>{this.onTransportActive()})}channelSerials(){let e={};for(const t of j(this.all,!0)){const s=this.all[t];s.properties.channelSerial&&(e[t]=s.properties.channelSerial)}return e}recoverChannels(e){for(const t of j(e,!0))this.get(t).properties.channelSerial=e[t]}async processChannelMessage(e){const t=e.channel;if(void 0===t)return void k.logAction(this.logger,k.LOG_ERROR,"Channels.processChannelMessage()","received event unspecified channel, action = "+e.action);const s=this.all[t];s?await s.processMessage(e):k.logAction(this.logger,k.LOG_ERROR,"Channels.processChannelMessage()","received event for non-existent channel: "+t)}onTransportActive(){for(const e in this.all){const t=this.all[e];"attaching"===t.state||"detaching"===t.state?t.checkPendingState():"suspended"===t.state?t._attach(!1,null):"attached"===t.state&&t.requestState("attaching")}}propogateConnectionInterruption(e,t){const s=["attaching","attached","detaching","suspended"],a={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"}[e];for(const i in this.all){const e=this.all[i];s.includes(e.state)&&e.notifyState(a,t)}}get(e,t){e=String(e);let s=this.all[e];if(s){if(t){if(s._shouldReattachToSetOptions(t,s.channelOptions))throw new E("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);s.setOptions(t)}}else s=this.all[e]=new _s(this.realtime,e,t);return s}getDerived(e,t,s){if(t.filter){const s=ve(t.filter),a=me(e);e=`[filter=${s}${a.qualifierParam}]${a.channelName}`}return this.get(e,s)}release(e){e=String(e);const t=this.all[e];if(!t)return;const s=t.getReleaseErr();if(s)throw s;delete this.all[e]}},zs=Hs;function Ks(e,t){if(e.isSynthesized()||t.isSynthesized())return e.timestamp>=t.timestamp;const s=e.parseId(),a=t.parseId();return s.msgSerial===a.msgSerial?s.index>a.index:s.msgSerial>a.msgSerial}var Js=class extends We{constructor(e,t,s=Ks){super(e.logger),this.presence=e,this.map=Object.create(null),this.syncInProgress=!1,this.residualMembers=null,this.memberKey=t,this.newerThan=s}get(e){return this.map[e]}getClient(e){const t=this.map,s=[];for(const a in t){const i=t[a];i.clientId==e&&"absent"!=i.action&&s.push(i)}return s}list(e){const t=this.map,s=e&&e.clientId,a=e&&e.connectionId,i=[];for(const n in t){const e=t[n];"absent"!==e.action&&(s&&s!=e.clientId||a&&a!=e.connectionId||i.push(e))}return i}put(e){"enter"!==e.action&&"update"!==e.action||((e=xt.fromValues(e)).action="present");const t=this.map,s=this.memberKey(e);this.residualMembers&&delete this.residualMembers[s];const a=t[s];return!(a&&!this.newerThan(e,a)||(t[s]=e,0))}values(){const e=this.map,t=[];for(const s in e){const a=e[s];"absent"!=a.action&&t.push(a)}return t}remove(e){const t=this.map,s=this.memberKey(e),a=t[s];return!(a&&!this.newerThan(e,a)||(this.syncInProgress?((e=xt.fromValues(e)).action="absent",t[s]=e):delete t[s],!a))}startSync(){const e=this.map,t=this.syncInProgress;k.logAction(this.logger,k.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+t),this.syncInProgress||(this.residualMembers=A(e),this.setInProgress(!0))}endSync(){const e=this.map,t=this.syncInProgress;if(k.logAction(this.logger,k.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+t),t){for(const t in e)"absent"===e[t].action&&delete e[t];this.presence._synthesizeLeaves(F(this.residualMembers));for(const t in this.residualMembers)delete e[t];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")}waitSync(e){const t=this.syncInProgress;k.logAction(this.logger,k.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+t),t?this.once("sync",e):e()}clear(){this.map={},this.setInProgress(!1),this.residualMembers=null}setInProgress(e){k.logAction(this.logger,k.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+e),this.syncInProgress=e,this.presence.syncComplete=!e}};function Ys(e){const t=e.channel.client,s=t.auth.clientId;return(!s||"*"===s)&&"connected"===t.connection.state}var Xs=class extends We{constructor(e){super(e.logger),this.channel=e,this.syncComplete=!1,this.members=new Js(this,e=>e.clientId+":"+e.connectionId),this._myMembers=new Js(this,e=>e.clientId),this.subscriptions=new We(this.logger),this.pendingPresence=[]}async enter(e){if(Ys(this))throw new E("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,e,"enter")}async update(e){if(Ys(this))throw new E("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,e,"update")}async enterClient(e,t){return this._enterOrUpdateClient(void 0,e,t,"enter")}async updateClient(e,t){return this._enterOrUpdateClient(void 0,e,t,"update")}async _enterOrUpdateClient(e,t,s,a){const i=this.channel;if(!i.connectionManager.activeState())throw i.connectionManager.getError();k.logAction(this.logger,k.LOG_MICRO,"RealtimePresence."+a+"Client()","channel = "+i.name+", id = "+e+", client = "+(t||"(implicit) "+this.channel.client.auth.clientId));const n=xt.fromData(s);n.action=a,e&&(n.id=e),t&&(n.clientId=t);const r=await n.encode(i.channelOptions);switch(i.state){case"attached":return i.sendPresence([r]);case"initialized":case"detached":i.attach();case"attaching":return new Promise((e,t)=>{this.pendingPresence.push({presence:r,callback:s=>s?t(s):e()})});default:{const e=new C("Unable to "+a+" presence channel while in "+i.state+" state",90001);throw e.code=90001,e}}}async leave(e){if(Ys(this))throw new E("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,e)}async leaveClient(e,t){const s=this.channel;if(!s.connectionManager.activeState())throw s.connectionManager.getError();k.logAction(this.logger,k.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+e);const a=xt.fromData(t);a.action="leave",e&&(a.clientId=e);const i=await a.encode(s.channelOptions);switch(s.state){case"attached":return s.sendPresence([i]);case"attaching":return new Promise((e,t)=>{this.pendingPresence.push({presence:i,callback:s=>s?t(s):e()})});case"initialized":case"failed":throw new C("Unable to leave presence channel (incompatible state)",90001);default:throw s.invalidStateError()}}async get(e){const t=!e||!("waitForSync"in e)||e.waitForSync;return new Promise((s,a)=>{function i(t){s(e?t.list(e):t.values())}"suspended"!==this.channel.state?function(e,t,s){switch(e.state){case"attached":case"suspended":s();break;case"initialized":case"detached":case"detaching":case"attaching":ae(e.attach(),function(e){e?t(e):s()});break;default:t(E.fromValues(e.invalidStateError()))}}(this.channel,e=>a(e),()=>{const e=this.members;t?e.waitSync(function(){i(e)}):i(e)}):t?a(E.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):i(this.members)})}async history(e){k.logAction(this.logger,k.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name);const t=this.channel.client.rest.presenceMixin;if(e&&e.untilAttach){if("attached"!==this.channel.state)throw new E("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400);delete e.untilAttach,e.from_serial=this.channel.properties.attachSerial}return t.history(this,e)}setPresence(e,t,s){let a,i;k.logAction(this.logger,k.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+e.length+" participants; syncChannelSerial = "+s);const n=this.members,r=this._myMembers,o=[],l=this.channel.connectionManager.connectionId;t&&(this.members.startSync(),s&&(i=s.match(/^[\w-]+:(.*)$/))&&(a=i[1]));for(let c of e)switch(c.action){case"leave":n.remove(c)&&o.push(c),c.connectionId!==l||c.isSynthesized()||r.remove(c);break;case"enter":case"present":case"update":n.put(c)&&o.push(c),c.connectionId===l&&r.put(c)}t&&!a&&(n.endSync(),this.channel.syncChannelSerial=null);for(let c=0;c<o.length;c++){const e=o[c];this.subscriptions.emit(e.action,e)}}onAttached(e){k.logAction(this.logger,k.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+e),e?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();const t=this.pendingPresence,s=t.length;if(s){this.pendingPresence=[];const e=[],a=xe.create(this.logger);k.logAction(this.logger,k.LOG_MICRO,"RealtimePresence.onAttached","sending "+s+" queued presence messages");for(let i=0;i<s;i++){const s=t[i];e.push(s.presence),a.push(s.callback)}this.channel.sendPresence(e).then(()=>a()).catch(e=>a(e))}}actOnChannelState(e,t,s){switch(e){case"attached":this.onAttached(t);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(s)}}failPendingPresence(e){if(this.pendingPresence.length){k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+X(e));for(let s=0;s<this.pendingPresence.length;s++)try{this.pendingPresence[s].callback(e)}catch(t){}this.pendingPresence=[]}}_clearMyMembers(){this._myMembers.clear()}_ensureMyMembersPresent(){const e=this._myMembers,t=this.channel.connectionManager.connectionId;for(const s in e.map){const a=e.map[s];k.logAction(this.logger,k.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+a.clientId+'" into the presence set');const i=a.connectionId===t?a.id:void 0;this._enterOrUpdateClient(i,a.clientId,a.data,"enter").catch(e=>{const t=new E("Presence auto re-enter failed",91004,400,e);k.logAction(this.logger,k.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()","Presence auto re-enter failed; reason = "+X(e));const s=new gs(this.channel.state,this.channel.state,!0,!1,t);this.channel.emit("update",s)})}}_synthesizeLeaves(e){const t=this.subscriptions;e.forEach(function(e){const s=xt.fromValues({action:"leave",connectionId:e.connectionId,clientId:e.clientId,data:e.data,encoding:e.encoding,timestamp:Date.now()});t.emit("leave",s)})}async subscribe(...e){const t=_s.processListenerArgs(e),s=t[0],a=t[1],i=this.channel;if("failed"===i.state)throw E.fromValues(i.invalidStateError());this.subscriptions.on(s,a),!1!==i.channelOptions.attachOnSubscribe&&await i.attach()}unsubscribe(...e){const t=_s.processListenerArgs(e),s=t[0],a=t[1];this.subscriptions.off(s,a)}},Qs=Ss.WebSocket,Zs=class extends Ms{constructor(e,t,s){super(e,t,s),this.shortName=Qs,s.heartbeats=f.Config.useProtocolHeartbeats,this.wsHost=s.host}static isAvailable(){return!!f.Config.WebSocket}createWebSocket(e,t){return this.uri=e+K(t),new f.Config.WebSocket(this.uri)}toString(){return"WebSocketTransport; uri="+this.uri}connect(){k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.connect()","starting"),Ms.prototype.connect.call(this);const e=this,t=this.params,s=t.options,a=(s.tls?"wss://":"ws://")+this.wsHost+":"+Re.getPort(s)+"/";k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.connect()","uri: "+a),ae(this.auth.getAuthParams(),function(s,i){if(e.isDisposed)return;let n="";for(const e in i)n+=" "+e+": "+i[e]+";";if(k.logAction(e.logger,k.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+n+" err: "+s),s)return void e.disconnect(s);const r=t.getConnectParams(i);try{const t=e.wsConnection=e.createWebSocket(a,r);t.binaryType=f.Config.binaryType,t.onopen=function(){e.onWsOpen()},t.onclose=function(t){e.onWsClose(t)},t.onmessage=function(t){e.onWsData(t.data)},t.onerror=function(t){e.onWsError(t)},t.on&&t.on("ping",function(){e.onActivity()})}catch(o){k.logAction(e.logger,k.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(o.stack||o.message)),e.disconnect(o)}})}send(e){const t=this.wsConnection;if(t)try{t.send(cs(e,this.connectionManager.realtime._MsgPack,this.params.format))}catch(s){const e="Exception from ws connection when trying to send: "+X(s);k.logAction(this.logger,k.LOG_ERROR,"WebSocketTransport.send()",e),this.finish("disconnected",new E(e,5e4,500))}else k.logAction(this.logger,k.LOG_ERROR,"WebSocketTransport.send()","No socket connection")}onWsData(e){k.logAction(this.logger,k.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+e.length+"; type = "+typeof e);try{this.onProtocolMessage((t=e,s=this.connectionManager.realtime._MsgPack,a=this.connectionManager.realtime._RealtimePresence,i=this.connectionManager.realtime._Annotations,n=this.connectionManager.realtime._objectsPlugin,r=this.format,ds(ie(t,s,r),a,i,n)))}catch(o){k.logAction(this.logger,k.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+o.stack)}var t,s,a,i,n,r}onWsOpen(){k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")}onWsClose(e){let t,s;if("object"==typeof e?(s=e.code,t=e.wasClean||1e3===s):(s=e,t=1e3==s),delete this.wsConnection,t){k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");const e=new E("Websocket closed",80003,400);this.finish("disconnected",e)}else{const e="Unclean disconnection of WebSocket ; code = "+s,t=new E(e,80003,400);k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.onWsClose()",e),this.finish("disconnected",t)}this.emit("disposed")}onWsError(e){k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+e.message),f.Config.nextTick(()=>{this.disconnect(Error(e.message))})}dispose(){k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;const e=this.wsConnection;e&&(e.onmessage=function(){},delete this.wsConnection,f.Config.nextTick(()=>{if(k.logAction(this.logger,k.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!e)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");e.close()}))}},ea=class{static subscribeFilter(e,t,s){const a=e=>{var a,i,n,r,o,l;const c={name:e.name,refTimeserial:null==(i=null==(a=e.extras)?void 0:a.ref)?void 0:i.timeserial,refType:null==(r=null==(n=e.extras)?void 0:n.ref)?void 0:r.type,isRef:!!(null==(l=null==(o=e.extras)?void 0:o.ref)?void 0:l.timeserial),clientId:e.clientId};Object.entries(t).find(([e,t])=>void 0!==t&&c[e]!==t)||s(e)};this.addFilteredSubscription(e,t,s,a),e.subscriptions.on(a)}static addFilteredSubscription(e,t,s,a){var i;if(e.filteredSubscriptions||(e.filteredSubscriptions=new Map),e.filteredSubscriptions.has(s)){const n=e.filteredSubscriptions.get(s);n.set(t,(null==(i=null==n?void 0:n.get(t))?void 0:i.concat(a))||[a])}else e.filteredSubscriptions.set(s,new Map([[t,[a]]]))}static getAndDeleteFilteredSubscriptions(e,t,s){if(!e.filteredSubscriptions)return[];if(!s&&t)return Array.from(e.filteredSubscriptions.entries()).map(([s,a])=>{var i;let n=a.get(t);return a.delete(t),0===a.size&&(null==(i=e.filteredSubscriptions)||i.delete(s)),n}).reduce((e,t)=>t?e.concat(...t):e,[]);if(!s||!e.filteredSubscriptions.has(s))return[];const a=e.filteredSubscriptions.get(s);if(!t){const t=Array.from(a.values()).reduce((e,t)=>e.concat(...t),[]);return e.filteredSubscriptions.delete(s),t}let i=a.get(t);return a.delete(t),i||[]}},ta=class e extends zs{constructor(t){var s;const a=e._MsgPack;if(!a)throw new Error("Expected DefaultRealtime._MsgPack to have been set");super(Re.objectifyOptions(t,!0,"Realtime",k.defaultLogger,m(p({},Jt),{Crypto:null!=(s=e.Crypto)?s:void 0,MsgPack:a,RealtimePresence:{RealtimePresence:Xs,PresenceMessage:xt,WirePresenceMessage:Rt},Annotations:{Annotation:as,WireAnnotation:ss,RealtimeAnnotations:ks,RestAnnotations:ls},WebSocketTransport:Zs,MessageInteractions:ea})))}static get Crypto(){if(null===this._Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");return this._Crypto}static set Crypto(e){this._Crypto=e}};ta.Utils=w,ta.ConnectionManager=Fs,ta.ProtocolMessage=fs,ta._Crypto=null,ta.Message=Yt,ta.PresenceMessage=Xt,ta.Annotation=is,ta._MsgPack=null,ta._Http=Be,ta._PresenceMap=Js,ta._MessageEncoding=rt;var sa=ta,aa=Uint8Array,ia=Uint32Array,na=Math.pow,ra=new ia(8),oa=[],la=new ia(64);function ca(e){return(e-(0|e))*na(2,32)|0}for(var ua,da,pa=2,ma=0;ma<64;){for(ua=!0,da=2;da<=pa/2;da++)pa%da===0&&(ua=!1);ua&&(ma<8&&(ra[ma]=ca(na(pa,.5))),oa[ma]=ca(na(pa,1/3)),ma++),pa++}var va=!!new aa(new ia([1]).buffer)[0];function ha(e){return va?e>>>24|(e>>>16&255)<<8|(65280&e)<<8|e<<24:e}function fa(e,t){return e>>>t|e<<32-t}function ga(e){var t,s=ra.slice(),a=e.length,i=8*a,n=512-(i+64)%512-1+i+65,r=new aa(n/8),o=new ia(r.buffer);r.set(e,0),r[a]=128,o[o.length-1]=ha(i);for(var l=0;l<n/32;l+=16){var c=s.slice();for(t=0;t<64;t++){var u;if(t<16)u=ha(o[l+t]);else{var d=la[t-15],p=la[t-2];u=la[t-7]+la[t-16]+(fa(d,7)^fa(d,18)^d>>>3)+(fa(p,17)^fa(p,19)^p>>>10)}la[t]=u|=0;for(var m=(fa(c[4],6)^fa(c[4],11)^fa(c[4],25))+(c[4]&c[5]^~c[4]&c[6])+c[7]+u+oa[t],v=(fa(c[0],2)^fa(c[0],13)^fa(c[0],22))+(c[0]&c[1]^c[2]&(c[0]^c[1])),h=7;h>0;h--)c[h]=c[h-1];c[0]=m+v|0,c[4]=c[4]+m|0}for(t=0;t<8;t++)s[t]=s[t]+c[t]|0}return new aa(new ia(s.map(function(e){return ha(e)})).buffer)}var ya,ba=new class{constructor(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}uint8ViewToBase64(e){let t="";const s=this.base64CharSet,a=e.byteLength,i=a%3,n=a-i;let r,o,l,c,u;for(let d=0;d<n;d+=3)u=e[d]<<16|e[d+1]<<8|e[d+2],r=(16515072&u)>>18,o=(258048&u)>>12,l=(4032&u)>>6,c=63&u,t+=s[r]+s[o]+s[l]+s[c];return 1==i?(u=e[n],r=(252&u)>>2,o=(3&u)<<4,t+=s[r]+s[o]+"=="):2==i&&(u=e[n]<<8|e[n+1],r=(64512&u)>>10,o=(1008&u)>>4,l=(15&u)<<2,t+=s[r]+s[o]+s[l]+"="),t}base64ToArrayBuffer(e){const t=null==atob?void 0:atob(e),s=t.length,a=new Uint8Array(s);for(let i=0;i<s;i++){const e=t.charCodeAt(i);a[i]=e}return this.toArrayBuffer(a)}isBuffer(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)}toBuffer(e){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(this.toArrayBuffer(e));throw new Error("BufferUtils.toBuffer expected an ArrayBuffer or a view onto one")}toArrayBuffer(e){if(!ArrayBuffer)throw new Error("Can't convert to ArrayBuffer: browser does not support the necessary types");if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);throw new Error("BufferUtils.toArrayBuffer expected an ArrayBuffer or a view onto one")}base64Encode(e){return this.uint8ViewToBase64(this.toBuffer(e))}base64UrlEncode(e){return this.base64Encode(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}base64Decode(e){if(ArrayBuffer&&f.Config.atob)return this.base64ToArrayBuffer(e);throw new Error("Expected ArrayBuffer to exist and Platform.Config.atob to be configured")}hexEncode(e){return this.toBuffer(e).reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"")}hexDecode(e){if(e.length%2!=0)throw new Error("Can't create a byte array from a hex string of odd length");const t=new Uint8Array(e.length/2);for(let s=0;s<t.length;s++)t[s]=parseInt(e.slice(2*s,2*(s+1)),16);return this.toArrayBuffer(t)}utf8Encode(e){if(f.Config.TextEncoder){const t=(new f.Config.TextEncoder).encode(e);return this.toArrayBuffer(t)}throw new Error("Expected TextEncoder to be configured")}utf8Decode(e){if(!this.isBuffer(e))throw new Error("Expected input of utf8decode to be an arraybuffer or typed array");if(TextDecoder)return(new TextDecoder).decode(e);throw new Error("Expected TextDecoder to be configured")}areBuffersEqual(e,t){if(!e||!t)return!1;const s=this.toArrayBuffer(e),a=this.toArrayBuffer(t);if(s.byteLength!=a.byteLength)return!1;const i=new Uint8Array(s),n=new Uint8Array(a);for(var r=0;r<i.length;r++)if(i[r]!=n[r])return!1;return!0}byteLength(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}arrayBufferViewToBuffer(e){return this.toArrayBuffer(e)}concat(e){const t=e.reduce((e,t)=>e+t.byteLength,0),s=new Uint8Array(t);let a=0;for(const i of e){const e=this.toBuffer(i);s.set(e,a),a+=e.byteLength}return s.buffer}sha256(e){const t=ga(this.toBuffer(e));return this.toArrayBuffer(t)}hmacSha256(e,t){const s=function(e,t){if(e.length>64&&(e=ga(e)),e.length<64){const t=new Uint8Array(64);t.set(e,0),e=t}for(var s=new Uint8Array(64),a=new Uint8Array(64),i=0;i<64;i++)s[i]=54^e[i],a[i]=92^e[i];var n=new Uint8Array(t.length+64);n.set(s,0),n.set(t,64);var r=new Uint8Array(96);return r.set(a,0),r.set(ga(n),64),ga(r)}(this.toBuffer(t),this.toBuffer(e));return this.toArrayBuffer(s)}},_a=(e=>(e[e.REQ_SEND=0]="REQ_SEND",e[e.REQ_RECV=1]="REQ_RECV",e[e.REQ_RECV_POLL=2]="REQ_RECV_POLL",e[e.REQ_RECV_STREAM=3]="REQ_RECV_STREAM",e))(_a||{}),ka=_a;function wa(){return new E("No HTTP request plugin provided. Provide at least one of the FetchRequest or XHRRequest plugins.",400,4e4)}var Sa=((ya=class{constructor(e){var t;this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this.client=null!=e?e:null;const s=(null==e?void 0:e.options.connectivityCheckUrl)||Re.connectivityCheckUrl,a=null!=(t=null==e?void 0:e.options.connectivityCheckParams)?t:null,i=!(null==e?void 0:e.options.connectivityCheckUrl),n=p(p({},Sa.bundledRequestImplementations),null==e?void 0:e._additionalHTTPRequestImplementations),r=n.XHRRequest,o=n.FetchRequest,l=!(!r&&!o);if(!l)throw wa();f.Config.xhrSupported&&r?(this.supportsAuthHeaders=!0,this.Request=async function(t,s,a,i,n){return new Promise(o=>{var l;const c=r.createRequest(s,a,i,n,ka.REQ_SEND,null!=(l=e&&e.options.timeouts)?l:null,this.logger,t);c.once("complete",(e,t,s,a,i)=>o({error:e,body:t,headers:s,unpacked:a,statusCode:i})),c.exec()})},(null==e?void 0:e.options.disableConnectivityCheck)?this.checkConnectivity=async function(){return!0}:this.checkConnectivity=async function(){var e;k.logAction(this.logger,k.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+s);const t=await this.doUri(Pe.Get,s,null,null,a);let n=!1;var r;return n=i?!t.error&&"yes"==(null==(e=t.body)?void 0:e.replace(/\n/,"")):!t.error&&(r=t.statusCode)>=200&&r<400,k.logAction(this.logger,k.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+n),n}):f.Config.fetchSupported&&o?(this.supportsAuthHeaders=!0,this.Request=async(t,s,a,i,n)=>o(t,null!=e?e:null,s,a,i,n),(null==e?void 0:e.options.disableConnectivityCheck)?this.checkConnectivity=async function(){return!0}:this.checkConnectivity=async function(){var e;k.logAction(this.logger,k.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+s);const t=await this.doUri(Pe.Get,s,null,null,null),a=!t.error&&"yes"==(null==(e=t.body)?void 0:e.replace(/\n/,""));return k.logAction(this.logger,k.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+a),a}):this.Request=async()=>({error:l?new C("no supported HTTP transports available",null,400):wa()})}get logger(){var e,t;return null!=(t=null==(e=this.client)?void 0:e.logger)?t:k.defaultLogger}async doUri(e,t,s,a,i){return this.Request?this.Request(e,t,s,i,a):{error:new C("Request invoked before assigned to",null,500)}}shouldFallback(e){const t=e.statusCode;return 408===t&&!e.code||400===t&&!e.code||t>=500&&t<=504}}).methods=[Pe.Get,Pe.Delete,Pe.Post,Pe.Put,Pe.Patch],ya.methodsWithoutBody=[Pe.Get,Pe.Delete],ya.methodsWithBody=[Pe.Post,Pe.Put,Pe.Patch],ya),Ea=Sa,Ca="ablyjs-storage-test",Ta=void 0!==z?z:"undefined"!=typeof window?window:self,Aa=new class{constructor(){try{Ta.sessionStorage.setItem(Ca,Ca),Ta.sessionStorage.removeItem(Ca),this.sessionSupported=!0}catch(e){this.sessionSupported=!1}try{Ta.localStorage.setItem(Ca,Ca),Ta.localStorage.removeItem(Ca),this.localSupported=!0}catch(e){this.localSupported=!1}}get(e){return this._get(e,!1)}getSession(e){return this._get(e,!0)}remove(e){return this._remove(e,!1)}removeSession(e){return this._remove(e,!0)}set(e,t,s){return this._set(e,t,s,!1)}setSession(e,t,s){return this._set(e,t,s,!0)}_set(e,t,s,a){const i={value:t};return s&&(i.expires=Date.now()+s),this.storageInterface(a).setItem(e,JSON.stringify(i))}_get(e,t){if(t&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!t&&!this.localSupported)throw new Error("Local Storage not supported");const s=this.storageInterface(t).getItem(e);if(!s)return null;const a=JSON.parse(s);return a.expires&&a.expires<Date.now()?(this.storageInterface(t).removeItem(e),null):a.value}_remove(e,t){return this.storageInterface(t).removeItem(e)}storageInterface(e){return e?Ta.sessionStorage:Ta.localStorage}},Ia=de(),Ra={agent:"browser",logTimestamps:!0,userAgent:Ia.navigator&&Ia.navigator.userAgent.toString(),currentUrl:Ia.location&&Ia.location.href,binaryType:"arraybuffer",WebSocket:Ia.WebSocket,fetchSupported:!!Ia.fetch,xhrSupported:Ia.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,allowComet:function(){const e=Ia.location;return!Ia.WebSocket||!e||!e.origin||e.origin.indexOf("http")>-1}(),useProtocolHeartbeats:!0,supportsBinary:!!Ia.TextDecoder,preferBinary:!1,ArrayBuffer:Ia.ArrayBuffer,atob:Ia.atob,nextTick:void 0!==Ia.setImmediate?Ia.setImmediate.bind(Ia):function(e){setTimeout(e,0)},addEventListener:Ia.addEventListener,inspect:JSON.stringify,stringByteSize:function(e){return Ia.TextDecoder&&(new Ia.TextEncoder).encode(e).length||e.length},TextEncoder:Ia.TextEncoder,TextDecoder:Ia.TextDecoder,getRandomArrayBuffer:async function(e){const t=new Uint8Array(e);return Ia.crypto.getRandomValues(t),t.buffer},isWebworker:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,push:{platform:"browser",formFactor:"desktop",storage:Aa}};function xa(e){return function(e){const t=[80015,80017,80030];return!!e.code&&!je.isTokenErr(e)&&(!!t.includes(e.code)||e.code>=4e4&&e.code<5e4)}(e)?[ms({action:ze.ERROR,error:e})]:[ms({action:ze.DISCONNECTED,error:e})]}var Oa=class extends Ms{constructor(e,t,s){super(e,t,s,!0),this.onAuthUpdated=e=>{this.authParams={access_token:e.token}},this.stream=!("stream"in s)||s.stream,this.sendRequest=null,this.recvRequest=null,this.pendingCallback=null,this.pendingItems=null}connect(){k.logAction(this.logger,k.LOG_MINOR,"CometTransport.connect()","starting"),Ms.prototype.connect.call(this);const e=this.params,t=e.options,s=Re.getHost(t,e.host),a=Re.getPort(t),i=t.tls?"https://":"http://";this.baseUri=i+s+":"+a+"/comet/";const n=this.baseUri+"connect";k.logAction(this.logger,k.LOG_MINOR,"CometTransport.connect()","uri: "+n),ae(this.auth.getAuthParams(),(e,t)=>{if(e)return void this.disconnect(e);if(this.isDisposed)return;this.authParams=t;const s=this.params.getConnectParams(t);"stream"in s&&(this.stream=s.stream),k.logAction(this.logger,k.LOG_MINOR,"CometTransport.connect()","connectParams:"+K(s));let a=!1;const i=this.recvRequest=this.createRequest(n,null,s,null,this.stream?ka.REQ_RECV_STREAM:ka.REQ_RECV);i.on("data",e=>{this.recvRequest&&(a||(a=!0,this.emit("preconnect")),this.onData(e))}),i.on("complete",e=>{this.recvRequest||(e=e||new E("Request cancelled",80003,400)),this.recvRequest=null,a||e||(a=!0,this.emit("preconnect")),this.onActivity(),e?e.code?this.onData(xa(e)):this.disconnect(e):f.Config.nextTick(()=>{this.recv()})}),i.exec()})}requestClose(){k.logAction(this.logger,k.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)}requestDisconnect(){k.logAction(this.logger,k.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)}_requestCloseOrDisconnect(e){const t=e?this.closeUri:this.disconnectUri;if(t){const s=this.createRequest(t,null,this.authParams,null,ka.REQ_SEND);s.on("complete",t=>{t&&(k.logAction(this.logger,k.LOG_ERROR,"CometTransport.request"+(e?"Close()":"Disconnect()"),"request returned err = "+X(t)),this.finish("disconnected",t))}),s.exec()}}dispose(){k.logAction(this.logger,k.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(k.logAction(this.logger,k.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",Os.disconnected()),f.Config.nextTick(()=>{this.emit("disposed")}))}onConnect(e){var t;if(this.isDisposed)return;const s=null==(t=e.connectionDetails)?void 0:t.connectionKey;Ms.prototype.onConnect.call(this,e);const a=this.baseUri+s;k.logAction(this.logger,k.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+a),this.sendUri=a+"/send",this.recvUri=a+"/recv",this.closeUri=a+"/close",this.disconnectUri=a+"/disconnect"}send(e){if(this.sendRequest)return this.pendingItems=this.pendingItems||[],void this.pendingItems.push(e);const t=this.pendingItems||[];t.push(e),this.pendingItems=null,this.sendItems(t)}sendAnyPending(){const e=this.pendingItems;e&&(this.pendingItems=null,this.sendItems(e))}sendItems(e){const t=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(e),ka.REQ_SEND);t.on("complete",(e,t)=>{e&&k.logAction(this.logger,k.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+X(e)),this.sendRequest=null,e?e.code?this.onData(xa(e)):this.disconnect(e):(t&&this.onData(t),this.pendingItems&&f.Config.nextTick(()=>{this.sendRequest||this.sendAnyPending()}))}),t.exec()}recv(){if(this.recvRequest)return;if(!this.isConnected)return;const e=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?ka.REQ_RECV_STREAM:ka.REQ_RECV_POLL);e.on("data",e=>{this.onData(e)}),e.on("complete",e=>{this.recvRequest=null,this.onActivity(),e?e.code?this.onData(xa(e)):this.disconnect(e):f.Config.nextTick(()=>{this.recv()})}),e.exec()}onData(e){try{const t=this.decodeResponse(e);if(t&&t.length)for(let e=0;e<t.length;e++)this.onProtocolMessage(ds(t[e],this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin))}catch(t){k.logAction(this.logger,k.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+t.stack)}}encodeRequest(e){return JSON.stringify(e)}decodeResponse(e){return"string"==typeof e?JSON.parse(e):e}};function Pa(e,t){if(function(e,t){return re(j(t)).includes("x-ably-errorcode")}(0,t))return e.error&&E.fromValues(e.error)}var Na=function(){},Ma=0,Da={},La=class e extends We{constructor(e,t,s,a,i,n,r,o){super(r),(s=s||{}).rnd=ee(),this.uri=e+K(s),this.headers=t||{},this.body=a,this.method=o?o.toUpperCase():O(a)?"GET":"POST",this.requestMode=i,this.timeouts=n,this.timedOut=!1,this.requestComplete=!1,this.id=String(++Ma),Da[this.id]=this}static createRequest(t,s,a,i,n,r,o,l){const c=r||Re.TIMEOUTS;return new e(t,s,A(a),i,n,c,o,l)}complete(e,t,s,a,i){this.requestComplete||(this.requestComplete=!0,!e&&t&&this.emit("data",t),this.emit("complete",e,t,s,a,i),this.dispose())}abort(){this.dispose()}exec(){let e=this.headers;const t=this.requestMode==ka.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,s=this.timer=setTimeout(()=>{this.timedOut=!0,i.abort()},t),a=this.method,i=this.xhr=new XMLHttpRequest,n=e.accept;let r=this.body,o="text";n?0===n.indexOf("application/x-msgpack")&&(o="arraybuffer"):e.accept="application/json",r&&(e["content-type"]||(e["content-type"]="application/json")).indexOf("application/json")>-1&&"string"!=typeof r&&(r=JSON.stringify(r)),i.open(a,this.uri,!0),i.responseType=o,"authorization"in e&&(i.withCredentials=!0);for(const f in e)i.setRequestHeader(f,e[f]);const l=(e,t,s,a)=>{var i;let n=t+" (event type: "+e.type+")";(null==(i=null==this?void 0:this.xhr)?void 0:i.statusText)&&(n+=", current statusText is "+this.xhr.statusText),k.logAction(this.logger,k.LOG_ERROR,"Request.on"+e.type+"()",n),this.complete(new C(n,s,a))};let c,u,d;i.onerror=function(e){l(e,"XHR error occurred",null,400)},i.onabort=e=>{this.timedOut?l(e,"Request aborted due to request timeout expiring",null,408):l(e,"Request cancelled",null,400)},i.ontimeout=function(e){l(e,"Request timed out",null,408)};let p=0,m=!1;const v=()=>{clearTimeout(s),d=u<400,204!=u?c=this.requestMode==ka.REQ_RECV_STREAM&&d&&function(e){return e.getResponseHeader&&(e.getResponseHeader("transfer-encoding")||!e.getResponseHeader("content-length"))}(i):this.complete(null,null,null,null,u)},h=()=>{let t;try{const s=function(e,t){return e.getResponseHeader&&e.getResponseHeader(t)}(i,"content-type");if(s?s.indexOf("application/json")>=0:"text"==i.responseType){const e="arraybuffer"===i.responseType?f.BufferUtils.utf8Decode(i.response):String(i.responseText);t=e.length?JSON.parse(e):e,m=!0}else t=i.response;void 0!==t.response?(u=t.statusCode,d=u<400,e=t.headers,t=t.response):e=function(e){const t=e.getAllResponseHeaders().trim().split("\r\n"),s={};for(let a=0;a<t.length;a++){const e=t[a].split(":").map(e=>e.trim());s[e[0].toLowerCase()]=e[1]}return s}(i)}catch(a){return void this.complete(new C("Malformed response body from server: "+a.message,null,400))}if(d||Array.isArray(t))return void this.complete(null,t,e,m,u);let s=Pa(t,e);s||(s=new C("Error response received from server: "+u+" body was: "+f.Config.inspect(t),null,u)),this.complete(s,t,e,m,u)};function g(){const e=i.responseText,t=e.length-1;let s,a;for(;p<t&&(s=e.indexOf("\n",p))>-1;)a=e.slice(p,s),p=s+1,y(a)}const y=e=>{try{e=JSON.parse(e)}catch(t){return void this.complete(new C("Malformed response body from server: "+t.message,null,400))}this.emit("data",e)},b=()=>{g(),this.streamComplete=!0,f.Config.nextTick(()=>{this.complete()})};i.onreadystatechange=function(){const e=i.readyState;e<3||0!==i.status&&(void 0===u&&(u=i.status,v()),3==e&&c?g():4==e&&(c?b():h()))},i.send(r)}dispose(){const e=this.xhr;if(e){e.onreadystatechange=e.onerror=e.onabort=e.ontimeout=Na,this.xhr=null;const t=this.timer;t&&(clearTimeout(t),this.timer=null),this.requestComplete||e.abort()}delete Da[this.id]}},Ua=Ss.XhrPolling,qa={order:["xhr_polling"],bundledImplementations:{web_socket:Zs,xhr_polling:class extends Oa{constructor(e,t,s){super(e,t,s),this.shortName=Ua,s.stream=!1,this.shortName=Ua}static isAvailable(){return!(!f.Config.xhrSupported||!f.Config.allowComet)}toString(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected}createRequest(e,t,s,a,i){return La.createRequest(e,t,s,a,i,this.timeouts,this.logger)}}}},Va={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",wsConnectivityCheckUrl:"wss://ws-up.ably-realtime.com",defaultTransports:[Ss.XhrPolling,Ss.WebSocket]};function $a(e,t,s){for(let a=0,i=s.length;a<i;a++){const i=s.charCodeAt(a);if(i<128)e.setUint8(t++,i>>>0&127);else if(i<2048)e.setUint8(t++,i>>>6&31|192),e.setUint8(t++,i>>>0&63|128);else if(i<65536)e.setUint8(t++,i>>>12&15|224),e.setUint8(t++,i>>>6&63|128),e.setUint8(t++,i>>>0&63|128);else{if(!(i<1114112))throw new Error("bad codepoint "+i);e.setUint8(t++,i>>>18&7|240),e.setUint8(t++,i>>>12&63|128),e.setUint8(t++,i>>>6&63|128),e.setUint8(t++,i>>>0&63|128)}}}function ja(e,t,s){let a="";for(let i=t,n=t+s;i<n;i++){const t=e.getUint8(i);if(128&t)if(192!=(224&t))if(224!=(240&t)){if(240!=(248&t))throw new Error("Invalid byte "+t.toString(16));a+=String.fromCharCode((7&t)<<18|(63&e.getUint8(++i))<<12|(63&e.getUint8(++i))<<6|63&e.getUint8(++i))}else a+=String.fromCharCode((15&t)<<12|(63&e.getUint8(++i))<<6|63&e.getUint8(++i));else a+=String.fromCharCode((15&t)<<6|63&e.getUint8(++i));else a+=String.fromCharCode(t)}return a}function Fa(e){let t=0;for(let s=0,a=e.length;s<a;s++){const a=e.charCodeAt(s);if(a<128)t+=1;else if(a<2048)t+=2;else if(a<65536)t+=3;else{if(!(a<1114112))throw new Error("bad codepoint "+a);t+=4}}return t}var Ga=4294967296,Ba=1/Ga,Ha=class{constructor(e,t){this.map=e=>{const t={};for(let s=0;s<e;s++)t[this.parse()]=this.parse();return t},this.bin=e=>{const t=new ArrayBuffer(e);return new Uint8Array(t).set(new Uint8Array(this.view.buffer,this.offset,e),0),this.offset+=e,t},this.buf=this.bin,this.str=e=>{const t=ja(this.view,this.offset,e);return this.offset+=e,t},this.array=e=>{const t=new Array(e);for(let s=0;s<e;s++)t[s]=this.parse();return t},this.ext=e=>(this.offset+=e,{type:this.view.getInt8(this.offset),data:this.buf(e)}),this.parse=()=>{const e=this.view.getUint8(this.offset);let t,s;if(!(128&e))return this.offset++,e;if(128==(240&e))return s=15&e,this.offset++,this.map(s);if(144==(240&e))return s=15&e,this.offset++,this.array(s);if(160==(224&e))return s=31&e,this.offset++,this.str(s);if(!(224&~e))return t=this.view.getInt8(this.offset),this.offset++,t;switch(e){case 192:return this.offset++,null;case 193:return void this.offset++;case 194:return this.offset++,!1;case 195:return this.offset++,!0;case 196:return s=this.view.getUint8(this.offset+1),this.offset+=2,this.bin(s);case 197:return s=this.view.getUint16(this.offset+1),this.offset+=3,this.bin(s);case 198:return s=this.view.getUint32(this.offset+1),this.offset+=5,this.bin(s);case 199:return s=this.view.getUint8(this.offset+1),this.offset+=2,this.ext(s);case 200:return s=this.view.getUint16(this.offset+1),this.offset+=3,this.ext(s);case 201:return s=this.view.getUint32(this.offset+1),this.offset+=5,this.ext(s);case 202:return t=this.view.getFloat32(this.offset+1),this.offset+=5,t;case 203:return t=this.view.getFloat64(this.offset+1),this.offset+=9,t;case 204:return t=this.view.getUint8(this.offset+1),this.offset+=2,t;case 205:return t=this.view.getUint16(this.offset+1),this.offset+=3,t;case 206:return t=this.view.getUint32(this.offset+1),this.offset+=5,t;case 207:return t=function(e,t){return t=t||0,e.getUint32(t)*Ga+e.getUint32(t+4)}(this.view,this.offset+1),this.offset+=9,t;case 208:return t=this.view.getInt8(this.offset+1),this.offset+=2,t;case 209:return t=this.view.getInt16(this.offset+1),this.offset+=3,t;case 210:return t=this.view.getInt32(this.offset+1),this.offset+=5,t;case 211:return t=function(e,t){return t=t||0,e.getInt32(t)*Ga+e.getUint32(t+4)}(this.view,this.offset+1),this.offset+=9,t;case 212:return s=1,this.offset++,this.ext(s);case 213:return s=2,this.offset++,this.ext(s);case 214:return s=4,this.offset++,this.ext(s);case 215:return s=8,this.offset++,this.ext(s);case 216:return s=16,this.offset++,this.ext(s);case 217:return s=this.view.getUint8(this.offset+1),this.offset+=2,this.str(s);case 218:return s=this.view.getUint16(this.offset+1),this.offset+=3,this.str(s);case 219:return s=this.view.getUint32(this.offset+1),this.offset+=5,this.str(s);case 220:return s=this.view.getUint16(this.offset+1),this.offset+=3,this.array(s);case 221:return s=this.view.getUint32(this.offset+1),this.offset+=5,this.array(s);case 222:return s=this.view.getUint16(this.offset+1),this.offset+=3,this.map(s);case 223:return s=this.view.getUint32(this.offset+1),this.offset+=5,this.map(s)}throw new Error("Unknown type 0x"+e.toString(16))},this.offset=t||0,this.view=e}};function Wa(e,t){return Object.keys(e).filter(function(s){const a=e[s];return!(t&&null==a||"function"==typeof a&&!a.toJSON)})}function za(e,t,s,a){const i=typeof e;if("string"==typeof e){const a=Fa(e);if(a<32)return t.setUint8(s,160|a),$a(t,s+1,e),1+a;if(a<256)return t.setUint8(s,217),t.setUint8(s+1,a),$a(t,s+2,e),2+a;if(a<65536)return t.setUint8(s,218),t.setUint16(s+1,a),$a(t,s+3,e),3+a;if(a<4294967296)return t.setUint8(s,219),t.setUint32(s+1,a),$a(t,s+5,e),5+a}if(ArrayBuffer.isView&&ArrayBuffer.isView(e)&&(e=e.buffer),e instanceof ArrayBuffer){const a=e.byteLength;if(a<256)return t.setUint8(s,196),t.setUint8(s+1,a),new Uint8Array(t.buffer).set(new Uint8Array(e),s+2),2+a;if(a<65536)return t.setUint8(s,197),t.setUint16(s+1,a),new Uint8Array(t.buffer).set(new Uint8Array(e),s+3),3+a;if(a<4294967296)return t.setUint8(s,198),t.setUint32(s+1,a),new Uint8Array(t.buffer).set(new Uint8Array(e),s+5),5+a}if("number"==typeof e){if(Math.floor(e)!==e)return t.setUint8(s,203),t.setFloat64(s+1,e),9;if(e>=0){if(e<128)return t.setUint8(s,e),1;if(e<256)return t.setUint8(s,204),t.setUint8(s+1,e),2;if(e<65536)return t.setUint8(s,205),t.setUint16(s+1,e),3;if(e<4294967296)return t.setUint8(s,206),t.setUint32(s+1,e),5;if(e<0x10000000000000000)return t.setUint8(s,207),function(e,t,s){s<0x10000000000000000?(e.setUint32(t,Math.floor(s*Ba)),e.setInt32(t+4,-1&s)):(e.setUint32(t,4294967295),e.setUint32(t+4,4294967295))}(t,s+1,e),9;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(s,e),1;if(e>=-128)return t.setUint8(s,208),t.setInt8(s+1,e),2;if(e>=-32768)return t.setUint8(s,209),t.setInt16(s+1,e),3;if(e>=-2147483648)return t.setUint8(s,210),t.setInt32(s+1,e),5;if(e>=-0x8000000000000000)return t.setUint8(s,211),function(e,t,s){s<0x8000000000000000?(e.setInt32(t,Math.floor(s*Ba)),e.setInt32(t+4,-1&s)):(e.setUint32(t,2147483647),e.setUint32(t+4,2147483647))}(t,s+1,e),9;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if("undefined"===i)return a?0:(t.setUint8(s,212),t.setUint8(s+1,0),t.setUint8(s+2,0),3);if(null===e)return a?0:(t.setUint8(s,192),1);if("boolean"===i)return t.setUint8(s,e?195:194),1;if("function"==typeof e.toJSON)return za(e.toJSON(),t,s,a);if("object"===i){let i,n,r=0;const o=Array.isArray(e);if(o?i=e.length:(n=Wa(e,a),i=n.length),i<16?(t.setUint8(s,i|(o?144:128)),r=1):i<65536?(t.setUint8(s,o?220:222),t.setUint16(s+1,i),r=3):i<4294967296&&(t.setUint8(s,o?221:223),t.setUint32(s+1,i),r=5),o)for(let l=0;l<i;l++)r+=za(e[l],t,s+r,a);else if(n)for(let l=0;l<i;l++){const i=n[l];r+=za(i,t,s+r),r+=za(e[i],t,s+r,a)}return r}if("function"===i)return 0;throw new Error("Unknown type "+i)}function Ka(e,t){const s=typeof e;if("string"===s){const t=Fa(e);if(t<32)return 1+t;if(t<256)return 2+t;if(t<65536)return 3+t;if(t<4294967296)return 5+t}if(ArrayBuffer.isView&&ArrayBuffer.isView(e)&&(e=e.buffer),e instanceof ArrayBuffer){const t=e.byteLength;if(t<256)return 2+t;if(t<65536)return 3+t;if(t<4294967296)return 5+t}if("number"==typeof e){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;if(e<0x10000000000000000)return 9;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;if(e>=-0x8000000000000000)return 9;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if("boolean"===s)return 1;if(null===e)return t?0:1;if(void 0===e)return t?0:3;if("function"==typeof e.toJSON)return Ka(e.toJSON(),t);if("object"===s){let s,a=0;if(Array.isArray(e)){s=e.length;for(let i=0;i<s;i++)a+=Ka(e[i],t)}else{const i=Wa(e,t);s=i.length;for(let n=0;n<s;n++){const s=i[n];a+=Ka(s)+Ka(e[s],t)}}if(s<16)return 1+a;if(s<65536)return 3+a;if(s<4294967296)return 5+a;throw new Error("Array or object too long 0x"+s.toString(16))}if("function"===s)return 0;throw new Error("Unknown type "+s)}var Ja,Ya={encode:function(e,t){const s=Ka(e,t);if(0===s)return;const a=new ArrayBuffer(s);return za(e,new DataView(a),0,t),a},decode:function(e){const t=new DataView(e),s=new Ha(t),a=s.parse();if(s.offset!==e.byteLength)throw new Error(e.byteLength-s.offset+" trailing bytes");return a},inspect:function(e){if(void 0===e)return"undefined";let t,s;if(e instanceof ArrayBuffer?(s="ArrayBuffer",t=new DataView(e)):e instanceof DataView&&(s="DataView",t=e),!t)return JSON.stringify(e);const a=[];for(let i=0;i<e.byteLength;i++){if(i>20){a.push("...");break}let e=t.getUint8(i).toString(16);1===e.length&&(e="0"+e),a.push(e)}return"<"+s+" "+a.join(" ")+">"},utf8Write:$a,utf8Read:ja,utf8ByteCount:Fa},Xa={XHRRequest:La,FetchRequest:async function(e,t,s,a,i,n){const r=new Headers(a||{}),o=e?e.toUpperCase():O(n)?"GET":"POST",l=new AbortController;let c;const u=new Promise(e=>{c=setTimeout(()=>{l.abort(),e({error:new C("Request timed out",null,408)})},t?t.options.timeouts.httpRequestTimeout:Re.TIMEOUTS.httpRequestTimeout)}),d={method:o,headers:r,body:n,signal:l.signal};f.Config.isWebworker||(d.credentials=r.has("authorization")?"include":"same-origin");const p=(async()=>{try{const e=new URLSearchParams(i||{});e.set("rnd",ee());const t=s+"?"+e,a=await de().fetch(t,d);if(clearTimeout(c),204==a.status)return{error:null,statusCode:a.status};const n=a.headers.get("Content-Type");let r;r=n&&n.indexOf("application/x-msgpack")>-1?await a.arrayBuffer():n&&n.indexOf("application/json")>-1?await a.json():await a.text();const o=!!n&&-1===n.indexOf("application/x-msgpack"),l=function(e){const t={};return e.forEach((e,s)=>{t[s]=e}),t}(a.headers);if(a.ok)return{error:null,body:r,headers:l,unpacked:o,statusCode:a.status};{const e=function(e,t){if(function(e,t){return!!t.get("x-ably-errorcode")}(0,t))return e.error&&E.fromValues(e.error)}(r,a.headers)||new C("Error response received from server: "+a.status+" body was: "+f.Config.inspect(r),null,a.status);return{error:e,body:r,headers:l,unpacked:o,statusCode:a.status}}}catch(e){return clearTimeout(c),{error:e}}})();return Promise.race([u,p])}},Qa=function(e,t){class s{constructor(e,t,s,a){this.algorithm=e,this.keyLength=t,this.mode=s,this.key=a}}class a{static getDefaultParams(e){var a;if(!e.key)throw new Error("Crypto.getDefaultParams: a key is required");a="string"==typeof e.key?t.toArrayBuffer(t.base64Decode(e.key.replace("_","/").replace("-","+"))):e.key instanceof ArrayBuffer?e.key:t.toArrayBuffer(e.key);var i=e.algorithm||"aes",n=8*a.byteLength,r=e.mode||"cbc",o=new s(i,n,r,a);if(e.keyLength&&e.keyLength!==o.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+e.keyLength+" was specified, but the key actually has length "+o.keyLength);return function(e){if("aes"===e.algorithm&&"cbc"===e.mode){if(128===e.keyLength||256===e.keyLength)return;throw new Error("Unsupported key length "+e.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}(o),o}static async generateRandomKey(t){try{return e.getRandomArrayBuffer((t||256)/8)}catch(s){throw new E("Failed to generate random key: "+s.message,400,5e4,s)}}static getCipher(e,t){var a,n=function(e){return e instanceof s}(e)?e:this.getDefaultParams(e);return{cipherParams:n,cipher:new i(n,null!=(a=e.iv)?a:null,t)}}}a.CipherParams=s;class i{constructor(e,s,a){if(this.logger=a,!crypto.subtle)throw isSecureContext?new Error("Crypto operations are not possible since the browser’s SubtleCrypto class is unavailable (reason unknown)."):new Error("Crypto operations are is not possible since the current environment is a non-secure context and hence the browser’s SubtleCrypto class is not available.");this.algorithm=e.algorithm+"-"+String(e.keyLength)+"-"+e.mode,this.webCryptoAlgorithm=e.algorithm+"-"+e.mode,this.key=t.toArrayBuffer(e.key),this.iv=s?t.toArrayBuffer(s):null}concat(e,s){const a=new ArrayBuffer(e.byteLength+s.byteLength),i=new DataView(a),n=new DataView(t.toArrayBuffer(e));for(let t=0;t<n.byteLength;t++)i.setInt8(t,n.getInt8(t));const r=new DataView(t.toArrayBuffer(s));for(let t=0;t<r.byteLength;t++)i.setInt8(n.byteLength+t,r.getInt8(t));return a}async encrypt(e){k.logAction(this.logger,k.LOG_MICRO,"CBCCipher.encrypt()","");const t=await this.getIv(),s=await crypto.subtle.importKey("raw",this.key,this.webCryptoAlgorithm,!1,["encrypt"]),a=await crypto.subtle.encrypt({name:this.webCryptoAlgorithm,iv:t},s,e);return this.concat(t,a)}async decrypt(e){k.logAction(this.logger,k.LOG_MICRO,"CBCCipher.decrypt()","");const s=t.toArrayBuffer(e),a=s.slice(0,16),i=s.slice(16),n=await crypto.subtle.importKey("raw",this.key,this.webCryptoAlgorithm,!1,["decrypt"]);return crypto.subtle.decrypt({name:this.webCryptoAlgorithm,iv:a},n,i)}async getIv(){if(this.iv){var s=this.iv;return this.iv=null,s}const a=await e.getRandomArrayBuffer(16);return t.toArrayBuffer(a)}}return a}(Ra,ba);f.Crypto=Qa,f.BufferUtils=ba,f.Http=Ea,f.Config=Ra,f.Transports=qa,f.WebStorage=Aa;for(const z of[Cs,sa])z.Crypto=Qa,z._MsgPack=Ya;Ea.bundledRequestImplementations=Xa,k.initLogHandlers(),f.Defaults=(Ja=Va,Object.assign(_e,Ja)),f.Config.agent&&(f.Defaults.agent+=" "+f.Config.agent);var Za={ErrorInfo:E,Rest:Cs,Realtime:sa,msgpack:Ya,makeProtocolMessageFromDeserialized:ps};return"object"==typeof s.exports&&(s.exports=((e,t,s,a)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of Object.getOwnPropertyNames(t))Object.prototype.hasOwnProperty.call(e,i)||i===s||Object.defineProperty(e,i,{get:()=>t[i],enumerable:!(a=Object.getOwnPropertyDescriptor(t,i))||a.enumerable});return e})(s.exports,t)),s.exports})());let Te=null;const Ae=e(!1),Ie=e([]),Re=()=>"undefined"!=typeof window?window.location.hostname:"default",xe=async e=>{ne.info("[ABLY] Connexion au service de temps réel");try{ne.debug("[ABLY] Initialisation sans clientId spécifique");const t={authCallback:async(e,t)=>{ne.debug("[ABLY] authCallback appelé pour renouveler le token");try{t(null,await(async()=>{var e;try{const t=await _e.routes.realtime.getToken();if(!(null==(e=t.data)?void 0:e.token))throw new Error("Token Ably non trouvé dans la réponse");return ne.debug("[ABLY] Nouveau token obtenu avec succès"),t.data.token}catch(t){throw ne.error("[ABLY] Erreur lors de la récupération du token",{error:t}),t}})())}catch(s){ne.error("[ABLY] Erreur dans authCallback",{error:s});t({code:40170,statusCode:401,message:s instanceof Error?s.message:"Erreur de récupération du token",name:"TokenError"},null)}},token:e,echoMessages:!1,closeOnUnload:!1,recover:""};Te=new Ce.Realtime(t),Te.connection.on("connected",()=>{ne.info("[ABLY] Connecté au service de temps réel"),Ae.value=!0}),Te.connection.on("disconnected",()=>{ne.info("[ABLY] Déconnecté du service de temps réel"),Ae.value=!1}),Te.connection.on("failed",e=>{ne.error("[ABLY] Échec de connexion",{reason:e.reason})}),Te.connection.on("suspended",()=>{}),setTimeout(()=>{Ae.value||(ne.debug("[ABLY] Tentative de connexion forcée après délai d'initialisation"),null==Te||Te.connect())},1e3)}catch(t){throw ne.error("[ABLY] Erreur de connexion",{error:t}),t}},Oe=(e,t,s)=>{if(!Te)return ne.error("[ABLY] Client non initialisé"),()=>{};try{Te.channels.get(e).subscribe(t,a=>{ne.debug(`[ABLY] Message reçu sur ${e}:${t}`,{message:a}),s(a.data)});return-1===Ie.value.findIndex(s=>s.channel===e&&s.event===t)?(Ie.value.push({channel:e,event:t,callback:s}),ne.debug(`[ABLY] Abonnement ajouté: ${e}:${t}`)):ne.debug(`[ABLY] Abonnement déjà existant: ${e}:${t}`),()=>Pe(e,t)}catch(a){return ne.error("[ABLY] Erreur lors de l'abonnement au canal",{channel:e,error:a}),()=>{}}},Pe=(e,t)=>{if(Te)try{const s=Te.channels.get(e);t?(s.unsubscribe(t),Ie.value=Ie.value.filter(s=>!(s.channel===e&&s.event===t))):(s.unsubscribe(),Ie.value=Ie.value.filter(t=>t.channel!==e)),Ue()}catch(s){ne.error("[ABLY] Erreur lors du désabonnement du canal",{channel:e,error:s})}else ne.error("[ABLY] Client non initialisé")},Ne=async(e,t,s)=>{if(Te)try{const a=Te.channels.get(e);await a.publish(t,s),ne.debug(`[ABLY] Message publié avec succès sur ${e}:${t}`)}catch(a){throw ne.error("[ABLY] Erreur de publication",{error:a}),a}else ne.error("[ABLY] Client non initialisé")},Me=()=>{ne.info("[ABLY] Déconnexion du service de temps réel"),Te&&(Te.close(),Te=null,Ae.value=!1)},De=()=>Te,Le=()=>{if(!Te)return ne.error("[ABLY] Client non initialisé"),[];const e=new Map;Ie.value.forEach(t=>{var s,a;e.has(t.channel)||e.set(t.channel,[]),(null==(s=e.get(t.channel))?void 0:s.includes(t.event))||null==(a=e.get(t.channel))||a.push(t.event)});return Array.from(e.entries()).map(([e,t])=>{let s="unknown";try{if(Te&&Te.channels){s=Te.channels.get(e).state||"attached"}}catch(a){}return{name:e,state:s,events:t}}).sort((e,t)=>e.name.localeCompare(t.name))},Ue=()=>{var e;const t=Le();return ne.debug(`[ABLY] Nombre total d'abonnements enregistrés: ${Ie.value.length}`),0===t.length?Ie.value.length>0&&ne.debug("[ABLY] Abonnements enregistrés mais aucun canal trouvé:",Ie.value.map(e=>`${e.channel}:${e.event}`)):t.forEach(e=>{e.name.includes("private-admin");e.events.length>0&&ne.debug("Événements:",{events:e.events.join(", ")})}),"undefined"!=typeof window&&(null==(e=window.AblyDebug)?void 0:e.isAutoDisplayActive)&&window.AblyDebug.isAutoDisplayActive(),t},qe=(e,t)=>{const s=Re();return Oe(`${s}:private-admin`,e,t)},Ve=(e,t,s)=>{const a=Re();return Oe(`${a}:private-admin-${e}`,t,s)},$e=(e,t,s)=>{const a=Re();return Oe(`${a}:ticket-${e}`,t,s)},je=async(e,t)=>{const s=Re();return Ne(`${s}:private-admin`,e,t)},Fe=async(e,t,s)=>{const a=Re();return Ne(`${a}:private-admin-${e}`,t,s)},Ge=qe,Be=t("realtime",()=>{ne.info("[REALTIME STORE] Initialisation du store");const t=e(!1),i=e(!1),n=e(null),r=e(!1),o=e(0),l=e(null),c=e(null),u=s(()=>t.value),d=s(()=>i.value),p=s(()=>null!==n.value),m=s(()=>o.value>0),v=async()=>{var e,s;ne.info("[REALTIME STORE] Initialisation du service de temps réel");try{if(t.value)return void ne.info("[REALTIME STORE] Service déjà initialisé");r.value=!0,n.value=null,ne.debug("[REALTIME STORE] Récupération du token API via le service centralisé");const a=await _e.routes.realtime.getToken();if(ne.debug("[REALTIME STORE] Réponse API token:",{response:a.data}),null==(e=a.data)?void 0:e.error)throw new Error(`Erreur serveur: ${a.data.error}`);const l=null==(s=a.data)?void 0:s.token;if(!l)throw new Error("Token Ably non trouvé dans la réponse");ne.debug("[REALTIME STORE] Initialisation d'Ably avec le token"),await xe(l),h(),t.value=!0,i.value=!0,o.value=0,ne.info("[REALTIME STORE] Service de temps réel initialisé avec succès"),setTimeout(()=>{ne.debug("[REALTIME STORE] État initial des canaux:"),b()},1e3)}catch(a){ne.error("[REALTIME STORE] Erreur lors de l'initialisation",{error:a}),n.value=a,t.value=!1,i.value=!1,y()}finally{r.value=!1}},h=()=>{const e=De();e&&(e.connection.on("connected",()=>{ne.info("[REALTIME STORE] Connexion réussie"),i.value=!0,n.value=null,o.value=0,l.value&&(clearTimeout(l.value),l.value=null)}),e.connection.on("disconnected",()=>{ne.warn("[REALTIME STORE] Connexion perdue"),i.value=!1}),e.connection.on("suspended",()=>{i.value=!1,y()}),e.connection.on("failed",e=>{var t;ne.error("[REALTIME STORE] Échec de connexion",{reason:e.reason}),i.value=!1,n.value=new Error((null==(t=e.reason)?void 0:t.message)||"Échec de connexion"),y()}))},f=()=>{n.value=null},g=async()=>(ne.info("[REALTIME STORE] Nouvelle tentative d'initialisation"),f(),o.value=0,l.value&&(clearTimeout(l.value),l.value=null),v()),y=()=>{if(o.value>=5)return void ne.error("[REALTIME STORE] Nombre maximum de tentatives de reconnexion atteint");o.value++;const e=Math.min(1e3*Math.pow(2,o.value-1),3e4);ne.warn("[REALTIME STORE] Tentative de reconnexion..."),ne.info(`[REALTIME STORE] Tentative de reconnexion ${o.value}/5 dans ${e}ms`),l.value=setTimeout(()=>{ne.info(`[REALTIME STORE] Exécution de la tentative de reconnexion ${o.value}`),v()},e)},b=()=>Ue(),_=(e=3e4)=>(k(),b(),c.value=setInterval(()=>{b()},e),!0),k=()=>!!c.value&&(clearInterval(c.value),c.value=null,!0);return a(i,e=>{e&&setTimeout(()=>{b()},1e3)}),"undefined"!=typeof window&&(window.AblyDebug={showChannels:()=>b(),getStatus:()=>{var e;return{initialized:t.value,connected:i.value,hasError:null!==n.value,error:(null==(e=n.value)?void 0:e.message)||null,reconnectAttempts:o.value}},reconnect:()=>g(),testSubscription:()=>{if(!t.value||!i.value)return;const e=qe("test-event",e=>{}),s=Ve(0,"test-event",e=>{});return window.AblyDebug.testPublishGlobal=(e="test global")=>{je("test-event",{message:e,timestamp:(new Date).toISOString(),type:"global"})},window.AblyDebug.testPublishPrivate=(e="test privé")=>{Fe(0,"test-event",{message:e,timestamp:(new Date).toISOString(),type:"private"})},()=>{e(),s()}},diagnosticComplet:()=>{var e;t.value,i.value,n.value,null==(e=n.value)||e.message,o.value;const s=De();s&&(ne.debug("État de la connexion",{state:s.connection.state}),ne.debug("ID de connexion",{id:s.connection.id}));const a=Ue();t.value&&i.value&&s&&(!a||a.length)},startAutoDisplay:(e=3e4)=>_(e),stopAutoDisplay:()=>k(),isAutoDisplayActive:()=>null!==c.value},_(6e4)),{initialized:t,connected:i,error:n,loading:r,isInitialized:u,isConnected:d,hasError:p,isReconnecting:m,init:v,disconnect:()=>{var e;ne.info("[REALTIME STORE] Déconnexion du service de temps réel"),Me(),ne.debug("[REALTIME STORE] État de la connexion après déconnexion:",{state:null==(e=De())?void 0:e.connection.state}),t.value=!1,i.value=!1,l.value&&(clearTimeout(l.value),l.value=null),k()},resetError:f,retry:g,debugShowChannels:b,startAutoDisplay:_,stopAutoDisplay:k}}),He=t("notifications",()=>{const t=e([]),a=e([]),r=e([]),o=e({email:!0,push:!0,desktop:!0,types:{ticket:!0,invoice:!0,payment:!0,client:!0,system:!0}}),l=e(!1),c=e(null),u=Be(),d=s(()=>t.value),p=s(()=>t.value.filter(e=>!e.read).length),m=s(()=>{const e=new Date;return t.value.filter(t=>new Date(t.created_at).toDateString()===e.toDateString())}),v=s(()=>[...a.value,...r.value]),h=e=>{const t=Date.now(),s={id:t,...e,timeout:e.timeout||5e3,closing:!1};return a.value.push(s),setTimeout(()=>{const e=a.value.findIndex(e=>e.id===t);if(-1!==e){const s={...a.value[e],closing:!0};a.value=a.value.filter(e=>e.id!==t),r.value.push(s),setTimeout(()=>{r.value=r.value.filter(e=>e.id!==t)},500)}},s.timeout),t},f=e=>{if(!u.isInitialized||!u.isConnected)return ne.warn("[NOTIFICATIONS STORE] Service temps réel non disponible, utilisation du mode local"),h(e);const t=Date.now(),s={id:t,...e,timeout:e.timeout||5e3,timestamp:(new Date).toISOString(),userId:w()};return je("toast:notification",s),t},g=f,y=(e,t="Succès")=>(ne.info(`[NOTIFICATIONS STORE] Affichage d'un message de succès: ${e}`),f({title:t,message:e,type:"success"})),b=(e,t="Erreur")=>(ne.warn(`[NOTIFICATIONS STORE] Affichage d'un message d'erreur: ${e}`),f({title:t,message:e,type:"error"})),_=y,k=b,w=()=>{try{const e=G0();if(e.user&&e.user.id)return e.user.id;const t=localStorage.getItem("user");if(t){return JSON.parse(t).id||null}return null}catch(e){return ne.error("[NOTIFICATIONS STORE] Erreur lors de la récupération de l'ID admin",{error:e}),null}};return i(()=>{(async()=>{if(u.isInitialized||await u.init(),u.isConnected){qe("notification:new",e=>{t.value.unshift(e)}),qe("notification:update",e=>{const s=t.value.findIndex(t=>t.id===e.id);-1!==s&&(t.value[s]=e)}),qe("notification:delete",e=>{t.value=t.value.filter(t=>t.id!==e.id)}),qe("toast:notification",e=>{const t=w();if(!e.userId||e.userId===t){const t={id:e.id,title:e.title,message:e.message,type:e.type,timeout:e.timeout||5e3,closing:!1};a.value.push(t),setTimeout(()=>{const e=a.value.findIndex(e=>e.id===t.id);if(-1!==e){const s={...a.value[e],closing:!0};a.value=a.value.filter(e=>e.id!==t.id),r.value.push(s),setTimeout(()=>{r.value=r.value.filter(e=>e.id!==t.id)},500)}},t.timeout)}});const e=w();e&&Ve(e,"notification:personal",e=>{t.value.unshift({...e,isPersonal:!0})})}else ne.error("[NOTIFICATIONS STORE] Impossible de s'abonner aux notifications, temps réel non connecté")})()}),n(()=>{}),{notifications:t,toasts:a,closingToasts:r,preferences:o,loading:l,error:c,allNotifications:d,unreadCount:p,todayNotifications:m,activeToasts:v,fetchNotifications:async()=>{try{l.value=!0;const e=await ke.get("/notifications");return t.value=e.data,ne.debug(`[NOTIFICATIONS STORE] Notifications chargées: ${e.data.length}`),e.data}catch(e){throw ne.error("[NOTIFICATIONS STORE] Erreur de chargement",{error:e}),c.value=e,e}finally{l.value=!1}},markAsRead:async e=>{ne.info(`[NOTIFICATIONS STORE] Marquer comme lu: ${e}`);try{await ke.put(`/notifications/${e}/read`);const s=t.value.findIndex(t=>t.id===e);-1!==s&&(t.value[s].read=!0)}catch(s){throw ne.error("[NOTIFICATIONS STORE] Erreur lors du marquage comme lu",{error:s}),s}},markAllAsRead:async()=>{ne.info("[NOTIFICATIONS STORE] Marquer tout comme lu");try{await ke.put("/notifications/read-all"),t.value=t.value.map(e=>({...e,read:!0}))}catch(e){throw ne.error("[NOTIFICATIONS STORE] Erreur lors du marquage de tout comme lu",{error:e}),e}},deleteNotification:async e=>{ne.info(`[NOTIFICATIONS STORE] Supprimer la notification: ${e}`);try{await ke.delete(`/notifications/${e}`),t.value=t.value.filter(t=>t.id!==e)}catch(s){throw ne.error("[NOTIFICATIONS STORE] Erreur lors de la suppression",{error:s}),s}},clearAll:async()=>{ne.info("[NOTIFICATIONS STORE] Supprimer toutes les notifications");try{await ke.delete("/notifications/all"),t.value=[]}catch(e){throw ne.error("[NOTIFICATIONS STORE] Erreur lors de la suppression de toutes les notifications",{error:e}),e}},updatePreferences:async e=>{ne.info("[NOTIFICATIONS STORE] Mise à jour des préférences");try{await ke.put("/notifications/preferences",e),o.value=e}catch(t){throw ne.error("[NOTIFICATIONS STORE] Erreur lors de la mise à jour des préférences",{error:t}),t}},addNotification:f,addNotificationLocal:h,showNotification:g,success:y,notificationError:b,removeToast:e=>{const t=a.value.findIndex(t=>t.id===e);if(-1!==t){const s={...a.value[t],closing:!0};a.value=a.value.filter(t=>t.id!==e),r.value.push(s),setTimeout(()=>{r.value=r.value.filter(t=>t.id!==e)},500)}},showSuccess:_,showError:k,showWarning:(e,t="Attention")=>f({title:t,message:e,type:"warning"}),showInfo:(e,t="Information")=>f({title:t,message:e,type:"info"})}}),We=t("dashboard",()=>{const t=e(!1),s=e(null),a=e({clients:{total:0,active:0,new:0},services:{total:0,active:0,pending:0},tickets:{total:0,open:0,urgent:0},revenue:{monthly:0}}),i=e({clients:[],services:[],tickets:[]});return{loading:t,error:s,stats:a,activity:i,fetchStats:async()=>{var e,i;const n=He();try{t.value=!0,s.value=null;const e=await _e.routes.admin.system.dashboard.getStats();a.value=e.data,ne.debug("[DASHBOARD STORE] Statistiques chargées")}catch(r){const t=(null==(i=null==(e=r.response)?void 0:e.data)?void 0:i.message)||"Erreur lors du chargement des statistiques";throw ne.error("[DASHBOARD STORE] Erreur de chargement des statistiques",{error:r}),n.showError(t),s.value=r,r}finally{t.value=!1}},fetchActivity:async()=>{var e,a;const n=He();try{t.value=!0,s.value=null;const e=await _e.routes.admin.system.dashboard.getActivity();i.value=e.data,ne.debug("[DASHBOARD STORE] Activité chargée")}catch(r){const t=(null==(a=null==(e=r.response)?void 0:e.data)?void 0:a.message)||"Erreur lors du chargement des activités récentes";throw ne.error("[DASHBOARD STORE] Erreur de chargement de l'activité",{error:r}),n.showError(t),s.value=r,r}finally{t.value=!1}},fetchRecentClients:async(e=5)=>{var t;try{return((null==(t=(await _e.routes.admin.system.dashboard.getRevenue()).data)?void 0:t.recentClients)||[]).slice(0,e)}catch(s){return ne.error("[DASHBOARD STORE] Erreur de chargement des clients récents",{error:s}),[]}},fetchRecentTickets:async(e=5)=>{var t;try{return((null==(t=(await _e.routes.admin.system.dashboard.getActivity()).data)?void 0:t.tickets)||[]).slice(0,e)}catch(s){return ne.error("[DASHBOARD STORE] Erreur de chargement des tickets récents",{error:s}),[]}}}}),ze={id:"dashboard"},Ke={class:"header-box"},Je={class:"stats-grid box-grid"},Ye={class:"stat-card card-box"},Xe={class:"stat-number","data-type":"clients","data-count":"totalClients"},Qe={class:"stat-label"},Ze={class:"stat-card card-box"},et={class:"stat-number","data-type":"services","data-count":"totalServices"},tt={class:"stat-label"},st={class:"stat-card card-box"},at={class:"stat-number","data-type":"tickets","data-count":"totalTickets"},it={class:"stat-label"},nt={class:"stat-card card-box"},rt={class:"stat-number","data-type":"revenue","data-count":"revenue"},ot={class:"stat-label"},lt={class:"dashboard-grid box-grid"},ct={class:"card card-box"},ut={class:"card-header"},dt={class:"card-title"},pt={class:"card-body"},mt={key:0,class:"loading-state"},vt={key:1,class:"error-state"},ht={key:2,class:"client-list"},ft={class:"client-info"},gt={class:"client-details"},yt={class:"client-name"},bt={class:"client-email"},_t={class:"client-meta"},kt={class:"client-date"},wt={class:"client-status"},St={key:0,class:"no-clients"},Et={class:"card card-box"},Ct={class:"card-header"},Tt={class:"card-title"},At={class:"card-body"},It={key:0,class:"loading-state"},Rt={key:1,class:"error-state"},xt={key:2,class:"client-list"},Ot={class:"client-info"},Pt={class:"client-details"},Nt={class:"client-name"},Mt={class:"client-email"},Dt={class:"client-meta"},Lt={class:"client-date"},Ut={class:"client-status"},qt={key:0,class:"no-clients"},Vt=(e,t)=>{const s=e.__vccOpts||e;for(const[a,i]of t)s[a]=i;return s},$t=Vt(r({__name:"DashboardView",setup(t){const s=We(),a=Be(),r=e(!0),b=e(null),_=e(0),k=e(0),w=e(0),S=e(0),E=e([]),C=e([]),T=e([]),A=(e,t)=>{ne.info(`[DASHBOARD] Traitement de l'action ${t} pour le client`,{client_id:e.id});const a={...e,name:e.name||((e.firstname||"")+" "+(e.lastname||"")).trim()};switch(ne.info(`[DASHBOARD] Client formaté avec le nom: ${a.name}`,{client_id:a.id}),t){case"create":E.value.some(e=>e.id===a.id)||(E.value.unshift(a),E.value.length>5&&E.value.pop(),ne.info("[DASHBOARD] Nouveau client ajouté à la liste"));break;case"update":const e=E.value.findIndex(e=>e.id===a.id);-1!==e&&(E.value[e]={...E.value[e],...a},ne.info("[DASHBOARD] Client existant mis à jour dans la liste"));break;case"delete":const t=E.value.length;E.value=E.value.filter(e=>e.id!==a.id),E.value.length<t&&(ne.info("[DASHBOARD] Client supprimé de la liste"),s.fetchRecentClients(1).then(e=>{e.length>0&&!E.value.some(t=>t.id===e[0].id)&&E.value.push(e[0])}))}},I=(e,t)=>{ne.info(`[DASHBOARD] Traitement de l'action ${t} pour le ticket`,{ticket_id:e.id});let a="";e.client&&"object"==typeof e.client&&(e.client.firstname&&e.client.lastname?a=`${e.client.firstname} ${e.client.lastname}`:e.client.name&&(a=e.client.name));let i=e.name||"";!i&&e.title&&(i=e.title,a?i+=` (${a})`:e.client_name&&(i+=` (${e.client_name})`)),ne.info(`[DASHBOARD] Ticket reçu: id=${e.id}, name=${e.name||"non défini"}, title=${e.title||"non défini"}, client=${a||e.client_name||"non défini"}`);const n={...e,name:i||"Sans titre"};switch(ne.info("[DASHBOARD] Ticket formaté",{ticket_id:n.id}),t){case"create":C.value.some(e=>e.id===n.id)||(C.value.unshift(n),C.value.length>5&&C.value.pop(),ne.info("[DASHBOARD] Nouveau ticket ajouté à la liste"));break;case"update":const e=C.value.findIndex(e=>e.id===n.id);-1!==e&&(C.value[e]={...C.value[e],...n},ne.info("[DASHBOARD] Ticket existant mis à jour dans la liste"));break;case"delete":const t=C.value.length;C.value=C.value.filter(e=>e.id!==n.id),C.value.length<t&&(ne.info("[DASHBOARD] Ticket supprimé de la liste"),s.fetchRecentTickets(1).then(e=>{e.length>0&&!C.value.some(t=>t.id===e[0].id)&&C.value.push(e[0])}))}},R=(e,t)=>{if(e.value===t)return;let s;if(e===_.value?s='[data-type="clients"]':e===k.value?s='[data-type="services"]':e===w.value?s='[data-type="tickets"]':e===S.value&&(s='[data-type="revenue"]'),s){const e=document.querySelector(s);e&&(e.classList.add("stat-update-animation"),setTimeout(()=>{e.classList.remove("stat-update-animation")},1e3))}e.value=t};function x(e){if(!e)return"";const t=e.split(/[- :]/),s=new Date(Date.UTC(+t[0],+t[1]-1,+t[2],+t[3],+t[4],+t[5]));return new Intl.DateTimeFormat("fr-FR",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"}).format(s)}function O(e){if(!e)return"status-badge status-default";return{active:"status-badge status-success",pending:"status-badge status-warning",suspended:"status-badge status-danger",open:"status-badge status-info",in_progress:"status-badge status-warning",resolved:"status-badge status-success",closed:"status-badge status-secondary"}[e]||"status-badge status-default"}return i(async()=>{var e;try{await Promise.all([s.fetchStats(),s.fetchActivity()]),_.value=s.stats.clients.active,k.value=s.stats.services.active,w.value=s.stats.tickets.total,S.value=(null==(e=s.stats.revenue)?void 0:e.monthly)||0,E.value=s.activity.clients,C.value=s.activity.tickets,(()=>{if(ne.info("[DASHBOARD] Abonnement aux mises à jour temps réel des statistiques"),a.isConnected)try{const e=Ge("dashboard-update",e=>{ne.info("[DASHBOARD] Mise à jour tableau de bord reçue:",{category:null==e?void 0:e.category,type:null==e?void 0:e.type}),e&&"object"==typeof e?"stats"===e.category?"clients"===e.type&&void 0!==e.count?(ne.info("[DASHBOARD] Mise à jour du compteur clients:",e.count),R(_,e.count)):"services"===e.type&&void 0!==e.count?(ne.info("[DASHBOARD] Mise à jour du compteur services:",e.count),R(k,e.count)):"tickets"===e.type&&void 0!==e.count?(ne.info("[DASHBOARD] Mise à jour du compteur tickets:",e.count),R(w,e.count)):"revenue"===e.type&&void 0!==e.amount&&(ne.info("[DASHBOARD] Mise à jour du compteur revenus:",e.amount),R(S,e.amount)):"activity"===e.category&&("client_update"===e.type&&e.client&&e.action?A(e.client,e.action):"ticket_update"===e.type&&e.ticket&&e.action&&I(e.ticket,e.action)):ne.warn("[DASHBOARD] Données reçues invalides:",e)});e&&"object"==typeof e&&"unsubscribe"in e&&T.value.push(e)}catch(e){const t=e instanceof Error?e:new Error(String(e));ne.error("[DASHBOARD] Erreur lors de l'abonnement aux mises à jour temps réel:",t)}else ne.warn("[DASHBOARD] Client temps réel non connecté, impossible de s'abonner aux mises à jour")})()}catch(t){b.value=t.message}finally{r.value=!1}}),n(()=>{ne.info("[DASHBOARD] Nettoyage des abonnements temps réel"),T.value.forEach(e=>{"function"==typeof e.unsubscribe&&e.unsubscribe()}),T.value=[]}),(e,t)=>{const s=m("router-link");return g(),o("div",ze,[l("div",Ke,[l("h1",null,c(e.$t("dashboard.title")),1)]),l("div",Je,[l("div",Ye,[t[0]||(t[0]=l("div",{class:"stat-icon"},[l("i",{class:"fas fa-users"})],-1)),l("div",Xe,c(_.value),1),l("div",Qe,c(e.$t("dashboard.stats.active_clients")),1)]),l("div",Ze,[t[1]||(t[1]=l("div",{class:"stat-icon"},[l("i",{class:"fas fa-server"})],-1)),l("div",et,c(k.value),1),l("div",tt,c(e.$t("dashboard.stats.active_services")),1)]),l("div",st,[t[2]||(t[2]=l("div",{class:"stat-icon"},[l("i",{class:"fas fa-cube"})],-1)),l("div",at,c(w.value),1),l("div",it,c(e.$t("dashboard.stats.active_tickets")),1)]),l("div",nt,[t[3]||(t[3]=l("div",{class:"stat-icon"},[l("i",{class:"fas fa-chart-line"})],-1)),l("div",rt,c((a=S.value,new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(a??0))),1),l("div",ot,c(e.$t("dashboard.stats.monthly_revenue")),1)])]),l("div",lt,[l("div",ct,[l("div",ut,[l("h3",dt,[t[4]||(t[4]=l("i",{class:"fas fa-users"},null,-1)),d(" "+c(e.$t("dashboard.recent_clients.title")),1)]),u(s,{to:"/clients",class:"btn btn-sm btn-outline"},{default:p(()=>[d(c(e.$t("common.view_all")),1)]),_:1})]),l("div",pt,[r.value?(g(),o("div",mt,t[5]||(t[5]=[l("i",{class:"fas fa-spinner fa-spin"},null,-1)]))):b.value?(g(),o("div",vt,c(b.value),1)):(g(),o("div",ht,[(g(!0),o(h,null,f(E.value,e=>(g(),o("div",{key:e.id,class:"client-item"},[l("div",ft,[t[6]||(t[6]=l("div",{class:"client-avatar"},[l("i",{class:"fas fa-user-circle"})],-1)),l("div",gt,[l("div",yt,[u(s,{to:`/clients/${e.id}`,class:"client-link"},{default:p(()=>[d(c(e.name),1)]),_:2},1032,["to"])]),l("div",bt,c(e.email),1)])]),l("div",_t,[l("div",kt,c(x(e.created_at)),1),l("div",wt,[l("span",{class:y(O(e.status))},c(e.status),3)])])]))),128)),0===E.value.length?(g(),o("div",St,c(e.$t("common.no_data")),1)):v("",!0)]))])]),l("div",Et,[l("div",Ct,[l("h3",Tt,[t[7]||(t[7]=l("i",{class:"fas fa-headset"},null,-1)),d(" "+c(e.$t("dashboard.recent_tickets.title")),1)]),u(s,{to:"/tickets",class:"btn btn-sm btn-outline"},{default:p(()=>[d(c(e.$t("common.view_all")),1)]),_:1})]),l("div",At,[r.value?(g(),o("div",It,t[8]||(t[8]=[l("i",{class:"fas fa-spinner fa-spin"},null,-1)]))):b.value?(g(),o("div",Rt,c(b.value),1)):(g(),o("div",xt,[(g(!0),o(h,null,f(C.value,e=>(g(),o("div",{key:e.id,class:"client-item"},[l("div",Ot,[t[9]||(t[9]=l("div",{class:"client-avatar"},[l("i",{class:"fas fa-headset"})],-1)),l("div",Pt,[l("div",Nt,[u(s,{to:`/tickets/${e.id}`,class:"client-link"},{default:p(()=>[d(c(e.title?e.title+(e.client_name?" ("+e.client_name+")":""):"Sans titre"),1)]),_:2},1032,["to"])]),l("div",Mt," #"+c(e.id),1)])]),l("div",Dt,[l("div",Lt,c(x(e.created_at)),1),l("div",Ut,[l("span",{class:y(O(e.status))},c(e.status),3)])])]))),128)),0===C.value.length?(g(),o("div",qt,c(e.$t("common.no_data")),1)):v("",!0)]))])])])]);var a}}}),[["__scopeId","data-v-79c87110"]]),jt=e=>{var t,s;const a={message:e.message,stack:e.stack};return e.response?a.response={data:e.response.data,status:e.response.status,headers:e.response.headers}:e.request&&(a.request=e.request),ne.error("Une erreur globale a été interceptée",a),(null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.message)?e.response.data.message:e.message?e.message:"Une erreur inattendue est survenue"},Ft={class:"logo"};const Gt=Vt({},[["render",function(e,t){return g(),o("div",Ft,t[0]||(t[0]=[l("h1",{class:"logo-text"},"TechCMS",-1)]))}],["__scopeId","data-v-8b8f127c"]]),Bt={class:"login-view"},Ht={class:"login-container"},Wt={class:"login-header"},zt={key:0,class:"login-form"},Kt={class:"form-group"},Jt={for:"email"},Yt={class:"input-group"},Xt=["placeholder"],Qt={class:"form-group"},Zt={for:"password"},es={class:"input-group"},ts=["type","placeholder"],ss={class:"form-options"},as={class:"remember-me"},is={for:"remember"},ns={key:0,class:"error-message"},rs=["disabled"],os={key:0,class:"fas fa-spinner fa-spin"},ls={key:1},cs={key:1,class:"forgot-password-form"},us={class:"form-group"},ds={for:"forgot-email"},ps={class:"input-group"},ms=["placeholder"],vs={key:0,class:"error-message"},hs={key:1,class:"success-message"},fs={class:"form-actions"},gs=["disabled"],ys={key:0,class:"fas fa-spinner fa-spin"},bs={key:1},_s={class:"login-footer"},ks=Vt(r({__name:"LoginView",setup(t){const{t:s}=b(),a=G0(),n=T(),r=e(""),p=e(""),m=e(!1),h=e(!1),f=e(!1),A=e(""),I=e(!1),R=e(""),x=e(!1);i(()=>{});const O=async()=>{if(ne.info("[LOGIN] Tentative de connexion"),!r.value||!p.value)return ne.warn("[LOGIN] Champs manquants"),void(A.value=s("login.errorFields"));try{f.value=!0,A.value="",ne.debug("[LOGIN] Appel de authStore.login"),await a.login(r.value,p.value,m.value),ne.info("[LOGIN] Connexion réussie"),n.push("/dashboard")}catch(e){ne.error("[LOGIN] Erreur de connexion",{error:e}),A.value=jt(e)}finally{f.value=!1}},P=async()=>{if(ne.info("[LOGIN] Tentative de réinitialisation du mot de passe"),!R.value)return ne.warn("[LOGIN] Email manquant"),void(A.value=s("login.errorEmail"));try{f.value=!0,ne.debug("[LOGIN] Appel de authStore.forgotPassword"),await a.forgotPassword(R.value),ne.info("[LOGIN] Email de réinitialisation envoyé"),x.value=!0,A.value=""}catch(e){ne.error("[LOGIN] Erreur de réinitialisation",{error:e}),A.value=jt(e)}finally{f.value=!1}},N=()=>{I.value=!I.value,A.value="",x.value=!1};return(e,t)=>(g(),o("div",Bt,[l("div",Ht,[l("div",Wt,[u(Gt,{class:"login-logo"}),l("h1",null,c(_(s)("login.welcome")),1),l("p",null,c(_(s)("login.subtitle")),1)]),I.value?(g(),o("div",cs,[l("h2",null,c(_(s)("login.resetTitle")),1),l("p",null,c(_(s)("login.resetDescription")),1),l("form",{onSubmit:k(P,["prevent"])},[l("div",us,[l("label",ds,c(_(s)("login.email")),1),l("div",ps,[t[8]||(t[8]=l("i",{class:"fas fa-envelope"},null,-1)),w(l("input",{id:"forgot-email","onUpdate:modelValue":t[4]||(t[4]=e=>R.value=e),type:"email",placeholder:_(s)("login.emailPlaceholder"),required:""},null,8,ms),[[S,R.value]])])]),A.value?(g(),o("div",vs,[t[9]||(t[9]=l("i",{class:"fas fa-exclamation-circle"},null,-1)),d(" "+c(A.value),1)])):v("",!0),x.value?(g(),o("div",hs,[t[10]||(t[10]=l("i",{class:"fas fa-check-circle"},null,-1)),d(" "+c(_(s)("login.resetSuccess")),1)])):v("",!0),l("div",fs,[l("button",{type:"button",class:"back-button",onClick:N},[t[11]||(t[11]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(_(s)("common.back")),1)]),l("button",{type:"submit",class:"reset-button",disabled:f.value},[f.value?(g(),o("i",ys)):(g(),o("span",bs,c(_(s)("login.sendReset")),1))],8,gs)])],32)])):(g(),o("div",zt,[l("form",{onSubmit:k(O,["prevent"])},[l("div",Kt,[l("label",Jt,c(_(s)("login.email")),1),l("div",Yt,[t[5]||(t[5]=l("i",{class:"fas fa-envelope"},null,-1)),w(l("input",{id:"email","onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),type:"email",placeholder:_(s)("login.emailPlaceholder"),required:"",autocomplete:"email"},null,8,Xt),[[S,r.value]])])]),l("div",Qt,[l("label",Zt,c(_(s)("login.password")),1),l("div",es,[t[6]||(t[6]=l("i",{class:"fas fa-lock"},null,-1)),w(l("input",{id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>p.value=e),type:h.value?"text":"password",placeholder:_(s)("login.passwordPlaceholder"),required:"",autocomplete:"current-password"},null,8,ts),[[E,p.value]]),l("button",{type:"button",class:"password-toggle",onClick:t[2]||(t[2]=e=>h.value=!h.value)},[l("i",{class:y(h.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),l("div",ss,[l("div",as,[w(l("input",{id:"remember","onUpdate:modelValue":t[3]||(t[3]=e=>m.value=e),type:"checkbox"},null,512),[[C,m.value]]),l("label",is,c(_(s)("login.rememberMe")),1)]),l("button",{type:"button",class:"forgot-password",onClick:N},c(_(s)("login.forgotPassword")),1)]),A.value?(g(),o("div",ns,[t[7]||(t[7]=l("i",{class:"fas fa-exclamation-circle"},null,-1)),d(" "+c(A.value),1)])):v("",!0),l("button",{type:"submit",class:"login-button",disabled:f.value},[f.value?(g(),o("i",os)):(g(),o("span",ls,c(_(s)("login.signIn")),1))],8,rs)],32)])),l("div",_s,[l("p",null,c(_(s)("login.copyright",{year:(new Date).getFullYear()})),1)])])]))}}),[["__scopeId","data-v-829fb0e4"]]);ne.info("[CLIENTS STORE] Initialisation du store clients");const ws=t("clients",()=>{const t=e([]),a=e(!1),i=e(null),n=e(1),r=e(1),o=e(10),l=e(!1),c=e(null),u=e(null),d=e(null),p=s(()=>t.value.length>0),m=s(()=>t.value.length),v=e=>{if(!e||!e.action||!e.client)return void ne.warn("[CLIENTS STORE] Données d'événement client incomplètes",{eventData:e});const{action:t,client:s,timestamp:a}=e;if(c.value!==a||!a)switch(c.value=a,d.value=e,ne.info(`[CLIENTS STORE] Traitement de l'événement ${t} pour le client #${s.id}`,{timestamp:a,client_id:s.id}),t){case"create":h(s);break;case"update":f(s);break;case"delete":g(s.id);break;default:ne.warn(`[CLIENTS STORE] Action inconnue: ${t}`)}},h=e=>{ne.debug("[CLIENTS STORE] Ajout d'un nouveau client en temps réel",{client_id:e.id});const s=t.value.findIndex(t=>t.id===e.id);if(-1!==s)return ne.debug("[CLIENTS STORE] Client existant, mise à jour",{client_id:e.id}),void(t.value[s]=e);t.value.unshift(e),ne.info("[CLIENTS STORE] Nouveau client ajouté en temps réel",{client_id:e.id})},f=e=>{ne.debug("[CLIENTS STORE] Mise à jour d'un client en temps réel",{client_id:e.id});const s=t.value.findIndex(t=>t.id===e.id);-1!==s?(t.value[s]=e,ne.debug("[CLIENTS STORE] Client mis à jour avec succès dans la liste",{client_id:e.id}),u.value&&u.value.id===e.id&&(u.value=e,ne.debug("[CLIENTS STORE] Client courant mis à jour avec succès",{client_id:e.id}))):(ne.debug("[CLIENTS STORE] Client non trouvé dans la liste, ajout",{client_id:e.id}),t.value.unshift(e))},g=e=>{const s=t.value.length;t.value=t.value.filter(t=>t.id!==e),t.value.length<s&&ne.info("[CLIENTS STORE] Client supprimé avec succès en temps réel",{client_id:e})};return{clients:t,loading:a,error:i,currentPage:n,totalPages:r,perPage:o,realtimeInitialized:l,lastEventTimestamp:c,currentClient:u,lastRealtimeEvent:d,hasClients:p,totalClients:m,fetchClients:async()=>{var e;ne.info("[CLIENTS STORE] Récupération des clients..."),a.value=!0,i.value=null;try{const e=G0();if(!(await e.checkAuth()))return ne.warn("[CLIENTS STORE] Utilisateur non authentifié"),i.value="Vous devez être connecté pour accéder à cette ressource",a.value=!1,!1;ne.debug("[CLIENTS STORE] Envoi de la requête API pour récupérer les clients");const s=await _e.routes.admin.client.list();return ne.debug("[CLIENTS STORE] Réponse reçue",{status:s.status}),t.value=s.data.data.clients||[],a.value=!1,!0}catch(s){return ne.error("[CLIENTS STORE] Erreur lors de la récupération des clients",{message:s.message,response:null==(e=s.response)?void 0:e.data}),i.value=s.message||"Erreur lors de la récupération des clients",a.value=!1,!1}},getClient:async e=>{ne.info(`[CLIENTS STORE] Récupération du client #${e}`);try{const t=await _e.routes.admin.client.get(e.toString());ne.debug("[CLIENTS STORE] Structure de la réponse",{data:t.data});let s=null;return t.data&&t.data.data&&t.data.data.client?s=t.data.data.client:t.data&&t.data.data?s=t.data.data:t.data&&t.data.client?s=t.data.client:t.data&&(s=t.data),ne.debug("[CLIENTS STORE] Données du client extraites",{clientData:s}),s}catch(t){return ne.error(`[CLIENTS STORE] Erreur lors de la récupération du client #${e}`,{error:t.message}),i.value=t.message,null}},createClient:async e=>{ne.info("[CLIENTS STORE] Création d'un nouveau client",{clientData:e}),a.value=!0,i.value=null;const s=He();try{const i=await _e.routes.admin.client.create(e);ne.info("[CLIENTS STORE] Client créé avec succès",{response:i.data});let n=null;return i.data&&i.data.data&&i.data.data.client?n=i.data.data.client:i.data&&i.data.data?n=i.data.data:i.data&&i.data.client?n=i.data.client:i.data&&(n=i.data),n&&(t.value.unshift(n),ne.debug("[CLIENTS STORE] Nouveau client ajouté à la liste",{client_id:n.id}),s.showSuccess("Client créé avec succès")),a.value=!1,n}catch(n){return ne.error("[CLIENTS STORE] Erreur lors de la création du client",{error:n.message}),i.value=n.message||"Erreur lors de la création du client",a.value=!1,s.showError(`Erreur lors de la création du client: ${n.message||"Erreur inconnue"}`),null}},updateClient:async(e,t)=>{ne.info(`[CLIENTS STORE] Mise à jour du client #${e}`,{clientData:t}),a.value=!0,i.value=null;const s=He();try{const i=await _e.routes.admin.client.update(e.toString(),t);ne.debug("[CLIENTS STORE] Client mis à jour avec succès",{response:i.data});let n=null;return i.data&&i.data.data&&i.data.data.client?n=i.data.data.client:i.data&&i.data.data?n=i.data.data:i.data&&i.data.client?n=i.data.client:i.data&&(n=i.data),n&&(f(n),ne.debug("[CLIENTS STORE] Client mis à jour dans la liste",{client_id:n.id}),s.showSuccess(`Client #${e} mis à jour avec succès`)),a.value=!1,n}catch(n){return ne.error(`[CLIENTS STORE] Erreur lors de la mise à jour du client #${e}`,{error:n.message}),i.value=n.message||"Erreur lors de la mise à jour du client",a.value=!1,s.showError(`Erreur lors de la mise à jour du client: ${n.message||"Erreur inconnue"}`),null}},deleteClient:async e=>{ne.info(`[CLIENTS STORE] Suppression du client #${e}`),a.value=!0,i.value=null;const t=He();try{return await _e.routes.admin.client.delete(e.toString()),ne.debug(`[CLIENTS STORE] Client #${e} supprimé avec succès`),g(e),a.value=!1,t.showSuccess(`Client #${e} supprimé avec succès`),!0}catch(s){return ne.error(`[CLIENTS STORE] Erreur lors de la suppression du client #${e}`,{error:s.message}),i.value=s.message||"Erreur lors de la suppression du client",a.value=!1,t.showError(`Erreur lors de la suppression du client: ${s.message||"Erreur inconnue"}`),!1}},initRealtimeListeners:()=>{if(!l.value){ne.info("[CLIENTS STORE] Initialisation des écouteurs temps réel");try{qe("client-update",e=>{ne.debug("[admin-frontend] EXPÉRIMENTAL - Événement client-update reçu",{eventData:e}),v(e)}),l.value=!0,ne.info("[CLIENTS STORE] Écouteurs temps réel initialisés avec succès")}catch(e){ne.error("[CLIENTS STORE] Erreur lors de l'initialisation des écouteurs temps réel",{error:e})}}},handleRealtimeClientUpdate:v,handleClientCreate:h,handleClientUpdate:f,handleClientDelete:g}}),Ss=t("services",()=>{const t=e([]),a=e(null),i=e(!1),n=e(""),r=e(null),o=e(0),l=e(1),c=e(15),u=e(!1),d=e(null),p=He(),m=s(()=>e=>t.value.find(t=>t.id===e)),v=s(()=>e=>t.value.filter(t=>t.status===e)),h=s(()=>e=>t.value.filter(t=>t.client_id===e)),f=e=>{const{event:s,service:i}=e;if(d.value=e,i)switch(s){case"create":case"created":t.value=[i,...t.value],p.showNotification({title:"Nouveau service",message:`Service ${i.name||"#"+i.id} créé`,type:"info",timeout:5e3});break;case"update":case"updated":const e=t.value.findIndex(e=>e.id===i.id);-1!==e&&(t.value[e]=i),a.value&&a.value.id===i.id&&(a.value=i);break;case"delete":case"deleted":t.value=t.value.filter(e=>e.id!==i.id),a.value&&a.value.id===i.id&&(a.value=null),p.showNotification({title:"Service supprimé",message:`Service ${i.name||"#"+i.id} supprimé`,type:"warning",timeout:5e3});break;case"status_changed":const s=t.value.findIndex(e=>e.id===i.id);-1!==s&&(t.value[s]=i),a.value&&a.value.id===i.id&&(a.value=i),p.showNotification({title:"Changement de statut",message:`Statut du service ${i.name||"#"+i.id} mis à jour: ${i.status}`,type:"info",timeout:5e3})}};return{services:t,currentService:a,loading:i,error:n,stats:r,total:o,currentPage:l,perPage:c,realtimeInitialized:u,lastRealtimeEvent:d,getServiceById:m,getServicesByStatus:v,getServicesByClient:h,fetchServices:async(e=1,s={})=>{i.value=!0,n.value="";try{const a=await _e.routes.admin.service.list({page:e,per_page:c.value,...s});return t.value=a.data.data,o.value=a.data.meta.total,l.value=a.data.meta.current_page,c.value=a.data.meta.per_page,Oe("services","update",e=>{f(e.data)}),a.data}catch(a){throw ne.error("Erreur lors de la récupération des services",{error:a}),n.value="Erreur lors de la récupération des services",a}finally{i.value=!1}},fetchServiceStats:async()=>(i.value=!0,n.value="",ne.warn("[ServicesStore] Tentative d'appel à fetchServiceStats qui est désactivée"),n.value="La fonction de statistiques de services est temporairement indisponible",p.showWarning("Les statistiques de services ne sont pas disponibles pour le moment","Fonctionnalité non disponible"),i.value=!1,null),fetchServiceById:async e=>{i.value=!0,n.value="";try{const t=await _e.routes.admin.service.get(e.toString());return t.data&&"object"==typeof t.data?t.data.id&&!t.data.data?(a.value=t.data,ne.debug(`Service #${e} récupéré avec succès (format direct)`,{service:t.data})):t.data.data?(a.value=t.data.data,ne.debug(`Service #${e} récupéré avec succès (format imbriqué)`,{service:t.data.data})):(ne.error(`La réponse pour le service #${e} ne contient pas de données valides`,{response:t}),n.value=`Format de réponse incorrect pour le service #${e}`,a.value=null):(ne.error(`La réponse pour le service #${e} n'est pas au format attendu`,{response:t}),n.value=`Format de réponse incorrect pour le service #${e}`,a.value=null),a.value}catch(t){return ne.error(`Erreur lors de la récupération du service #${e}`,{error:t}),n.value=`Impossible de charger les détails du service #${e}`,null}finally{i.value=!1}},fetchClientServices:async e=>{i.value=!0,n.value="";try{return(await _e.routes.admin.service.getClientServices(e.toString())).data}catch(t){return ne.error(`Erreur lors de la récupération des services du client ${e}`,{error:t}),n.value=`Impossible de charger les services du client ${e}`,null}finally{i.value=!1}},createService:async e=>{i.value=!0,n.value="";try{const s=await _e.routes.admin.service.create(e);return t.value.unshift(s.data.data),p.showNotification({title:"Service créé",message:"Le service a été créé avec succès",type:"success",timeout:5e3}),s.data.data}catch(s){return ne.error("Erreur lors de la création du service",{error:s}),n.value="Impossible de créer le service",null}finally{i.value=!1}},updateService:async(e,s)=>{i.value=!0,n.value="";try{const i=await _e.routes.admin.service.update(e.toString(),s),n=t.value.findIndex(t=>t.id===e);return-1!==n&&(t.value[n]=i.data.data),a.value&&a.value.id===e&&(a.value=i.data.data),p.showNotification({title:"Service mis à jour",message:"Le service a été mis à jour avec succès",type:"success",timeout:5e3}),i.data.data}catch(r){return ne.error(`Erreur lors de la mise à jour du service ${e}`,{error:r}),n.value=`Impossible de mettre à jour le service ${e}`,null}finally{i.value=!1}},changeServiceStatus:async(e,s,r)=>{ne.info(`[ServicesStore] changeServiceStatus appelé pour le service ${e} avec le statut ${s}`),i.value=!0,n.value="";try{const i=r?{status:s,notes:r}:{status:s};ne.debug(`[ServicesStore] Envoi de la requête PUT à /api/v1/services/${e}/status`,{data:i});const n=await _e.routes.admin.service.changeStatus(e.toString(),i);ne.debug(`[ServicesStore] Requête PUT réussie pour le service ${e}`,{response:n.data});const o=t.value.findIndex(t=>t.id===e);return-1!==o&&(t.value[o]={...t.value[o],...n.data}),a.value&&a.value.id===e&&(a.value=n.data),p.showNotification({title:"Statut modifié",message:`Le statut du service a été changé en "${s}"`,type:"success",timeout:5e3}),n.data}catch(o){return ne.error(`[ServicesStore] Erreur lors du changement de statut du service ${e}`,{error:o}),n.value=`Impossible de modifier le statut du service ${e}`,p.showNotification({title:"Erreur",message:"Impossible de changer le statut du service",type:"error"}),null}finally{i.value=!1}},deleteService:async e=>{ne.info(`[ServicesStore] deleteService appelé pour le service ${e}`),i.value=!0,n.value="";try{return ne.debug(`[ServicesStore] Envoi de la requête DELETE à /api/v1/services/${e}`),await _e.routes.admin.service.delete(e.toString()),ne.debug(`[ServicesStore] Requête DELETE réussie pour le service ${e}`),t.value=t.value.filter(t=>t.id!==e),a.value&&a.value.id===e&&(a.value=null),p.showNotification({title:"Service supprimé",message:"Le service a été supprimé avec succès",type:"success",timeout:5e3}),!0}catch(s){throw ne.error(`[ServicesStore] Erreur lors de la suppression du service ${e}`,{error:s}),n.value=`Erreur lors de la suppression du service ${e}`,p.showNotification({title:"Erreur",message:"Impossible de supprimer le service",type:"error"}),s}finally{i.value=!1}},initRealtimeListeners:()=>{if(u.value)ne.info("[ServicesStore] Les écouteurs temps réel sont déjà initialisés");else try{Oe("services","created",e=>{f({event:"created",service:e.data})}),Oe("services","updated",e=>{f({event:"updated",service:e.data})}),Oe("services","deleted",e=>{f({event:"deleted",service:e.data})}),Oe("services","status_changed",e=>{f({event:"status_changed",service:e.data})}),u.value=!0,ne.info("[ServicesStore] Écouteurs temps réel initialisés avec succès")}catch(e){ne.error("[ServicesStore] Erreur lors de l'initialisation des écouteurs temps réel",{error:e})}},handleRealtimeUpdate:f}}),Es={id:"clientsList",class:"view-container"},Cs={class:"header-box"},Ts={class:"page-title"},As={class:"page-description"},Is={class:"filter-box"},Rs={class:"filter-grid"},xs={class:"filter-group"},Os={class:"filter-label"},Ps={class:"filter-input-wrapper"},Ns=["placeholder"],Ms={class:"filter-group"},Ds={class:"filter-label"},Ls={class:"filter-input-wrapper"},Us={value:""},qs={value:"active"},Vs={value:"inactive"},$s={value:"pending"},js={class:"filter-group"},Fs={class:"filter-label"},Gs={class:"filter-input-wrapper"},Bs={value:""},Hs={value:"hosting"},Ws={value:"domain"},zs={value:"ssl"},Ks={key:0,class:"loading-state box"},Js={key:1,class:"empty-state box"},Ys={class:"empty-title"},Xs={class:"empty-description"},Qs={key:2,class:"table-box"},Zs={class:"data-table"},ea=["onClick"],ta={class:"client-details"},sa={class:"client-name"},aa={class:"services-list"},ia={key:0,class:"service-count"},na={key:1,class:"no-services"},ra={class:"actions"},oa={class:"action-buttons"},la=["title","onClick"],ca=["title","onClick"],ua=["title","onClick"],da={key:3,class:"pagination"},pa=["onClick"],ma=r({__name:"ClientsView",setup(t){const{t:n}=b(),r=T(),u=ws(),p=Ss(),m=Be(),E=e("name"),C=e(!1),I=e(""),R=e(""),x=e(""),O=e(1),P=e(10),N=e({});a([I,R,x],()=>{O.value=1});const M=s(()=>{if(!u.clients.length)return[];let e=[...u.clients];if(I.value){const t=I.value.toLowerCase();e=e.filter(e=>e.firstname&&e.firstname.toLowerCase().includes(t)||e.lastname&&e.lastname.toLowerCase().includes(t)||e.email&&e.email.toLowerCase().includes(t)||e.company&&e.company.toLowerCase().includes(t))}return R.value&&(e=e.filter(e=>e.status===R.value)),x.value&&(e=e.filter(e=>(N.value[e.id]||[]).some(e=>e.type===x.value))),[...e].sort((e,t)=>{const s=e[E.value],a=t[E.value];return s<a?C.value?1:-1:s>a?C.value?-1:1:0})}),D=s(()=>Math.ceil(M.value.length/P.value)),L=s(()=>{const e=(O.value-1)*P.value,t=e+P.value;return M.value.slice(e,t)}),U=async()=>{try{ne.debug("[ClientsView] Chargement des clients..."),await u.fetchClients(),ne.debug(`[ClientsView] Clients chargés: ${u.clients.length}`),await q()}catch(e){ne.error("[ClientsView] Erreur lors du chargement des clients",{error:e})}},q=async()=>{try{for(const t of u.clients)try{ne.debug(`[ClientsView] Récupération des services pour le client #${t.id}`);const e=await p.fetchClientServices(t.id);ne.debug(`[ClientsView] Services récupérés pour le client #${t.id}`,{response:e}),e&&e.data&&(N.value[t.id]=Array.isArray(e.data)?e.data:[e.data])}catch(e){ne.error(`[ClientsView] Erreur lors de la récupération des services pour le client #${t.id}`,{error:e}),N.value[t.id]=[]}}catch(t){ne.error("[ClientsView] Erreur lors de la récupération des services",{error:t})}},V=e=>{r.push({name:"client-details",params:{id:e.toString()}})},$=()=>{r.push({name:"create-client"})};return i(async()=>{await U(),(()=>{try{m.isInitialized||(ne.debug("[ClientsView] Initialisation du store realtime"),m.init()),u.initRealtimeListeners(),ne.info("[ClientsView] Fonctionnalités temps réel initialisées avec succès")}catch(e){ne.error("[ClientsView] Erreur lors de l'initialisation du temps réel",{error:e})}})()}),(e,t)=>(g(),o("div",Es,[l("div",Cs,[l("div",null,[l("h1",Ts,c(_(n)("clients.title")),1),l("span",As,c(_(n)("clients.description")),1)]),l("button",{class:"btn btn-gradient",onClick:$},[t[3]||(t[3]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(_(n)("clients.add_new")),1)])]),l("div",Is,[l("div",Rs,[l("div",xs,[l("label",Os,c(_(n)("clients.filters.search")),1),l("div",Ps,[t[4]||(t[4]=l("i",{class:"fas fa-search"},null,-1)),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>I.value=e),type:"text",class:"filter-input",placeholder:_(n)("clients.filters.search_placeholder")},null,8,Ns),[[S,I.value]])])]),l("div",Ms,[l("label",Ds,c(_(n)("clients.filters.status")),1),l("div",Ls,[t[5]||(t[5]=l("i",{class:"fas fa-user-clock"},null,-1)),w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>R.value=e),class:"filter-input"},[l("option",Us,c(_(n)("clients.status.all")),1),l("option",qs,c(_(n)("clients.status.active")),1),l("option",Vs,c(_(n)("clients.status.inactive")),1),l("option",$s,c(_(n)("clients.status.pending")),1)],512),[[A,R.value]])])]),l("div",js,[l("label",Fs,c(_(n)("clients.filters.service_type")),1),l("div",Gs,[t[6]||(t[6]=l("i",{class:"fas fa-cog"},null,-1)),w(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>x.value=e),class:"filter-input"},[l("option",Bs,c(_(n)("clients.services.all")),1),l("option",Hs,c(_(n)("clients.services.hosting")),1),l("option",Ws,c(_(n)("clients.services.domain")),1),l("option",zs,c(_(n)("clients.services.ssl")),1)],512),[[A,x.value]])])])])]),_(u).loading?(g(),o("div",Ks,[t[7]||(t[7]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(n)("common.loading")),1)])):0===M.value.length?(g(),o("div",Js,[t[8]||(t[8]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-users"})],-1)),l("h3",Ys,c(_(n)("clients.empty.title")),1),l("p",Xs,c(_(n)("clients.empty.description")),1)])):(g(),o("div",Qs,[l("table",Zs,[l("thead",null,[l("tr",null,[t[9]||(t[9]=l("th",null,"ID",-1)),l("th",null,c(_(n)("clients.table.client")),1),l("th",null,c(_(n)("clients.table.company")),1),l("th",null,c(_(n)("clients.table.email")),1),l("th",null,c(_(n)("clients.table.phone")),1),l("th",null,c(_(n)("clients.table.status")),1),l("th",null,c(_(n)("clients.table.services")),1),l("th",null,c(_(n)("clients.table.actions")),1)])]),l("tbody",null,[(g(!0),o(h,null,f(L.value,e=>(g(),o("tr",{key:e.id,onClick:t=>V(e.id)},[l("td",null,"#"+c(e.id),1),l("td",null,[l("div",ta,[l("span",sa,c(e.firstname)+" "+c(e.lastname),1)])]),l("td",null,c(e.company||"-"),1),l("td",null,c(e.email),1),l("td",null,c(e.phone||"-"),1),l("td",null,[l("span",{class:y(`status-badge status-${e.status}`)},c(_(n)(`clients.status.${e.status}`)),3)]),l("td",null,[l("div",aa,[N.value[e.id]&&N.value[e.id].length?(g(),o("span",ia," ("+c(N.value[e.id].length)+") ",1)):(g(),o("span",na,c(_(n)("clients.no_services")),1))])]),l("td",ra,[l("div",oa,[l("button",{class:"btn-icon",title:_(n)("clients.actions.view"),onClick:k(t=>V(e.id),["stop"])},t[10]||(t[10]=[l("i",{class:"fas fa-eye"},null,-1)]),8,la),l("button",{class:"btn-icon",title:_(n)("clients.actions.edit"),onClick:k(t=>{return s=e.id,void r.push({name:"edit-client",params:{id:s.toString()}});var s},["stop"])},t[11]||(t[11]=[l("i",{class:"fas fa-edit"},null,-1)]),8,ca),l("button",{class:"btn-icon",title:_(n)("clients.actions.delete"),onClick:k(t=>(async e=>{if(confirm(n("clients.confirm_delete")))try{await u.deleteClient(e),await U()}catch(t){ne.error("[ClientsView] Erreur lors de la suppression du client",{error:t})}})(e.id),["stop"])},t[12]||(t[12]=[l("i",{class:"fas fa-trash"},null,-1)]),8,ua)])])],8,ea))),128))])])])),D.value>1?(g(),o("div",da,[(g(!0),o(h,null,f(D.value,e=>(g(),o("a",{key:e,class:y(["page-link",{active:e===O.value}]),onClick:t=>(e=>{O.value=e,window.scrollTo({top:0,behavior:"smooth"})})(e)},c(e),11,pa))),128))])):v("",!0)]))}}),va=Vt(ma,[["__scopeId","data-v-08aae1e2"]]),ha=t("products",()=>{const t=e([]),a=e(!1),i=e(null),n=e(null),r=e(null),o=e(!1),l=s(()=>t.value||[]),c=s(()=>(t.value||[]).filter(e=>"active"===e.status)),u=s(()=>(t.value||[]).filter(e=>"maintenance"===e.status)),d=s(()=>(t.value||[]).filter(e=>"inactive"===e.status)),p=e=>{var s;try{if(r.value=e,ne.info("[PRODUCTS STORE] Événement temps réel reçu",{action:e.action,product_id:(null==(s=e.product)?void 0:s.id)||"non spécifié"}),"create"===e.action){if(e.product&&e.product.id){-1===t.value.findIndex(t=>t.id===e.product.id)&&(t.value.push(e.product),ne.info("[PRODUCTS STORE] Nouveau produit ajouté à la liste",{product_id:e.product.id}))}}else if("update"===e.action){if(e.product&&e.product.id){const s=t.value.findIndex(t=>t.id===e.product.id);-1!==s&&(t.value[s]=e.product,ne.info("[PRODUCTS STORE] Produit mis à jour dans la liste",{product_id:e.product.id})),n.value&&n.value.id===e.product.id&&(n.value=e.product,ne.info("[PRODUCTS STORE] Produit courant mis à jour",{product_id:e.product.id}))}}else"delete"===e.action&&e.product&&e.product.id&&(t.value=t.value.filter(t=>t.id!==e.product.id),ne.info("[PRODUCTS STORE] Produit supprimé de la liste",{product_id:e.product.id}),n.value&&n.value.id===e.product.id&&(n.value=null,ne.info("[PRODUCTS STORE] Produit courant réinitialisé car supprimé",{product_id:e.product.id})))}catch(a){ne.error("[PRODUCTS STORE] Erreur lors du traitement de l'événement temps réel",{err:a,event_data:e})}};return{products:t,loading:a,error:i,currentProduct:n,lastRealtimeEvent:r,allProducts:l,activeProducts:c,maintenanceProducts:u,inactiveProducts:d,fetchProducts:async()=>{try{a.value=!0,i.value=null,ne.info("Début de la récupération des produits");const e=await _e.routes.admin.product.list();ne.debug("Réponse API produits",{response:e}),e.data&&e.data.products?(ne.debug("Structure de réponse avec data.products",{products:e.data.products}),t.value=e.data.products||[]):Array.isArray(e.data)?(ne.debug("Structure de réponse tableau",{data:e.data}),t.value=e.data):(ne.warn("Format de réponse inattendu",{data:e.data}),t.value=[]),ne.debug("Produits après traitement",{products:t.value})}catch(e){const t=e instanceof Error?e.message:"Erreur inconnue";ne.error("Erreur lors de la récupération des produits",{err:e}),i.value=t||"Erreur lors de la récupération des produits"}finally{a.value=!1}},fetchProduct:async e=>{try{a.value=!0,i.value=null,ne.info(`Début de la récupération du produit ID: ${e}`);let s=t.value.find(t=>t.id===e);if(!s){const t=await _e.routes.admin.product.get(String(e));ne.info("Réponse API produit:",t),t.data&&(s=t.data,ne.info("Données brutes du produit reçues de l'API:",{id:s.id,hidden_raw:t.data.hidden,hidden_type:typeof t.data.hidden,featured_raw:t.data.featured,featured_type:typeof t.data.featured}))}return s||null}catch(s){const t=s instanceof Error?s.message:"Erreur inconnue";throw ne.error(`Erreur lors de la récupération du produit ID ${e}:`,{error:s}),i.value=t||"Erreur lors de la récupération du produit",s}finally{a.value=!1}},updateProduct:async(e,s)=>{try{a.value=!0,i.value=null,ne.info(`Mise à jour du produit ID: ${e}`,{data:s});const n=await _e.routes.admin.product.update(String(e),s),r=t.value.findIndex(t=>t.id===e);return-1!==r&&(t.value[r]=n.data),{success:!0,data:n.data}}catch(n){const t=n instanceof Error?n.message:"Erreur inconnue";return ne.error(`Erreur lors de la mise à jour du produit ID ${e}`,{err:n}),i.value=t||"Erreur lors de la mise à jour du produit",{success:!1,message:i.value}}finally{a.value=!1}},createProduct:async e=>{try{a.value=!0,i.value=null;const s=(await _e.routes.admin.product.create(e)).data;return t.value.push(s),{success:!0,data:s}}catch(s){const e=s instanceof Error?s.message:"Erreur inconnue";return ne.error("Erreur lors de la création du produit",{err:s}),i.value=e||"Erreur lors de la création du produit",{success:!1,message:i.value}}finally{a.value=!1}},deleteProduct:async e=>{try{return a.value=!0,i.value=null,await _e.routes.admin.product.delete(String(e)),t.value=t.value.filter(t=>t.id!==e),!0}catch(s){const e=s instanceof Error?s.message:"Erreur inconnue";throw ne.error("Erreur lors de la suppression du produit",{err:s}),i.value=e||"Erreur lors de la suppression du produit",s}finally{a.value=!1}},initRealtimeListeners:()=>{if(!o.value)try{return ne.info("[PRODUCTS STORE] Initialisation des écouteurs temps réel"),qe("product-update",e=>{ne.debug("[PRODUCTS STORE] Événement product-update reçu",{eventData:e}),p(e)}),o.value=!0,ne.info("[PRODUCTS STORE] Écouteurs temps réel initialisés avec succès"),!0}catch(e){return ne.error("[PRODUCTS STORE] Erreur lors de l'initialisation des écouteurs temps réel",{err:e}),!1}},handleRealtimeProductUpdate:p}}),fa=t("productGroups",()=>{const t=e([]),s=e(!1),a=e(null);return{productGroups:t,loading:s,error:a,fetchProductGroups:async()=>{var e,i;s.value=!0,a.value=null;try{const e=await _e.routes.admin.productGroup.list();t.value=e.data.productGroups||[]}catch(n){ne.error("Erreur lors de la récupération des groupes de produits",{error:n}),a.value=(null==(i=null==(e=n.response)?void 0:e.data)?void 0:i.message)||"Erreur lors de la récupération des groupes de produits"}finally{s.value=!1}},createProductGroup:async e=>{var i,n;s.value=!0,a.value=null;try{const s=await _e.routes.admin.productGroup.create(e);return t.value.push(s.data),s.data}catch(r){throw ne.error("Erreur lors de la création du groupe de produits",{error:r}),a.value=(null==(n=null==(i=r.response)?void 0:i.data)?void 0:n.message)||"Erreur lors de la création du groupe de produits",a.value}finally{s.value=!1}},updateProductGroup:async(e,i)=>{var n,r;s.value=!0,a.value=null;try{const s=await _e.routes.admin.productGroup.update(String(e),i),a=t.value.findIndex(t=>t.id===e);return-1!==a&&(t.value[a]=s.data),s.data}catch(o){throw ne.error("Erreur lors de la mise à jour du groupe de produits",{error:o}),a.value=(null==(r=null==(n=o.response)?void 0:n.data)?void 0:r.message)||"Erreur lors de la mise à jour du groupe de produits",a.value}finally{s.value=!1}},deleteProductGroup:async e=>{var i,n;s.value=!0,a.value=null;try{return await _e.routes.admin.productGroup.delete(String(e)),t.value=t.value.filter(t=>t.id!==e),!0}catch(r){throw ne.error("Erreur lors de la suppression du groupe de produits",{error:r}),a.value=(null==(n=null==(i=r.response)?void 0:i.data)?void 0:n.message)||"Erreur lors de la suppression du groupe de produits",a.value}finally{s.value=!1}},getGroupName:e=>{if(!e)return"";const s=t.value.find(t=>t.id===e);return s?s.name:""}}}),ga={key:0,class:"modal-overlay"},ya={class:"modal-container"},ba={class:"modal-header"},_a={class:"modal-body"},ka={class:"form-group"},wa={for:"name"},Sa=["placeholder"],Ea={key:0,class:"error-message"},Ca={class:"form-group"},Ta={for:"slug"},Aa=["placeholder"],Ia={key:0,class:"error-message"},Ra={class:"form-text text-muted"},xa={class:"form-group"},Oa={for:"description"},Pa=["placeholder"],Na={class:"form-actions"},Ma={type:"submit",class:"btn btn-primary"},Da=r({__name:"ProductGroupModal",props:{show:{type:Boolean},editMode:{type:Boolean},groupToEdit:{}},emits:["close","created","updated"],setup(t,{emit:i}){const{t:n}=b(),r=fa(),u=t,d=i,p=e(""),m=e(""),h=e(""),f=e({});a(p,e=>{var t;(!u.editMode||u.editMode&&!(null==(t=u.groupToEdit)?void 0:t.slug))&&(m.value=e.toLowerCase().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,""))}),a(()=>u.groupToEdit,e=>{e&&(p.value=e.name||"",m.value=e.slug||"",h.value=e.description||"")},{immediate:!0});const E=()=>{p.value="",m.value="",h.value="",f.value={}},C=async()=>{if(f.value={},p.value.trim()||(f.value.name=n("product_groups.errors.name_required")),m.value.trim()?/^[a-z0-9-]+$/.test(m.value)||(f.value.slug=n("product_groups.errors.slug_invalid")):f.value.slug=n("product_groups.errors.slug_required"),0===Object.keys(f.value).length)try{u.editMode&&u.groupToEdit?(await r.updateProductGroup(u.groupToEdit.id,{name:p.value,slug:m.value,description:h.value}),d("updated")):(await r.createProductGroup({name:p.value,slug:m.value,description:h.value}),d("created")),E(),d("close")}catch(e){ne.error("Erreur lors de la soumission du formulaire",{error:e})}},T=()=>{E(),d("close")},A=s(()=>u.editMode?n("product_groups.edit_title"):n("product_groups.add_title"));return(e,t)=>e.show?(g(),o("div",ga,[l("div",ya,[l("div",ba,[l("h3",null,c(A.value),1),l("button",{class:"close-button",onClick:T},t[3]||(t[3]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",_a,[l("form",{onSubmit:k(C,["prevent"])},[l("div",ka,[l("label",wa,c(_(n)("product_groups.fields.name"))+" *",1),w(l("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e),type:"text",class:y(["form-control",{"is-invalid":f.value.name}]),placeholder:_(n)("product_groups.placeholders.name")},null,10,Sa),[[S,p.value]]),f.value.name?(g(),o("div",Ea,c(f.value.name),1)):v("",!0)]),l("div",Ca,[l("label",Ta,c(_(n)("product_groups.fields.slug"))+" *",1),w(l("input",{id:"slug","onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e),type:"text",class:y(["form-control",{"is-invalid":f.value.slug}]),placeholder:_(n)("product_groups.placeholders.slug")},null,10,Aa),[[S,m.value]]),f.value.slug?(g(),o("div",Ia,c(f.value.slug),1)):v("",!0),l("small",Ra,c(_(n)("product_groups.slug_help")),1)]),l("div",xa,[l("label",Oa,c(_(n)("product_groups.fields.description")),1),w(l("textarea",{id:"description","onUpdate:modelValue":t[2]||(t[2]=e=>h.value=e),class:"form-control",placeholder:_(n)("product_groups.placeholders.description"),rows:"3"},null,8,Pa),[[S,h.value]])]),l("div",Na,[l("button",{type:"button",class:"btn btn-secondary",onClick:T},c(_(n)("common.cancel")),1),l("button",Ma,c(_(n)("common.save")),1)])],32)])])])):v("",!0)}}),La=Vt(Da,[["__scopeId","data-v-183c40bb"]]),Ua={class:"products-view view-container"},qa={class:"header-box"},Va={class:"header-content"},$a={class:"page-title"},ja={class:"page-description"},Fa={class:"header-actions"},Ga={class:"filter-box"},Ba={class:"filter-grid"},Ha={class:"filter-group"},Wa={class:"filter-label"},za={class:"filter-input-wrapper"},Ka=["placeholder"],Ja={class:"filter-group"},Ya={class:"filter-label"},Xa={class:"filter-input-wrapper"},Qa=["value"],Za={class:"filter-group"},ei={class:"filter-label"},ti={class:"filter-input-wrapper"},si={value:"all"},ai={value:"active"},ii={value:"inactive"},ni={value:"maintenance"},ri={class:"filter-group"},oi={class:"filter-label"},li={class:"filter-input-wrapper"},ci={value:"all"},ui={value:"none"},di=["value"],pi={class:"filter-group"},mi={class:"filter-label"},vi={class:"filter-input-wrapper"},hi={value:""},fi={value:"0-50"},gi={value:"50-200"},yi={value:"200-1000"},bi={key:0,class:"loading-state box"},_i={key:1,class:"empty-state box"},ki={key:2,class:"table-box"},wi={class:"data-table"},Si=["onClick"],Ei={class:"product-name"},Ci={class:"actions"},Ti={class:"actions-menu"},Ai=["title","onClick"],Ii=["title","onClick"],Ri=r({__name:"ProductsView",setup(t){const{t:n}=b(),r=T(),E=ha(),C=He(),I=fa(),R=e(!0),x=e(!1),O=e(void 0),P=e("all"),N=e("all"),M=e([{value:"all",label:n("products_services.filters.all_types")},{value:"reseller_hosting",label:n("products_services.types.reseller")},{value:"dedicated_server",label:n("products_services.types.dedicated")},{value:"vps",label:n("products_services.types.vps")},{value:"shared_hosting",label:n("products_services.types.shared")}]),D=e("all"),L=e(""),U=e(""),q=e("name"),V=e(!1),$=e("DESC"),j=e(!1),F=s(()=>{ne.debug("Calcul des produits filtrés",{allProducts:E.allProducts});let e=[...E.allProducts];if("all"!==N.value&&(ne.debug("Filtrage par type",{filter:N.value}),e=e.filter(e=>e.product_type===N.value)),"all"!==P.value&&(ne.debug("Filtrage par statut",{filter:P.value}),e=e.filter(e=>e.status===P.value)),"all"!==D.value&&(ne.debug("Filtrage par groupe",{filter:D.value}),e="none"===D.value?e.filter(e=>e&&!e.group_id):e.filter(e=>{var t;return e&&(null==(t=e.group_id)?void 0:t.toString())===D.value})),L.value){ne.debug("Filtrage par recherche",{query:L.value});const t=L.value.toLowerCase();e=e.filter(e=>{var s;return e.name.toLowerCase().includes(t)||((null==(s=e.description)?void 0:s.toLowerCase().includes(t))??!1)})}if(U.value){ne.debug("Filtrage par prix",{range:U.value});const[t,s]=U.value.split("-").map(Number);isNaN(t)||isNaN(s)||(e=e.filter(e=>"number"==typeof e.price&&e.price>=t&&e.price<=s))}return e}),G=async()=>{try{R.value=!0,await(async()=>{try{const e=(await _e.routes.admin.system.module.list("servers")).data;e.success&&e.data&&e.data.servers&&Object.entries(e.data.servers).forEach(([e,t])=>{const s=t;s.active&&M.value.push({value:`module_${e}`,label:s.name,isModuleType:!0})})}catch(e){ne.error("Erreur lors du chargement des modules",{error:e}),C.showNotification({title:n("common.error"),type:"error",message:n("products_services.errors.modules_load")})}})(),await E.fetchProducts(),await I.fetchProductGroups();const e=new URLSearchParams(window.location.search).get("moduleType");e&&(N.value=`module_${e}`)}catch(e){ne.error("Erreur lors de la récupération des données",{error:e}),C.showNotification({title:n("common.error"),type:"error",message:n("products_services.errors.fetch")})}finally{R.value=!1}},B=e=>{r.push(`/products/${e.id}`)},H=e=>{q.value===e?($.value="ASC"===$.value?"DESC":"ASC",V.value="DESC"===$.value):(q.value=e,$.value="DESC",V.value=!0)},W=()=>{O.value={name:"",slug:"",description:""},j.value=!1,x.value=!0};return a(()=>E.lastRealtimeEvent,e=>{var t,s,a,i;e&&(ne.info("[PRODUCTS VIEW] Événement temps réel détecté",{action:e.action,product_id:(null==(t=e.product)?void 0:t.id)||"non spécifié"}),"create"===e.action?C.showNotification({type:"success",title:n("products_services.realtime.new_title"),message:n("products_services.realtime.new_message",{name:(null==(s=e.product)?void 0:s.name)||"Nouveau produit"})}):"update"===e.action?C.showNotification({type:"info",title:n("products_services.realtime.updated_title"),message:n("products_services.realtime.updated_message",{name:(null==(a=e.product)?void 0:a.name)||"Produit"})}):"delete"===e.action&&C.showNotification({type:"warning",title:n("products_services.realtime.deleted_title"),message:n("products_services.realtime.deleted_message",{name:(null==(i=e.product)?void 0:i.name)||"Produit"})}))}),i(async()=>{R.value=!0;try{ne.debug("Début du chargement des produits dans ProductsView"),await E.fetchProducts(),ne.debug("Produits récupérés dans ProductsView",{products:E.allProducts}),await I.fetchProductGroups(),ne.debug("Groupes de produits récupérés",{groups:I.productGroups}),ne.debug("Produits filtrés initialement",{filtered:F.value}),E.initRealtimeListeners(),ne.info("[PRODUCTS VIEW] Écouteurs temps réel initialisés")}catch(e){ne.error("Erreur lors du chargement des produits",{error:e}),C.showError(n("products_services.errors.load_failed"))}finally{R.value=!1}}),(e,t)=>{const s=m("router-link");return g(),o("div",Ua,[l("div",qa,[l("div",Va,[l("h1",$a,c(_(n)("products_services.title")),1),l("span",ja,c(_(n)("products_services.description")),1)]),l("div",Fa,[l("button",{class:"btn btn-outline",onClick:W},[t[10]||(t[10]=l("i",{class:"fas fa-folder-plus"},null,-1)),d(" "+c(_(n)("product_groups.add")),1)]),u(s,{to:"/products/create",class:"btn btn-primary"},{default:p(()=>[t[11]||(t[11]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(_(n)("products_services.add")),1)]),_:1,__:[11]})])]),l("div",Ga,[l("div",Ba,[l("div",Ha,[l("label",Wa,c(_(n)("products_services.filters.search")),1),l("div",za,[t[12]||(t[12]=l("i",{class:"fas fa-search"},null,-1)),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>L.value=e),type:"text",class:"filter-input",placeholder:_(n)("products_services.search")},null,8,Ka),[[S,L.value]])])]),l("div",Ja,[l("label",Ya,c(_(n)("products_services.filters.type")),1),l("div",Xa,[t[13]||(t[13]=l("i",{class:"fas fa-tags"},null,-1)),w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>N.value=e),class:"filter-input"},[(g(!0),o(h,null,f(M.value,e=>(g(),o("option",{key:e.value,value:e.value},c(e.label),9,Qa))),128))],512),[[A,N.value]])])]),l("div",Za,[l("label",ei,c(_(n)("products_services.filters.status")),1),l("div",ti,[t[14]||(t[14]=l("i",{class:"fas fa-server"},null,-1)),w(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>P.value=e),class:"filter-input"},[l("option",si,c(_(n)("products_services.status.all")),1),l("option",ai,c(_(n)("products_services.status.active")),1),l("option",ii,c(_(n)("products_services.status.inactive")),1),l("option",ni,c(_(n)("products_services.status.maintenance")),1)],512),[[A,P.value]])])]),l("div",ri,[l("label",oi,c(_(n)("products_services.filters.group")),1),l("div",li,[t[15]||(t[15]=l("i",{class:"fas fa-users"},null,-1)),w(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>D.value=e),class:"filter-input"},[l("option",ci,c(_(n)("products_services.groups.all")),1),l("option",ui,c(_(n)("products_services.groups.none")),1),(g(!0),o(h,null,f(_(I).productGroups,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name),9,di))),128))],512),[[A,D.value]])])]),l("div",pi,[l("label",mi,c(_(n)("products_services.filters.price_range")),1),l("div",vi,[t[16]||(t[16]=l("i",{class:"fas fa-tag"},null,-1)),w(l("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>U.value=e),class:"filter-input"},[l("option",hi,c(_(n)("products_services.filters.all_prices")),1),l("option",fi,c(_(n)("products_services.filters.price_low")),1),l("option",gi,c(_(n)("products_services.filters.price_medium")),1),l("option",yi,c(_(n)("products_services.filters.price_high")),1)],512),[[A,U.value]])])])])]),R.value?(g(),o("div",bi,[t[17]||(t[17]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(n)("common.loading")),1)])):F.value&&0===F.value.length?(g(),o("div",_i,[t[18]||(t[18]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-box"})],-1)),l("h3",null,c(_(n)("products_services.empty.title")),1),l("p",null,c(_(n)("products_services.empty.description")),1)])):(g(),o("div",ki,[l("table",wi,[l("thead",null,[l("tr",null,[l("th",{class:y({active:"name"===q.value}),onClick:t[5]||(t[5]=e=>H("name"))},[d(c(_(n)("products_services.columns.name"))+" ",1),"name"===q.value?(g(),o("i",{key:0,class:y("ASC"===$.value?"fas fa-sort-up":"fas fa-sort-down")},null,2)):v("",!0)],2),l("th",null,c(_(n)("products_services.columns.description")),1),l("th",{class:y({active:"product_type"===q.value}),onClick:t[6]||(t[6]=e=>H("product_type"))},[d(c(_(n)("products_services.columns.type"))+" ",1),"product_type"===q.value?(g(),o("i",{key:0,class:y("ASC"===$.value?"fas fa-sort-up":"fas fa-sort-down")},null,2)):v("",!0)],2),l("th",{class:y({active:"price"===q.value}),onClick:t[7]||(t[7]=e=>H("price"))},[d(c(_(n)("products_services.columns.price"))+" ",1),"price"===q.value?(g(),o("i",{key:0,class:y("ASC"===$.value?"fas fa-sort-up":"fas fa-sort-down")},null,2)):v("",!0)],2),l("th",{class:y({active:"status"===q.value}),onClick:t[8]||(t[8]=e=>H("status"))},[d(c(_(n)("products_services.columns.status"))+" ",1),"status"===q.value?(g(),o("i",{key:0,class:y("ASC"===$.value?"fas fa-sort-up":"fas fa-sort-down")},null,2)):v("",!0)],2),l("th",null,c(_(n)("products_services.columns.group")),1),l("th",null,c(_(n)("products_services.columns.clients")),1),l("th",null,c(_(n)("common.actions")),1)])]),l("tbody",null,[(g(!0),o(h,null,f(F.value,e=>{var s;return g(),o("tr",{key:e.id,onClick:t=>B(e)},[l("td",null,[l("span",Ei,c(e.name),1)]),l("td",null,c(e.description&&e.description.length>50?e.description.substring(0,50)+"...":e.description||""),1),l("td",null,c((null==(s=M.value.find(t=>t.value===e.product_type))?void 0:s.label)||e.product_type),1),l("td",null,c(e.price)+" €",1),l("td",null,[l("span",{class:y("status-badge status-"+e.status)},c(_(n)(`products_services.status.${e.status}`)),3)]),l("td",null,c(e.group_id?_(I).getGroupName(e.group_id):_(n)("products_services.groups.none")),1),l("td",null,c(Array.isArray(e.clients)?e.clients.length:"0"),1),l("td",Ci,[l("div",Ti,[l("button",{class:"btn-icon",title:_(n)("products_services.actions.edit"),onClick:k(t=>B(e),["stop"])},t[19]||(t[19]=[l("i",{class:"fas fa-edit"},null,-1)]),8,Ai),l("button",{class:"btn-icon",title:_(n)("products_services.actions.delete"),onClick:k(t=>(async e=>{if(confirm(n("products_services.confirm_delete")))try{await E.deleteProduct(e.id)}catch(t){ne.error("Erreur lors de la suppression du produit",{error:t}),C.showNotification({title:n("common.error"),type:"error",message:n("products_services.errors.delete")})}})(e),["stop"])},t[20]||(t[20]=[l("i",{class:"fas fa-trash"},null,-1)]),8,Ii)])])],8,Si)}),128))])])])),u(La,{show:x.value,"edit-mode":j.value,"group-to-edit":O.value,onClose:t[9]||(t[9]=e=>x.value=!1),onCreated:G,onUpdated:G},null,8,["show","edit-mode","group-to-edit"])])}}}),xi=Vt(Ri,[["__scopeId","data-v-67fd4ea6"]]),Oi=()=>({getAllDrafts:async()=>{var e,t;try{return(await _e.routes.admin.productDraft.list()).data}catch(s){return ne.error("Erreur lors de la récupération des brouillons",{error:s}),{success:!1,error:(null==(t=null==(e=s.response)?void 0:e.data)?void 0:t.message)||s.message||"Une erreur est survenue"}}},getDraft:async e=>{var t,s;try{return(await _e.routes.admin.productDraft.get(e.toString())).data}catch(a){return ne.error(`Erreur lors de la récupération du brouillon #${e}`,{error:a,draftId:e}),{success:!1,error:(null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.message)||a.message||"Une erreur est survenue"}}},saveDraft:async(e,t,s)=>{var a,i;try{const a={data:e,current_step:t};return(s?await _e.routes.admin.productDraft.update(s.toString(),a):await _e.routes.admin.productDraft.create(a)).data}catch(n){return ne.error("Erreur lors de la sauvegarde du brouillon",{error:n,draftId:s}),{success:!1,error:(null==(i=null==(a=n.response)?void 0:a.data)?void 0:i.message)||n.message||"Une erreur est survenue"}}},deleteDraft:async e=>{var t,s;try{return(await _e.routes.admin.productDraft.delete(e.toString())).data}catch(a){return ne.error(`Erreur lors de la suppression du brouillon #${e}`,{error:a,draftId:e}),{success:!1,error:(null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.message)||a.message||"Une erreur est survenue"}}}}),Pi=t("productWizard",{state:()=>({draftId:null,productData:{name:"",slug:"",description:"",short_description:"",color:"#0066ff",group_id:null,product_type:"reseller_hosting",welcome_email:null,welcome_email_id:null,image_url:null,featured:!1,tag_line:"",order_link:"",price:0,setup_fee:0,recurring:!0,billing_cycle:"monthly",allow_quantity:!1,stock_control:!1,stock_quantity:0,price_monthly:0,price_quarterly:0,price_semiannually:0,price_annually:0,price_biennially:0,price_triennially:0,default_billing_cycle:"monthly",allow_cycle_change:!0,tax_included:!1,tax_exempt:!1,other:{requireDomain:!1,autoSetup:!0,stockControl:!1,stockQuantity:0,hidden:!1,featured:!1,welcomeEmail:0,notes:""},links:{direct_link:"",custom_url:"",directLinks:{cartLink:"",cartLinkWithTemplate:"",cartLinkWithDomain:"",groupLink:""},productLinks:[]},freedomain_settings:{enabled:!1,type:"free",discount_amount:10,payment_type:"once",available_cycles:[],available_tlds:[]},id:void 0,auto_provision:!1,module:null,server_group:null,server_id:null,package_name:null,provisioning_type:"manual",server_type:"",custom_fields:[],configurable_options:[],upgrades:[],upgrade_products:[],features:[],free_domain:!1,free_domain_tlds:[],free_domain_payment_type:"once",free_domain_payment_terms:[],cross_sells:[],affiliate_payment:!1,affiliate_amount:0,hidden:!1,downloads:[]},errors:{},editingProductId:null,currentStep:"details",isSubmitting:!1}),getters:{isValid:e=>0===Object.keys(e.errors).length,isCompleteForStep:e=>e=>!0,formattedProductData:e=>({name:e.productData.name,slug:e.productData.slug,description:e.productData.description,short_description:e.productData.short_description,image_url:e.productData.image_url,color:e.productData.color,group_id:e.productData.group_id,product_type:e.productData.product_type,welcome_email_id:e.productData.welcome_email_id,price:e.productData.price,setup_fee:e.productData.setup_fee,recurring:e.productData.recurring?1:0,billing_cycle:e.productData.billing_cycle,allow_quantity:e.productData.allow_quantity?1:0,stock_control:e.productData.stock_control?1:0,stock_quantity:e.productData.stock_quantity,auto_provision:e.productData.auto_provision?1:0,module:e.productData.module,provisioning_type:e.productData.provisioning_type||(e.productData.auto_provision?"auto_setup_on_order":"manual"),server_group:e.productData.server_group,server_id:e.productData.server_id,server_type:e.productData.server_type||e.productData.module||"",package_name:e.productData.package_name||"",custom_fields:e.productData.custom_fields,configurable_options:e.productData.configurable_options,upgrades:e.productData.upgrades,free_domain:e.productData.free_domain?1:0,free_domain_tlds:e.productData.free_domain_tlds,free_domain_payment_type:e.productData.free_domain_payment_type,free_domain_payment_terms:e.productData.free_domain_payment_terms,features:JSON.stringify(e.productData.features||[]),affiliate_payment:e.productData.affiliate_payment?1:0,affiliate_amount:e.productData.affiliate_amount,hidden:e.productData.hidden?1:0,featured:e.productData.featured?1:0,downloads:e.productData.downloads,options:JSON.stringify({links:e.productData.links,cross_sells:e.productData.cross_sells})})},actions:{resetProductData(){this.productData={name:"",slug:"",description:"",short_description:"",color:"#0066ff",group_id:null,product_type:"reseller_hosting",welcome_email:null,welcome_email_id:null,image_url:null,featured:!1,tag_line:"",order_link:"",price:0,setup_fee:0,recurring:!0,billing_cycle:"monthly",allow_quantity:!1,stock_control:!1,stock_quantity:0,price_monthly:0,price_quarterly:0,price_semiannually:0,price_annually:0,price_biennially:0,price_triennially:0,default_billing_cycle:"monthly",allow_cycle_change:!0,tax_included:!1,tax_exempt:!1,other:{requireDomain:!1,autoSetup:!0,stockControl:!1,stockQuantity:0,hidden:!1,featured:!1,welcomeEmail:0,notes:""},auto_provision:!1,module:null,server_group:null,server_id:null,package_name:null,provisioning_type:"manual",server_type:"",features:[],custom_fields:[],configurable_options:[],upgrades:[],upgrade_products:[],free_domain:!1,free_domain_tlds:[],free_domain_payment_type:"free",free_domain_payment_terms:[],cross_sells:[],affiliate_payment:!1,affiliate_amount:0,hidden:!1,downloads:[],links:{direct_link:"",custom_url:"",directLinks:{cartLink:"",cartLinkWithTemplate:"",cartLinkWithDomain:"",groupLink:""},productLinks:[]},freedomain_settings:{enabled:!1,type:"free",discount_amount:10,payment_type:"once",available_cycles:[],available_tlds:[]},id:void 0},this.editingProductId=null,this.errors={},this.currentStep="details"},async loadProduct(e){try{const t=ha(),s=await t.fetchProduct(e);return this.editingProductId=e,ne.info("Mode édition activé pour le produit ID:",{productId:this.editingProductId}),await this.initEditMode(s),s}catch(t){throw ne.error("Erreur lors du chargement du produit",{error:t}),this.resetProductData(),new Error("Produit non trouvé")}},initEditMode(e){var t,s;e&&(ne.info("Initialisation du mode édition pour le produit",{id:e.id,hidden_avant_conversion:e.hidden,hidden_type:typeof e.hidden,featured_avant_conversion:e.featured,featured_type:typeof e.featured}),this.editingProductId=e.id,this.productData.name=e.name||"",this.productData.slug=e.slug||"",this.productData.description=e.description||"",this.productData.color=e.color||"#0066ff",this.productData.group_id=e.group_id||null,this.productData.product_type=e.product_type||"reseller_hosting",this.productData.welcome_email=e.welcome_email||null,this.productData.price=e.price||0,this.productData.setup_fee=e.setup_fee||0,this.productData.recurring=e.recurring||!1,this.productData.billing_cycle=e.billing_cycle||"monthly",this.productData.allow_quantity=e.allow_quantity||!1,this.productData.stock_control=e.stock_control||!1,this.productData.stock_quantity=e.stock_quantity||0,this.productData.auto_provision=e.auto_provision||!1,this.productData.module=e.module||null,this.productData.server_group=e.server_group||null,this.productData.server_id=e.server_id||null,this.productData.package_name=e.package_name||null,this.productData.custom_fields=e.custom_fields||[],this.productData.configurable_options=e.configurable_options||[],this.productData.upgrades=e.upgrades||[],this.productData.free_domain=e.free_domain||!1,this.productData.free_domain_tlds=e.free_domain_tlds||[],this.productData.free_domain_payment_type=e.free_domain_payment_type||"free",this.productData.free_domain_payment_terms=e.free_domain_payment_terms||[],this.productData.cross_sells=e.cross_sells||[],this.productData.affiliate_payment=e.affiliate_payment||!1,this.productData.affiliate_amount=e.affiliate_amount||0,this.productData.hidden=1===e.hidden||"1"===e.hidden||!0===e.hidden,this.productData.featured=1===e.featured||"1"===e.featured||!0===e.featured,this.productData.downloads=e.downloads||[],this.productData.links={direct_link:(null==(t=e.links)?void 0:t.direct_link)||"",custom_url:(null==(s=e.links)?void 0:s.custom_url)||""},this.currentStep="details")},validateStep(e){switch(this.errors={},e){case"details":this.productData.name||(this.errors.name="Le nom du produit est obligatoire"),this.productData.group_id||(this.errors.group_id="Le groupe de produits est obligatoire");break;case"pricing":this.productData.price<0&&(this.errors.price="Le prix ne peut pas être négatif"),this.productData.setup_fee<0&&(this.errors.setup_fee="Les frais de configuration ne peuvent pas être négatifs");break;case"module":this.productData.auto_provision&&!this.productData.module&&(this.errors.module="Le module est requis pour le provisionnement automatique")}return 0===Object.keys(this.errors).length},goToNextStep(e,t){return!!this.validateStep(e)&&(this.currentStep=t,!0)},async saveProduct(){if(!this.validateForSave()){return{success:!1,message:Object.values(this.errors).join(", ")||"Veuillez corriger les erreurs dans le formulaire"}}this.isSubmitting=!0;try{const e=ha(),t=this.formattedProductData;let s;return ne.info("Mode de sauvegarde du produit:",{mode:this.editingProductId?"ÉDITION":"CRÉATION",productId:this.editingProductId,data:t}),this.editingProductId?(ne.info("Mise à jour du produit existant",{productId:this.editingProductId}),s=await e.updateProduct(this.editingProductId,t)):(ne.info("Création d'un nouveau produit"),s=await e.createProduct(t)),this.isSubmitting=!1,s.success&&(this.resetProductData(),this.deleteFromServer(),F0.push("/products")),s}catch(e){throw this.isSubmitting=!1,ne.error("Erreur lors de la sauvegarde",{error:e}),He().addNotification({title:"Erreur",message:"La sauvegarde du produit a échoué.",type:"error"}),e}},updateSlug(){this.productData.name&&(this.productData.slug=this.productData.name.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/[\s-]+/g,"-").trim())},validateForSave(){return this.errors={},this.productData.product_type||(this.errors.product_type="Le type de produit est obligatoire"),this.productData.name||(this.errors.name="Le nom du produit est obligatoire"),this.productData.slug||(this.errors.slug="Le slug du produit est obligatoire"),void 0!==this.productData.price&&this.productData.price<0&&(this.errors.price="Le prix ne peut pas être négatif"),void 0!==this.productData.setup_fee&&this.productData.setup_fee<0&&(this.errors.setup_fee="Les frais de configuration ne peuvent pas être négatifs"),this.productData.stock_control&&void 0!==this.productData.stock_quantity&&this.productData.stock_quantity<0&&(this.errors.stock_quantity="La quantité en stock ne peut pas être négative"),0===Object.keys(this.errors).length},validate(e=null){const t=e||this.currentStep;switch(this.errors={},t){case"type":this.productData.product_type||(this.errors.product_type="Le type de produit est obligatoire");break;case"details":this.productData.name||(this.errors.name="Le nom du produit est obligatoire"),this.productData.group_id||(this.errors.group_id="Le groupe de produits est obligatoire");break;case"pricing":this.productData.price<0&&(this.errors.price="Le prix ne peut pas être négatif"),this.productData.setup_fee<0&&(this.errors.setup_fee="Les frais de configuration ne peuvent pas être négatifs"),this.productData.stock_control&&this.productData.stock_quantity<0&&(this.errors.stock_quantity="La quantité en stock ne peut pas être négative");break;case"module":this.productData.auto_provision&&!this.productData.module&&(this.errors.module="Le module est obligatoire pour le provisionnement automatique"),this.productData.auto_provision&&this.productData.module&&!this.productData.server_id&&(this.errors.server_id="Le serveur est obligatoire pour le provisionnement automatique")}return 0===Object.keys(this.errors).length},nextStep(){if(!this.validate())return!1;const e=["details","pricing","module","customfields","configurableoptions","upgrades","freedomain","crosssells","other","links"],t=e.indexOf(this.currentStep);return t<e.length-1&&(this.currentStep=e[t+1],!0)},prevStep(){const e=["details","pricing","module","customfields","configurableoptions","upgrades","freedomain","crosssells","other","links"],t=e.indexOf(this.currentStep);return t>0&&(this.currentStep=e[t-1],!0)},generateSlug(){this.productData.name&&(this.productData.slug=this.productData.name.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/[\s-]+/g,"-").trim())},async syncWithServer(){const e=Oi(),t=He();try{const t={current_step:this.currentStep,...this.productData},s=null===this.draftId?void 0:this.draftId,a=await e.saveDraft(t,this.currentStep,s);return a&&a.success&&a.data&&a.data.id&&(this.draftId=a.data.id),!0}catch(s){return ne.error("Erreur lors de la synchronisation avec le serveur",{error:s}),t.addNotification({title:"Erreur de sauvegarde",message:"Impossible de sauvegarder le brouillon sur le serveur",type:"error"}),!1}},async loadFromServer(){const e=Oi();try{const t=await e.getAllDrafts();if(t&&t.success&&t.data&&t.data.length>0){const e=t.data[0];return this.draftId=void 0!==e.id?Number(e.id):null,e.data&&(Object.assign(this.productData,e.data),this.currentStep=e.current_step||"details"),!0}return!1}catch(t){const e=t;return e.response&&404===e.response.status||(ne.error("Erreur lors du chargement depuis le serveur",{error:t}),He().addNotification({title:"Erreur de chargement",message:"Impossible de charger le brouillon depuis le serveur",type:"error"})),!1}},async deleteFromServer(){if(!this.draftId)return!0;const e=Oi();try{return await e.deleteDraft(this.draftId),this.draftId=null,!0}catch(t){return ne.error("Erreur lors de la suppression du brouillon",{error:t}),!1}},async hasDraft(){try{return ne.warn("Vérification des brouillons désactivée pour le moment"),!1}catch(e){return ne.error("Erreur lors de la vérification des brouillons",{error:e}),!1}},setProductData(e){e&&(e.id&&(this.editingProductId=parseInt(e.id),ne.info("Mode édition activé via setProductData pour le produit ID:",{productId:this.editingProductId})),this.productData={...this.productData,...e},this.syncWithServer())},setWizardConfig(e){},updateProductData(e){return this.setProductData(e)}}}),Ni={class:"product-header"},Mi={class:"header-content"},Di={class:"page-title"},Li={class:"action-buttons"},Ui=["disabled"],qi=["disabled"],Vi={key:0,class:"spinner-loading"},$i={class:"tabs-navigation"},ji=r({__name:"ProductHeader",props:{title:{type:String,required:!0},isSubmitting:{type:Boolean,default:!1},productType:{type:String,default:"shared_hosting"},productId:{type:[Number,null],default:null}},emits:["save","cancel"],setup(e){const t=I(),a=e,i=s(()=>!!a.productId),{t:n}=b(),r=e=>{var t;return i.value?{name:e.route,params:{idOrAction:null==(t=a.productId)?void 0:t.toString()}}:"product-type"===e.route?{name:e.route,params:{type:a.productType}}:{name:e.route,params:{idOrAction:"create",type:a.productType}}},u=[{id:"type",label:n("products_services.tabs.type"),route:"product-type",icon:"fas fa-sitemap"},{id:"details",label:n("products_services.tabs.details"),route:"product-details",icon:"fas fa-info-circle"},{id:"pricing",label:n("products_services.tabs.pricing"),route:"product-pricing",icon:"fas fa-tag"},{id:"module",label:n("products_services.tabs.module"),route:"product-module",icon:"fas fa-cogs"},{id:"custom_fields",label:n("products_services.tabs.custom_fields"),route:"product-custom-fields",icon:"fas fa-list-alt"},{id:"configurable_options",label:n("products_services.tabs.configurable_options"),route:"product-configurable-options",icon:"fas fa-sliders-h"},{id:"upgrades",label:n("products_services.tabs.upgrades"),route:"product-upgrades",icon:"fas fa-level-up-alt"},{id:"free_domain",label:n("products_services.tabs.free_domain"),route:"product-free-domain",icon:"fas fa-globe"},{id:"cross_sells",label:n("products_services.tabs.cross_sells"),route:"product-cross-sells",icon:"fas fa-handshake"},{id:"other",label:n("products_services.tabs.other"),route:"product-other",icon:"fas fa-ellipsis-h"},{id:"links",label:n("products_services.tabs.links"),route:"product-links",icon:"fas fa-link"}],_=s(()=>{var e;const s=(null==(e=t.name)?void 0:e.toString())||"",a=u.find(e=>e.route===s);return a?a.id:"details"}),k=s(()=>u.filter(e=>("type"!==e.id||!i.value)&&("module"!==e.id||"domain"!==a.productType)));return(t,s)=>{const a=m("router-link");return g(),o("div",Ni,[l("div",Mi,[l("h1",Di,c(e.title),1),l("div",Li,[l("button",{class:"btn btn-outline-secondary",disabled:e.isSubmitting,onClick:s[0]||(s[0]=e=>t.$emit("cancel"))},[s[2]||(s[2]=l("i",{class:"fas fa-times"},null,-1)),d(" "+c(t.$t("common.cancel")),1)],8,Ui),l("button",{class:"btn btn-primary",disabled:e.isSubmitting,onClick:s[1]||(s[1]=e=>t.$emit("save"))},[s[3]||(s[3]=l("i",{class:"fas fa-save"},null,-1)),d(" "+c(t.$t("common.save"))+" ",1),e.isSubmitting?(g(),o("span",Vi)):v("",!0)],8,qi)])]),l("div",$i,[(g(!0),o(h,null,f(k.value,e=>(g(),R(a,{key:e.id,to:r(e),class:y(["tab-item",{active:_.value===e.id}])},{default:p(()=>[l("i",{class:y("fas fa-"+e.icon)},null,2),d(" "+c(e.label),1)]),_:2},1032,["to","class"]))),128))])])}}}),Fi=Vt(ji,[["__scopeId","data-v-367304dd"]]),Gi={key:0,class:"modal-overlay"},Bi={class:"modal-container"},Hi={class:"modal-content"},Wi={class:"modal-header"},zi={class:"modal-title"},Ki={class:"modal-body"},Ji={class:"modal-text"},Yi={key:0,class:"draft-diff"},Xi={class:"diff-title"},Qi={class:"diff-container"},Zi={class:"diff-label"},en={class:"diff-values"},tn={class:"diff-old"},sn={class:"diff-new"},an={key:1,class:"diff-empty"},nn={class:"modal-footer"},rn={key:0},on={key:1},ln={class:"modal-actions"},cn=r({__name:"DraftConfirmationModal",props:{draftData:{type:Object,required:!0},currentData:{type:Object,required:!0}},emits:["resume","discard"],setup(t,{expose:s,emit:a}){const n=t,r=a,u=e(!1),d=e(!1),p=e({});i(()=>{S()});const m=e=>{"Escape"===e.key&&u.value&&b()};i(()=>{document.addEventListener("keydown",m)}),x(()=>{document.removeEventListener("keydown",m)});const y=()=>{u.value=!1,document.body.style.overflow=""},b=()=>{y()},_=()=>{d.value=!d.value},k=()=>{y(),r("resume",n.draftData)},w=()=>{y(),r("discard")},S=()=>{const e={};for(const t in n.draftData)JSON.stringify(n.draftData[t])!==JSON.stringify(n.currentData[t])&&(e[t]={old:n.currentData[t],new:n.draftData[t]});p.value=e},E=e=>e.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^\w/,e=>e.toUpperCase()),C=e=>null==e?"-":"object"==typeof e?JSON.stringify(e).substring(0,30)+"...":"boolean"==typeof e?e?"Oui":"Non":e.toString();return s({open:()=>{u.value=!0,document.body.style.overflow="hidden"},close:y}),(e,t)=>u.value?(g(),o("div",Gi,[l("div",Bi,[l("div",Hi,[l("div",Wi,[l("h3",zi,c(e.$t("product_wizard.draft_modal.title")),1),l("button",{class:"modal-close",onClick:b},t[0]||(t[0]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",Ki,[l("p",Ji,c(e.$t("product_wizard.draft_modal.description")),1),d.value?(g(),o("div",Yi,[l("h4",Xi,c(e.$t("product_wizard.draft_modal.changes")),1),l("div",Qi,[Object.keys(p.value).length>0?(g(!0),o(h,{key:0},f(p.value,(e,s)=>(g(),o("div",{key:s,class:"diff-item"},[l("div",Zi,c(E(s)),1),l("div",en,[l("div",tn,c(C(e.old)),1),t[1]||(t[1]=l("div",{class:"diff-arrow"},[l("i",{class:"fas fa-arrow-right"})],-1)),l("div",sn,c(C(e.new)),1)])]))),128)):(g(),o("div",an,c(e.$t("product_wizard.draft_modal.no_changes")),1))])])):v("",!0)]),l("div",nn,[l("button",{type:"button",class:"btn-link",onClick:_},[d.value?(g(),o("span",rn,c(e.$t("product_wizard.draft_modal.hide_changes")),1)):(g(),o("span",on,c(e.$t("product_wizard.draft_modal.view_changes")),1))]),l("div",ln,[l("button",{type:"button",class:"btn btn-outline-secondary",onClick:w},c(e.$t("product_wizard.draft_modal.discard")),1),l("button",{type:"button",class:"btn btn-primary",onClick:k},c(e.$t("product_wizard.draft_modal.resume")),1)])])])])])):v("",!0)}}),un=Vt(cn,[["__scopeId","data-v-8d40bf3d"]]),dn={class:"create-product-page"},pn={class:"content-container"},mn={key:0,class:"text-center",style:{padding:"var(--spacing-xl)"}},vn=r({__name:"CreateProductView",setup(t){const{t:n}=b(),r=T(),c=I(),d=He(),p=ha(),h=Pi(),f=e(!1),y=e(!1),k=e("shared_hosting"),w=e(null),S=s(()=>{const e=c.params.idOrAction;return e&&"create"!==e?parseInt(e,10):null}),E=s(()=>!!S.value),C=[{value:"shared_hosting",label:n("products_services.types.shared_hosting"),icon:"server",description:n("products_services.types_descriptions.shared_hosting")},{value:"reseller_hosting",label:n("products_services.types.reseller_hosting"),icon:"users",description:n("products_services.types_descriptions.reseller_hosting")},{value:"server_vps",label:n("products_services.types.server_vps"),icon:"desktop",description:n("products_services.types_descriptions.server_vps")},{value:"domain",label:n("products_services.types.domain"),icon:"globe",description:n("products_services.types_descriptions.domain")},{value:"other",label:n("products_services.types.other"),icon:"box",description:n("products_services.types_descriptions.other")}],A=[{id:"type",label:n("products_services.tabs.type"),icon:"tag",route:"create-product"},{id:"details",label:n("products_services.tabs.details"),icon:"info-circle",route:"product-details"},{id:"pricing",label:n("products_services.tabs.pricing"),icon:"money-bill",route:"product-pricing"},{id:"module",label:n("products_services.tabs.module"),icon:"puzzle-piece",route:"product-module"},{id:"custom_fields",label:n("products_services.tabs.custom_fields"),icon:"list-alt",route:"product-custom-fields"},{id:"configurable_options",label:n("products_services.tabs.configurable_options"),icon:"cogs",route:"product-configurable-options"},{id:"upgrades",label:n("products_services.tabs.upgrades"),icon:"arrow-up",route:"product-upgrades"},{id:"freedomain",label:n("products_services.tabs.freedomain"),icon:"globe",route:"product-freedomain"},{id:"cross_sells",label:n("products_services.tabs.cross_sells"),icon:"shopping-cart",route:"product-cross-sells"},{id:"other",label:n("products_services.tabs.other"),icon:"ellipsis-h",route:"product-other"},{id:"links",label:n("products_services.tabs.links"),icon:"link",route:"product-links"}];i(async()=>{var e;f.value=!0;try{await h.hasDraft()&&!E.value?null==(e=w.value)||e.open():E.value?await x():(h.resetProductData(),h.productData.product_type=k.value)}catch(t){ne.error("Erreur lors du chargement initial de la vue de création de produit",{error:t}),d.addNotification({title:n("common.error"),message:n("products_services.errors.load_failed"),type:"error"})}finally{f.value=!1}}),a(k,e=>{h.productData.product_type=e});const R=e=>{k.value=e},x=async()=>{if(S.value)try{const e=await p.fetchProduct(S.value);h.setProductData(e),k.value=(null==e?void 0:e.product_type)||"shared_hosting"}catch(e){ne.error("Erreur lors du chargement du produit pour édition",{productId:S.value,error:e}),d.addNotification({title:n("common.error"),message:n("products_services.errors.load_failed"),type:"error"})}},O=async()=>{var e;y.value=!0;try{if(!k.value)return void d.addNotification({title:n("common.error"),type:"error",message:n("products_services.errors.type_required")});if(h.productData.product_type=k.value,!h.productData.name){const t=(null==(e=C.find(e=>e.value===k.value))?void 0:e.label)||k.value;h.productData.name=`Nouveau ${t}`,h.productData.slug=k.value.replace(/_/g,"-")}const t=await h.saveProduct();t.success?r.push({name:"products"}):h.errors&&Object.keys(h.errors).length>0?Object.entries(h.errors).forEach(([e,t])=>{d.addNotification({title:n("common.error"),type:"error",message:`${e}: ${t}`})}):d.addNotification({title:n("common.error"),type:"error",message:t.message||n("products_services.errors.save_failed")})}catch(t){ne.error("Erreur lors de la sauvegarde du produit",{productData:h.productData,error:t}),d.addNotification({title:n("common.error"),type:"error",message:n("products_services.errors.save_failed")})}finally{y.value=!1}},P=()=>{r.push({name:"products"})},N=e=>{"function"==typeof h.setProductData?h.setProductData(e):h.productData={...e},k.value=e.product_type||"shared_hosting";try{d.addNotification({title:n("common.success"),type:"success",message:n("products_services.draft_resumed")})}catch(t){ne.error("Erreur lors de laffichage de la notification de reprise de brouillon",{error:t}),"function"==typeof d.addNotification&&d.addNotification({title:n("common.success"),message:n("products_services.draft_resumed"),type:"success"})}},M=async()=>{try{h.resetProductData(),h.productData&&(h.productData.product_type=k.value)}catch(e){ne.error("Erreur lors de la suppression du brouillon",{error:e}),h.resetProductData(),h.productData&&(h.productData.product_type=k.value)}try{d.addNotification({title:n("common.success"),type:"success",message:n("products_services.draft_discarded")})}catch(e){ne.error("Erreur notification",{error:e}),"function"==typeof d.addNotification&&d.addNotification({title:n("common.success"),message:n("products_services.draft_discarded"),type:"success"})}};return(e,t)=>{const s=m("router-view");return g(),o("div",dn,[u(Fi,{title:_(n)("products_services.create_title"),tabs:A,"active-tab":"type","is-submitting":y.value,"product-type":k.value,"product-id":S.value,onSave:O,onCancel:P},null,8,["title","is-submitting","product-type","product-id"]),l("div",pn,[f.value?(g(),o("div",mn,t[0]||(t[0]=[l("div",{class:"spinner-loading",style:{margin:"0 auto"}},null,-1)]))):v("",!0),u(s,{onUpdateProductType:R})]),u(un,{ref_key:"draftConfirmationRef",ref:w,"draft-data":_(h).productData,"current-data":{},onResume:N,onDiscard:M},null,8,["draft-data"])])}}}),hn={class:"section-description"},fn={class:"product-type-grid"},gn=["onClick"],yn={class:"product-type-icon"},bn={class:"product-type-title"},_n={class:"product-type-description"},kn=r({__name:"ProductTypeView",emits:["update-product-type"],setup(t,{emit:s}){const{t:n}=b(),r=Pi(),u=s,d=e("shared_hosting"),p=[{value:"shared_hosting",label:n("products_services.types.shared_hosting"),icon:"server",description:n("products_services.types_descriptions.shared_hosting")},{value:"reseller_hosting",label:n("products_services.types.reseller_hosting"),icon:"users",description:n("products_services.types_descriptions.reseller_hosting")},{value:"server_vps",label:n("products_services.types.server_vps"),icon:"desktop",description:n("products_services.types_descriptions.server_vps")},{value:"domain",label:n("products_services.types.domain"),icon:"globe",description:n("products_services.types_descriptions.domain")},{value:"other",label:n("products_services.types.other"),icon:"box",description:n("products_services.types_descriptions.other")}];return i(()=>{var e;(null==(e=r.productData)?void 0:e.product_type)&&(d.value=r.productData.product_type)}),a(d,e=>{r.productData&&(r.productData.product_type=e),u("update-product-type",e)}),(e,t)=>(g(),o("div",null,[l("p",hn,c(_(n)("products_services.type_selection_help")),1),l("div",fn,[(g(),o(h,null,f(p,e=>l("div",{key:e.value,class:y(["product-type-card",{selected:d.value===e.value}]),onClick:t=>d.value=e.value},[l("div",yn,[l("i",{class:y(`fas fa-${e.icon}`)},null,2)]),l("h3",bn,c(e.label),1),l("p",_n,c(e.description),1)],10,gn)),64))])]))}}),wn=Vt(kn,[["__scopeId","data-v-760f6251"]]),Sn={class:"section-description"},En={key:0,class:"text-center",style:{padding:"var(--spacing-xl)"}},Cn={class:"form-section"},Tn={class:"form-section-title"},An={class:"form-row"},In={class:"form-col"},Rn={class:"form-group"},xn={class:"form-label"},On=["placeholder"],Pn={class:"form-col"},Nn={class:"form-group"},Mn={class:"form-label"},Dn=["placeholder"],Ln={class:"form-hint"},Un={class:"form-group"},qn={class:"form-label"},Vn={value:null},$n=["value"],jn={class:"form-group"},Fn={class:"form-label"},Gn=["placeholder"],Bn={class:"form-group"},Hn={class:"form-label"},Wn=["placeholder"],zn={class:"form-section"},Kn={class:"form-section-title"},Jn={class:"form-row"},Yn={class:"form-col"},Xn={class:"form-group"},Qn={class:"form-label"},Zn={value:""},er=["value"],tr={class:"form-col"},sr={class:"form-group"},ar={class:"form-label"},ir={class:"form-group"},nr={class:"form-label"},rr={key:0,class:"product-image-preview"},or=["src"],lr={class:"form-group form-checkbox"},cr={for:"hidden",class:"form-checkbox-label"},ur={class:"form-hint"},dr={class:"form-group form-checkbox"},pr={for:"featured",class:"form-checkbox-label"},mr={class:"form-hint"},vr={class:"form-section"},hr={class:"form-section-title"},fr={class:"form-group"},gr={class:"form-label"},yr=["placeholder"],br={class:"form-group"},_r={class:"form-label"},kr=["placeholder"],wr={class:"form-hint"},Sr=r({__name:"ProductDetailsView",setup(t){const{t:a}=b(),n=T(),r=I(),u=He(),d=Pi(),p=fa(),m=e(!1),y=e(!1),E=e([]),R=e([]),x=s(()=>d.productData||{name:"",slug:"",description:"",short_description:"",group_id:null,welcome_email_id:"",color:"#0066ff",image_url:null,hidden:!1,featured:!1,tag_line:"",order_link:""}),P=s(()=>r.params.type),N=s(()=>r.params.idOrAction),M=s(()=>!isNaN(parseInt(N.value))),D=e({hidden:!1,featured:!1});O(()=>{const e=!0===x.value.hidden||"1"===String(x.value.hidden)||1===Number(x.value.hidden),t=!0===x.value.featured||"1"===String(x.value.featured)||1===Number(x.value.featured);D.value.hidden!==e&&(D.value.hidden=e),D.value.featured!==t&&(D.value.featured=t)});const L=(e,t)=>{D.value[e]=t;const s={hidden:D.value.hidden,featured:D.value.featured};d.updateProductData(s)},U=s({get:()=>D.value.hidden,set:e=>L("hidden",e)}),q=s({get:()=>D.value.featured,set:e=>L("featured",e)}),V=e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;const a=new FileReader;a.onload=e=>{e.target&&e.target.result&&d.updateProductData({image_url:e.target.result,image_file:s})},a.readAsDataURL(s)},$=()=>{d.updateProductData({image_url:null})},j=async()=>{if(x.value.name?x.value.group_id||(u.showNotification({type:"error",title:a("common.error"),message:a("products_services.details.category_required")}),0):(u.showNotification({type:"error",title:a("common.error"),message:a("products_services.details.name_required")}),0)){y.value=!0;try{x.value.slug||d.updateProductData({slug:x.value.name.toLowerCase().replace(/[^a-z0-9]+/g,"-")}),M.value&&await d.saveProduct();const e=M.value?{name:"product-pricing",params:{idOrAction:N.value}}:{name:"product-pricing",params:{type:P.value}};n.push(e),u.showNotification({type:"success",title:a("common.success"),message:a("products_services.details.saved_successfully")})}catch(e){ne.error("Erreur lors de la sauvegarde des détails du produit",{error:e}),u.showNotification({type:"error",title:a("common.error"),message:a("products_services.error_saving_data")})}finally{y.value=!1}}};return i(()=>{(async()=>{m.value=!0;try{if(await p.fetchProductGroups(),E.value=p.productGroups,R.value=[{id:1,name:"Email de bienvenue par défaut"},{id:2,name:"Email de bienvenue produits hosting"},{id:3,name:"Email de bienvenue services"}],M.value){const e=ha(),t=await e.fetchProduct(N.value);d.setProductData(t)}}catch(e){ne.error("Erreur lors du chargement des données des détails du produit",{error:e}),u.showNotification({type:"error",title:a("common.error"),message:a("products_services.error_loading_data")})}finally{m.value=!1}})()}),(e,t)=>(g(),o("div",null,[l("p",Sn,c(_(a)("products_services.details.description")),1),m.value?(g(),o("div",En,t[11]||(t[11]=[l("div",{class:"spinner-loading",style:{margin:"0 auto"}},null,-1)]))):(g(),o("form",{key:1,onSubmit:k(j,["prevent"])},[l("div",Cn,[l("h3",Tn,c(_(a)("products_services.details.basic_info")),1),l("div",An,[l("div",In,[l("div",Rn,[l("label",xn,c(_(a)("products_services.details.name"))+" *",1),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>x.value.name=e),type:"text",class:"form-control",placeholder:_(a)("products_services.details.name_placeholder"),required:""},null,8,On),[[S,x.value.name]])])]),l("div",Pn,[l("div",Nn,[l("label",Mn,c(_(a)("products_services.details.slug")),1),w(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>x.value.slug=e),type:"text",class:"form-control",placeholder:_(a)("products_services.details.slug_placeholder")},null,8,Dn),[[S,x.value.slug]]),l("p",Ln,c(_(a)("products_services.details.slug_hint")),1)])])]),l("div",Un,[l("label",qn,c(_(a)("products_services.details.category"))+" *",1),w(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>x.value.group_id=e),class:"form-control",required:""},[l("option",Vn,c(_(a)("products_services.details.select_category")),1),(g(!0),o(h,null,f(E.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name),9,$n))),128))],512),[[A,x.value.group_id]])]),l("div",jn,[l("label",Fn,c(_(a)("products_services.details.description")),1),w(l("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>x.value.description=e),class:"form-control",placeholder:_(a)("products_services.details.description_placeholder"),rows:"4"},null,8,Gn),[[S,x.value.description]])]),l("div",Bn,[l("label",Hn,c(_(a)("products_services.details.short_description")),1),w(l("textarea",{"onUpdate:modelValue":t[4]||(t[4]=e=>x.value.short_description=e),class:"form-control",placeholder:_(a)("products_services.details.short_description_placeholder"),rows:"2"},null,8,Wn),[[S,x.value.short_description]])])]),l("div",zn,[l("h3",Kn,c(_(a)("products_services.details.display_options")),1),l("div",Jn,[l("div",Yn,[l("div",Xn,[l("label",Qn,c(_(a)("products_services.details.welcome_email")),1),w(l("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>x.value.welcome_email_id=e),class:"form-control"},[l("option",Zn,c(_(a)("products_services.details.select_welcome_email")),1),(g(!0),o(h,null,f(R.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name),9,er))),128))],512),[[A,x.value.welcome_email_id]])])]),l("div",tr,[l("div",sr,[l("label",ar,c(_(a)("products_services.details.color")),1),w(l("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>x.value.color=e),type:"color",class:"form-control color-picker"},null,512),[[S,x.value.color]])])])]),l("div",ir,[l("label",nr,c(_(a)("products_services.details.image")),1),l("input",{type:"file",class:"form-control",accept:"image/*",onChange:V},null,32),x.value.image_url?(g(),o("div",rr,[l("img",{src:x.value.image_url,alt:"Product Image"},null,8,or),l("button",{type:"button",class:"btn btn-danger btn-sm",onClick:$},c(_(a)("products_services.details.remove_image")),1)])):v("",!0)]),l("div",lr,[w(l("input",{id:"hidden","onUpdate:modelValue":t[7]||(t[7]=e=>U.value=e),type:"checkbox",class:"form-checkbox-input"},null,512),[[C,U.value]]),l("label",cr,c(_(a)("products_services.details.hidden")),1),l("p",ur,c(_(a)("products_services.details.hidden_hint")),1)]),l("div",dr,[w(l("input",{id:"featured","onUpdate:modelValue":t[8]||(t[8]=e=>q.value=e),type:"checkbox",class:"form-checkbox-input"},null,512),[[C,q.value]]),l("label",pr,c(_(a)("products_services.details.featured")),1),l("p",mr,c(_(a)("products_services.details.featured_hint")),1)])]),l("div",vr,[l("h3",hr,c(_(a)("products_services.details.additional_info")),1),l("div",fr,[l("label",gr,c(_(a)("products_services.details.tag_line")),1),w(l("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>x.value.tag_line=e),type:"text",class:"form-control",placeholder:_(a)("products_services.details.tag_line_placeholder")},null,8,yr),[[S,x.value.tag_line]])]),l("div",br,[l("label",_r,c(_(a)("products_services.details.order_link")),1),w(l("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>x.value.order_link=e),type:"text",class:"form-control",placeholder:_(a)("products_services.details.order_link_placeholder")},null,8,kr),[[S,x.value.order_link]]),l("p",wr,c(_(a)("products_services.details.order_link_hint")),1)])])],32))]))}}),Er=Vt(Sr,[["__scopeId","data-v-6c1e669b"]]),Cr={class:"section-description"},Tr={key:0,class:"text-center",style:{padding:"var(--spacing-xl)"}},Ar={class:"pricing-grid"},Ir={class:"form-group"},Rr={class:"form-label"},xr={class:"price-field"},Or={class:"form-hint"},Pr={class:"form-group"},Nr={class:"form-label"},Mr={class:"price-field"},Dr={class:"form-hint"},Lr={class:"recurring-options"},Ur={class:"pricing-section-title"},qr={class:"custom-switch"},Vr={class:"toggle-switch"},$r={key:0,class:"billing-cycles"},jr={class:"form-label"},Fr={class:"price-field"},Gr=["onUpdate:modelValue"],Br={class:"form-group"},Hr={class:"form-label"},Wr=["value"],zr={class:"form-group form-checkbox"},Kr={for:"allow_cycle_change",class:"form-checkbox-label"},Jr={class:"form-hint"},Yr={class:"tax-options"},Xr={class:"pricing-section-title"},Qr={class:"form-group form-checkbox"},Zr={for:"tax_included",class:"form-checkbox-label"},eo={class:"form-hint"},to={class:"form-group form-checkbox"},so={for:"tax_exempt",class:"form-checkbox-label"},ao={class:"form-hint"},io=r({__name:"ProductPricingView",setup(t){const{t:a}=b(),n=T(),r=I(),u=He(),d=Pi(),p=e(!1),m=e(!1),y=e({setup_fee:0,price:0,recurring:!1,price_monthly:0,price_quarterly:0,price_semiannually:0,price_annually:0,price_biennially:0,price_triennially:0,default_billing_cycle:"monthly",allow_cycle_change:!0,tax_included:!1,tax_exempt:!1}),E=s(()=>r.params.type),R=s(()=>r.params.idOrAction),x=s(()=>!isNaN(parseInt(R.value))),O=[{name:a("products_services.pricing.monthly"),value:"monthly",field:"price_monthly"},{name:a("products_services.pricing.quarterly"),value:"quarterly",field:"price_quarterly"},{name:a("products_services.pricing.semiannually"),value:"semiannually",field:"price_semiannually"},{name:a("products_services.pricing.annually"),value:"annually",field:"price_annually"},{name:a("products_services.pricing.biennially"),value:"biennially",field:"price_biennially"},{name:a("products_services.pricing.triennially"),value:"triennially",field:"price_triennially"}],P=s(()=>O.filter(e=>{const t=y.value[e.field];return null!=t&&"number"==typeof t&&t>0})),N=async()=>{if(!(y.value.price<0||y.value.setup_fee<0)||(u.showNotification({type:"error",title:a("common.error"),message:a("products_services.pricing.price_not_negative")}),0)){m.value=!0;try{d.updateProductData({setup_fee:y.value.setup_fee,price:y.value.price,recurring:y.value.recurring,price_monthly:y.value.price_monthly,price_quarterly:y.value.price_quarterly,price_semiannually:y.value.price_semiannually,price_annually:y.value.price_annually,price_biennially:y.value.price_biennially,price_triennially:y.value.price_triennially,default_billing_cycle:y.value.default_billing_cycle,allow_cycle_change:y.value.allow_cycle_change,tax_included:y.value.tax_included,tax_exempt:y.value.tax_exempt}),x.value&&await d.saveProduct();const e=x.value?{name:"product-module",params:{idOrAction:R.value}}:{name:"product-module",params:{type:E.value}};n.push(e),u.showNotification({type:"success",title:a("common.success"),message:a("products_services.pricing.saved_successfully")})}catch(e){ne.error("Erreur lors de la sauvegarde",{error:e}),u.showNotification({type:"error",title:a("common.error"),message:a("products_services.error_saving_data")})}finally{m.value=!1}}};return i(()=>{(async()=>{p.value=!0;try{if(x.value){const e=d.productData;y.value={setup_fee:e.setup_fee||0,price:e.price||0,recurring:e.recurring||!1,price_monthly:e.price_monthly||0,price_quarterly:e.price_quarterly||0,price_semiannually:e.price_semiannually||0,price_annually:e.price_annually||0,price_biennially:e.price_biennially||0,price_triennially:e.price_triennially||0,default_billing_cycle:e.default_billing_cycle||"monthly",allow_cycle_change:!1!==e.allow_cycle_change,tax_included:e.tax_included||!1,tax_exempt:e.tax_exempt||!1}}}catch(e){ne.error("Erreur lors du chargement des données",{error:e}),u.showNotification({type:"error",title:a("common.error"),message:a("products_services.error_loading_data")})}finally{p.value=!1}})()}),(e,t)=>(g(),o("div",null,[l("p",Cr,c(_(a)("products_services.pricing.description")),1),p.value?(g(),o("div",Tr,t[7]||(t[7]=[l("div",{class:"spinner-loading",style:{margin:"0 auto"}},null,-1)]))):(g(),o("form",{key:1,onSubmit:k(N,["prevent"])},[l("div",Ar,[l("div",Ir,[l("label",Rr,c(_(a)("products_services.pricing.setup_fee")),1),l("div",xr,[t[8]||(t[8]=l("span",{class:"currency-symbol"},"€",-1)),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>y.value.setup_fee=e),type:"number",class:"form-control",min:"0",step:"0.01"},null,512),[[S,y.value.setup_fee]])]),l("p",Or,c(_(a)("products_services.pricing.setup_fee_hint")),1)]),l("div",Pr,[l("label",Nr,c(_(a)("products_services.pricing.base_price"))+" *",1),l("div",Mr,[t[9]||(t[9]=l("span",{class:"currency-symbol"},"€",-1)),w(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>y.value.price=e),type:"number",class:"form-control",min:"0",step:"0.01",required:""},null,512),[[S,y.value.price]])]),l("p",Dr,c(_(a)("products_services.pricing.base_price_hint")),1)])]),l("div",Lr,[l("h3",Ur,c(_(a)("products_services.pricing.recurring_options")),1),l("div",qr,[l("label",Vr,[w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>y.value.recurring=e),type:"checkbox"},null,512),[[C,y.value.recurring]]),t[10]||(t[10]=l("span",{class:"toggle-slider"},null,-1))]),l("span",null,c(_(a)("products_services.pricing.recurring_pricing")),1)]),y.value.recurring?(g(),o("div",$r,[(g(),o(h,null,f(O,e=>l("div",{key:e.value,class:"form-group"},[l("label",jr,c(e.name),1),l("div",Fr,[t[11]||(t[11]=l("span",{class:"currency-symbol"},"€",-1)),w(l("input",{"onUpdate:modelValue":t=>y.value[e.field]=t,type:"number",class:"form-control",min:"0",step:"0.01"},null,8,Gr),[[S,y.value[e.field]]])])])),64)),l("div",Br,[l("label",Hr,c(_(a)("products_services.pricing.default_cycle")),1),w(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>y.value.default_billing_cycle=e),class:"form-control"},[(g(!0),o(h,null,f(P.value,e=>(g(),o("option",{key:e.value,value:e.value},c(e.name),9,Wr))),128))],512),[[A,y.value.default_billing_cycle]])]),l("div",zr,[w(l("input",{id:"allow_cycle_change","onUpdate:modelValue":t[4]||(t[4]=e=>y.value.allow_cycle_change=e),type:"checkbox",class:"form-checkbox-input"},null,512),[[C,y.value.allow_cycle_change]]),l("label",Kr,c(_(a)("products_services.pricing.allow_cycle_change")),1),l("p",Jr,c(_(a)("products_services.pricing.allow_cycle_change_hint")),1)])])):v("",!0)]),l("div",Yr,[l("h3",Xr,c(_(a)("products_services.pricing.tax_options")),1),l("div",Qr,[w(l("input",{id:"tax_included","onUpdate:modelValue":t[5]||(t[5]=e=>y.value.tax_included=e),type:"checkbox",class:"form-checkbox-input"},null,512),[[C,y.value.tax_included]]),l("label",Zr,c(_(a)("products_services.pricing.tax_included")),1),l("p",eo,c(_(a)("products_services.pricing.tax_included_hint")),1)]),l("div",to,[w(l("input",{id:"tax_exempt","onUpdate:modelValue":t[6]||(t[6]=e=>y.value.tax_exempt=e),type:"checkbox",class:"form-checkbox-input"},null,512),[[C,y.value.tax_exempt]]),l("label",so,c(_(a)("products_services.pricing.tax_exempt")),1),l("p",ao,c(_(a)("products_services.pricing.tax_exempt_hint")),1)])])],32))]))}}),no=Vt(io,[["__scopeId","data-v-699d9842"]]),ro={class:"product-module-page"},oo={class:"module-section"},lo={class:"section-description"},co={key:0,class:"text-center",style:{padding:"var(--spacing-xl)"}},uo={class:"module-section-title"},po={class:"module-options"},mo=["onClick"],vo={class:"module-icon"},ho=["src","alt"],fo={key:1,class:"fas fa-server"},go={class:"module-name"},yo={class:"module-description"},bo={key:0,class:"provision-options mt-l"},_o={class:"d-flex justify-content-between align-items-center mb-3"},ko={class:"module-section-title mb-0"},wo={class:"btn-group"},So={key:0,class:"text-center py-l"},Eo={key:0,class:"form-group mb-3"},Co={class:"form-label"},To={value:"",selected:""},Ao=["value"],Io={key:1,class:"text-center"},Ro={key:2,class:"text-center py-l"},xo={key:3,class:"server-config-options mt-l"},Oo={key:0,class:"form-group mb-3"},Po={for:"package_name",class:"form-label"},No={value:null},Mo=["value"],Do={class:"text-muted d-block mt-1"},Lo={class:"config-grid"},Uo={class:"form-label"},qo=["onUpdate:modelValue","required"],Vo={key:0,value:""},$o=["value"],jo=["onUpdate:modelValue","placeholder","required"],Fo=["onUpdate:modelValue","placeholder","required"],Go=["onUpdate:modelValue","placeholder","required"],Bo={key:4,class:"form-check"},Ho=["id","onUpdate:modelValue"],Wo=["for"],zo=["onUpdate:modelValue","placeholder"],Ko={key:6,class:"form-text text-muted"},Jo={key:2,class:"card my-3"},Yo={class:"card-header bg-primary-subtle"},Xo={class:"mb-0"},Qo={class:"card-body"},Zo={class:"text-muted mb-3"},el={class:"provisioning-options"},tl={class:"form-check mb-2"},sl={for:"provisioning_immediate",class:"form-check-label"},al={class:"form-check mb-2"},il={for:"provisioning_payment",class:"form-check-label"},nl={class:"form-check mb-2"},rl={for:"provisioning_manual_accept",class:"form-check-label"},ol={class:"form-check mb-2"},ll={for:"provisioning_manual",class:"form-check-label"},cl={__name:"ProductModuleView",setup(t){const{t:n}=b(),r=Pi();He();const u=e({servers:{}}),d=e(!0),p=e(r.productData.module||null),m=e([]),k=e({module_name:r.productData.module||null,server_id:r.productData.server_id||null,server_group:r.productData.server_group||null,package_name:r.productData.package_name||null,provisioning_type:r.productData.provisioning_type||"manual",group_id:r.productData.group_id||null}),E=e([]),T=e(!1),I=e(null),R=e(!1),x=e("simple"),O=s(()=>{if(!I.value||!I.value.form)return[];const e=I.value.form.find(e=>"package_name"===e.name);return e&&e.options?e.options.map(e=>({value:e.value,text:e.label||e.value})):[]}),N=s(()=>{if(!I.value||!I.value.form)return[];return I.value.form.filter(e=>"package_name"!==e.name&&("simple"!==x.value||("simple"===e.displayMode||!e.displayMode))).map(e=>["select","text","number","password"].includes(e.type)?{...e,inputClass:"form-control"}:e)});function M(){ne.debug("[ProductModule] Package sélectionné",{package_name:k.value.package_name})}function D(){E.value=[],I.value=null,k.value.server_id=null,k.value.package_name=null,k.value.server_group=null,k.value.provisioning_type="manual"}async function L(e){D(),T.value=!0;try{const t=(await _e.routes.admin.server.list({module:e})).data;t.servers?E.value=t.servers.map(e=>({label:`${e.name} (${e.hostname})`,value:e.id})):(ne.error("Failed to fetch compatible servers: response did not contain a `servers` key."),E.value=[])}catch(t){ne.error("Error fetching compatible servers",{error:t}),E.value=[]}finally{T.value=!1}}function U(e){p.value===e?(p.value=null,k.value.module_name=null,D()):(p.value=e,k.value.module_name=e,L(e))}return a(()=>k.value.server_id,e=>{!async function(e){if(e){R.value=!0;try{const t=(await _e.routes.admin.server.getConfigOptions(e)).data;t.success?(I.value=t.data,ne.debug("[ProductModule] Structure des options de serveur récupérée",{server_id:e,options_count:t.data?Object.keys(t.data).length:0})):(ne.error("Failed to fetch config options",{message:t.message}),I.value=null)}catch(t){ne.error("Error fetching config options",{error:t}),I.value=null}finally{R.value=!1}}else I.value=null}(e)}),a(k,e=>{ne.debug("[ProductModule] Mise à jour des paramètres du module",{package_name:e.package_name,config_mode:x.value,module_name:e.module_name});const t={module:e.module_name,server_id:e.server_id,server_group:e.server_group,package_name:e.package_name,provisioning_type:e.provisioning_type,auto_provision:"manual"!==e.provisioning_type,group_id:e.group_id};if(I.value&&I.value.form)for(const s of I.value.form)e.hasOwnProperty(s.name)&&(t[s.name]=e[s.name]);r.setProductData(t)},{deep:!0}),a(()=>r.productData.module,e=>{e&&e!==p.value&&U(e)}),i(()=>{!async function(){d.value=!0;try{const e=(await _e.routes.admin.system.module.list("servers")).data;e.success?(u.value=e.data,p.value&&L(p.value)):ne.error("Failed to fetch available modules",{message:e.message})}catch(e){ne.error("Error fetching available modules",{error:e})}finally{d.value=!1}}(),async function(){try{const e=(await _e.routes.admin.product.groups.list()).data;e.success?m.value=e.groups||[]:ne.error("Failed to fetch product groups",{message:e.message})}catch(e){ne.error("Error fetching product groups",{error:e})}}()}),(e,t)=>(g(),o("div",ro,[l("div",oo,[l("p",lo,c(_(n)("products_services.module.description")),1),d.value?(g(),o("div",co,t[8]||(t[8]=[l("div",{class:"spinner-loading",style:{margin:"0 auto"}},null,-1)]))):(g(),o(h,{key:1},[l("h3",uo,c(_(n)("products_services.module.select_module")),1),l("div",po,[(g(!0),o(h,null,f(u.value.servers,(e,t)=>(g(),o("div",{key:t,class:y(["module-card",{selected:p.value===t}]),onClick:e=>U(t)},[l("div",vo,[e.logo?(g(),o("img",{key:0,src:`/${e.logo}`,alt:`${e.name} logo`,class:"module-logo-img"},null,8,ho)):(g(),o("i",fo))]),l("h4",go,c(e.name),1),l("p",yo,c(e.description),1)],10,mo))),128))]),p.value?(g(),o("div",bo,[l("div",_o,[l("h3",ko,c(_(n)("products_services.module.provision_settings")),1),l("div",wo,[l("button",{type:"button",class:y(["btn",{"btn-primary":"simple"===x.value,"btn-secondary":"simple"!==x.value}]),onClick:t[0]||(t[0]=e=>x.value="simple")},c(_(n)("common.simple")),3),l("button",{type:"button",class:y(["btn",{"btn-primary":"advanced"===x.value,"btn-secondary":"advanced"!==x.value}]),onClick:t[1]||(t[1]=e=>x.value="advanced")},c(_(n)("common.advanced")),3)])]),T.value?(g(),o("div",So,t[9]||(t[9]=[l("div",{class:"spinner-loading mx-auto"},null,-1)]))):(g(),o(h,{key:1},[E.value.length>0?(g(),o("div",Eo,[l("label",Co,c(_(n)("products_services.module.select_server")),1),w(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>k.value.server_id=e),class:"form-control",required:""},[l("option",To,c(_(n)("products_services.module.select_server_placeholder")||"Sélectionnez un serveur"),1),(g(!0),o(h,null,f(E.value,e=>(g(),o("option",{key:e.value,value:e.value},c(e.label),9,Ao))),128))],512),[[A,k.value.server_id]])])):(g(),o("p",Io,c(_(n)("products_services.module.no_compatible_servers")),1)),R.value?(g(),o("div",Ro,t[10]||(t[10]=[l("div",{class:"spinner-loading mx-auto"},null,-1)]))):v("",!0),k.value.server_id&&I.value?(g(),o("div",xo,["simple"===x.value&&O.value.length>0?(g(),o("div",Oo,[l("label",Po,c(_(n)("products_services.module.package_name")||"Package"),1),w(l("select",{id:"package_name","onUpdate:modelValue":t[3]||(t[3]=e=>k.value.package_name=e),class:"form-select",onChange:M},[l("option",No,c(_(n)("common.select")||"Sélectionner..."),1),(g(!0),o(h,null,f(O.value,e=>(g(),o("option",{key:e.value,value:e.value},c(e.text),9,Mo))),128))],544),[[A,k.value.package_name]]),l("small",Do,c(_(n)("products_services.module.package_name_help")||"Sélectionnez le package à provisionner pour ce produit."),1)])):v("",!0),l("div",Lo,[(g(!0),o(h,null,f(N.value,e=>(g(),o("div",{key:e.name,class:"form-group mb-3"},[l("label",Uo,c(e.label),1),"select"===e.type?w((g(),o("select",{key:0,"onUpdate:modelValue":t=>k.value[e.name]=t,class:"form-control",required:"required"===e.validation},[e.placeholder?(g(),o("option",Vo,c(e.placeholder),1)):v("",!0),(g(!0),o(h,null,f(e.options,e=>(g(),o("option",{key:e.value,value:e.value},c(e.text||e.label||e.value),9,$o))),128))],8,qo)),[[A,k.value[e.name]]]):"text"===e.type?w((g(),o("input",{key:1,"onUpdate:modelValue":t=>k.value[e.name]=t,type:"text",class:"form-control",placeholder:e.placeholder,required:"required"===e.validation},null,8,jo)),[[S,k.value[e.name]]]):"number"===e.type?w((g(),o("input",{key:2,"onUpdate:modelValue":t=>k.value[e.name]=t,type:"number",class:"form-control",placeholder:e.placeholder,required:"required"===e.validation},null,8,Fo)),[[S,k.value[e.name]]]):"password"===e.type?w((g(),o("input",{key:3,"onUpdate:modelValue":t=>k.value[e.name]=t,type:"password",class:"form-control",placeholder:e.placeholder,required:"required"===e.validation},null,8,Go)),[[S,k.value[e.name]]]):"checkbox"===e.type?(g(),o("div",Bo,[w(l("input",{id:"checkbox-"+e.name,"onUpdate:modelValue":t=>k.value[e.name]=t,type:"checkbox",class:"form-check-input"},null,8,Ho),[[C,k.value[e.name]]]),l("label",{for:"checkbox-"+e.name,class:"form-check-label"},c(e.label),9,Wo)])):w((g(),o("input",{key:5,"onUpdate:modelValue":t=>k.value[e.name]=t,type:"text",class:"form-control",placeholder:e.placeholder},null,8,zo)),[[S,k.value[e.name]]]),e.help?(g(),o("small",Ko,c(e.help),1)):v("",!0)]))),128))])])):v("",!0)],64))])):v("",!0)],64)),p.value?(g(),o("div",Jo,[l("div",Yo,[l("h5",Xo,c(_(n)("products_services.module.auto_provisioning_options")||"Options de provisionnement automatique"),1)]),l("div",Qo,[l("p",Zo,c(_(n)("products_services.module.auto_provision_intro")||"Définissez quand le produit sera automatiquement configuré."),1),l("div",el,[l("div",tl,[w(l("input",{id:"provisioning_immediate","onUpdate:modelValue":t[4]||(t[4]=e=>k.value.provisioning_type=e),type:"radio",class:"form-check-input",value:"auto_setup_on_order"},null,512),[[P,k.value.provisioning_type]]),l("label",sl,c(_(n)("products_services.module.provisioning_immediate_full")||"Configurer automatiquement le produit dès qu'une commande est passée"),1)]),l("div",al,[w(l("input",{id:"provisioning_payment","onUpdate:modelValue":t[5]||(t[5]=e=>k.value.provisioning_type=e),type:"radio",class:"form-check-input",value:"auto_setup_on_payment"},null,512),[[P,k.value.provisioning_type]]),l("label",il,c(_(n)("products_services.module.provisioning_payment_full")||"Configurer automatiquement le produit dès réception du premier paiement"),1)]),l("div",nl,[w(l("input",{id:"provisioning_manual_accept","onUpdate:modelValue":t[6]||(t[6]=e=>k.value.provisioning_type=e),type:"radio",class:"form-check-input",value:"manual_accept"},null,512),[[P,k.value.provisioning_type]]),l("label",rl,c(_(n)("products_services.module.provisioning_manual_accept_full")||"Configurer automatiquement le produit lorsque vous acceptez manuellement une commande en attente"),1)]),l("div",ol,[w(l("input",{id:"provisioning_manual","onUpdate:modelValue":t[7]||(t[7]=e=>k.value.provisioning_type=e),type:"radio",class:"form-check-input",value:"manual"},null,512),[[P,k.value.provisioning_type]]),l("label",ll,c(_(n)("products_services.module.provisioning_manual_full")||"Ne pas configurer automatiquement ce produit"),1)])])])])):v("",!0)])]))}},ul=Vt(cl,[["__scopeId","data-v-ff2efab8"]]),dl={class:"section-description"},pl={key:0,class:"text-center",style:{padding:"var(--spacing-xl)"}},ml={key:1},vl={key:0,class:"custom-fields-list"},hl={class:"custom-field-header"},fl={class:"custom-field-name"},gl={class:"custom-field-actions"},yl=["onClick"],bl=["onClick"],_l={class:"custom-field-details"},kl={class:"custom-field-detail"},wl={class:"detail-label"},Sl={class:"detail-value"},El={class:"custom-field-detail"},Cl={class:"detail-label"},Tl={class:"detail-value"},Al={class:"custom-field-detail"},Il={class:"detail-label"},Rl={class:"detail-value"},xl={key:0,class:"custom-field-detail"},Ol={class:"detail-label"},Pl={class:"detail-value"},Nl={key:1,class:"empty-state"},Ml={class:"fields-footer"},Dl={class:"actions-container"},Ll=["disabled"],Ul={key:2,class:"modal"},ql={class:"modal-content"},Vl={class:"modal-header"},$l={class:"modal-body"},jl={class:"form-group"},Fl={class:"form-label"},Gl=["placeholder"],Bl={class:"form-group"},Hl={class:"form-label"},Wl=["value"],zl={class:"form-group"},Kl={class:"form-label"},Jl=["placeholder"],Yl={class:"form-group form-checkbox"},Xl={for:"field-required",class:"form-checkbox-label"},Ql={key:0,class:"form-group"},Zl={class:"form-label"},ec={class:"options-list"},tc=["onUpdate:modelValue","placeholder"],sc=["onClick"],ac={key:1,class:"form-group"},ic={class:"form-label"},nc=["placeholder"],rc={class:"form-hint"},oc={class:"form-group form-checkbox"},lc={for:"field-admin-only",class:"form-checkbox-label"},cc={class:"modal-footer"},uc={type:"submit",class:"btn btn-primary"},dc=r({__name:"ProductCustomFieldsView",emits:["cancel"],setup(t,{expose:a,emit:n}){const r=n,{t:u}=b(),p=I(),m=T(),y=He(),E=Pi(),R=e(!1),x=e([]),O=e(!1),P=e(null),N=e({name:"",type:"text",description:"",required:!1,admin_only:!1,validation:"",options:[]}),M=e(null),D=s(()=>p.params.idOrAction),L=s(()=>!isNaN(parseInt(D.value))),U=[{name:u("products_services.custom_fields.type_text"),value:"text"},{name:u("products_services.custom_fields.type_textarea"),value:"textarea"},{name:u("products_services.custom_fields.type_dropdown"),value:"dropdown"},{name:u("products_services.custom_fields.type_radio"),value:"radio"},{name:u("products_services.custom_fields.type_checkbox"),value:"checkbox"},{name:u("products_services.custom_fields.type_date"),value:"date"},{name:u("products_services.custom_fields.type_password"),value:"password"}],q=e=>["dropdown","radio","checkbox"].includes(e),V=e=>{const t=U.find(t=>t.value===e);return t?t.name:e},$=()=>{N.value.options.push("")},j=()=>{if(!N.value.name)return void y.showNotification({type:"error",title:u("common.error"),message:u("products_services.custom_fields.name_required")});if(q(N.value.type)&&(!N.value.options||0===N.value.options.length))return void y.showNotification({type:"error",title:u("common.error"),message:u("products_services.custom_fields.options_required")});const e=JSON.parse(JSON.stringify(N.value));if(void 0===e.id&&(e.id=Date.now()),P.value){const t=x.value.findIndex(t=>t.id===e.id);-1!==t&&(x.value[t]=e)}else x.value.push(e);F()},F=()=>{N.value={name:"",type:"text",description:"",required:!1,admin_only:!1,validation:"",options:[]},P.value=null,O.value=!1},G=async()=>{R.value=!0;try{E.setProductData({custom_fields:x.value}),L.value&&D.value&&await(async()=>{const e=ha(),t=await e.fetchProduct(D.value);if(t){const s={custom_fields:x.value};await e.updateProduct(t.id,s)}})(),y.showNotification({type:"success",title:u("common.success"),message:u("products_services.custom_fields.saved_success")}),M.value&&m.push(M.value)}catch(e){ne.error("Erreur lors de la sauvegarde des champs personnalisés",{error:e}),y.showNotification({type:"error",title:u("common.error"),message:u("products_services.error_saving_data")})}finally{R.value=!1}};return i(()=>{!function(){const e={steps:[{name:"details",label:u("products_services.wizard.steps.details"),completed:!0},{name:"pricing",label:u("products_services.wizard.steps.pricing"),completed:!0},{name:"custom_fields",label:u("products_services.wizard.steps.custom_fields"),completed:!1,current:!0},{name:"configurable_options",label:u("products_services.wizard.steps.configurable_options"),completed:!1},{name:"upgrades",label:u("products_services.wizard.steps.upgrades"),completed:!1},{name:"cross_sells",label:u("products_services.wizard.steps.cross_sells"),completed:!1},{name:"links",label:u("products_services.wizard.steps.links"),completed:!1}],exitUrl:"/products-services"};E.setWizardConfig(e)}(),(async()=>{R.value=!0;try{if(L.value){const e=ha(),t=await e.fetchProduct(D.value);E.setProductData(t)}if(E.productData.custom_fields){const e=E.productData.custom_fields;x.value=Array.isArray(e)?e:[]}}catch(e){ne.error("Erreur lors du chargement des données des champs personnalisés",{error:e}),y.showNotification({type:"error",title:u("common.error"),message:u("products_services.error_loading_data")})}finally{R.value=!1}})()}),a({saveData:G}),(e,t)=>(g(),o("div",null,[l("p",dl,c(_(u)("products_services.custom_fields.description")),1),R.value?(g(),o("div",pl,t[8]||(t[8]=[l("div",{class:"spinner-loading",style:{margin:"0 auto"}},null,-1)]))):(g(),o("div",ml,[x.value.length>0?(g(),o("div",vl,[(g(!0),o(h,null,f(x.value,e=>(g(),o("div",{key:e.id,class:"custom-field-item"},[l("div",hl,[l("h4",fl,c(e.name),1),l("div",gl,[l("button",{class:"btn-icon edit",onClick:t=>(e=>{P.value=e,N.value=JSON.parse(JSON.stringify(e)),O.value=!0})(e)},t[9]||(t[9]=[l("i",{class:"fas fa-pencil-alt"},null,-1)]),8,yl),l("button",{class:"btn-icon delete",onClick:t=>(e=>{if(confirm(u("products_services.custom_fields.delete_confirm"))){const t=x.value.findIndex(t=>t.id===e.id);-1!==t&&x.value.splice(t,1)}})(e)},t[10]||(t[10]=[l("i",{class:"fas fa-trash"},null,-1)]),8,bl)])]),l("div",_l,[l("div",kl,[l("span",wl,c(_(u)("products_services.custom_fields.type")),1),l("span",Sl,c(V(e.type)),1)]),l("div",El,[l("span",Cl,c(_(u)("products_services.custom_fields.required")),1),l("span",Tl,c(e.required?_(u)("common.yes"):_(u)("common.no")),1)]),l("div",Al,[l("span",Il,c(_(u)("products_services.custom_fields.description")),1),l("span",Rl,c(e.description||_(u)("common.none")),1)]),q(e.type)?(g(),o("div",xl,[l("span",Ol,c(_(u)("products_services.custom_fields.options")),1),l("span",Pl,c(e.options?e.options.join(", "):_(u)("common.none")),1)])):v("",!0)])]))),128))])):(g(),o("div",Nl,[t[11]||(t[11]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-clipboard-list"})],-1)),l("h4",null,c(_(u)("products_services.custom_fields.no_fields")),1),l("p",null,c(_(u)("products_services.custom_fields.no_fields_description")),1)])),l("div",Ml,[l("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=e=>O.value=!0)},[t[12]||(t[12]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(_(u)("products_services.custom_fields.add_field")),1)])]),l("div",Dl,[l("button",{type:"button",class:"btn btn-primary",disabled:R.value,onClick:G},c(_(u)("common.save")),9,Ll),l("button",{type:"button",class:"btn btn-secondary",onClick:t[1]||(t[1]=e=>r("cancel"))},c(_(u)("common.cancel")),1)]),O.value?(g(),o("div",Ul,[l("div",ql,[l("div",Vl,[l("h3",null,c(P.value?_(u)("products_services.custom_fields.edit_field"):_(u)("products_services.custom_fields.add_field")),1),l("button",{class:"close-button",onClick:F},t[13]||(t[13]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",$l,[l("form",{onSubmit:k(j,["prevent"])},[l("div",jl,[l("label",Fl,c(_(u)("products_services.custom_fields.field_name"))+" *",1),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>N.value.name=e),type:"text",class:"form-control",placeholder:_(u)("products_services.custom_fields.field_name_placeholder"),required:""},null,8,Gl),[[S,N.value.name]])]),l("div",Bl,[l("label",Hl,c(_(u)("products_services.custom_fields.field_type"))+" *",1),w(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>N.value.type=e),class:"form-select"},[(g(),o(h,null,f(U,e=>l("option",{key:e.value,value:e.value},c(e.name),9,Wl)),64))],512),[[A,N.value.type]])]),l("div",zl,[l("label",Kl,c(_(u)("products_services.custom_fields.field_description")),1),w(l("textarea",{"onUpdate:modelValue":t[4]||(t[4]=e=>N.value.description=e),class:"form-control",rows:"3",placeholder:_(u)("products_services.custom_fields.field_description_placeholder")},null,8,Jl),[[S,N.value.description]])]),l("div",Yl,[w(l("input",{id:"field-required","onUpdate:modelValue":t[5]||(t[5]=e=>N.value.required=e),type:"checkbox",class:"form-checkbox-input"},null,512),[[C,N.value.required]]),l("label",Xl,c(_(u)("products_services.custom_fields.field_required")),1)]),q(N.value.type)?(g(),o("div",Ql,[l("label",Zl,c(_(u)("products_services.custom_fields.field_options"))+" *",1),l("div",ec,[(g(!0),o(h,null,f(N.value.options,(e,s)=>(g(),o("div",{key:s,class:"option-item"},[w(l("input",{"onUpdate:modelValue":e=>N.value.options[s]=e,type:"text",class:"form-control",placeholder:_(u)("products_services.custom_fields.option_placeholder")},null,8,tc),[[S,N.value.options[s]]]),l("button",{type:"button",class:"btn btn-danger btn-sm",onClick:e=>(e=>{N.value.options.splice(e,1)})(s)},t[14]||(t[14]=[l("i",{class:"fas fa-times"},null,-1)]),8,sc)]))),128))]),l("button",{type:"button",class:"btn btn-outline-primary",onClick:$},c(_(u)("products_services.custom_fields.add_option")),1)])):v("",!0),"text"===N.value.type?(g(),o("div",ac,[l("label",ic,c(_(u)("products_services.custom_fields.validation_regex")),1),w(l("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>N.value.validation=e),type:"text",class:"form-control",placeholder:_(u)("products_services.custom_fields.validation_placeholder")},null,8,nc),[[S,N.value.validation]]),l("p",rc,c(_(u)("products_services.custom_fields.validation_hint")),1)])):v("",!0),l("div",oc,[w(l("input",{id:"field-admin-only","onUpdate:modelValue":t[7]||(t[7]=e=>N.value.admin_only=e),type:"checkbox",class:"form-checkbox-input"},null,512),[[C,N.value.admin_only]]),l("label",lc,c(_(u)("products_services.custom_fields.field_admin_only")),1)]),l("div",cc,[l("button",{type:"button",class:"btn btn-secondary",onClick:F},c(_(u)("common.cancel")),1),l("button",uc,c(_(u)("common.save")),1)])],32)])])])):v("",!0)]))]))}}),pc=Vt(dc,[["__scopeId","data-v-b3ae7ccb"]]),mc={class:"section-description"},vc={key:0,class:"text-center",style:{padding:"var(--spacing-xl)"}},hc={key:1},fc={key:0,class:"options-list"},gc=["onClick"],yc={class:"option-name"},bc={class:"option-type-badge"},_c={class:"option-actions"},kc=["onClick"],wc=["onClick"],Sc={key:0,class:"option-content"},Ec={class:"form-group"},Cc={class:"form-label"},Tc={key:0,class:"option-choices"},Ac={class:"form-label"},Ic={class:"choices-table"},Rc={key:0},xc={key:1},Oc={key:2},Pc={key:1,class:"empty-state"},Nc={class:"options-footer"},Mc={key:2,class:"modal"},Dc={class:"modal-content"},Lc={class:"modal-header"},Uc={class:"modal-body"},qc={class:"form-group"},Vc={class:"form-label"},$c={class:"form-group"},jc={class:"form-label"},Fc={value:"dropdown"},Gc={value:"radio"},Bc={value:"checkbox"},Hc={value:"quantity"},Wc={class:"form-group form-checkbox"},zc={for:"option-required",class:"form-checkbox-label"},Kc={key:0,class:"option-choices-section"},Jc={class:"choice-items"},Yc={class:"form-group"},Xc={class:"form-label"},Qc=["onUpdate:modelValue"],Zc={class:"form-group"},eu={class:"form-label"},tu=["onUpdate:modelValue"],su={value:"free"},au={value:"one_time"},iu={value:"recurring"},nu={key:0,class:"form-group"},ru={class:"form-label"},ou={class:"price-field"},lu=["onUpdate:modelValue"],cu=["onClick"],uu={key:1,class:"option-quantity-section"},du={class:"form-row"},pu={class:"form-col"},mu={class:"form-group"},vu={class:"form-label"},hu={class:"form-col"},fu={class:"form-group"},gu={class:"form-label"},yu={class:"form-group"},bu={class:"form-label"},_u={value:"free"},ku={value:"one_time"},wu={value:"recurring"},Su={key:0,class:"form-group"},Eu={class:"form-label"},Cu={class:"price-field"},Tu={class:"modal-footer"},Au={type:"submit",class:"btn btn-primary"},Iu={class:"wizard-actions"},Ru=r({__name:"ProductConfigurableOptionsView",setup(t){const{t:a}=b(),n=T(),r=Pi(),u=He(),p=e(!1),m=e([]),y=e(null),E=e(!1),I=e(null),R=e({id:null,name:"",type:"dropdown",required:!1,pricing_type:"free",price:0,min_quantity:1,max_quantity:10,choices:[]}),x=s(()=>null!==r.editingProductId),O=e=>`€${parseFloat(e.toString()).toFixed(2)}`,P=()=>{R.value.choices.push({id:Date.now(),name:"",pricing_type:"free",price:0})},N=()=>{if(!R.value.name)return void u.showNotification({type:"error",title:a("common.error"),message:a("products_services.configurable_options.name_required")});if("quantity"!==R.value.type&&(!R.value.choices||0===R.value.choices.length))return void u.showNotification({type:"error",title:a("common.error"),message:a("products_services.configurable_options.choices_required")});const e={...R.value};if(null===e.id&&(e.id=Date.now()),null!==I.value){const t=I.value.id,s=m.value.findIndex(e=>e.id===t);-1!==s&&(m.value[s]=e)}else m.value.push(e);M(),u.showNotification({type:"success",title:a("common.success"),message:null!==I.value?a("products_services.configurable_options.updated_success"):a("products_services.configurable_options.added_success")})},M=()=>{R.value={id:null,name:"",type:"dropdown",required:!1,pricing_type:"free",price:0,min_quantity:1,max_quantity:10,choices:[]},I.value=null,E.value=!1},D=()=>{M()},L=async()=>{p.value=!0;try{x.value&&r.productData.configurable_options&&(m.value=r.productData.configurable_options.map(e=>(e=>{var t;return e.id&&e.choices?e:{id:e.id||Date.now(),name:e.name,type:e.type,required:e.required,pricing_type:"free",price:0,min_quantity:"quantity"===e.type?1:void 0,max_quantity:"quantity"===e.type?10:void 0,choices:(null==(t=e.options)?void 0:t.map(e=>({id:Date.now()+Math.floor(1e3*Math.random()),name:e.name,pricing_type:e.price>0?"recurring":"free",price:e.price||0})))||[]}})(e)))}catch(e){ne.error("Erreur lors du chargement des données",{error:e}),u.showNotification({type:"error",title:a("common.error"),message:a("products_services.error_loading_data")})}finally{p.value=!1}},U=async()=>{await(async()=>{p.value=!0;try{const e=m.value.map(e=>({name:e.name,type:e.type,required:e.required,options:e.choices.map(e=>({name:e.name,price:e.price||0,setup_fee:0}))}));r.productData.configurable_options=e,u.showNotification({type:"success",title:a("common.success"),message:a("products_services.configurable_options.all_saved")})}catch(e){ne.error("Erreur lors de l'enregistrement des options",{error:e}),u.showNotification({type:"error",title:a("common.error"),message:a("products_services.configurable_options.save_error")})}finally{p.value=!1}})(),n.push("/products/wizard/pricing")};return i(()=>{L()}),(e,t)=>(g(),o("div",null,[l("p",mc,c(_(a)("products_services.configurable_options.description")),1),p.value?(g(),o("div",vc,t[9]||(t[9]=[l("div",{class:"spinner-loading",style:{margin:"0 auto"}},null,-1)]))):(g(),o("div",hc,[m.value.length>0?(g(),o("div",fc,[(g(!0),o(h,null,f(m.value,e=>{return g(),o("div",{key:e.id,class:"option-item"},[l("div",{class:"option-header",onClick:t=>(e=>{y.value===e.id?y.value=null:y.value=e.id})(e)},[l("div",yc,[d(c(e.name)+" ",1),l("span",bc,c((s=e.type,{dropdown:a("products_services.configurable_options.type_dropdown"),radio:a("products_services.configurable_options.type_radio"),checkbox:a("products_services.configurable_options.type_checkbox"),quantity:a("products_services.configurable_options.type_quantity")}[s]||s)),1)]),l("div",_c,[l("button",{class:"btn-icon edit",onClick:k(t=>(e=>{I.value=e,R.value=JSON.parse(JSON.stringify(e)),E.value=!0})(e),["stop"])},t[10]||(t[10]=[l("i",{class:"fas fa-pencil-alt"},null,-1)]),8,kc),l("button",{class:"btn-icon delete",onClick:k(t=>(e=>{const t=a("products_services.configurable_options.delete_confirm",{name:e.name});if(window.confirm(t)){const t=m.value.findIndex(t=>t.id===e.id);if(-1!==t){m.value.splice(t,1),y.value=null;const e=m.value.map(e=>({name:e.name,type:e.type,required:e.required,options:e.choices.map(e=>({name:e.name,price:e.price||0,setup_fee:0}))}));r.productData.configurable_options=e,u.showNotification({type:"success",title:a("common.success"),message:a("products_services.configurable_options.deleted_success")})}}})(e),["stop"])},t[11]||(t[11]=[l("i",{class:"fas fa-trash"},null,-1)]),8,wc)])],8,gc),y.value===e.id?(g(),o("div",Sc,[l("div",Ec,[l("label",Cc,c(_(a)("products_services.configurable_options.required")),1),l("div",null,c(e.required?_(a)("common.yes"):_(a)("common.no")),1)]),e.choices&&e.choices.length>0?(g(),o("div",Tc,[l("h4",Ac,c(_(a)("products_services.configurable_options.choices")),1),l("table",Ic,[l("thead",null,[l("tr",null,[l("th",null,c(_(a)("products_services.configurable_options.choice_name")),1),l("th",null,c(_(a)("products_services.configurable_options.choice_price")),1)])]),l("tbody",null,[(g(!0),o(h,null,f(e.choices,e=>(g(),o("tr",{key:e.id},[l("td",null,c(e.name),1),l("td",null,["free"===e.pricing_type?(g(),o("span",Rc,c(_(a)("products_services.pricing.free")),1)):"one_time"===e.pricing_type?(g(),o("span",xc,c(O(e.price))+" ("+c(_(a)("products_services.pricing.one_time"))+") ",1)):"recurring"===e.pricing_type?(g(),o("span",Oc,c(O(e.price))+" ("+c(_(a)("products_services.pricing.recurring"))+") ",1)):v("",!0)])]))),128))])])])):v("",!0)])):v("",!0)]);var s}),128))])):(g(),o("div",Pc,[t[12]||(t[12]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-sliders-h"})],-1)),l("h4",null,c(_(a)("products_services.configurable_options.no_options")),1),l("p",null,c(_(a)("products_services.configurable_options.no_options_description")),1)])),l("div",Nc,[l("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=e=>E.value=!0)},[t[13]||(t[13]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(_(a)("products_services.configurable_options.add_option")),1)])]),E.value||I.value?(g(),o("div",Mc,[l("div",Dc,[l("div",Lc,[l("h3",null,c(I.value?_(a)("products_services.configurable_options.edit_option"):_(a)("products_services.configurable_options.add_option")),1),l("button",{class:"close-button",onClick:D},t[14]||(t[14]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",Uc,[l("form",{onSubmit:k(N,["prevent"])},[l("div",qc,[l("label",Vc,c(_(a)("products_services.configurable_options.option_name"))+" *",1),w(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>R.value.name=e),type:"text",class:"form-control",required:""},null,512),[[S,R.value.name]])]),l("div",$c,[l("label",jc,c(_(a)("products_services.configurable_options.option_type"))+" *",1),w(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>R.value.type=e),class:"form-control",required:""},[l("option",Fc,c(_(a)("products_services.configurable_options.type_dropdown")),1),l("option",Gc,c(_(a)("products_services.configurable_options.type_radio")),1),l("option",Bc,c(_(a)("products_services.configurable_options.type_checkbox")),1),l("option",Hc,c(_(a)("products_services.configurable_options.type_quantity")),1)],512),[[A,R.value.type]])]),l("div",Wc,[w(l("input",{id:"option-required","onUpdate:modelValue":t[3]||(t[3]=e=>R.value.required=e),type:"checkbox",class:"form-checkbox-input"},null,512),[[C,R.value.required]]),l("label",zc,c(_(a)("products_services.configurable_options.required")),1)]),"quantity"!==R.value.type?(g(),o("div",Kc,[l("h4",null,c(_(a)("products_services.configurable_options.choices")),1),l("div",Jc,[(g(!0),o(h,null,f(R.value.choices,(e,s)=>(g(),o("div",{key:s,class:"choice-item"},[l("div",Yc,[l("label",Xc,c(_(a)("products_services.configurable_options.choice_name")),1),w(l("input",{"onUpdate:modelValue":t=>e.name=t,type:"text",class:"form-control"},null,8,Qc),[[S,e.name]])]),l("div",Zc,[l("label",eu,c(_(a)("products_services.configurable_options.pricing_type")),1),w(l("select",{"onUpdate:modelValue":t=>e.pricing_type=t,class:"form-control"},[l("option",su,c(_(a)("products_services.pricing.free")),1),l("option",au,c(_(a)("products_services.pricing.one_time")),1),l("option",iu,c(_(a)("products_services.pricing.recurring")),1)],8,tu),[[A,e.pricing_type]])]),"free"!==e.pricing_type?(g(),o("div",nu,[l("label",ru,c(_(a)("products_services.configurable_options.price")),1),l("div",ou,[t[15]||(t[15]=l("span",{class:"currency-symbol"},"€",-1)),w(l("input",{"onUpdate:modelValue":t=>e.price=t,type:"number",class:"form-control",min:"0",step:"0.01"},null,8,lu),[[S,e.price]])])])):v("",!0),l("button",{type:"button",class:"btn btn-danger btn-sm",onClick:e=>(e=>{R.value.choices.splice(e,1)})(s)},c(_(a)("common.remove")),9,cu)]))),128))]),l("button",{type:"button",class:"btn btn-outline-primary",onClick:P},c(_(a)("products_services.configurable_options.add_choice")),1)])):v("",!0),"quantity"===R.value.type?(g(),o("div",uu,[l("div",du,[l("div",pu,[l("div",mu,[l("label",vu,c(_(a)("products_services.configurable_options.min_quantity")),1),w(l("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>R.value.min_quantity=e),type:"number",class:"form-control",min:"1"},null,512),[[S,R.value.min_quantity]])])]),l("div",hu,[l("div",fu,[l("label",gu,c(_(a)("products_services.configurable_options.max_quantity")),1),w(l("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>R.value.max_quantity=e),type:"number",class:"form-control",min:"1"},null,512),[[S,R.value.max_quantity]])])])]),l("div",yu,[l("label",bu,c(_(a)("products_services.configurable_options.pricing_type")),1),w(l("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>R.value.pricing_type=e),class:"form-control"},[l("option",_u,c(_(a)("products_services.pricing.free")),1),l("option",ku,c(_(a)("products_services.pricing.one_time")),1),l("option",wu,c(_(a)("products_services.pricing.recurring")),1)],512),[[A,R.value.pricing_type]])]),"free"!==R.value.pricing_type?(g(),o("div",Su,[l("label",Eu,c(_(a)("products_services.configurable_options.price_per_unit")),1),l("div",Cu,[t[16]||(t[16]=l("span",{class:"currency-symbol"},"€",-1)),w(l("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>R.value.price=e),type:"number",class:"form-control",min:"0",step:"0.01"},null,512),[[S,R.value.price]])])])):v("",!0)])):v("",!0),l("div",Tu,[l("button",{type:"button",class:"btn btn-secondary",onClick:D},c(_(a)("common.cancel")),1),l("button",Au,c(_(a)("common.save")),1)])],32)])])])):v("",!0)])),l("div",Iu,[l("button",{class:"btn btn-secondary",onClick:t[8]||(t[8]=t=>e.$router.push("/products/wizard/links"))},c(_(a)("common.back")),1),l("button",{class:"btn btn-primary",onClick:U},c(_(a)("common.next")),1)])]))}}),xu=Vt(Ru,[["__scopeId","data-v-1e31b778"]]),Ou={class:"section-description"},Pu={class:"product-selector"},Nu={class:"section-title"},Mu={class:"search-container"},Du=["placeholder"],Lu={class:"filter-group",style:{"margin-bottom":"var(--spacing-md)"}},Uu={value:""},qu=["value"],Vu={class:"product-groups"},$u={key:0,class:"text-center",style:{padding:"var(--spacing-xl)"}},ju={key:1,class:"empty-state"},Fu={class:"empty-title"},Gu={class:"empty-description"},Bu={class:"group-title"},Hu={class:"product-cards"},Wu=["onClick"],zu={class:"product-image"},Ku=["src","alt"],Ju={class:"product-details"},Yu={class:"product-name"},Xu={class:"product-type"},Qu={class:"product-price"},Zu={key:0,class:"selected-products-container"},ed={class:"section-title"},td={class:"badge"},sd={class:"selected-products-list"},ad={class:"product-info"},id={class:"product-name"},nd={class:"product-category"},rd=["onClick"],od={key:1,class:"empty-state"},ld={class:"empty-title"},cd={class:"empty-description"},ud=r({__name:"ProductUpgradesView",setup(t){const{t:a}=b(),n=I(),r=He(),u=Pi(),p=fa(),m=ha(),k=e(!1),E=e(""),C=e(""),T=e([]),R=e([]),x=e([]);T.value||(T.value=[]),x.value||(x.value=[]);const O=s(()=>n.params.idOrAction),P=s(()=>!isNaN(parseInt(O.value))),N=s(()=>{const e=E.value?E.value.toLowerCase():"",t=C.value,s=P.value&&O.value?parseInt(O.value):null;return T.value&&Array.isArray(T.value)?T.value.filter(a=>{if(!a||!a.name)return!1;const i=!e||a.name.toLowerCase().includes(e),n=!t||String(a.group_id)===String(t),r=!s||a.id!==s;return i&&n&&r}):[]}),M=s(()=>{if(!(N.value&&Array.isArray(N.value)&&x.value&&Array.isArray(x.value)))return[];const e=new Set(N.value.filter(e=>e&&e.group_id).map(e=>e.group_id));return x.value.filter(t=>t&&t.id&&e.has(Number(t.id)))}),D=e=>R.value.some(t=>t.id===e),L=e=>{const t=x.value.find(t=>t.id===e);return t?t.name:""},U=e=>{const t=R.value.findIndex(t=>t.id===e.id);-1!==t&&R.value.splice(t,1)};return i(()=>{(async()=>{k.value=!0;try{T.value||(T.value=[]),x.value||(x.value=[]),R.value||(R.value=[]),await p.fetchProductGroups(),x.value=p.productGroups||[];try{await m.fetchProducts(),T.value=m.products||[]}catch(e){T.value=[],ne.error("Erreur lors du chargement des produits",{error:e})}if(P.value&&O.value){const e=parseInt(O.value);T.value=T.value.filter(t=>t&&t.id!==e)}if(P.value&&O.value&&(!u.productData||!("id"in u.productData)||!u.productData.id)){const e=await m.fetchProduct(O.value);e&&u.setProductData(e)}if(P.value&&u.productData&&u.productData.upgrade_products){const e=(u.productData.upgrade_products||[]).map(e=>parseInt(String(e)));R.value=T.value.filter(t=>t&&t.id&&e.includes(Number(t.id)))}}catch(e){ne.error("Erreur lors du chargement des données",{error:e}),r.showNotification({type:"error",title:a("common.error"),message:a("products_services.error_loading_data")})}finally{k.value=!1}})()}),(e,t)=>(g(),o("div",null,[l("p",Ou,c(_(a)("products_services.upgrades.description")),1),l("div",Pu,[l("h3",Nu,c(_(a)("products_services.upgrades.select_products")),1),l("div",Mu,[t[2]||(t[2]=l("i",{class:"fas fa-search search-icon"},null,-1)),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>E.value=e),type:"text",placeholder:_(a)("common.search"),class:"search-input"},null,8,Du),[[S,E.value]])]),l("div",Lu,[w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>C.value=e),class:"form-control"},[l("option",Uu,c(_(a)("products_services.all_categories")),1),(g(!0),o(h,null,f(x.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name),9,qu))),128))],512),[[A,C.value]])]),l("div",Vu,[k.value?(g(),o("div",$u,t[3]||(t[3]=[l("div",{class:"spinner-loading",style:{margin:"0 auto"}},null,-1)]))):0===N.value.length?(g(),o("div",ju,[t[4]||(t[4]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-box-open"})],-1)),l("h4",Fu,c(_(a)("products_services.no_products_found")),1),l("p",Gu,c(_(a)("products_services.try_different_filter")),1)])):(g(!0),o(h,{key:2},f(M.value,(e,s)=>{return g(),o("div",{key:e.id||s,class:"product-group"},[l("h4",Bu,c(e.name),1),l("div",Hu,[(g(!0),o(h,null,f((a=e.id,N.value.filter(e=>String(e.group_id)===String(a))),e=>{return g(),o("div",{key:e.id,class:y(["product-card",{selected:D(e.id)}]),onClick:t=>(e=>{D(e.id)?U(e):R.value.push(e)})(e)},[l("div",zu,[l("img",{src:e.image_url||"/assets/images/product-placeholder.png",alt:e.name},null,8,Ku),t[5]||(t[5]=l("div",{class:"product-selection"},[l("i",{class:"fas fa-check"})],-1))]),l("div",Ju,[l("h5",Yu,c(e.name),1),l("div",Xu,c(e.type),1),l("div",Qu,c((s=e.price,null==s?"€0.00":`€${parseFloat(String(s)).toFixed(2)}`)),1)])],10,Wu);var s}),128))])]);var a}),128))])]),R.value.length>0?(g(),o("div",Zu,[l("h3",ed,[d(c(_(a)("products_services.upgrades.selected_products"))+" ",1),l("span",td,c(R.value.length),1)]),l("div",sd,[(g(!0),o(h,null,f(R.value,e=>(g(),o("div",{key:e.id,class:"selected-product"},[l("div",ad,[l("div",id,c(e.name),1),l("div",nd,c(L(e.group_id||null)),1)]),l("button",{class:"remove-button",onClick:t=>U(e)},t[6]||(t[6]=[l("i",{class:"fas fa-times"},null,-1)]),8,rd)]))),128))])])):k.value?v("",!0):(g(),o("div",od,[t[7]||(t[7]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-arrow-up"})],-1)),l("h4",ld,c(_(a)("products_services.upgrades.no_products_selected")),1),l("p",cd,c(_(a)("products_services.upgrades.select_products_description")),1)]))]))}}),dd=Vt(ud,[["__scopeId","data-v-19a89781"]]),pd={class:"product-freedomain-page"},md={class:"section-description"},vd={key:0,class:"text-center",style:{padding:"var(--spacing-xl)"}},hd={class:"form-group"},fd={class:"custom-switch"},gd={class:"toggle-switch"},yd={class:"form-hint"},bd={key:0,class:"settings-container"},_d={class:"form-section"},kd={class:"section-title"},wd={class:"form-group"},Sd={class:"form-label"},Ed={value:"free"},Cd={value:"discounted"},Td={key:0,class:"form-group"},Ad={class:"form-label"},Id={class:"price-field"},Rd={class:"form-group"},xd={class:"form-label"},Od={value:"once"},Pd={value:"recurring"},Nd={class:"form-section"},Md={class:"section-title"},Dd={class:"section-description"},Ld={class:"billing-cycles-container"},Ud={class:"custom-checkbox"},qd=["id","value"],Vd=["for"],$d={class:"form-section"},jd={class:"section-title"},Fd={class:"section-description"},Gd={class:"tld-selection"},Bd={class:"search-container"},Hd=["placeholder"],Wd={class:"tld-grid"},zd=["onClick"],Kd={class:"tld-name"},Jd={class:"tld-price"},Yd={key:0,class:"tld-selected-badge"},Xd={class:"wizard-actions"},Qd=["disabled"],Zd={key:0,class:"spinner-container"},ep=r({__name:"ProductFreeDomainView",setup(t){const{t:a}=b(),n=T(),r=I(),u=He(),p=Pi(),m=ha(),E=e(!1),R=e(!1),x=e(""),O=e([{id:1,name:".com",price:12.99},{id:2,name:".net",price:14.99},{id:3,name:".org",price:13.99},{id:4,name:".info",price:9.99},{id:5,name:".biz",price:10.99},{id:6,name:".io",price:29.99},{id:7,name:".dev",price:19.99},{id:8,name:".app",price:18.99},{id:9,name:".tech",price:16.99},{id:10,name:".shop",price:15.99},{id:11,name:".fr",price:12.99},{id:12,name:".eu",price:14.99}]),P=e({enabled:!1,type:"free",discount_amount:10,payment_type:"once",available_cycles:[],available_tlds:[]}),N=[{id:"monthly",name:a("products_services.pricing.monthly")},{id:"quarterly",name:a("products_services.pricing.quarterly")},{id:"semiannually",name:a("products_services.pricing.semiannually")},{id:"annually",name:a("products_services.pricing.annually")},{id:"biennially",name:a("products_services.pricing.biennially")},{id:"triennially",name:a("products_services.pricing.triennially")}],M=s(()=>r.params.type),D=s(()=>r.params.idOrAction),L=s(()=>!isNaN(parseInt(D.value))),U=s(()=>{const e=x.value.toLowerCase();return e?O.value.filter(t=>t.name.toLowerCase().includes(e)):O.value}),q=e=>P.value.available_tlds.includes(e),V=async()=>{R.value=!0;try{p.updateProductData({freedomain_settings:P.value}),L.value&&await p.saveProduct();const e=L.value?{name:"product-cross-sells",params:{idOrAction:D.value}}:{name:"product-cross-sells",params:{type:M.value}};n.push(e),u.showNotification({type:"success",title:a("common.success"),message:a("products_services.freedomain.saved_successfully")})}catch(e){ne.error("Erreur lors de la sauvegarde des paramètres de domaine gratuit",{error:e}),u.showNotification({type:"error",title:a("common.error"),message:a("products_services.error_saving_data")})}finally{R.value=!1}},$=()=>{n.push({name:"products-list"})};return i(()=>{(async()=>{E.value=!0;try{if(L.value){if(!p.productData.id){const e=await m.fetchProduct(D.value);e&&p.setProductData(e)}p.productData.freedomain_settings&&(P.value={...p.productData.freedomain_settings})}}catch(e){ne.error("Erreur lors du chargement des données pour le domaine gratuit",{error:e}),u.showNotification({type:"error",title:a("common.error"),message:a("products_services.error_loading_data")})}finally{E.value=!1}})()}),(e,t)=>(g(),o("div",pd,[l("p",md,c(_(a)("products_services.freedomain.description")),1),E.value?(g(),o("div",vd,t[6]||(t[6]=[l("div",{class:"spinner-loading",style:{margin:"0 auto"}},null,-1)]))):(g(),o("form",{key:1,onSubmit:k(V,["prevent"])},[l("div",hd,[l("div",fd,[l("label",gd,[w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>P.value.enabled=e),type:"checkbox"},null,512),[[C,P.value.enabled]]),t[7]||(t[7]=l("span",{class:"toggle-slider"},null,-1))]),l("span",null,c(_(a)("products_services.freedomain.enable")),1)]),l("p",yd,c(_(a)("products_services.freedomain.enable_hint")),1)]),P.value.enabled?(g(),o("div",bd,[l("div",_d,[l("h3",kd,c(_(a)("products_services.freedomain.settings")),1),l("div",wd,[l("label",Sd,c(_(a)("products_services.freedomain.type")),1),w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>P.value.type=e),class:"form-control"},[l("option",Ed,c(_(a)("products_services.freedomain.type_free")),1),l("option",Cd,c(_(a)("products_services.freedomain.type_discounted")),1)],512),[[A,P.value.type]])]),"discounted"===P.value.type?(g(),o("div",Td,[l("label",Ad,c(_(a)("products_services.freedomain.discount_amount")),1),l("div",Id,[t[8]||(t[8]=l("span",{class:"currency-symbol"},"€",-1)),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>P.value.discount_amount=e),type:"number",class:"form-control",min:"0",step:"0.01"},null,512),[[S,P.value.discount_amount]])])])):v("",!0),l("div",Rd,[l("label",xd,c(_(a)("products_services.freedomain.payment_type")),1),w(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>P.value.payment_type=e),class:"form-control"},[l("option",Od,c(_(a)("products_services.freedomain.payment_once")),1),l("option",Pd,c(_(a)("products_services.freedomain.payment_recurring")),1)],512),[[A,P.value.payment_type]])])]),l("div",Nd,[l("h3",Md,c(_(a)("products_services.freedomain.billing_cycles")),1),l("p",Dd,c(_(a)("products_services.freedomain.billing_cycles_desc")),1),l("div",Ld,[(g(),o(h,null,f(N,e=>l("div",{key:e.id,class:"cycle-option"},[l("div",Ud,[w(l("input",{id:"cycle-"+e.id,"onUpdate:modelValue":t[4]||(t[4]=e=>P.value.available_cycles=e),type:"checkbox",value:e.id},null,8,qd),[[C,P.value.available_cycles]]),l("label",{for:"cycle-"+e.id},c(e.name),9,Vd)])])),64))])]),l("div",$d,[l("h3",jd,c(_(a)("products_services.freedomain.tld_selection")),1),l("p",Fd,c(_(a)("products_services.freedomain.tld_selection_desc")),1),l("div",Gd,[l("div",Bd,[t[9]||(t[9]=l("i",{class:"fas fa-search search-icon"},null,-1)),w(l("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>x.value=e),type:"text",placeholder:_(a)("products_services.freedomain.search_tlds"),class:"search-input"},null,8,Hd),[[S,x.value]])]),l("div",Wd,[(g(!0),o(h,null,f(U.value,e=>{return g(),o("div",{key:e.id,class:y(["tld-item",{selected:q(e.id)}]),onClick:t=>(e=>{const t=P.value.available_tlds.indexOf(e);-1===t?P.value.available_tlds.push(e):P.value.available_tlds.splice(t,1)})(e.id)},[l("span",Kd,c(e.name),1),l("span",Jd,c((s=e.price,new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(s))),1),q(e.id)?(g(),o("div",Yd,t[10]||(t[10]=[l("i",{class:"fas fa-check"},null,-1)]))):v("",!0)],10,zd);var s}),128))])])])])):v("",!0),l("div",Xd,[l("button",{type:"button",class:"btn btn-outline-secondary",onClick:$},c(_(a)("common.cancel")),1),l("button",{type:"submit",class:"btn btn-primary",disabled:R.value},[d(c(R.value?_(a)("common.saving"):_(a)("common.save_continue"))+" ",1),R.value?(g(),o("span",Zd,t[11]||(t[11]=[l("i",{class:"fas fa-spinner fa-spin"},null,-1)]))):v("",!0)],8,Qd)])],32))]))}}),tp=Vt(ep,[["__scopeId","data-v-f1f6b885"]]),sp={class:"section-description"},ap={key:0,class:"text-center",style:{padding:"var(--spacing-xl)"}},ip={key:1},np={class:"tabs-container"},rp={class:"tabs-navigation"},op={class:"search-container"},lp=["placeholder"],cp={key:0},up={key:0,class:"selected-products"},dp={class:"selected-title"},pp={class:"selected-count"},mp={class:"selected-products-list"},vp={class:"product-info"},hp={class:"product-name"},fp={class:"product-type"},gp={class:"product-price"},yp=["onClick"],bp={key:1,class:"empty-state"},_p={class:"available-title"},kp={class:"products-grid"},wp=["onClick"],Sp={class:"product-image"},Ep=["src","alt"],Cp={class:"product-details"},Tp={class:"product-name"},Ap={class:"product-type"},Ip={class:"product-price"},Rp={key:1},xp={key:0,class:"selected-products"},Op={class:"selected-title"},Pp={class:"selected-count"},Np={class:"selected-products-list"},Mp={class:"product-info"},Dp={class:"product-name"},Lp={class:"product-type"},Up={class:"product-price"},qp=["onClick"],Vp={key:1,class:"empty-state"},$p={class:"available-title"},jp={class:"products-grid"},Fp=["onClick"],Gp={class:"product-image"},Bp=["src","alt"],Hp={class:"product-details"},Wp={class:"product-name"},zp={class:"product-type"},Kp={class:"product-price"},Jp=r({__name:"ProductCrossSellsView",setup(t,{expose:a}){const{t:n}=b(),r=I(),u=He(),p=Pi(),m=ha(),k=e(!1),E=e("cross_sells"),C=e(""),T=e([]),A=e([]),R=e([]),x=s(()=>r.params.idOrAction),O=s(()=>!isNaN(parseInt(x.value))),P=s(()=>{const e=C.value.toLowerCase();return T.value&&Array.isArray(T.value)?T.value.filter(t=>{if(!t||!t.name||!t.type)return!1;const s=t.name.toLowerCase().includes(e),a=t.type.toLowerCase().includes(e),i=O.value?parseInt(x.value):null;return(s||a)&&t.id!==i}):[]}),N=e=>A.value.some(t=>t.id===e.id),M=e=>R.value.some(t=>t.id===e.id),D=e=>{const t=A.value.findIndex(t=>t.id===e.id);-1!==t&&A.value.splice(t,1)},L=e=>{const t=R.value.findIndex(t=>t.id===e.id);-1!==t&&R.value.splice(t,1)},U=e=>null==e?"€0.00":`€${parseFloat(String(e)).toFixed(2)}`;i(()=>{(async()=>{k.value=!0;try{const e=await m.fetchProducts();if(T.value=Array.isArray(e)?e:[],O.value&&p.productData.cross_sells&&Array.isArray(p.productData.cross_sells)&&T.value){const e=p.productData.cross_sells.map(e=>"string"==typeof e?parseInt(e):e);A.value=T.value.filter(t=>t.id&&e.includes(Number(t.id)))}const t=p.productData;if(t.related_products&&Array.isArray(t.related_products)&&T.value){const e=t.related_products.map(e=>"string"==typeof e?parseInt(e):e);R.value=T.value.filter(t=>t.id&&e.includes(Number(t.id)))}}catch(e){ne.error("Erreur lors du chargement des données de cross-sells",{error:e}),u.showNotification({type:"error",title:n("common.error"),message:n("products_services.error_loading_data")})}finally{k.value=!1}})()});return a({saveData:async()=>{try{const e=A.value.map(e=>Number(e.id||0)).filter(e=>0!==e),t=R.value.map(e=>Number(e.id||0)).filter(e=>0!==e);p.productData.cross_sells=e;return p.productData.related_products=t,O.value&&(await m.updateProduct(parseInt(x.value),{cross_sells:e,related_products:t}),u.showNotification({type:"success",title:n("common.success"),message:n("products_services.cross_sells.saved_successfully")})),!0}catch(e){return ne.error("Erreur lors de la sauvegarde des cross-sells",{error:e}),u.showNotification({type:"error",title:n("common.error"),message:n("products_services.cross_sells.save_error")}),!1}}}),(e,t)=>(g(),o("div",null,[l("p",sp,c(_(n)("products_services.cross_sells.description")),1),k.value?(g(),o("div",ap,t[3]||(t[3]=[l("div",{class:"spinner-loading",style:{margin:"0 auto"}},null,-1)]))):(g(),o("div",ip,[l("div",np,[l("div",rp,[l("div",{class:y(["tab-item",{active:"cross_sells"===E.value}]),onClick:t[0]||(t[0]=e=>E.value="cross_sells")},[t[4]||(t[4]=l("i",{class:"fas fa-handshake"},null,-1)),d(" "+c(_(n)("products_services.cross_sells.tab_cross_sells")),1)],2),l("div",{class:y(["tab-item",{active:"related"===E.value}]),onClick:t[1]||(t[1]=e=>E.value="related")},[t[5]||(t[5]=l("i",{class:"fas fa-link"},null,-1)),d(" "+c(_(n)("products_services.cross_sells.tab_related")),1)],2)]),l("div",op,[t[6]||(t[6]=l("i",{class:"fas fa-search search-icon"},null,-1)),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>C.value=e),type:"text",placeholder:_(n)("common.search"),class:"search-input"},null,8,lp),[[S,C.value]])]),"cross_sells"===E.value?(g(),o("div",cp,[A.value.length>0?(g(),o("div",up,[l("h4",dp,[d(c(_(n)("products_services.cross_sells.selected_products"))+" ",1),l("span",pp,c(A.value.length),1)]),l("div",mp,[(g(!0),o(h,null,f(A.value,e=>(g(),o("div",{key:e.id,class:"selected-product-item"},[l("div",vp,[l("div",hp,c(e.name),1),l("div",fp,c(e.type),1),l("div",gp,c(U(e.price)),1)]),l("button",{class:"remove-button",onClick:t=>D(e)},t[7]||(t[7]=[l("i",{class:"fas fa-times"},null,-1)]),8,yp)]))),128))])])):(g(),o("div",bp,[t[8]||(t[8]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-handshake"})],-1)),l("h4",null,c(_(n)("products_services.cross_sells.no_cross_sells")),1),l("p",null,c(_(n)("products_services.cross_sells.no_cross_sells_description")),1)])),l("h4",_p,c(_(n)("products_services.cross_sells.available_products")),1),l("div",kp,[(g(!0),o(h,null,f(P.value,e=>(g(),o("div",{key:e.id,class:y(["product-card",{selected:N(e)}]),onClick:t=>(e=>{N(e)?D(e):A.value.push(e)})(e)},[l("div",Sp,[l("img",{src:e.image_url||"/assets/images/product-placeholder.png",alt:e.name},null,8,Ep),t[9]||(t[9]=l("div",{class:"product-selection"},[l("i",{class:"fas fa-check"})],-1))]),l("div",Cp,[l("h5",Tp,c(e.name),1),l("div",Ap,c(e.type),1),l("div",Ip,c(U(e.price)),1)])],10,wp))),128))])])):v("",!0),"related"===E.value?(g(),o("div",Rp,[R.value.length>0?(g(),o("div",xp,[l("h4",Op,[d(c(_(n)("products_services.cross_sells.selected_related"))+" ",1),l("span",Pp,c(R.value.length),1)]),l("div",Np,[(g(!0),o(h,null,f(R.value,e=>(g(),o("div",{key:e.id,class:"selected-product-item"},[l("div",Mp,[l("div",Dp,c(e.name),1),l("div",Lp,c(e.type),1),l("div",Up,c(U(e.price)),1)]),l("button",{class:"remove-button",onClick:t=>L(e)},t[10]||(t[10]=[l("i",{class:"fas fa-times"},null,-1)]),8,qp)]))),128))])])):(g(),o("div",Vp,[t[11]||(t[11]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-link"})],-1)),l("h4",null,c(_(n)("products_services.cross_sells.no_related")),1),l("p",null,c(_(n)("products_services.cross_sells.no_related_description")),1)])),l("h4",$p,c(_(n)("products_services.cross_sells.available_products")),1),l("div",jp,[(g(!0),o(h,null,f(P.value,e=>(g(),o("div",{key:e.id,class:y(["product-card",{selected:M(e)}]),onClick:t=>(e=>{M(e)?L(e):R.value.push(e)})(e)},[l("div",Gp,[l("img",{src:e.image_url||"/assets/images/product-placeholder.png",alt:e.name},null,8,Bp),t[12]||(t[12]=l("div",{class:"product-selection"},[l("i",{class:"fas fa-check"})],-1))]),l("div",Hp,[l("h5",Wp,c(e.name),1),l("div",zp,c(e.type),1),l("div",Kp,c(U(e.price)),1)])],10,Fp))),128))])])):v("",!0)])]))]))}}),Yp=Vt(Jp,[["__scopeId","data-v-74c604e2"]]),Xp={class:"product-other-view"},Qp={class:"wizard-content"},Zp={class:"other-options-configuration"},em={class:"section-header"},tm={class:"section-title"},sm={class:"form-options-container"},am={class:"form-row"},im={class:"form-group form-group-checkbox"},nm={class:"form-check"},rm=["checked"],om={for:"require-domain",class:"form-check-label"},lm={class:"form-text text-muted"},cm={class:"form-group form-group-checkbox"},um={class:"form-check"},dm=["checked"],pm={for:"auto-setup",class:"form-check-label"},mm={class:"form-text text-muted"},vm={class:"form-row"},hm={class:"form-group form-group-checkbox"},fm={class:"form-check"},gm=["checked"],ym={for:"stock-control",class:"form-check-label"},bm={class:"form-text text-muted"},_m={key:0,class:"form-group"},km={for:"stock-quantity"},wm=["value"],Sm={class:"form-text text-muted"},Em={class:"form-row"},Cm={class:"form-group form-group-checkbox"},Tm={class:"form-check"},Am=["checked"],Im={for:"hidden",class:"form-check-label"},Rm={class:"form-text text-muted"},xm={class:"form-group form-group-checkbox"},Om={class:"form-check"},Pm=["checked"],Nm={for:"featured",class:"form-check-label"},Mm={class:"form-text text-muted"},Dm={class:"form-row"},Lm={class:"form-group"},Um={for:"welcome-email"},qm=["value"],Vm=["value"],$m={class:"form-text text-muted"},jm={class:"form-row"},Fm={class:"form-group"},Gm={for:"notes"},Bm=["placeholder"],Hm={class:"form-text text-muted"},Wm=r({__name:"ProductOtherView",setup(t){var s,a,n,r,u,d,p,m;const{t:y}=b(),k=Pi(),E=e({requireDomain:(null==(s=k.productData.other)?void 0:s.requireDomain)||!1,autoSetup:void 0===(null==(a=k.productData.other)?void 0:a.autoSetup)||k.productData.other.autoSetup,stockControl:(null==(n=k.productData.other)?void 0:n.stockControl)||!1,stockQuantity:(null==(r=k.productData.other)?void 0:r.stockQuantity)||0,hidden:(null==(u=k.productData.other)?void 0:u.hidden)||!1,featured:(null==(d=k.productData.other)?void 0:d.featured)||!1,welcomeEmail:(null==(p=k.productData.other)?void 0:p.welcomeEmail)||0,notes:(null==(m=k.productData.other)?void 0:m.notes)||""}),C=e([{id:0,name:y("products_services.other.welcome_email_none")},{id:1,name:y("products_services.other.welcome_email_product")},{id:2,name:y("products_services.other.welcome_email_general")},{id:3,name:y("products_services.other.welcome_email_both")}]),T=()=>{E.value.stockControl=!E.value.stockControl,E.value.stockControl||(E.value.stockQuantity=0)},A=()=>{E.value.requireDomain=!E.value.requireDomain},I=()=>{E.value.autoSetup=!E.value.autoSetup},R=()=>{E.value.hidden=!E.value.hidden},x=()=>{E.value.featured=!E.value.featured};return i(()=>{k.currentStep="other"}),(e,t)=>(g(),o("div",Xp,[l("div",Qp,[l("div",Zp,[l("div",em,[l("h3",tm,c(_(y)("products_services.other.configuration_title")),1)]),l("div",sm,[l("div",am,[l("div",im,[l("div",nm,[l("input",{id:"require-domain",type:"checkbox",class:"form-check-input",checked:E.value.requireDomain,onChange:A},null,40,rm),l("label",om,c(_(y)("products_services.other.require_domain")),1)]),l("small",lm,c(_(y)("products_services.other.require_domain_help")),1)]),l("div",cm,[l("div",um,[l("input",{id:"auto-setup",type:"checkbox",class:"form-check-input",checked:E.value.autoSetup,onChange:I},null,40,dm),l("label",pm,c(_(y)("products_services.other.auto_setup")),1)]),l("small",mm,c(_(y)("products_services.other.auto_setup_help")),1)])]),l("div",vm,[l("div",hm,[l("div",fm,[l("input",{id:"stock-control",type:"checkbox",class:"form-check-input",checked:E.value.stockControl,onChange:T},null,40,gm),l("label",ym,c(_(y)("products_services.other.stock_control")),1)]),l("small",bm,c(_(y)("products_services.other.stock_control_help")),1)]),E.value.stockControl?(g(),o("div",_m,[l("label",km,c(_(y)("products_services.other.stock_quantity")),1),l("input",{id:"stock-quantity",type:"number",class:"form-control",min:"0",value:E.value.stockQuantity,onInput:t[0]||(t[0]=e=>{var t,s;return s=null==(t=e.target)?void 0:t.value,void(E.value.stockQuantity=parseInt(String(s))||0)})},null,40,wm),l("small",Sm,c(_(y)("products_services.other.stock_quantity_help")),1)])):v("",!0)]),l("div",Em,[l("div",Cm,[l("div",Tm,[l("input",{id:"hidden",type:"checkbox",class:"form-check-input",checked:E.value.hidden,onChange:R},null,40,Am),l("label",Im,c(_(y)("products_services.other.hidden")),1)]),l("small",Rm,c(_(y)("products_services.other.hidden_help")),1)]),l("div",xm,[l("div",Om,[l("input",{id:"featured",type:"checkbox",class:"form-check-input",checked:E.value.featured,onChange:x},null,40,Pm),l("label",Nm,c(_(y)("products_services.other.featured")),1)]),l("small",Mm,c(_(y)("products_services.other.featured_help")),1)])]),l("div",Dm,[l("div",Lm,[l("label",Um,c(_(y)("products_services.other.welcome_email")),1),l("select",{id:"welcome-email",class:"form-control",value:E.value.welcomeEmail,onChange:t[1]||(t[1]=e=>{var t,s;return s=null==(t=e.target)?void 0:t.value,void(E.value.welcomeEmail=parseInt(String(s)))})},[(g(!0),o(h,null,f(C.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name),9,Vm))),128))],40,qm),l("small",$m,c(_(y)("products_services.other.welcome_email_help")),1)])]),l("div",jm,[l("div",Fm,[l("label",Gm,c(_(y)("products_services.other.notes")),1),w(l("textarea",{id:"notes","onUpdate:modelValue":t[2]||(t[2]=e=>E.value.notes=e),class:"form-control",rows:"4",placeholder:_(y)("products_services.other.notes_placeholder")},null,8,Bm),[[S,E.value.notes]]),l("small",Hm,c(_(y)("products_services.other.notes_help")),1)])])])])])]))}}),zm=Vt(Wm,[["__scopeId","data-v-3db009c1"]]),Km={class:"product-links-view"},Jm={class:"wizard-content"},Ym={class:"direct-links-section"},Xm={class:"section-header"},Qm={class:"section-title"},Zm={class:"form-options-container"},ev={class:"form-group"},tv={for:"cart-link"},sv={class:"input-group"},av=["value","placeholder"],iv={class:"form-group"},nv={for:"cart-link-template"},rv={class:"input-group"},ov=["value","placeholder"],lv={class:"form-group"},cv={for:"cart-link-domain"},uv={class:"input-group"},dv=["value","placeholder"],pv={class:"form-group"},mv={for:"group-link"},vv={class:"input-group"},hv=["value","placeholder"],fv={class:"product-links-section"},gv={class:"section-header"},yv={class:"section-title"},bv={class:"product-links-table"},_v={class:"data-table"},kv={class:"text-center visits-column"},wv={class:"text-center actions-column"},Sv=["value","placeholder","onInput"],Ev={class:"text-center visits-column"},Cv={class:"text-center actions-column"},Tv=["disabled","onClick"],Av=r({__name:"ProductLinksView",setup(t){var s,a,n,r,u,p,m,v,y;const{t:k}=b(),w=He(),S=Pi(),E=e({directLinks:{cartLink:(null==(a=null==(s=S.productData.links)?void 0:s.directLinks)?void 0:a.cartLink)||"",cartLinkWithTemplate:(null==(r=null==(n=S.productData.links)?void 0:n.directLinks)?void 0:r.cartLinkWithTemplate)||"",cartLinkWithDomain:(null==(p=null==(u=S.productData.links)?void 0:u.directLinks)?void 0:p.cartLinkWithDomain)||"",groupLink:(null==(v=null==(m=S.productData.links)?void 0:m.directLinks)?void 0:v.groupLink)||""},productLinks:(null==(y=S.productData.links)?void 0:y.productLinks)||[]}),C=(e,t)=>{E.value.directLinks[e]=t},T=()=>{E.value.productLinks.push({url:"",visits:0})};return i(()=>{0===E.value.productLinks.length&&T(),S.currentStep="links"}),(e,t)=>(g(),o("div",Km,[l("div",Jm,[l("div",Ym,[l("div",Xm,[l("h3",Qm,c(_(k)("products_services.links.direct_links_title")),1)]),l("div",Zm,[l("div",ev,[l("label",tv,c(_(k)("products_services.links.direct_cart_link")),1),l("div",sv,[l("input",{id:"cart-link",type:"text",class:"form-control",value:E.value.directLinks.cartLink,placeholder:_(k)("products_services.links.direct_cart_link_placeholder"),onInput:t[0]||(t[0]=e=>C("cartLink",e.target.value))},null,40,av),t[4]||(t[4]=l("div",{class:"input-group-append"},[l("button",{type:"button",class:"btn btn-outline-secondary"},[l("i",{class:"fas fa-copy"})])],-1))])]),l("div",iv,[l("label",nv,c(_(k)("products_services.links.direct_cart_link_template")),1),l("div",rv,[l("input",{id:"cart-link-template",type:"text",class:"form-control",value:E.value.directLinks.cartLinkWithTemplate,placeholder:_(k)("products_services.links.direct_cart_link_template_placeholder"),onInput:t[1]||(t[1]=e=>C("cartLinkWithTemplate",e.target.value))},null,40,ov),t[5]||(t[5]=l("div",{class:"input-group-append"},[l("button",{type:"button",class:"btn btn-outline-secondary"},[l("i",{class:"fas fa-copy"})])],-1))])]),l("div",lv,[l("label",cv,c(_(k)("products_services.links.direct_cart_link_domain")),1),l("div",uv,[l("input",{id:"cart-link-domain",type:"text",class:"form-control",value:E.value.directLinks.cartLinkWithDomain,placeholder:_(k)("products_services.links.direct_cart_link_domain_placeholder"),onInput:t[2]||(t[2]=e=>C("cartLinkWithDomain",e.target.value))},null,40,dv),t[6]||(t[6]=l("div",{class:"input-group-append"},[l("button",{type:"button",class:"btn btn-outline-secondary"},[l("i",{class:"fas fa-copy"})])],-1))])]),l("div",pv,[l("label",mv,c(_(k)("products_services.links.group_cart_link")),1),l("div",vv,[l("input",{id:"group-link",type:"text",class:"form-control",value:E.value.directLinks.groupLink,placeholder:_(k)("products_services.links.group_cart_link_placeholder"),onInput:t[3]||(t[3]=e=>C("groupLink",e.target.value))},null,40,hv),t[7]||(t[7]=l("div",{class:"input-group-append"},[l("button",{type:"button",class:"btn btn-outline-secondary"},[l("i",{class:"fas fa-copy"})])],-1))])])])]),l("div",fv,[l("div",gv,[l("h3",yv,c(_(k)("products_services.links.product_links_title")),1),l("button",{type:"button",class:"btn btn-sm btn-outline-primary add-link-btn",onClick:T},[t[8]||(t[8]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(_(k)("products_services.links.add_link")),1)])]),l("div",bv,[l("table",_v,[l("thead",null,[l("tr",null,[l("th",null,c(_(k)("products_services.links.url")),1),l("th",kv,c(_(k)("products_services.links.visits")),1),l("th",wv,c(_(k)("products_services.links.actions")),1)])]),l("tbody",null,[(g(!0),o(h,null,f(E.value.productLinks,(e,s)=>(g(),o("tr",{key:s},[l("td",null,[l("input",{type:"text",class:"form-control",value:e.url,placeholder:_(k)("products_services.links.url_placeholder"),onInput:e=>((e,t)=>{E.value.productLinks[e].url=t})(s,e.target.value)},null,40,Sv)]),l("td",Ev,c(e.visits),1),l("td",Cv,[l("button",{type:"button",class:"btn btn-sm btn-outline-danger",disabled:1===E.value.productLinks.length,onClick:e=>(e=>{E.value.productLinks.splice(e,1),w.addNotification({type:"success",title:k("products_services.links.success.link_removed_title"),message:k("products_services.links.success.link_removed_message")})})(s)},t[9]||(t[9]=[l("i",{class:"fas fa-trash-alt"},null,-1)]),8,Tv)])]))),128))])])])])])]))}}),Iv=Vt(Av,[["__scopeId","data-v-365f2c01"]]),Rv=t("invoices",()=>{const t=e([]),a=e(null),i=e(!1),n=e(null),r=e(!1),o=e(null),l=e(null),c=s(()=>e=>t.value.find(t=>t.id===e)||null),u=s(()=>e=>"all"===e?t.value:t.value.filter(t=>t.status===e)),d=e=>{if(!e||!e.action||!e.invoice)return void ne.warn("[INVOICES STORE] Données d'événement facture incomplètes",{eventData:e});const{action:t,invoice:s,timestamp:a}=e;if(o.value!==a||!a)switch(o.value=a,l.value={...e},ne.info(`[INVOICES STORE] Traitement de l'événement ${t} pour la facture #${s.id}`,{timestamp:a,invoice_id:s.id}),t){case"create":p(s);break;case"update":m(s);break;case"delete":v(s.id);break;default:ne.warn(`[INVOICES STORE] Action inconnue: ${t}`)}},p=e=>{ne.debug("[INVOICES STORE] Ajout d'une nouvelle facture en temps réel",{invoice_id:e.id});const s=t.value.findIndex(t=>t.id===e.id);if(-1!==s)return ne.debug("[INVOICES STORE] Facture existante, mise à jour",{invoice_id:e.id}),void(t.value[s]=e);t.value.unshift(e),ne.info("[INVOICES STORE] Nouvelle facture ajoutée en temps réel",{invoice_id:e.id})},m=e=>{ne.debug("[INVOICES STORE] Mise à jour d'une facture en temps réel",{invoice_id:e.id});const s=t.value.findIndex(t=>t.id===e.id);-1!==s?(t.value[s]=e,ne.debug("[INVOICES STORE] Facture mise à jour avec succès dans la liste",{invoice_id:e.id}),a.value&&a.value.id===e.id&&(a.value=e,ne.debug("[INVOICES STORE] Facture courante mise à jour avec succès",{invoice_id:e.id}))):(ne.debug("[INVOICES STORE] Facture non trouvée dans la liste, ajout",{invoice_id:e.id}),t.value.unshift(e))},v=e=>{const s=t.value.length;t.value=t.value.filter(t=>t.id!==e),t.value.length<s&&ne.info("[INVOICES STORE] Facture supprimée avec succès en temps réel",{invoice_id:e})};return{invoices:t,currentInvoice:a,loading:i,error:n,realtimeInitialized:r,lastEventTimestamp:o,lastRealtimeEvent:l,getInvoiceById:c,getInvoicesByStatus:u,fetchInvoices:async()=>{var e,s;i.value=!0,n.value=null;try{const e=await _e.routes.admin.invoice.list();return t.value=e.data.invoices,e.data.invoices}catch(a){ne.error("[INVOICES STORE] Erreur lors du chargement des factures",{error:a}),n.value=(null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.message)||"Erreur lors du chargement des factures";return He().addNotification({title:"Erreur",message:n.value||"Erreur lors du chargement des factures",type:"error"}),[]}finally{i.value=!1}},fetchInvoice:async e=>{var t,s;if(!e)return null;i.value=!0,n.value=null;try{const t=(await _e.routes.admin.invoice.get(e.toString())).data.invoice;t&&(a.value=t)}catch(r){ne.error(`[INVOICES STORE] Erreur lors du chargement de la facture ${e}`,{error:r}),n.value=(null==(s=null==(t=r.response)?void 0:t.data)?void 0:s.message)||`Erreur lors du chargement de la facture ${e}`;return He().addNotification({title:"Erreur",message:n.value||`Erreur lors du chargement de la facture ${e}`,type:"error"}),null}finally{i.value=!1}},createInvoice:async e=>{var s,a;i.value=!0,n.value=null;const r=He();try{const s=(await _e.routes.admin.invoice.create(e)).data.invoice;return t.value.unshift(s),r.addNotification({title:"Succès",message:"Facture créée avec succès",type:"success"}),s}catch(o){return ne.error("[INVOICES STORE] Erreur lors de la création de la facture",{error:o}),n.value=(null==(a=null==(s=o.response)?void 0:s.data)?void 0:a.message)||"Erreur lors de la création de la facture",r.addNotification({title:"Erreur",message:n.value||"Erreur lors de la création de la facture",type:"error"}),null}finally{i.value=!1}},updateInvoice:async(e,s)=>{var r,o;let l,c;if(i.value=!0,n.value=null,s)l=e,c=s;else{const t=e;l=t.id,c={...t},delete c.id}try{const e=await _e.routes.admin.invoice.update(l.toString(),c),s=t.value.findIndex(e=>e.id===l);-1!==s&&(t.value[s]=e.data.invoice),a.value&&a.value.id===l&&(a.value=e.data.invoice);return He().addNotification({title:"Succès",message:"Facture mise à jour avec succès",type:"success"}),e.data.invoice}catch(u){ne.error(`[INVOICES STORE] Erreur lors de la mise à jour de la facture ${e}`,{error:u}),n.value=(null==(o=null==(r=u.response)?void 0:r.data)?void 0:o.message)||`Erreur lors de la mise à jour de la facture ${l}`;return He().addNotification({title:"Erreur",message:n.value||`Erreur lors de la mise à jour de la facture ${l}`,type:"error"}),null}finally{i.value=!1}},deleteInvoice:async e=>{var s,a;i.value=!0,n.value=null;const r=He();try{return await _e.routes.admin.invoice.delete(e.toString()),t.value=t.value.filter(t=>t.id!==e),r.addNotification({title:"Succès",message:"Facture supprimée avec succès",type:"success"}),!0}catch(o){return ne.error(`[INVOICES STORE] Erreur lors de la suppression de la facture ${e}`,{error:o}),n.value=(null==(a=null==(s=o.response)?void 0:s.data)?void 0:a.message)||`Erreur lors de la suppression de la facture ${e}`,r.addNotification({title:"Erreur",message:n.value||`Erreur lors de la suppression de la facture ${e}`,type:"error"}),!1}finally{i.value=!1}},markAsPaid:async(e,s={})=>{var r,o;i.value=!0,n.value=null;try{const i=await _e.routes.admin.invoice.markAsPaid(e.toString(),s),n=t.value.findIndex(t=>t.id===e);-1!==n&&(t.value[n]=i.data.invoice,ne.info("[INVOICES STORE] Facture marquée comme payée",{invoice_id:e}));He().addNotification({title:"Succès",message:"Facture marquée comme payée",type:"success"}),a.value&&a.value.id===e&&(a.value=i.data.invoice);return He().addNotification({title:"Succès",message:"Facture marquée comme payée",type:"success"}),i.data.invoice}catch(l){ne.error(`[INVOICES STORE] Erreur lors du marquage de la facture ${e} comme payée`,{error:l}),n.value=(null==(o=null==(r=l.response)?void 0:r.data)?void 0:o.message)||`Erreur lors du marquage de la facture ${e} comme payée`;return He().addNotification({title:"Erreur",message:n.value||`Erreur lors du marquage de la facture ${e} comme payée`,type:"error"}),null}finally{i.value=!1}},initRealtimeListeners:()=>{if(r.value)ne.info("[INVOICES STORE] Les écouteurs temps réel sont déjà initialisés");else{ne.info("[INVOICES STORE] Initialisation des écouteurs temps réel pour les factures");try{qe("invoice-update",e=>{d(e)}),r.value=!0,ne.info("[INVOICES STORE] Écouteurs temps réel initialisés avec succès pour les factures")}catch(e){ne.error("[INVOICES STORE] Erreur lors de l'initialisation des écouteurs temps réel",{error:e})}}},handleRealtimeInvoiceUpdate:d,handleInvoiceCreate:p,handleInvoiceUpdate:m,handleInvoiceDelete:v}}),xv={class:"invoices-view view-container"},Ov={class:"header-box"},Pv={class:"page-title"},Nv={class:"page-description"},Mv={class:"filter-box"},Dv={class:"filter-grid"},Lv={class:"filter-group"},Uv={class:"filter-label"},qv={class:"filter-input-wrapper"},Vv=["placeholder"],$v={class:"filter-group"},jv={class:"filter-label"},Fv={class:"filter-input-wrapper"},Gv={value:""},Bv={value:"paid"},Hv={value:"unpaid"},Wv={value:"overdue"},zv={value:"cancelled"},Kv={class:"filter-group"},Jv={class:"filter-label"},Yv={class:"filter-input-wrapper"},Xv={value:""},Qv={value:"this_month"},Zv={value:"last_month"},eh={value:"this_year"},th={key:0,class:"loading-state box"},sh={key:1,class:"empty-state box"},ah={class:"empty-title"},ih={class:"empty-description"},nh={key:2,class:"table-box"},rh={class:"data-table"},oh=["onClick"],lh={class:"actions"},ch={class:"action-buttons"},uh=["title","onClick"],dh=["title","onClick"],ph=["title","onClick"],mh={key:3,class:"pagination"},vh=["onClick"],hh=r({__name:"InvoicesView",setup(t){const{t:n}=b(),r=T(),E=Rv(),C=e(""),I=e(""),R=e(""),x=e(1),O=e(10);a([C,I,R],()=>{x.value=1});const P=s(()=>{let e=[...E.invoices].map(e=>({...e,date:e.created_at,invoice_date:e.created_at}));if(I.value&&(e=e.filter(e=>e.status===I.value)),C.value){const t=C.value.toLowerCase();e=e.filter(e=>{var s,a;return(null==(s=e.client_name)?void 0:s.toLowerCase().includes(t))||(null==(a=e.product_name)?void 0:a.toLowerCase().includes(t))||e.id.toString().includes(t)})}if("current_month"===R.value){const t=new Date,s=t.getMonth(),a=t.getFullYear();e=e.filter(e=>{const t=new Date(e.created_at);return t.getMonth()===s&&t.getFullYear()===a})}else if("previous_month"===R.value){const t=new Date;let s=t.getMonth()-1,a=t.getFullYear();s<0&&(s=11,a--),e=e.filter(e=>{const t=new Date(e.created_at);return t.getMonth()===s&&t.getFullYear()===a})}else if("current_year"===R.value){const t=(new Date).getFullYear();e=e.filter(e=>new Date(e.created_at).getFullYear()===t)}return e.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),e}),N=s(()=>Math.ceil(P.value.length/O.value)),M=s(()=>{const e=(x.value-1)*O.value,t=e+O.value;return P.value.slice(e,t)}),D=async()=>{try{await E.fetchInvoices()}catch(e){ne.error("[InvoicesView] Erreur lors du chargement des factures",{error:e})}},L=e=>{r.push({name:"invoice-details",params:{id:e.toString()}})},U=e=>{if(!e)return"";return new Date(e).toLocaleDateString("fr-FR")};return a(()=>E.lastRealtimeEvent,e=>{var t;e&&ne.info("[INVOICES-VIEW] Événement temps réel reçu pour les factures",{action:e.action,invoice_id:null==(t=e.invoice)?void 0:t.id})},{deep:!0}),i(async()=>{await D(),ne.info("[INVOICES-VIEW] Initialisation des écouteurs temps réel"),E.initRealtimeListeners()}),(e,t)=>{const s=m("router-link");return g(),o("div",xv,[l("div",Ov,[l("div",null,[l("h1",Pv,c(e.$t("invoices.title")),1),l("span",Nv,c(e.$t("invoices.description")),1)]),u(s,{to:"/invoices/create",class:"btn btn-gradient"},{default:p(()=>[t[3]||(t[3]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(e.$t("invoices.actions.add")),1)]),_:1,__:[3]})]),l("div",Mv,[l("div",Dv,[l("div",Lv,[l("label",Uv,c(e.$t("invoices.filters.search")),1),l("div",qv,[t[4]||(t[4]=l("i",{class:"fas fa-search"},null,-1)),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>C.value=e),type:"text",class:"filter-input",placeholder:e.$t("invoices.search.placeholder")},null,8,Vv),[[S,C.value]])])]),l("div",$v,[l("label",jv,c(e.$t("invoices.filters.status")),1),l("div",Fv,[t[5]||(t[5]=l("i",{class:"fas fa-file-invoice-dollar"},null,-1)),w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>I.value=e),class:"filter-input"},[l("option",Gv,c(e.$t("invoices.status.all")),1),l("option",Bv,c(e.$t("invoices.status.paid")),1),l("option",Hv,c(e.$t("invoices.status.unpaid")),1),l("option",Wv,c(e.$t("invoices.status.overdue")),1),l("option",zv,c(e.$t("invoices.status.cancelled")),1)],512),[[A,I.value]])])]),l("div",Kv,[l("label",Jv,c(e.$t("invoices.filters.date_range")),1),l("div",Yv,[t[6]||(t[6]=l("i",{class:"fas fa-calendar"},null,-1)),w(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>R.value=e),class:"filter-input"},[l("option",Xv,c(e.$t("invoices.filters.all_time")),1),l("option",Qv,c(e.$t("invoices.filters.this_month")),1),l("option",Zv,c(e.$t("invoices.filters.last_month")),1),l("option",eh,c(e.$t("invoices.filters.this_year")),1)],512),[[A,R.value]])])])])]),_(E).loading?(g(),o("div",th,[t[7]||(t[7]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(n)("common.loading")),1)])):0===P.value.length?(g(),o("div",sh,[t[8]||(t[8]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-file-invoice-dollar"})],-1)),l("h3",ah,c(_(n)("invoices.empty.title")),1),l("p",ih,c(_(n)("invoices.empty.description")),1)])):(g(),o("div",nh,[l("table",rh,[l("thead",null,[l("tr",null,[t[9]||(t[9]=l("th",null,"ID",-1)),l("th",null,c(_(n)("invoices.table.client")),1),l("th",null,c(_(n)("invoices.table.service")),1),l("th",null,c(_(n)("invoices.table.date")),1),l("th",null,c(_(n)("invoices.table.due_date")),1),l("th",null,c(_(n)("invoices.table.amount")),1),l("th",null,c(_(n)("invoices.table.status")),1),l("th",null,c(_(n)("invoices.table.actions")),1)])]),l("tbody",null,[(g(!0),o(h,null,f(M.value,e=>{return g(),o("tr",{key:e.id,onClick:t=>L(e.id)},[l("td",null,"#"+c(e.id),1),l("td",null,c(e.client_name),1),l("td",null,c(e.service_name||"-"),1),l("td",null,c(U(e.date)),1),l("td",null,c(e.due_date?U(e.due_date):"-"),1),l("td",null,c((a=e.amount,new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(a))),1),l("td",null,[l("span",{class:y(`status-badge status-${e.status}`)},c((s=e.status,{paid:n("invoices.status.paid"),unpaid:n("invoices.status.unpaid"),overdue:n("invoices.status.overdue"),cancelled:n("invoices.status.cancelled")}[s]||s)),3)]),l("td",lh,[l("div",ch,[l("button",{class:"btn-icon",title:_(n)("invoices.actions.view"),onClick:k(t=>L(e.id),["stop"])},t[10]||(t[10]=[l("i",{class:"fas fa-eye"},null,-1)]),8,uh),l("button",{class:"btn-icon",title:_(n)("invoices.actions.edit"),onClick:k(t=>{return s=e.id,void r.push({name:"edit-invoice",params:{id:s.toString()}});var s},["stop"])},t[11]||(t[11]=[l("i",{class:"fas fa-edit"},null,-1)]),8,dh),"paid"!==e.status?(g(),o("button",{key:0,class:"btn-icon",title:_(n)("invoices.actions.mark_paid"),onClick:k(t=>(async e=>{if(confirm(n("invoices.confirm_mark_paid")))try{await E.markAsPaid(e),await D()}catch(t){ne.error("[InvoicesView] Erreur lors du marquage comme payé",{error:t})}})(e.id),["stop"])},t[12]||(t[12]=[l("i",{class:"fas fa-credit-card"},null,-1)]),8,ph)):v("",!0)])])],8,oh);var s,a}),128))])])])),N.value>1?(g(),o("div",mh,[(g(!0),o(h,null,f(N.value,e=>(g(),o("a",{key:e,class:y(["page-link",{active:e===x.value}]),onClick:t=>(e=>{x.value=e,window.scrollTo({top:0,behavior:"smooth"})})(e)},c(e),11,vh))),128))])):v("",!0)])}}}),fh=Vt(hh,[["__scopeId","data-v-b14c2ee2"]]),gh=t("payments",{state:()=>({payments:[],currentPayment:null,loading:!1,error:null,realtimeInitialized:!1,lastUpdateTimestamp:null,lastRealtimeEvent:null}),getters:{getPaymentById:e=>t=>e.payments.find(e=>e.id===t)||null,getPaymentsByStatus:e=>t=>"all"===t?e.payments:e.payments.filter(e=>e.status===t)},actions:{async fetchPayments(){var e,t;this.loading=!0,this.error=null;try{const e=await _e.routes.admin.payment.list();e.data&&e.data.payments?this.payments=e.data.payments:this.payments=[]}catch(s){ne.error("Erreur lors du chargement des paiements",{error:s}),this.error=(null==(t=null==(e=s.response)?void 0:e.data)?void 0:t.message)||"Erreur lors du chargement des paiements";He().showNotification({title:"Erreur",message:this.error||"Une erreur est survenue",type:"error"})}finally{this.loading=!1}},async fetchPayment(e){var t,s;this.loading=!0,this.error=null;try{const t=await _e.routes.admin.payment.get(e.toString());return t.data&&t.data.payment?(this.currentPayment=t.data.payment,t.data.payment):null}catch(a){ne.error(`Erreur lors du chargement du paiement ${e}`,{error:a}),this.error=(null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.message)||`Erreur lors du chargement du paiement ${e}`;return He().showNotification({title:"Erreur",message:this.error||"Une erreur est survenue",type:"error"}),null}finally{this.loading=!1}},async createPayment(e){var t,s;this.loading=!0,this.error=null;try{const t=await _e.routes.admin.payment.create(e);if(t.data&&t.data.payment){this.payments.unshift(t.data.payment);return He().showNotification({title:"Succès",message:"Paiement créé avec succès",type:"success"}),t.data.payment}return null}catch(a){ne.error("Erreur lors de la création du paiement",{error:a}),this.error=(null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.message)||"Erreur lors de la création du paiement";return He().showNotification({title:"Erreur",message:this.error||"Une erreur est survenue",type:"error"}),null}finally{this.loading=!1}},async updatePayment(e,t){var s,a;this.loading=!0,this.error=null;try{const s=await _e.routes.admin.payment.update(e.toString(),t);if(s.data&&s.data.payment){const t=this.payments.findIndex(t=>t.id===e);-1!==t&&(this.payments[t]=s.data.payment),this.currentPayment&&this.currentPayment.id===e&&(this.currentPayment=s.data.payment);return He().showNotification({title:"Succès",message:"Paiement mis à jour avec succès",type:"success"}),s.data.payment}return null}catch(i){ne.error(`Erreur lors de la mise à jour du paiement ${e}`,{error:i}),this.error=(null==(a=null==(s=i.response)?void 0:s.data)?void 0:a.message)||`Erreur lors de la mise à jour du paiement ${e}`;return He().showNotification({title:"Erreur",message:this.error||"Une erreur est survenue",type:"error"}),null}finally{this.loading=!1}},async processRefund(e,t=""){var s,a;this.loading=!0,this.error=null;try{const s=await _e.routes.admin.payment.refund(e.toString(),t);if(s.data&&s.data.payment){const t=this.payments.findIndex(t=>t.id===e);return-1!==t&&(this.payments[t]=s.data.payment),this.currentPayment&&this.currentPayment.id===e&&(this.currentPayment=s.data.payment),He().showNotification({message:`Paiement #${e} remboursé avec succès`,type:"success",title:"Succès"}),s.data.payment}return null}catch(i){return i instanceof Error&&(this.error=(null==(a=null==(s=i.response)?void 0:s.data)?void 0:a.message)||"Erreur lors du remboursement du paiement",He().showNotification({message:this.error||"Une erreur est survenue",type:"error",title:"Erreur"})),null}finally{this.loading=!1}},async deletePayment(e){var t,s;this.loading=!0,this.error=null;try{await _e.routes.admin.payment.delete(e.toString()),this.payments=this.payments.filter(t=>t.id!==e),this.currentPayment&&this.currentPayment.id===e&&(this.currentPayment=null);return He().showNotification({title:"Succès",message:"Paiement supprimé avec succès",type:"success"}),!0}catch(a){ne.error(`Erreur lors de la suppression du paiement ${e}`,{error:a}),this.error=(null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.message)||`Erreur lors de la suppression du paiement ${e}`;return He().showNotification({title:"Erreur",message:this.error||"Une erreur est survenue",type:"error"}),!1}finally{this.loading=!1}},async refundPayment(e,t={}){var s,a;this.loading=!0,this.error=null;try{const s=await _e.routes.admin.payment.refund(e.toString(),t.reason);if(s.data&&s.data.payment){const t=this.payments.findIndex(t=>t.id===e);-1!==t&&(this.payments[t]=s.data.payment),this.currentPayment&&this.currentPayment.id===e&&(this.currentPayment=s.data.payment);return He().showNotification({title:"Succès",message:"Remboursement traité avec succès",type:"success"}),s.data.payment}return null}catch(i){ne.error(`Erreur lors du remboursement du paiement ${e}`,{error:i}),this.error=(null==(a=null==(s=i.response)?void 0:s.data)?void 0:a.message)||`Erreur lors du remboursement du paiement ${e}`;return He().showNotification({title:"Erreur",message:this.error||"Une erreur est survenue",type:"error"}),null}finally{this.loading=!1}},initRealtimeListeners(){if(!this.realtimeInitialized)try{Oe("payments","update",e=>{this.handleRealtimePaymentUpdate(e.data)}),this.realtimeInitialized=!0,ne.info("[PAYMENTS STORE] Écouteurs temps réel initialisés")}catch(e){ne.error("[PAYMENTS STORE] Erreur lors de l'initialisation des écouteurs temps réel",{error:e})}},handleRealtimePaymentUpdate(e){var t;try{if(this.lastRealtimeEvent=e,e.timestamp&&this.lastUpdateTimestamp===e.timestamp)return void ne.info("[PAYMENTS STORE] Événement temps réel ignoré (doublon)",{eventData:e});switch(this.lastUpdateTimestamp=e.timestamp,ne.info("[PAYMENTS STORE] Événement temps réel reçu",{action:e.action,payment_id:(null==(t=e.payment)?void 0:t.id)||"unknown"}),e.action){case"create":e.payment&&this.handlePaymentCreate(e.payment);break;case"update":e.payment&&this.handlePaymentUpdate(e.payment);break;case"delete":e.payment&&this.handlePaymentDelete(e.payment);break;default:ne.warn("[PAYMENTS STORE] Type d'action inconnu",{action:e.action})}}catch(s){ne.error("[PAYMENTS STORE] Erreur lors du traitement de l'événement temps réel",{error:s})}},handlePaymentCreate(e){-1===this.payments.findIndex(t=>t.id===e.id)&&(this.payments.unshift(e),ne.info("[PAYMENTS STORE] Nouveau paiement ajouté via temps réel",{payment_id:e.id}))},handlePaymentUpdate(e){const t=this.payments.findIndex(t=>t.id===e.id);-1!==t&&(this.payments[t]=e,ne.info("[PAYMENTS STORE] Paiement mis à jour via temps réel",{payment_id:e.id})),this.currentPayment&&this.currentPayment.id===e.id&&(this.currentPayment=e,ne.info("[PAYMENTS STORE] Paiement courant mis à jour via temps réel",{payment_id:e.id}))},handlePaymentDelete(e){this.payments=this.payments.filter(t=>t.id!==e.id),this.currentPayment&&this.currentPayment.id===e.id&&(this.currentPayment=null),ne.info("[PAYMENTS STORE] Paiement supprimé via temps réel",{payment_id:e.id})}}}),yh={class:"payments-view view-container"},bh={class:"header-box"},_h={class:"page-title"},kh={class:"page-description"},wh={class:"filter-box"},Sh={class:"filter-grid"},Eh={class:"filter-group"},Ch={class:"filter-label"},Th={class:"filter-input-wrapper"},Ah=["placeholder"],Ih={class:"filter-group"},Rh={class:"filter-label"},xh={class:"filter-input-wrapper"},Oh={value:""},Ph={value:"completed"},Nh={value:"pending"},Mh={value:"failed"},Dh={value:"refunded"},Lh={class:"filter-group"},Uh={class:"filter-label"},qh={class:"filter-input-wrapper"},Vh={value:""},$h={value:"bank_transfer"},jh={value:"cash"},Fh={key:0,class:"loading-state box"},Gh={key:1,class:"empty-state box"},Bh={class:"empty-title"},Hh={class:"empty-description"},Wh={key:2,class:"table-box"},zh={class:"data-table"},Kh=["onClick"],Jh={class:"actions"},Yh={class:"action-buttons"},Xh=["title","onClick"],Qh=["title","onClick"],Zh=["title","onClick"],ef={key:3,class:"pagination"},tf=["onClick"],sf=r({__name:"PaymentsView",setup(t){const{t:n}=b(),r=T(),E=gh(),C=He(),I=e(""),R=e(""),x=e(""),O=e(1),P=e(10);a([I,R,x],()=>{O.value=1});const N=s(()=>{if(!E.payments.length)return[];let e=[...E.payments];if(I.value){const t=I.value.toLowerCase();e=e.filter(e=>String(e.id).includes(t)||e.client_name&&e.client_name.toLowerCase().includes(t)||String(e.invoice_id).includes(t)||e.transaction_id&&e.transaction_id.toLowerCase().includes(t))}return R.value&&(e=e.filter(e=>e.status===R.value)),x.value&&(e=e.filter(e=>e.payment_method===x.value)),e}),M=s(()=>N.value.length),D=s(()=>Math.ceil(M.value/P.value)),L=s(()=>{const e=(O.value-1)*P.value,t=e+P.value;return N.value.slice(e,t)}),U=async()=>{try{await E.fetchPayments()}catch(e){ne.error("[PaymentsView] Erreur lors du chargement des paiements",{error:e})}},q=e=>{r.push({name:"payment-details",params:{id:e.toString()}})},V=e=>{if(!e)return"-";return new Date(e).toLocaleDateString("fr-FR",{year:"numeric",month:"2-digit",day:"2-digit"})};return i(async()=>{await U(),ne.info("[PaymentsView] Initialisation des écouteurs temps réel"),E.initRealtimeListeners()}),(e,t)=>{const s=m("router-link");return g(),o("div",yh,[l("div",bh,[l("div",null,[l("h1",_h,c(e.$t("payments.title")),1),l("span",kh,c(e.$t("payments.description")),1)]),u(s,{to:"/payments/create",class:"btn btn-gradient"},{default:p(()=>[t[3]||(t[3]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(e.$t("payments.actions.add")),1)]),_:1,__:[3]})]),l("div",wh,[l("div",Sh,[l("div",Eh,[l("label",Ch,c(e.$t("payments.filters.search")),1),l("div",Th,[t[4]||(t[4]=l("i",{class:"fas fa-search"},null,-1)),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>I.value=e),type:"text",class:"filter-input",placeholder:e.$t("payments.search.placeholder")},null,8,Ah),[[S,I.value]])])]),l("div",Ih,[l("label",Rh,c(e.$t("payments.filters.status")),1),l("div",xh,[t[5]||(t[5]=l("i",{class:"fas fa-credit-card"},null,-1)),w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>R.value=e),class:"filter-input"},[l("option",Oh,c(e.$t("payments.status.all")),1),l("option",Ph,c(e.$t("payments.status.completed")),1),l("option",Nh,c(e.$t("payments.status.pending")),1),l("option",Mh,c(e.$t("payments.status.failed")),1),l("option",Dh,c(e.$t("payments.status.refunded")),1)],512),[[A,R.value]])])]),l("div",Lh,[l("label",Uh,c(e.$t("payments.filters.method")),1),l("div",qh,[t[8]||(t[8]=l("i",{class:"fas fa-money-bill-wave"},null,-1)),w(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>x.value=e),class:"filter-input"},[l("option",Vh,c(e.$t("payments.methods.all")),1),t[6]||(t[6]=l("option",{value:"stripe"},"Stripe",-1)),t[7]||(t[7]=l("option",{value:"paypal"},"PayPal",-1)),l("option",$h,c(e.$t("payments.methods.bank_transfer")),1),l("option",jh,c(e.$t("payments.methods.cash")),1)],512),[[A,x.value]])])])])]),_(E).loading?(g(),o("div",Fh,[t[9]||(t[9]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(n)("common.loading")),1)])):0===N.value.length?(g(),o("div",Gh,[t[10]||(t[10]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-money-bill-wave"})],-1)),l("h3",Bh,c(_(n)("payments.empty.title")),1),l("p",Hh,c(_(n)("payments.empty.description")),1)])):(g(),o("div",Wh,[l("table",zh,[l("thead",null,[l("tr",null,[t[11]||(t[11]=l("th",null,"ID",-1)),l("th",null,c(_(n)("payments.table.client")),1),l("th",null,c(_(n)("payments.table.invoice")),1),l("th",null,c(_(n)("payments.table.date")),1),l("th",null,c(_(n)("payments.table.amount")),1),l("th",null,c(_(n)("payments.table.method")),1),l("th",null,c(_(n)("payments.table.status")),1),l("th",null,c(_(n)("payments.table.actions")),1)])]),l("tbody",null,[(g(!0),o(h,null,f(L.value,e=>{return g(),o("tr",{key:e.id,onClick:t=>q(e.id)},[l("td",null,"#"+c(e.id),1),l("td",null,c(e.client_name),1),l("td",null,"#"+c(e.invoice_id),1),l("td",null,c(V(e.payment_date)),1),l("td",null,c((i=e.amount,new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(i))),1),l("td",null,c((a=e.payment_method,{stripe:"Stripe",paypal:"PayPal",bank_transfer:n("payments.methods.bank_transfer"),cash:n("payments.methods.cash")}[a]||a)),1),l("td",null,[l("span",{class:y(`status-badge status-${e.status}`)},c((s=e.status,{completed:n("payments.status.completed"),pending:n("payments.status.pending"),failed:n("payments.status.failed"),refunded:n("payments.status.refunded")}[s]||s)),3)]),l("td",Jh,[l("div",Yh,[l("button",{class:"btn-icon",title:_(n)("payments.actions.view"),onClick:k(t=>q(e.id),["stop"])},t[12]||(t[12]=[l("i",{class:"fas fa-eye"},null,-1)]),8,Xh),l("button",{class:"btn-icon",title:_(n)("payments.actions.edit"),onClick:k(t=>{return s=e.id,void r.push({name:"edit-payment",params:{id:s.toString()}});var s},["stop"])},t[13]||(t[13]=[l("i",{class:"fas fa-edit"},null,-1)]),8,Qh),"completed"===e.status?(g(),o("button",{key:0,class:"btn-icon",title:_(n)("payments.actions.refund"),onClick:k(t=>(async e=>{if(confirm(n("payments.confirm_refund")))try{await E.processRefund(e,""),C.addNotification({type:"success",message:n("payments.messages.refund_success"),title:n("common.success")}),await U()}catch(t){ne.error("[PaymentsView] Erreur lors du remboursement",{error:t})}})(e.id),["stop"])},t[14]||(t[14]=[l("i",{class:"fas fa-undo"},null,-1)]),8,Zh)):v("",!0)])])],8,Kh);var s,a,i}),128))])])])),D.value>1?(g(),o("div",ef,[(g(!0),o(h,null,f(D.value,e=>(g(),o("a",{key:e,class:y(["page-link",{active:e===O.value}]),onClick:t=>(e=>{O.value=e,window.scrollTo({top:0,behavior:"smooth"})})(e)},c(e),11,tf))),128))])):v("",!0)])}}}),af=Vt(sf,[["__scopeId","data-v-601ece97"]]),nf=t("subscriptions",{state:()=>({subscriptions:[],currentSubscription:null,loading:!1,error:null}),getters:{getSubscriptionById:e=>t=>e.subscriptions.find(e=>e.id===t)||null,getSubscriptionsByStatus:e=>t=>"all"===t?e.subscriptions:e.subscriptions.filter(e=>e.status===t),getActiveSubscriptions:e=>e.subscriptions.filter(e=>"active"===e.status),getExpiringSoonSubscriptions:e=>{const t=new Date,s=new Date;return s.setDate(t.getDate()+30),e.subscriptions.filter(e=>{if("active"!==e.status||!e.renewal_date)return!1;const a=new Date(e.renewal_date);return a>=t&&a<=s})}},actions:{async fetchSubscriptions(){var e,t;this.loading=!0,this.error=null;try{const e=await _e.routes.admin.subscription.list();e.data&&e.data.subscriptions?this.subscriptions=e.data.subscriptions:this.subscriptions=[]}catch(s){s instanceof Error?this.error=(null==(t=null==(e=s.response)?void 0:e.data)?void 0:t.message)||"Erreur lors de la récupération des abonnements":this.error="Erreur lors de la récupération des abonnements",He().addNotification({message:this.error||"Une erreur est survenue",type:"error",title:"Erreur"})}finally{this.loading=!1}},async fetchSubscriptionsByClient(e){var t,s;this.loading=!0,this.error=null;try{const t=await _e.routes.admin.subscription.getByClient(e.toString());return t.data&&t.data.subscriptions?t.data.subscriptions:[]}catch(a){return a instanceof Error?this.error=(null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.message)||"Erreur lors de la récupération des abonnements du client":this.error="Erreur lors de la récupération des abonnements du client",He().addNotification({message:this.error||"Une erreur est survenue",type:"error",title:"Erreur"}),[]}finally{this.loading=!1}},async fetchSubscriptionsByStatus(e){var t,s;this.loading=!0,this.error=null;try{const t=await _e.routes.admin.subscription.getByStatus(e);return t.data&&t.data.subscriptions?t.data.subscriptions:[]}catch(a){return a instanceof Error?this.error=(null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.message)||"Erreur lors de la récupération des abonnements":this.error="Erreur lors de la récupération des abonnements",He().addNotification({message:this.error||"Une erreur est survenue",type:"error",title:"Erreur"}),[]}finally{this.loading=!1}},async fetchSubscription(e){var t,s;this.loading=!0,this.error=null;try{const t=await _e.routes.admin.subscription.get(e.toString());return t.data&&t.data.subscription?(this.currentSubscription=t.data.subscription,t.data.subscription):null}catch(a){return a instanceof Error?this.error=(null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.message)||`Erreur lors de la récupération de l'abonnement #${e}`:this.error=`Erreur lors de la récupération de l'abonnement #${e}`,He().addNotification({message:this.error||"Une erreur est survenue",type:"error",title:"Erreur"}),null}finally{this.loading=!1}},async createSubscription(e){var t,s;this.loading=!0,this.error=null;try{const t=await _e.routes.admin.subscription.create(e);return t.data&&t.data.subscription?(this.subscriptions.unshift(t.data.subscription),He().addNotification({message:"Abonnement créé avec succès",type:"success",title:"Succès"}),t.data.subscription):null}catch(a){return a instanceof Error?this.error=(null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.message)||"Erreur lors de la création de l'abonnement":this.error="Erreur lors de la création de l'abonnement",He().addNotification({message:this.error||"Une erreur est survenue",type:"error",title:"Erreur"}),null}finally{this.loading=!1}},async updateSubscription(e,t){var s,a;this.loading=!0,this.error=null;try{const s=await _e.routes.admin.subscription.update(e.toString(),t);if(s.data&&s.data.subscription){const t=this.subscriptions.findIndex(t=>t.id===e);return-1!==t&&(this.subscriptions[t]=s.data.subscription),this.currentSubscription&&this.currentSubscription.id===e&&(this.currentSubscription=s.data.subscription),He().addNotification({message:`Abonnement #${e} mis à jour avec succès`,type:"success",title:"Succès"}),s.data.subscription}return null}catch(i){return i instanceof Error?this.error=(null==(a=null==(s=i.response)?void 0:s.data)?void 0:a.message)||"Erreur lors de la mise à jour de l'abonnement":this.error="Erreur lors de la mise à jour de l'abonnement",He().addNotification({message:this.error||"Une erreur est survenue",type:"error",title:"Erreur"}),null}finally{this.loading=!1}},async deleteSubscription(e){var t,s;this.loading=!0,this.error=null;try{return await _e.routes.admin.subscription.delete(e.toString()),this.subscriptions=this.subscriptions.filter(t=>t.id!==e),this.currentSubscription&&this.currentSubscription.id===e&&(this.currentSubscription=null),He().addNotification({message:`Abonnement #${e} supprimé avec succès`,type:"success",title:"Succès"}),!0}catch(a){return a instanceof Error?this.error=(null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.message)||"Erreur lors de la suppression de l'abonnement":this.error="Erreur lors de la suppression de l'abonnement",He().addNotification({message:this.error||"Une erreur est survenue",type:"error",title:"Erreur"}),!1}finally{this.loading=!1}},async cancelSubscription(e,t=""){var s,a;this.loading=!0,this.error=null;try{const s=await _e.routes.admin.subscription.cancel(e.toString(),t);if(s.data&&s.data.subscription){const t=this.subscriptions.findIndex(t=>t.id===e);return-1!==t&&(this.subscriptions[t]=s.data.subscription),this.currentSubscription&&this.currentSubscription.id===e&&(this.currentSubscription=s.data.subscription),He().addNotification({message:`Abonnement #${e} annulé avec succès`,type:"success",title:"Succès"}),s.data.subscription}return null}catch(i){return i instanceof Error?this.error=(null==(a=null==(s=i.response)?void 0:s.data)?void 0:a.message)||"Erreur lors de l'annulation de l'abonnement":this.error="Erreur lors de l'annulation de l'abonnement",He().addNotification({message:this.error||"Une erreur est survenue",type:"error",title:"Erreur"}),null}finally{this.loading=!1}},async renewSubscription(e){var t,s;this.loading=!0,this.error=null;try{const t=await _e.routes.admin.subscription.renew(e.toString());if(t.data&&t.data.subscription){const s=this.subscriptions.findIndex(t=>t.id===e);return-1!==s&&(this.subscriptions[s]=t.data.subscription),this.currentSubscription&&this.currentSubscription.id===e&&(this.currentSubscription=t.data.subscription),He().addNotification({message:`Abonnement #${e} renouvelé avec succès.`,type:"success",title:"Succès"}),t.data.subscription}return null}catch(a){return a instanceof Error?this.error=(null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.message)||"Erreur lors du renouvellement de l'abonnement":this.error="Erreur lors du renouvellement de l'abonnement",He().addNotification({message:this.error||"Une erreur est survenue",type:"error",title:"Erreur"}),null}finally{this.loading=!1}}}}),rf={class:"subscriptions-view view-container"},of={class:"header-box"},lf={class:"page-title"},cf={class:"page-description"},uf={class:"filter-box"},df={class:"filter-grid"},pf={class:"filter-group"},mf={class:"filter-label"},vf={class:"filter-input-wrapper"},hf=["placeholder"],ff={class:"filter-group"},gf={class:"filter-label"},yf={class:"filter-input-wrapper"},bf={value:""},_f={value:"active"},kf={value:"pending"},wf={value:"cancelled"},Sf={value:"expired"},Ef={class:"filter-group"},Cf={class:"filter-label"},Tf={class:"filter-input-wrapper"},Af={value:""},If={value:"monthly"},Rf={value:"quarterly"},xf={value:"semi_annual"},Of={value:"annual"},Pf={key:0,class:"loading-state box"},Nf={key:1,class:"empty-state box"},Mf={class:"empty-title"},Df={class:"empty-description"},Lf={key:2,class:"table-box"},Uf={class:"data-table"},qf=["onClick"],Vf={class:"actions"},$f={class:"action-buttons"},jf=["title","onClick"],Ff=["title","onClick"],Gf=["title","onClick"],Bf=["title","onClick"],Hf={key:3,class:"pagination"},Wf=["onClick"],zf=r({__name:"SubscriptionsView",setup(t){const{t:n}=b(),r=T(),E=nf(),C=e(""),I=e(""),R=e(""),x=e(1),O=e(10);a([C,I,R],()=>{x.value=1});const P=s(()=>{if(!E.subscriptions.length)return[];let e=[...E.subscriptions];if(C.value){const t=C.value.toLowerCase();e=e.filter(e=>String(e.id).includes(t)||e.client_name&&e.client_name.toLowerCase().includes(t)||e.product_name&&e.product_name.toLowerCase().includes(t))}return I.value&&(e=e.filter(e=>e.status===I.value)),R.value&&(e=e.filter(e=>e.billing_cycle===R.value)),e}),N=s(()=>Math.ceil(P.value.length/O.value)),M=s(()=>{const e=(x.value-1)*O.value,t=e+O.value;return P.value.slice(e,t)}),D=async()=>{try{await E.fetchSubscriptions()}catch(e){ne.error("[SubscriptionsView] Erreur lors du chargement des abonnements",{error:e})}},L=e=>{r.push({name:"subscription-details",params:{id:e.toString()}})},U=e=>{if(!e)return"";return new Date(e).toLocaleDateString("fr-FR")};return i(async()=>{await D()}),(e,t)=>{const s=m("router-link");return g(),o("div",rf,[l("div",of,[l("div",null,[l("h1",lf,c(e.$t("subscriptions.title")),1),l("span",cf,c(e.$t("subscriptions.description")),1)]),u(s,{to:"/subscriptions/create",class:"btn btn-gradient"},{default:p(()=>[t[3]||(t[3]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(e.$t("subscriptions.actions.add")),1)]),_:1,__:[3]})]),l("div",uf,[l("div",df,[l("div",pf,[l("label",mf,c(e.$t("subscriptions.filters.search")),1),l("div",vf,[t[4]||(t[4]=l("i",{class:"fas fa-search"},null,-1)),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>C.value=e),type:"text",class:"filter-input",placeholder:e.$t("subscriptions.search.placeholder")},null,8,hf),[[S,C.value]])])]),l("div",ff,[l("label",gf,c(e.$t("subscriptions.filters.status")),1),l("div",yf,[t[5]||(t[5]=l("i",{class:"fas fa-sync-alt"},null,-1)),w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>I.value=e),class:"filter-input"},[l("option",bf,c(e.$t("subscriptions.status.all")),1),l("option",_f,c(e.$t("subscriptions.status.active")),1),l("option",kf,c(e.$t("subscriptions.status.pending")),1),l("option",wf,c(e.$t("subscriptions.status.cancelled")),1),l("option",Sf,c(e.$t("subscriptions.status.expired")),1)],512),[[A,I.value]])])]),l("div",Ef,[l("label",Cf,c(e.$t("subscriptions.filters.billing_cycle")),1),l("div",Tf,[t[6]||(t[6]=l("i",{class:"fas fa-calendar-alt"},null,-1)),w(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>R.value=e),class:"filter-input"},[l("option",Af,c(e.$t("subscriptions.filters.all_cycles")),1),l("option",If,c(e.$t("subscriptions.cycles.monthly")),1),l("option",Rf,c(e.$t("subscriptions.cycles.quarterly")),1),l("option",xf,c(e.$t("subscriptions.cycles.semi_annual")),1),l("option",Of,c(e.$t("subscriptions.cycles.annual")),1)],512),[[A,R.value]])])])])]),_(E).loading?(g(),o("div",Pf,[t[7]||(t[7]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(n)("common.loading")),1)])):0===P.value.length?(g(),o("div",Nf,[t[8]||(t[8]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-calendar-alt"})],-1)),l("h3",Mf,c(_(n)("subscriptions.empty.title")),1),l("p",Df,c(_(n)("subscriptions.empty.description")),1)])):(g(),o("div",Lf,[l("table",Uf,[l("thead",null,[l("tr",null,[t[9]||(t[9]=l("th",null,"ID",-1)),l("th",null,c(_(n)("subscriptions.table.client")),1),l("th",null,c(_(n)("subscriptions.table.product")),1),l("th",null,c(_(n)("subscriptions.table.start_date")),1),l("th",null,c(_(n)("subscriptions.table.renewal_date")),1),l("th",null,c(_(n)("subscriptions.table.price")),1),l("th",null,c(_(n)("subscriptions.table.cycle")),1),l("th",null,c(_(n)("subscriptions.table.status")),1),l("th",null,c(_(n)("subscriptions.table.actions")),1)])]),l("tbody",null,[(g(!0),o(h,null,f(M.value,e=>{return g(),o("tr",{key:e.id||"new",onClick:t=>e.id&&L(e.id)},[l("td",null,"#"+c(e.id),1),l("td",null,c(e.client_name),1),l("td",null,c(e.product_name),1),l("td",null,c(U(e.start_date)),1),l("td",null,c(e.renewal_date?U(e.renewal_date):"-"),1),l("td",null,c((i=e.price,new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(i))),1),l("td",null,c((a=e.billing_cycle,{monthly:n("subscriptions.cycles.monthly"),quarterly:n("subscriptions.cycles.quarterly"),semi_annual:n("subscriptions.cycles.semi_annual"),annual:n("subscriptions.cycles.annual")}[a]||a)),1),l("td",null,[l("span",{class:y(`status-badge status-${e.status}`)},c((s=e.status,{active:n("subscriptions.status.active"),pending:n("subscriptions.status.pending"),cancelled:n("subscriptions.status.cancelled"),expired:n("subscriptions.status.expired")}[s]||s)),3)]),l("td",Vf,[l("div",$f,[l("button",{class:"btn-icon",title:_(n)("subscriptions.actions.view"),onClick:k(t=>e.id&&L(e.id),["stop"])},t[10]||(t[10]=[l("i",{class:"fas fa-eye"},null,-1)]),8,jf),l("button",{class:"btn-icon",title:_(n)("subscriptions.actions.edit"),onClick:k(t=>{return e.id&&(s=e.id,void r.push({name:"edit-subscription",params:{id:s.toString()}}));var s},["stop"])},t[11]||(t[11]=[l("i",{class:"fas fa-edit"},null,-1)]),8,Ff),"active"===e.status?(g(),o("button",{key:0,class:"btn-icon",title:_(n)("subscriptions.actions.cancel"),onClick:k(t=>e.id&&(async e=>{if(confirm(n("subscriptions.confirm_cancel")))try{await E.cancelSubscription(e),await D()}catch(t){ne.error("[SubscriptionsView] Erreur lors de l'annulation",{error:t})}})(e.id),["stop"])},t[12]||(t[12]=[l("i",{class:"fas fa-ban"},null,-1)]),8,Gf)):v("",!0),"active"!==e.status?(g(),o("button",{key:1,class:"btn-icon",title:_(n)("subscriptions.actions.renew"),onClick:k(t=>e.id&&(async e=>{try{await E.renewSubscription(e),await D()}catch(t){ne.error("[SubscriptionsView] Erreur lors du renouvellement",{error:t})}})(e.id),["stop"])},t[13]||(t[13]=[l("i",{class:"fas fa-sync"},null,-1)]),8,Bf)):v("",!0)])])],8,qf);var s,a,i}),128))])])])),N.value>1?(g(),o("div",Hf,[(g(!0),o(h,null,f(N.value,e=>(g(),o("a",{key:e,class:y(["page-link",{active:e===x.value}]),onClick:t=>(e=>{x.value=e,window.scrollTo({top:0,behavior:"smooth"})})(e)},c(e),11,Wf))),128))])):v("",!0)])}}}),Kf=Vt(zf,[["__scopeId","data-v-e33cd36c"]]),Jf=t("tickets",()=>{const t=e([]),a=e(!1),i=e(null),n=e(!1),r=e(null),o=e(null),l=e(null),c=s(()=>t.value),u=s(()=>t.value.filter(e=>"open"===e.status)),d=s(()=>t.value.filter(e=>"urgent"===e.priority)),p=s(()=>t.value.filter(e=>"assigned"!==e.status&&!("assigned_to"in e))),m=e=>{try{if(o.value===e.timestamp)return void ne.debug("[TICKETS STORE] Événement déjà traité, ignoré",{timestamp:e.timestamp});o.value=e.timestamp,l.value={...e};const t=e.ticket;if(!t||!t.id)return void ne.error("[TICKETS STORE] Données de ticket invalides dans l'event temps réel",{eventData:e});switch(ne.info("[TICKETS STORE] Événement reçu pour le ticket",{ticketId:t.id,action:e.action}),e.action){case"create":v(t);break;case"update":h(t);break;case"delete":f(t);break;default:ne.warn("[TICKETS STORE] Action temps réel inconnue",{action:e.action})}}catch(t){ne.error("[TICKETS STORE] Erreur lors du traitement de l'event temps réel",{error:t})}},v=e=>{try{ne.info("[TICKETS STORE] Ajout d'un nouveau ticket via temps réel",{ticketId:e.id});const s=t.value.findIndex(t=>t.id===e.id);-1===s?(t.value.unshift(e),ne.debug("[TICKETS STORE] Ticket ajouté avec succès à la liste")):(ne.debug("[TICKETS STORE] Le ticket existe déjà dans la liste, mise à jour appliquée"),t.value[s]=e)}catch(s){ne.error("[TICKETS STORE] Erreur lors du traitement de la création de ticket en temps réel",{error:s})}},h=e=>{try{ne.info("[TICKETS STORE] Mise à jour d'un ticket via temps réel",{ticketId:e.id});const s=t.value.findIndex(t=>t.id===e.id);-1!==s&&(t.value[s]=e,ne.debug("[TICKETS STORE] Ticket mis à jour dans la liste")),r.value&&r.value.id===e.id&&(r.value={...e},ne.debug("[TICKETS STORE] Ticket courant mis à jour avec une nouvelle référence"))}catch(s){ne.error("[TICKETS STORE] Erreur lors du traitement de la mise à jour de ticket en temps réel",{error:s})}},f=e=>{try{ne.info("[TICKETS STORE] Suppression d'un ticket via temps réel",{ticketId:e.id}),t.value=t.value.filter(t=>t.id!==e.id),ne.debug("[TICKETS STORE] Ticket supprimé de la liste"),r.value&&r.value.id===e.id&&(r.value=null,ne.debug("[TICKETS STORE] Ticket courant réinitialisé car supprimé"))}catch(s){ne.error("[TICKETS STORE] Erreur lors du traitement de la suppression de ticket en temps réel",{error:s})}};return{tickets:t,loading:a,error:i,realtimeInitialized:n,currentTicket:r,lastEventTimestamp:o,lastRealtimeEvent:l,allTickets:c,openTickets:u,urgentTickets:d,unassignedTickets:p,fetchTickets:async(e={})=>{var s,i;try{a.value=!0,ne.debug("[TICKETS STORE] Récupération des tickets avec filtres",{params:e});const s=await _e.routes.admin.ticket.list(e);return s.data&&s.data.tickets?t.value=s.data.tickets:s.data&&s.data.data&&s.data.data.tickets?t.value=s.data.data.tickets:t.value=[],ne.debug("[TICKETS STORE] Récupération terminée",{count:t.value.length}),t.value}catch(n){const e=(null==(i=null==(s=n.response)?void 0:s.data)?void 0:i.message)||"Erreur inconnue lors de la récupération des tickets";return n.value=e,ne.error("[TICKETS STORE] Erreur lors de la récupération des tickets",{error:n.value}),He().addNotification({message:e,type:"error",title:"Erreur"}),[]}finally{a.value=!1}},getTicket:async(e,t=1,s=7)=>{var i,n;try{a.value=!0,ne.debug(`[TICKETS STORE] Récupération du ticket #${e} (page ${t})`);const i=await _e.routes.admin.ticket.get(String(e),{page:t,per_page:s});if(i.data&&i.data.ticket){const e=i.data.ticket;return e.replies=(i.data.replies||[]).map(e=>({...e,author_name:e.user_name,is_staff:"admin"===e.user_type})),e.pagination=i.data.pagination||null,r.value=e,e}return null}catch(o){const t=(null==(n=null==(i=o.response)?void 0:i.data)?void 0:n.message)||`Erreur lors de la récupération du ticket #${e}`;return o.value=t,ne.error(`[TICKETS STORE] Erreur lors de la récupération du ticket #${e}`,{error:o.value}),He().addNotification({message:t,type:"error",title:"Erreur"}),null}finally{a.value=!1}},createTicket:async e=>{var s,i;try{a.value=!0,ne.debug("[TICKETS STORE] Création d'un nouveau ticket",{ticket:e});const s=await _e.routes.admin.ticket.create(e);return s.data&&s.data.ticket?(t.value.push(s.data.ticket),He().addNotification({message:"Le ticket a été créé avec succès",type:"success",title:"Succès"}),s.data.ticket):null}catch(n){const t=(null==(i=null==(s=n.response)?void 0:s.data)?void 0:i.message)||"Erreur lors de la création du ticket";return n.value=t,ne.error("[TICKETS STORE] Erreur lors de la création du ticket",{error:n.value,ticket:e}),He().addNotification({message:t,type:"error",title:"Erreur"}),null}finally{a.value=!1}},updateTicket:async(e,s)=>{var i,n;try{a.value=!0,ne.debug(`[TICKETS STORE] Mise à jour du ticket #${e}`,{ticket:s});const i=await _e.routes.admin.ticket.update(String(e),s);if(i.data&&i.data.ticket){const s=t.value.findIndex(t=>t.id===e);return-1!==s&&(t.value[s]=i.data.ticket),r.value&&r.value.id===e&&(r.value=i.data.ticket),He().addNotification({message:"Le ticket a été mis à jour avec succès",type:"success",title:"Succès"}),i.data.ticket}return null}catch(o){const t=(null==(n=null==(i=o.response)?void 0:i.data)?void 0:n.message)||`Erreur lors de la mise à jour du ticket #${e}`;return o.value=t,ne.error(`[TICKETS STORE] Erreur lors de la mise à jour du ticket #${e}`,{error:o.value,ticket:s}),He().addNotification({message:t,type:"error",title:"Erreur"}),null}finally{a.value=!1}},deleteTicket:async e=>{var s,i;try{return a.value=!0,ne.debug(`[TICKETS STORE] Suppression du ticket #${e}`),await _e.routes.admin.ticket.delete(String(e)),t.value=t.value.filter(t=>t.id!==e),r.value&&r.value.id===e&&(r.value=null),He().addNotification({message:"Le ticket a été supprimé avec succès",type:"success",title:"Succès"}),!0}catch(n){const t=(null==(i=null==(s=n.response)?void 0:s.data)?void 0:i.message)||`Erreur lors de la suppression du ticket #${e}`;return n.value=t,ne.error(`[TICKETS STORE] Erreur lors de la suppression du ticket #${e}`,{error:n.value}),He().addNotification({message:t,type:"error",title:"Erreur"}),!1}finally{a.value=!1}},addReply:async(e,t)=>{var s,i,n,o,l,c,u,d,p,m,v,h;try{a.value=!0,ne.debug(`[TICKETS STORE] Préparation ajout réponse ticket #${e}`,{ticketId:e,replyData:t,replyDataType:typeof t,replyDataKeys:Object.keys(t),messageLength:(null==(s=t.message)?void 0:s.length)||0});const n=await _e.routes.admin.ticket.addReply(String(e),t);if(ne.debug("[TICKETS STORE] Réponse API reçue",{ticketId:e,status:n.status,statusText:n.statusText,headers:n.headers,data:n.data,hasData:!!n.data,hasReply:!(!n.data||!n.data.reply),dataKeys:n.data?Object.keys(n.data):[],replyData:(null==(i=n.data)?void 0:i.reply)||"ABSENT"}),n.data&&n.data.reply){if(r.value){r.value.replies||(r.value.replies=[]);const t={...n.data.reply,author_name:n.data.reply.author_name||n.data.reply.user_name,is_staff:"admin"===n.data.reply.user_type};r.value.replies.unshift(t),ne.info("[TICKETS STORE] Réponse ajoutée à la liste locale pour affichage immédiat (ordre DESC)",{ticketId:e,replyId:n.data.reply.id,totalReplies:r.value.replies.length,currentTicketStructure:Object.keys(r.value),insertionMethod:"unshift (début de liste pour ordre DESC)"})}else ne.warn("[TICKETS STORE] currentTicket.value est null, impossible d'ajouter la réponse localement",{ticketId:e,hasCurrentTicket:!!r.value});return He().addNotification({message:"Votre réponse a été ajoutée avec succès",type:"success",title:"Succès"}),n.data.reply}return ne.warn("[TICKETS STORE] response.data.reply manquant dans la réponse API",{ticketId:e,hasData:!!n.data,dataKeys:n.data?Object.keys(n.data):[],fullResponse:n.data}),null}catch(f){ne.error(`[TICKETS STORE] Erreur détaillée ajout réponse ticket #${e}`,{ticketId:e,replyData:t,error:{message:f.message,status:null==(n=f.response)?void 0:n.status,statusText:null==(o=f.response)?void 0:o.statusText,data:null==(l=f.response)?void 0:l.data,headers:null==(c=f.response)?void 0:c.headers,config:{url:null==(u=f.config)?void 0:u.url,method:null==(d=f.config)?void 0:d.method,data:null==(p=f.config)?void 0:p.data,headers:null==(m=f.config)?void 0:m.headers}}});const s=(null==(h=null==(v=f.response)?void 0:v.data)?void 0:h.message)||`Erreur lors de l'ajout d'une réponse au ticket #${e}`;return f.value=s,He().addNotification({message:s,type:"error",title:"Erreur"}),null}finally{a.value=!1}},closeTicket:async e=>{var s,i;try{a.value=!0,ne.debug(`[TICKETS STORE] Fermeture du ticket #${e}`);const s=await _e.routes.admin.ticket.close(String(e));if(s.data&&s.data.ticket){const a=t.value.findIndex(t=>t.id===e);return-1!==a&&(t.value[a]=s.data.ticket),r.value&&r.value.id===e&&(r.value=s.data.ticket),He().addNotification({message:"Le ticket a été fermé avec succès",type:"success",title:"Succès"}),s.data.ticket}return null}catch(n){const t=(null==(i=null==(s=n.response)?void 0:s.data)?void 0:i.message)||`Erreur lors de la fermeture du ticket #${e}`;return n.value=t,ne.error(`[TICKETS STORE] Erreur lors de la fermeture du ticket #${e}`,{error:n.value}),He().addNotification({message:t,type:"error",title:"Erreur"}),null}finally{a.value=!1}},reopenTicket:async e=>{var s,i;try{a.value=!0,ne.debug(`[TICKETS STORE] Réouverture du ticket #${e}`);const s=await _e.routes.admin.ticket.reopen(String(e));if(s.data&&s.data.ticket){const a=t.value.findIndex(t=>t.id===e);return-1!==a&&(t.value[a]=s.data.ticket),r.value&&r.value.id===e&&(r.value=s.data.ticket),He().addNotification({message:"Le ticket a été rouvert avec succès",type:"success",title:"Succès"}),s.data.ticket}return null}catch(n){const t=(null==(i=null==(s=n.response)?void 0:s.data)?void 0:i.message)||`Erreur lors de la réouverture du ticket #${e}`;return n.value=t,ne.error(`[TICKETS STORE] Erreur lors de la réouverture du ticket #${e}`,{error:n.value}),He().addNotification({message:t,type:"error",title:"Erreur"}),null}finally{a.value=!1}},initRealtimeListeners:()=>{if(!n.value){ne.info("[TICKETS STORE] Initialisation des écouteurs temps réel");try{qe("ticket-update",e=>{ne.debug("[TICKETS STORE] Événement ticket-update reçu",{action:null==e?void 0:e.action}),m(e)}),n.value=!0,ne.info("[TICKETS STORE] Écouteurs temps réel initialisés avec succès")}catch(e){ne.error("[TICKETS STORE] Erreur lors de l'initialisation des écouteurs temps réel",{error:e})}}},handleRealtimeTicketUpdate:m,handleTicketCreate:v,handleTicketUpdate:h,handleTicketDelete:f}}),Yf={class:"tickets-view view-container"},Xf={class:"header-box"},Qf={class:"page-title"},Zf={class:"page-description"},eg={class:"filter-box"},tg={class:"filter-grid"},sg={class:"filter-group"},ag={class:"filter-label"},ig={class:"filter-input-wrapper"},ng=["placeholder"],rg={class:"filter-group"},og={class:"filter-label"},lg={class:"filter-input-wrapper"},cg={value:""},ug={value:"open"},dg={value:"pending"},pg={value:"resolved"},mg={value:"closed"},vg={class:"filter-group"},hg={class:"filter-label"},fg={class:"filter-input-wrapper"},gg={value:""},yg={value:"low"},bg={value:"medium"},_g={value:"high"},kg={value:"urgent"},wg={class:"filter-group"},Sg={class:"filter-label"},Eg={class:"filter-input-wrapper"},Cg={value:""},Tg={value:"unassigned"},Ag=["value"],Ig={class:"filter-group"},Rg={class:"filter-label"},xg={class:"filter-input-wrapper"},Og={value:""},Pg={value:"unassigned"},Ng=["value"],Mg={class:"filter-actions"},Dg={key:0,class:"loading-state box"},Lg={key:1,class:"empty-state box"},Ug={class:"empty-title"},qg={class:"empty-description"},Vg={key:2,class:"table-box"},$g={class:"data-table"},jg=["onClick"],Fg={class:"subject-cell"},Gg={key:0,class:"department-badge"},Bg={key:1,class:"unassigned-badge"},Hg={key:0,class:"assigned-badge"},Wg={key:1,class:"unassigned-badge"},zg={class:"actions"},Kg={class:"action-buttons"},Jg=["title","onClick"],Yg=["title","onClick"],Xg=["title","onClick"],Qg=["title","onClick"],Zg=["title","onClick"],ey={key:3,class:"pagination"},ty=["onClick"],sy=r({__name:"TicketsView",setup(t){const{t:n}=b(),r=T(),E=Jf(),C=He(),I=e(!1),R=e(""),x=e(""),O=e(""),P=e(""),N=e(""),M=e(1),D=e(10),L=s(()=>E.tickets),U=e([]),q=e([]);a([R,x,O,P,N],()=>{M.value=1});const V=s(()=>{const e=R.value.toLowerCase();let t=L.value;return e&&(t=t.filter(t=>t.subject.toLowerCase().includes(e)||t.client_name.toLowerCase().includes(e)||t.id.toString().includes(e))),x.value&&(t=t.filter(e=>e.status===x.value)),O.value&&(t=t.filter(e=>e.priority===O.value)),P.value&&(t="unassigned"===P.value?t.filter(e=>!e.department_id):t.filter(e=>e.department_id===parseInt(P.value))),N.value&&(t="unassigned"===N.value?t.filter(e=>!e.assigned_to):t.filter(e=>e.assigned_to===parseInt(N.value))),O.value&&(t=t.filter(e=>e.priority===O.value)),t}),$=s(()=>Math.ceil(V.value.length/D.value)),j=s(()=>{const e=(M.value-1)*D.value,t=e+D.value;return V.value.slice(e,t)});async function F(){var e,t;I.value=!0;try{const a={};x.value&&(a.status=x.value),O.value&&(a.priority=O.value),P.value&&(a.department_id=P.value),N.value&&(a.assigned_to=N.value),await E.fetchTickets(a);const i=await _e.routes.admin.ticket.list(a);i.data?(void 0!==i.data.departments?U.value=i.data.departments||[]:i.data.data&&void 0!==i.data.data.departments?U.value=i.data.data.departments||[]:U.value=[],0===E.tickets.length?ne.info("Aucun ticket trouvé, affichage d'une liste vide",{filtres:a}):ne.info(`${E.tickets.length} tickets chargés avec succès`)):(ne.error("Aucune donnée reçue de l'API",{response:i}),U.value=[],C.showError(n("tickets.errors.unexpected_format")));try{const s=await _e.routes.admin.admins.list();q.value=(null==(e=s.data.data)?void 0:e.admins)||(null==(t=s.data)?void 0:t.admins)||[]}catch(s){ne.error("[TICKETS] Erreur lors du chargement des administrateurs",{error:s}),C.showError(n("tickets.errors.admins_load_failed"))}}catch(s){C.showError(n("tickets.errors.fetch_failed")),s.response?ne.error("Erreur API (réponse du serveur)",{status:s.response.status,statusText:s.response.statusText,data:s.response.data,headers:s.response.headers}):s.request?ne.error("Erreur API (pas de réponse)",{request:s.request}):ne.error("Erreur lors de la configuration de la requête",{message:s.message,stack:s.stack})}finally{I.value=!1}}function G(){R.value="",x.value="",O.value="",P.value="",N.value="",F()}const B=e=>{r.push({name:"ticket-details",params:{id:e.toString()}})},H=e=>{if(!e)return"-";const t=new Date(e);return new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)};return i(async()=>{await F(),E.initRealtimeListeners(),ne.info("[TicketsView] Écouteurs temps réel initialisés")}),(e,t)=>{const s=m("router-link");return g(),o("div",Yf,[l("div",Xf,[l("div",null,[l("h1",Qf,c(e.$t("tickets.title")),1),l("span",Zf,c(e.$t("tickets.description")),1)]),u(s,{to:"/tickets/create",class:"btn btn-gradient"},{default:p(()=>[t[5]||(t[5]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(e.$t("tickets.actions.add")),1)]),_:1,__:[5]})]),l("div",eg,[l("div",tg,[l("div",sg,[l("label",ag,c(e.$t("tickets.filters.search")),1),l("div",ig,[t[6]||(t[6]=l("i",{class:"fas fa-search"},null,-1)),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>R.value=e),type:"text",class:"filter-input",placeholder:e.$t("tickets.search.placeholder")},null,8,ng),[[S,R.value]])])]),l("div",rg,[l("label",og,c(e.$t("tickets.filters.status")),1),l("div",lg,[t[7]||(t[7]=l("i",{class:"fas fa-ticket-alt"},null,-1)),w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>x.value=e),class:"filter-input"},[l("option",cg,c(e.$t("tickets.status.all")),1),l("option",ug,c(e.$t("tickets.status.open")),1),l("option",dg,c(e.$t("tickets.status.pending")),1),l("option",pg,c(e.$t("tickets.status.resolved")),1),l("option",mg,c(e.$t("tickets.status.closed")),1)],512),[[A,x.value]])])]),l("div",vg,[l("label",hg,c(e.$t("tickets.filters.priority")),1),l("div",fg,[t[8]||(t[8]=l("i",{class:"fas fa-flag"},null,-1)),w(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>O.value=e),class:"filter-input"},[l("option",gg,c(e.$t("tickets.priority.all")),1),l("option",yg,c(e.$t("tickets.priority.low")),1),l("option",bg,c(e.$t("tickets.priority.medium")),1),l("option",_g,c(e.$t("tickets.priority.high")),1),l("option",kg,c(e.$t("tickets.priority.urgent")),1)],512),[[A,O.value]])])]),l("div",wg,[l("label",Sg,c(e.$t("tickets.filters.department")),1),l("div",Eg,[t[9]||(t[9]=l("i",{class:"fas fa-sitemap"},null,-1)),w(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>P.value=e),class:"filter-input"},[l("option",Cg,c(e.$t("tickets.departments.all")),1),l("option",Tg,c(e.$t("tickets.departments.unassigned")),1),(g(!0),o(h,null,f(U.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name),9,Ag))),128))],512),[[A,P.value]])])]),l("div",Ig,[l("label",Rg,c(e.$t("tickets.filters.assigned_to")),1),l("div",xg,[t[10]||(t[10]=l("i",{class:"fas fa-user-check"},null,-1)),w(l("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>N.value=e),class:"filter-input"},[l("option",Og,c(e.$t("tickets.assigned_to.all")),1),l("option",Pg,c(e.$t("tickets.assigned_to.unassigned")),1),(g(!0),o(h,null,f(q.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.username),9,Ng))),128))],512),[[A,N.value]])])])]),l("div",Mg,[l("button",{class:"btn btn-secondary",onClick:G},[t[11]||(t[11]=l("i",{class:"fas fa-undo"},null,-1)),d(" "+c(e.$t("common.reset_filters")),1)]),u(s,{to:"/ticket-departments",class:"btn btn-primary"},{default:p(()=>[t[12]||(t[12]=l("i",{class:"fas fa-cog"},null,-1)),d(" "+c(e.$t("tickets.departments.manage")),1)]),_:1,__:[12]})])]),I.value?(g(),o("div",Dg,[t[13]||(t[13]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(n)("common.loading")),1)])):0===V.value.length?(g(),o("div",Lg,[t[14]||(t[14]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-ticket-alt"})],-1)),l("h3",Ug,c(_(n)("tickets.empty.title")),1),l("p",qg,c(_(n)("tickets.empty.description")),1)])):(g(),o("div",Vg,[l("table",$g,[l("thead",null,[l("tr",null,[t[15]||(t[15]=l("th",null,"ID",-1)),l("th",null,c(_(n)("tickets.table.subject")),1),l("th",null,c(_(n)("tickets.table.client")),1),l("th",null,c(_(n)("tickets.table.department")),1),l("th",null,c(_(n)("tickets.table.assigned_to")),1),l("th",null,c(_(n)("tickets.table.priority")),1),l("th",null,c(_(n)("tickets.table.status")),1),l("th",null,c(_(n)("tickets.table.last_reply")),1),l("th",null,c(_(n)("tickets.table.created_at")),1),l("th",null,c(_(n)("tickets.table.actions")),1)])]),l("tbody",null,[(g(!0),o(h,null,f(j.value,e=>{return g(),o("tr",{key:e.id,onClick:t=>B(e.id)},[l("td",null,"#"+c(e.id),1),l("td",Fg,c(e.subject),1),l("td",null,c(e.client_name),1),l("td",null,[e.department_name?(g(),o("span",Gg,c(e.department_name),1)):(g(),o("span",Bg,c(_(n)("tickets.departments.none")),1))]),l("td",null,[e.assigned_to_name?(g(),o("span",Hg,c(e.assigned_to_name),1)):(g(),o("span",Wg,c(_(n)("tickets.assigned_to.none")),1))]),l("td",null,[l("span",{class:y(`priority-badge priority-${e.priority}`)},c((a=e.priority,n(`tickets.priority.${a}`))),3)]),l("td",null,[l("span",{class:y(`status-badge status-${e.status}`)},c((s=e.status,n(`tickets.status.${s}`))),3)]),l("td",null,c(H(e.last_reply)),1),l("td",null,c(H(e.created_at)),1),l("td",zg,[l("div",Kg,[l("button",{class:"btn-icon",title:_(n)("tickets.actions.view"),onClick:k(t=>B(e.id),["stop"])},t[16]||(t[16]=[l("i",{class:"fas fa-eye"},null,-1)]),8,Jg),l("button",{class:"btn-icon",title:_(n)("tickets.actions.edit"),onClick:k(t=>{return s=e.id,void r.push({name:"edit-ticket",params:{id:s.toString()}});var s},["stop"])},t[17]||(t[17]=[l("i",{class:"fas fa-edit"},null,-1)]),8,Yg),"closed"===e.status||"resolved"===e.status?(g(),o("button",{key:0,class:"btn-icon success-icon",title:_(n)("tickets.actions.reopen"),onClick:k(t=>(async e=>{try{await E.reopenTicket(e),await F()}catch(t){ne.error("[TicketsView] Erreur lors de la réouverture",{ticketId:e,error:t})}})(e.id),["stop"])},t[18]||(t[18]=[l("i",{class:"fas fa-unlock"},null,-1)]),8,Xg)):(g(),o("button",{key:1,class:"btn-icon warning-icon",title:_(n)("tickets.actions.close"),onClick:k(t=>(async e=>{try{await E.closeTicket(e),await F()}catch(t){ne.error("[TicketsView] Erreur lors de la fermeture",{ticketId:e,error:t})}})(e.id),["stop"])},t[19]||(t[19]=[l("i",{class:"fas fa-lock"},null,-1)]),8,Qg)),l("button",{class:"btn-icon danger-icon",title:_(n)("tickets.actions.delete"),onClick:k(t=>(async e=>{if(confirm(n("tickets.confirm_delete")))try{await E.deleteTicket(e),await F()}catch(t){ne.error("[TicketsView] Erreur lors de la suppression",{ticketId:e,error:t})}})(e.id),["stop"])},t[20]||(t[20]=[l("i",{class:"fas fa-trash-alt"},null,-1)]),8,Zg)])])],8,jg);var s,a}),128))])])])),$.value>1?(g(),o("div",ey,[(g(!0),o(h,null,f($.value,e=>(g(),o("a",{key:e,class:y(["page-link",{active:e===M.value}]),onClick:t=>(e=>{M.value=e,window.scrollTo({top:0,behavior:"smooth"})})(e)},c(e),11,ty))),128))])):v("",!0)])}}}),ay=Vt(sy,[["__scopeId","data-v-6f2ba23e"]]),iy={class:"settings-view view-container"},ny={class:"header-box"},ry={class:"page-description"},oy={key:0,class:"loading-state"},ly={class:"loading-state-text"},cy={key:1,class:"settings-grid"},uy=["onClick"],dy={class:"settings-box-header"},py={class:"settings-box-icon"},my={class:"settings-box-title"},vy={key:0,class:"settings-box-badge"},hy={class:"settings-box-description"},fy={class:"settings-box-actions"},gy={class:"btn btn-secondary"},yy=r({__name:"SettingsView",setup(t){const{t:a}=b(),n=T(),r=He(),u=e(!0),p=s(()=>[{id:"general",title:a("settings.general.title"),description:a("settings.general.description"),icon:"fas fa-cog",route:"/settings/general"},{id:"notifications",title:a("settings.notifications.title"),description:a("settings.notifications.description"),icon:"fas fa-bell",route:"/settings/notifications"},{id:"security",title:a("settings.security.title"),description:a("settings.security.description"),icon:"fas fa-shield-alt",route:"/settings/security"},{id:"billing",title:a("settings.billing.title"),description:a("settings.billing.description"),icon:"fas fa-file-invoice-dollar",route:"/settings/billing"},{id:"servers",title:a("settings.servers.title"),description:a("settings.servers.description"),icon:"fas fa-server",route:"/settings/servers"},{id:"integrations",title:a("settings.integrations.title"),description:a("settings.integrations.description"),icon:"fas fa-plug",badge:"API",route:"/settings/integrations"},{id:"automation",title:a("settings.automation.title")||"Automatisation",description:a("settings.automation.description")||"Configurer les tâches automatisées pour la gestion des tickets, facturations, services et domaines",icon:"fas fa-robot",route:"/settings/automation"},{id:"modules",title:a("settings.modules.title"),description:a("settings.modules.description"),icon:"fas fa-cubes",route:"/settings/modules"},{id:"license",title:a("settings.license.title"),description:a("settings.license.description"),icon:"fas fa-key",route:"/settings/license"}]);return i(async()=>{try{setTimeout(()=>{u.value=!1},500)}catch(e){ne.error("Error loading settings",{error:e}),r.notificationError(a("common.errorLoading"))}}),(e,t)=>(g(),o("div",iy,[l("div",ny,[l("div",null,[l("h1",null,c(_(a)("settings.title")),1),l("div",ry,c(_(a)("settings.description")),1)])]),u.value?(g(),o("div",oy,[t[0]||(t[0]=l("div",{class:"loading-state-icon"},[l("i",{class:"fas fa-spinner fa-spin"})],-1)),l("div",ly,c(_(a)("common.loading")),1)])):(g(),o("div",cy,[(g(!0),o(h,null,f(p.value,(e,s)=>(g(),o("div",{key:s,class:"settings-box",onClick:t=>{return s=e.route,void n.push(s);var s}},[l("div",dy,[l("div",py,[l("i",{class:y(e.icon)},null,2)]),l("div",null,[l("h3",my,[d(c(e.title)+" ",1),e.badge?(g(),o("span",vy,c(e.badge),1)):v("",!0)])])]),l("p",hy,c(e.description),1),l("div",fy,[l("button",gy,[t[1]||(t[1]=l("i",{class:"fas fa-cog"},null,-1)),d(" "+c(_(a)("common.configure")),1)])])],8,uy))),128))]))]))}}),by=Vt(yy,[["__scopeId","data-v-d747ed16"]]),_y=t("servers",()=>{const t=e([]),s=e(!1),a=e(!1),i=e(!1),n=He();return{servers:t,loading:s,saving:a,getServerById:e=>t.value.find(t=>t.id===e),fetchServers:async()=>{var e,a;try{s.value=!0,ne.debug("[SERVERS STORE] Récupération des serveurs");const e=await _e.routes.admin.system.server.list();return t.value=e.data.servers||[],ne.info("[SERVERS STORE] Serveurs récupérés avec succès",{count:t.value.length}),t.value}catch(i){const t=(null==(a=null==(e=i.response)?void 0:e.data)?void 0:a.message)||"Erreur lors de la récupération des serveurs";throw ne.error("[SERVERS STORE] Erreur lors de la récupération des serveurs",{error:i}),n.showError(t),i}finally{s.value=!1}},createServer:async e=>{var s,i;try{a.value=!0,ne.debug("[SERVERS STORE] Création d'un nouveau serveur",{serverName:e.name});const s=await _e.routes.admin.system.server.create(e);if(s.data.success){const e=s.data.server;t.value.push(e);const a="Serveur créé avec succès";return ne.info("[SERVERS STORE] Serveur créé avec succès",{serverId:e.id}),n.showSuccess(a),e}{const e=s.data.message||"Erreur lors de la création du serveur";throw ne.warn("[SERVERS STORE] Échec de la création du serveur",{message:e}),n.showError(e),new Error(e)}}catch(r){const e=(null==(i=null==(s=r.response)?void 0:s.data)?void 0:i.message)||"Erreur lors de la création du serveur";throw ne.error("[SERVERS STORE] Erreur lors de la création du serveur",{error:r}),n.showError(e),r}finally{a.value=!1}},updateServer:async e=>{var s,i;try{a.value=!0,ne.debug("[SERVERS STORE] Mise à jour du serveur",{serverId:e.id});const s=await _e.routes.admin.system.server.update(String(e.id),e);if(s.data.success){const e=s.data.server,a=t.value.findIndex(t=>t.id===e.id);-1!==a&&(t.value[a]=e);const i="Serveur mis à jour avec succès";return ne.info("[SERVERS STORE] Serveur mis à jour avec succès",{serverId:e.id}),n.showSuccess(i),e}{const e=s.data.message||"Erreur lors de la mise à jour du serveur";throw ne.warn("[SERVERS STORE] Échec de la mise à jour du serveur",{message:e}),n.showError(e),new Error(e)}}catch(r){const e=(null==(i=null==(s=r.response)?void 0:s.data)?void 0:i.message)||"Erreur lors de la mise à jour du serveur";throw ne.error("[SERVERS STORE] Erreur lors de la mise à jour du serveur",{error:r}),n.showError(e),r}finally{a.value=!1}},deleteServer:async e=>{var s,i;try{a.value=!0,ne.debug("[SERVERS STORE] Suppression du serveur",{serverId:e});const s=await _e.routes.admin.system.server.delete(String(e));if(!s.data.success){const e=s.data.message||"Erreur lors de la suppression du serveur";throw ne.warn("[SERVERS STORE] Échec de la suppression du serveur",{message:e}),n.showError(e),new Error(e)}{t.value=t.value.filter(t=>t.id!==e);const s="Serveur supprimé avec succès";ne.info("[SERVERS STORE] Serveur supprimé avec succès",{serverId:e}),n.showSuccess(s)}}catch(r){const e=(null==(i=null==(s=r.response)?void 0:s.data)?void 0:i.message)||"Erreur lors de la suppression du serveur";throw ne.error("[SERVERS STORE] Erreur lors de la suppression du serveur",{error:r}),n.showError(e),r}finally{a.value=!1}},testServerConnection:async(e,t)=>{var s,a;try{if(i.value=!0,e){ne.debug("[SERVERS STORE] Test de connexion pour un serveur existant",{serverId:e});const t=await _e.routes.admin.system.server.test(String(e));return t.data.success&&(ne.info("[SERVERS STORE] Test de connexion réussi",{serverId:e}),n.showSuccess("Connexion au serveur établie avec succès")),t.data}if(t){ne.debug("[SERVERS STORE] Test de connexion pour un nouveau serveur",{serverName:t.name});const e=await _e.routes.admin.system.server.testNew(t);return e.data.success&&(ne.info("[SERVERS STORE] Test de connexion réussi pour le nouveau serveur"),n.showSuccess("Connexion au nouveau serveur établie avec succès")),e.data}{const e="Identifiant de serveur ou données de serveur requis";throw ne.warn("[SERVERS STORE] Tentative de test de connexion sans identifiant ni données"),n.showError(e),new Error(e)}}catch(r){const e=(null==(a=null==(s=r.response)?void 0:s.data)?void 0:a.message)||"Erreur lors du test de connexion au serveur";throw ne.error("[SERVERS STORE] Erreur lors du test de connexion au serveur",{error:r}),n.showError(e),r}finally{i.value=!1}},testNewServerConnection:async e=>{var t,s;try{i.value=!0,ne.debug("[SERVERS STORE] Test de connexion pour un nouveau serveur",{serverName:e.name});const t=await _e.routes.admin.system.server.testNew(e);return t.data.success&&(ne.info("[SERVERS STORE] Test de connexion réussi pour le nouveau serveur"),n.showSuccess("Connexion au nouveau serveur établie avec succès")),t.data}catch(a){const e=(null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.message)||"Erreur lors du test de connexion au nouveau serveur";throw ne.error("[SERVERS STORE] Erreur lors du test de connexion au nouveau serveur",{error:a}),n.showError(e),a}finally{i.value=!1}},getServerStats:async e=>{var t,a;try{s.value=!0,ne.debug("[SERVERS STORE] Récupération des statistiques du serveur",{serverId:e});const t=await _e.routes.admin.system.server.getStats(String(e));return ne.info("[SERVERS STORE] Statistiques du serveur récupérées avec succès",{serverId:e}),t.data}catch(i){const e=(null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.message)||"Erreur lors de la récupération des statistiques du serveur";throw ne.error("[SERVERS STORE] Erreur lors de la récupération des statistiques du serveur",{error:i}),n.showError(e),i}finally{s.value=!1}},getServerPlans:async e=>{var t,a;try{s.value=!0,ne.debug("[SERVERS STORE] Récupération des plans du serveur",{serverId:e});const t=await _e.routes.admin.system.server.getPlans(String(e));return ne.info("[SERVERS STORE] Plans du serveur récupérés avec succès",{serverId:e}),t.data}catch(i){const e=(null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.message)||"Erreur lors de la récupération des plans du serveur";throw ne.error("[SERVERS STORE] Erreur lors de la récupération des plans du serveur",{error:i}),n.showError(e),i}finally{s.value=!1}},showSuccessMessage:async e=>{await n.showSuccess(e)},showErrorMessage:async e=>{await n.showError(e)}}}),ky={class:"view-container"},wy={class:"header-box"},Sy={class:"page-description"},Ey={class:"settings-section"},Cy={key:0,class:"loading-state"},Ty={class:"loading-state-text"},Ay={class:"server-list-container"},Iy={class:"header-box"},Ry={class:"header-actions"},xy={class:"table-box"},Oy={class:"table"},Py={key:0},Ny={key:0},My={colspan:"6",class:"text-center"},Dy=["onClick"],Ly={class:"status-container"},Uy={class:"action-buttons"},qy=["onClick"],Vy=["onClick"],$y=["onClick"],jy={key:1},Fy={key:1,class:"server-details-container mt-4"},Gy={class:"header-box"},By={key:0,class:"loading-state-text ml-2"},Hy={class:"server-stats-grid table-box"},Wy={class:"server-stat-card"},zy={class:"stat-header"},Ky={class:"stat-content"},Jy={key:0,class:"loading-spinner"},Yy={key:1},Xy={class:"stat-value"},Qy={key:0,class:"stat-details"},Zy={key:1,class:"stat-details"},eb={class:"server-stat-card"},tb={class:"stat-header"},sb={class:"stat-content"},ab={key:0,class:"loading-spinner"},ib={key:1},nb={class:"stat-value"},rb={class:"progress"},ob={class:"server-stat-card"},lb={class:"stat-header"},cb={class:"stat-content"},ub={key:0,class:"loading-spinner"},db={key:1},pb={class:"stat-value"},mb={class:"progress"},vb={key:0,class:"stat-details"},hb={class:"server-stat-card"},fb={class:"stat-header"},gb={class:"stat-content"},yb={key:0,class:"loading-spinner"},bb={key:1},_b={class:"stat-value"},kb={class:"progress"},wb={key:0,class:"stat-details"},Sb={class:"server-stat-card"},Eb={class:"stat-header"},Cb={class:"stat-content"},Tb={key:0,class:"loading-spinner"},Ab={key:1,class:"stat-value"},Ib={class:"server-stat-card"},Rb={class:"stat-header"},xb={class:"stat-content"},Ob={class:"stat-details"},Pb={key:0},Nb={key:0,class:"last-updated"},Mb={key:0,class:"modal",tabindex:"-1",role:"dialog",style:{display:"block"}},Db={class:"modal-content"},Lb={class:"modal-header"},Ub={class:"modal-title"},qb={class:"modal-body"},Vb={class:"form-group"},$b={for:"serverName"},jb={class:"form-group"},Fb={for:"serverType"},Gb={value:"",disabled:""},Bb=["value"],Hb={class:"form-group"},Wb={for:"serverHostname"},zb={class:"form-group"},Kb={for:"serverIp"},Jb={class:"form-group"},Yb={for:"serverPort"},Xb={class:"form-group"},Qb={for:"serverUsername"},Zb={class:"form-group"},e_={for:"serverPassword"},t_=["required"],s_={key:0,class:"form-text text-muted"},a_={key:0,class:"form-group"},i_={for:"serverApiToken"},n_={key:0,class:"form-text text-muted"},r_={class:"form-group"},o_={for:"serverNameservers"},l_={class:"form-text text-muted"},c_={class:"form-group"},u_={for:"serverMaxAccounts"},d_={class:"form-text text-muted"},p_={class:"form-check"},m_={class:"form-check-label",for:"serverSecure"},v_={class:"form-check"},h_={class:"form-check-label",for:"serverActive"},f_={class:"form-group mt-3"},g_={key:0,class:"form-text text-muted"},y_={class:"modal-footer justify-content-between"},b_=["disabled"],__={key:0,class:"spinner-border spinner-border-sm",role:"status"},k_=["disabled"],w_={key:0,class:"spinner-border spinner-border-sm",role:"status"},S_={key:1,class:"modal",tabindex:"-1",role:"dialog",style:{display:"block"}},E_={class:"modal-content"},C_={class:"modal-header"},T_={class:"modal-title"},A_={class:"modal-body"},I_={class:"modal-footer"},R_=r({__name:"ServersView",setup(t){const{t:s}=b({messages:{fr:{"settings.servers":{title:"Gestion des Serveurs",description:"Gérez vos serveurs et leurs configurations",add:"Ajouter un Serveur",edit:"Modifier le Serveur",delete:"Supprimer le Serveur",name:"Nom",type:"Type",selectModule:"Sélectionner un module",hostname:"Nom d'hôte",ip:"Adresse IP",port:"Port",username:"Nom d'utilisateur",password:"Mot de passe",passwordHint:"Laissez vide si vous ne souhaitez pas modifier le mot de passe",apiToken:"Token API",apiTokenHint:"Laissez vide si vous ne souhaitez pas modifier le token API",secure:"Connexion sécurisée (SSL/TLS)",active:"Actif",maxAccounts:"Nombre maximum de comptes",nameservers:"Serveurs de noms (un par ligne)",status:"Statut",online:"En ligne",offline:"Hors ligne",inactive:"Inactif",load:"Charge CPU",memory:"Mémoire",disk:"Disque",uptime:"Temps de fonctionnement",info:"Informations",used:"Utilisé",total:"Total",free:"Libre",lastCheck:"Dernière vérification",lastRefresh:"Dernière actualisation",refresh:"Actualiser",refreshing:"Actualisation en cours...",refreshSuccess:"Statistiques actualisées avec succès",refreshError:"Erreur lors de l'actualisation des statistiques",testConnection:"Tester la connexion",testConnectionSuccess:"Connexion réussie",testConnectionError:"Erreur de connexion",confirmDelete:"Êtes-vous sûr de vouloir supprimer ce serveur ?",deleteSuccess:"Serveur supprimé avec succès",deleteError:"Erreur lors de la suppression du serveur",saveSuccess:"Serveur enregistré avec succès",saveError:"Erreur lors de l'enregistrement du serveur",details:"Détails du serveur",requiredField:"Ce champ est requis",cancel:"Annuler",save:"Enregistrer",confirm:"Confirmer",cpuLoad:"Charge CPU",last_updated:"Dernière mise à jour",apiTokenInputHint:"Entrez le token API"}}}}),a=_y(),n=He(),r=e(!0),u=e(!1),p=e(!1),m=e([]),E=e({}),T=e(!1),I=e(!1),R=e({type:"cPanel",port:2087,secure:!0,active:!0,name:"",hostname:"",username:"",password:"",api_token:"",ip:"",maxAccounts:0,nameservers:""}),x=e(null),O=e(null),P=async()=>{r.value=!0;try{m.value=await a.fetchServers()}catch(e){ne&&ne.error("Error fetching servers",{error:e}),n&&n.error(s("common.errorFetching"))}finally{r.value=!1}},M=(e=null)=>{R.value=e?{...e,password:"",api_token:"",type:e.type}:{name:"",hostname:"",type:"cPanel",username:"",password:"",port:2087,secure:!0,active:!0,api_token:"",ip:"",maxAccounts:0,nameservers:""},T.value=!0},D=()=>{T.value=!1},L=async()=>{const e=R.value;if(e.name&&e.hostname&&e.username&&e.ip)if(e.id||e.password){u.value=!0;try{e.id?await a.updateServer(e):await a.createServer(e),n&&n.success(s("settings.servers.saveSuccess")),D(),P()}catch(t){ne&&ne.error("Error saving server",{error:t}),n&&n.error(s("settings.servers.saveError"))}finally{u.value=!1}}else n&&n.error("Le mot de passe est requis pour la création d'un nouveau serveur.");else n&&n.error("Veuillez remplir tous les champs obligatoires.")},U=()=>{x.value=null,I.value=!1},q=async()=>{if(!x.value||void 0===x.value.id)return ne&&ne.warn("Attempted to delete a server without an ID."),void(x.value&&U());try{await a.deleteServer(x.value.id),n&&n.success(s("settings.servers.deleteSuccess")),P()}catch(e){ne&&ne.error("Error deleting server",{error:e}),n&&n.error(s("settings.servers.deleteError"))}finally{U()}},V=async e=>{if(void 0!==e.id){p.value=!0;try{(await a.testServerConnection(e.id)).success?n&&n.success(s("settings.servers.testSuccess")):n&&n.error(s("settings.servers.testError"))}catch(t){ne&&ne.error("Error testing server connection",{error:t,serverId:e.id}),n&&n.error(s("settings.servers.testError"))}finally{p.value=!1}}else ne&&ne.warn("testServerConnection called on a server without an ID.",{server:e})},$=()=>""!==R.value.name&&""!==R.value.hostname&&""!==R.value.username&&""!==R.value.password&&""!==R.value.ip,j=e=>({"status-online":"online"===e,"status-offline":"offline"===e}),F=e=>e<33?"bg-success":e<66?"bg-warning":"bg-danger",G=e=>new Date(e).toLocaleString(),B=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB","PB"][t]},H=e=>{if(!e)return"0 secondes";const t=Math.floor(e/86400),s=Math.floor(e%86400/3600),a=Math.floor(e%3600/60);let i="";return t>0&&(i+=`${t} jour${t>1?"s":""} `),(s>0||t>0)&&(i+=`${s} heure${s>1?"s":""} `),i+=`${a} minute${a>1?"s":""}`,i},W=()=>{switch(R.value.type?R.value.type.toLowerCase():""){case"cpanel":default:R.value.port=2087;break;case"proxmox":R.value.port=8006;break;case"virtualizor":R.value.port=4085}};return i(async()=>{await async function(){try{const e=(await _e.routes.admin.system.module.list("servers")).data;e.success&&e.data&&e.data.servers?E.value=e.data.servers:n.notificationError("Erreur lors du chargement des modules de serveurs")}catch(e){ne.error("Erreur lors du chargement des modules de serveurs",{error:e}),n.notificationError("Erreur lors du chargement des modules de serveurs")}}(),await P();const e=new URLSearchParams(window.location.search).get("moduleType");if(e){for(const t in E.value)if(E.value[t].name===e){R.value.type=e;break}W(),M()}}),(e,t)=>{var i;return g(),o("div",ky,[l("div",wy,[l("div",null,[l("h1",null,c(_(s)("settings.servers.title")),1),l("div",Sy,c(_(s)("settings.servers.description")),1)])]),l("div",Ey,[r.value?(g(),o("div",Cy,[t[17]||(t[17]=l("div",{class:"loading-state-icon"},[l("i",{class:"fas fa-spinner fa-spin"})],-1)),l("div",Ty,c(_(s)("common.loading")),1)])):v("",!0),l("div",Ay,[l("div",Iy,[l("div",Ry,[l("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=e=>M())},[t[18]||(t[18]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(_(s)("settings.servers.add")),1)])])]),l("div",xy,[l("table",Oy,[l("thead",null,[l("tr",null,[l("th",null,c(_(s)("settings.servers.name")),1),l("th",null,c(_(s)("settings.servers.hostname")),1),l("th",null,c(_(s)("settings.servers.type")),1),l("th",null,c(_(s)("settings.servers.ip")),1),l("th",null,c(_(s)("settings.servers.status")),1),l("th",null,c(_(s)("common.actions")),1)])]),r.value?(g(),o("tbody",jy,t[22]||(t[22]=[l("tr",null,[l("td",{colspan:"6",class:"text-center"},[l("div",{class:"loading-spinner"})])],-1)]))):(g(),o("tbody",Py,[0===m.value.length?(g(),o("tr",Ny,[l("td",My,c(_(s)("settings.servers.noServers")),1)])):v("",!0),(g(!0),o(h,null,f(m.value,e=>{return g(),o("tr",{key:e.id,class:y(["server-row",{selected:O.value&&O.value.id===e.id}]),onClick:t=>(e=>{O.value&&O.value.id===e.id?O.value=null:O.value=e})(e)},[l("td",null,c(e.name),1),l("td",null,c(e.hostname),1),l("td",null,[l("span",{class:y(["server-type-badge",(i=e.type,{"server-type-badge-cpanel":"cPanel"===i,"server-type-badge-proxmox":"Proxmox"===i,"server-type-badge-virtualizor":"Virtualizor"===i})])},c(e.type),3)]),l("td",null,c(e.ip),1),l("td",null,[l("div",Ly,[l("span",{class:y(["status-badge",(a=e.active,{"status-active":a,"status-inactive":!a})])},c(e.active?_(s)("common.active"):_(s)("common.inactive")),3),e.active&&e.status?(g(),o("span",{key:0,class:y(["status-badge ml-2",j(e.status)])},c("online"===e.status?_(s)("settings.servers.online"):_(s)("settings.servers.offline")),3)):v("",!0)])]),l("td",null,[l("div",Uy,[l("button",{class:"btn btn-sm btn-info mr-1",title:"Test Connection",onClick:k(t=>V(e),["stop"])},t[19]||(t[19]=[l("i",{class:"fas fa-plug"},null,-1)]),8,qy),l("button",{class:"btn btn-sm btn-primary mr-1",title:"Edit",onClick:k(t=>M(e),["stop"])},t[20]||(t[20]=[l("i",{class:"fas fa-edit"},null,-1)]),8,Vy),l("button",{class:"btn btn-sm btn-danger",title:"Delete",onClick:k(t=>(e=>{x.value=e,I.value=!0})(e),["stop"])},t[21]||(t[21]=[l("i",{class:"fas fa-trash"},null,-1)]),8,$y)])])],10,Dy);var a,i}),128))]))])])]),O.value&&O.value.id?(g(),o("div",Fy,[l("div",Gy,[l("h3",null,c(_(s)("settings.servers.details"))+": "+c(O.value.name),1),l("button",{class:"btn btn-sm btn-outline-primary",onClick:t[1]||(t[1]=e=>(async e=>{if(e&&e.id){e.loadingStats=!0;try{const t=await a.getServerStats(e.id);t.data&&t.data.success&&(e.stats=t.data.data,e.status=t.data.data.status,e.lastUpdated=(new Date).toLocaleString())}catch(t){ne&&ne.error("Erreur lors de la récupération des statistiques du serveur",{error:t}),n&&n.error(s("settings.servers.stats_error"))}finally{e.loadingStats=!1}}})(O.value))},[t[23]||(t[23]=l("i",{class:"fas fa-sync-alt"},null,-1)),d(" "+c(_(s)("settings.servers.refresh")),1)]),O.value.loadingStats?(g(),o("div",By,c(_(s)("settings.servers.refreshing")),1)):v("",!0)]),l("div",Hy,[l("div",Wy,[l("div",zy,[t[24]||(t[24]=l("i",{class:"fas fa-info-circle"},null,-1)),d(" "+c(_(s)("settings.servers.status")),1)]),l("div",Ky,[O.value.loadingStats?(g(),o("div",Jy)):(g(),o("div",Yy,[l("div",Xy,[l("span",{class:y(j(O.value.status))},c("online"===O.value.status?_(s)("settings.servers.online"):_(s)("settings.servers.offline")),3)]),O.value.stats&&O.value.stats.last_updated?(g(),o("div",Qy,c(_(s)("settings.servers.lastRefresh"))+": "+c(G(O.value.stats.last_updated)),1)):v("",!0),O.value.last_check?(g(),o("div",Zy,c(_(s)("settings.servers.lastCheck"))+": "+c(G(O.value.last_check)),1)):v("",!0)]))])]),l("div",eb,[l("div",tb,[t[25]||(t[25]=l("i",{class:"fas fa-microchip"},null,-1)),d(" "+c(_(s)("settings.servers.load")),1)]),l("div",sb,[O.value.loadingStats?(g(),o("div",ab)):(g(),o("div",ib,[l("div",nb,c(O.value.stats&&O.value.stats.server_load?O.value.stats.server_load:0)+"%",1),l("div",rb,[l("div",{class:y(["progress-bar",F(O.value.stats&&O.value.stats.server_load?O.value.stats.server_load:0)]),style:N({width:`${O.value.stats&&O.value.stats.server_load?O.value.stats.server_load:0}%`})},null,6)])]))])]),l("div",ob,[l("div",lb,[t[26]||(t[26]=l("i",{class:"fas fa-memory"},null,-1)),d(" "+c(_(s)("settings.servers.memory")),1)]),l("div",cb,[O.value.loadingStats?(g(),o("div",ub)):(g(),o("div",db,[l("div",pb,c(O.value.stats&&O.value.stats.memory&&O.value.stats.memory.percent?O.value.stats.memory.percent+"%":"0%"),1),l("div",mb,[l("div",{class:y(["progress-bar",F(O.value.stats&&O.value.stats.memory?O.value.stats.memory.percent:0)]),style:N({width:`${O.value.stats&&O.value.stats.memory?O.value.stats.memory.percent:0}%`})},null,6)]),O.value.stats&&O.value.stats.memory?(g(),o("div",vb,c(B(O.value.stats.memory.used||0))+" / "+c(B(O.value.stats.memory.total||0)),1)):v("",!0)]))])]),l("div",hb,[l("div",fb,[t[27]||(t[27]=l("i",{class:"fas fa-hdd"},null,-1)),d(" "+c(_(s)("settings.servers.disk")),1)]),l("div",gb,[O.value.loadingStats?(g(),o("div",yb)):(g(),o("div",bb,[l("div",_b,c(O.value.stats&&O.value.stats.disk&&O.value.stats.disk.percent?O.value.stats.disk.percent+"%":"0%"),1),l("div",kb,[l("div",{class:y(["progress-bar",F(O.value.stats&&O.value.stats.disk?O.value.stats.disk.percent:0)]),style:N({width:`${O.value.stats&&O.value.stats.disk?O.value.stats.disk.percent:0}%`})},null,6)]),O.value.stats&&O.value.stats.disk?(g(),o("div",wb,c(B(O.value.stats.disk.used||0))+" / "+c(B(O.value.stats.disk.total||0)),1)):v("",!0)]))])]),l("div",Sb,[l("div",Eb,[t[28]||(t[28]=l("i",{class:"fas fa-clock"},null,-1)),d(" "+c(_(s)("settings.servers.uptime")),1)]),l("div",Cb,[O.value.loadingStats?(g(),o("div",Tb)):O.value.stats?(g(),o("div",Ab,c(H(O.value.stats.uptime||0)),1)):v("",!0)])]),l("div",Ib,[l("div",Rb,[t[29]||(t[29]=l("i",{class:"fas fa-info-circle"},null,-1)),d(" "+c(_(s)("settings.servers.info")),1)]),l("div",xb,[l("div",Ob,[l("div",null,c(_(s)("settings.servers.port"))+": "+c(O.value.port),1),l("div",null,c(_(s)("settings.servers.secure"))+": "+c(O.value.secure?_(s)("common.yes"):_(s)("common.no")),1),O.value.maxAccounts?(g(),o("div",Pb,c(_(s)("settings.servers.maxAccounts"))+": "+c(O.value.maxAccounts),1)):v("",!0)])])])]),O.value.lastUpdated?(g(),o("div",Nb,c(_(s)("settings.servers.last_updated"))+": "+c(O.value.lastUpdated),1)):v("",!0)])):v("",!0)]),T.value?(g(),o("div",Mb,[l("div",{class:"modal-dialog",role:"document",onClick:t[15]||(t[15]=k(()=>{},["stop"]))},[l("div",Db,[l("div",Lb,[l("h5",Ub,c(R.value.id?_(s)("settings.servers.edit"):_(s)("settings.servers.add")),1),l("button",{type:"button",class:"close",onClick:D},t[30]||(t[30]=[l("span",{"aria-hidden":"true"},"×",-1)]))]),l("div",qb,[l("form",{onSubmit:k(L,["prevent"])},[l("div",Vb,[l("label",$b,c(_(s)("settings.servers.name")),1),w(l("input",{id:"serverName","onUpdate:modelValue":t[2]||(t[2]=e=>R.value.name=e),type:"text",class:"form-control",required:""},null,512),[[S,R.value.name]])]),l("div",jb,[l("label",Fb,c(_(s)("settings.servers.type")),1),w(l("select",{id:"serverType","onUpdate:modelValue":t[3]||(t[3]=e=>R.value.type=e),class:"form-control",required:"",onChange:W},[l("option",Gb,c(_(s)("settings.servers.selectModule")),1),(g(!0),o(h,null,f(E.value,(e,t)=>(g(),o("option",{key:t,value:e.name},c(e.display_name||e.name),9,Bb))),128))],544),[[A,R.value.type]])]),l("div",Hb,[l("label",Wb,c(_(s)("settings.servers.hostname")),1),w(l("input",{id:"serverHostname","onUpdate:modelValue":t[4]||(t[4]=e=>R.value.hostname=e),type:"text",class:"form-control",required:""},null,512),[[S,R.value.hostname]])]),l("div",zb,[l("label",Kb,c(_(s)("settings.servers.ip")),1),w(l("input",{id:"serverIp","onUpdate:modelValue":t[5]||(t[5]=e=>R.value.ip=e),type:"text",class:"form-control",required:""},null,512),[[S,R.value.ip]])]),l("div",Jb,[l("label",Yb,c(_(s)("settings.servers.port")),1),w(l("input",{id:"serverPort","onUpdate:modelValue":t[6]||(t[6]=e=>R.value.port=e),type:"number",class:"form-control"},null,512),[[S,R.value.port]])]),l("div",Xb,[l("label",Qb,c(_(s)("settings.servers.username")),1),w(l("input",{id:"serverUsername","onUpdate:modelValue":t[7]||(t[7]=e=>R.value.username=e),type:"text",class:"form-control",required:""},null,512),[[S,R.value.username]])]),l("div",Zb,[l("label",e_,c(_(s)("settings.servers.password")),1),w(l("input",{id:"serverPassword","onUpdate:modelValue":t[8]||(t[8]=e=>R.value.password=e),type:"password",class:"form-control",required:!R.value.id},null,8,t_),[[S,R.value.password]]),R.value.id?(g(),o("small",s_,c(_(s)("settings.servers.passwordHint")),1)):v("",!0)]),"cpanel"===R.value.type?(g(),o("div",a_,[l("label",i_,c(_(s)("settings.servers.apiToken")),1),w(l("input",{id:"serverApiToken","onUpdate:modelValue":t[9]||(t[9]=e=>R.value.api_token=e),type:"password",class:"form-control"},null,512),[[S,R.value.api_token]]),R.value.id?(g(),o("small",n_,c(_(s)("settings.servers.apiTokenInputHint")),1)):v("",!0)])):v("",!0),l("div",r_,[l("label",o_,c(_(s)("settings.servers.nameservers")),1),w(l("textarea",{id:"serverNameservers","onUpdate:modelValue":t[10]||(t[10]=e=>R.value.nameservers=e),class:"form-control",placeholder:"ns1.example.com\nns2.example.com",rows:"3"},null,512),[[S,R.value.nameservers]]),l("small",l_,c(_(s)("settings.servers.nameserversHint")),1)]),l("div",c_,[l("label",u_,c(_(s)("settings.servers.maxAccounts")),1),w(l("input",{id:"serverMaxAccounts","onUpdate:modelValue":t[11]||(t[11]=e=>R.value.maxAccounts=e),type:"number",class:"form-control",min:"0"},null,512),[[S,R.value.maxAccounts]]),l("small",d_,c(_(s)("settings.servers.maxAccountsHint")),1)]),l("div",p_,[w(l("input",{id:"serverSecure","onUpdate:modelValue":t[12]||(t[12]=e=>R.value.secure=e),type:"checkbox",class:"form-check-input"},null,512),[[C,R.value.secure]]),l("label",m_,c(_(s)("settings.servers.secure")),1)]),l("div",v_,[w(l("input",{id:"serverActive","onUpdate:modelValue":t[13]||(t[13]=e=>R.value.active=e),type:"checkbox",class:"form-check-input"},null,512),[[C,R.value.active]]),l("label",h_,c(_(s)("settings.servers.active")),1)]),l("div",f_,[$()?v("",!0):(g(),o("small",g_,c(_(s)("settings.servers.fillRequiredFields")),1))]),l("div",y_,[l("div",null,[l("button",{type:"button",class:"btn btn-secondary",onClick:D},c(_(s)("common.cancel")),1)]),l("div",null,[l("button",{type:"button",class:"btn btn-info me-2",disabled:p.value||!$(),onClick:t[14]||(t[14]=e=>R.value.id?V(R.value):(async()=>{p.value=!0;try{(await a.testServerConnection(null,R.value)).success?n&&n.success(s("settings.servers.testConnectionSuccess")):n&&n.error(s("settings.servers.testConnectionError"))}catch(e){ne&&ne.error("Error testing new server connection",{error:e}),n&&n.error(s("settings.servers.testConnectionError"))}finally{p.value=!1}})())},[p.value?(g(),o("span",__)):v("",!0),d(" "+c(_(s)("settings.servers.testConnection")),1)],8,b_),l("button",{type:"submit",class:"btn btn-primary",disabled:u.value},[u.value?(g(),o("span",w_)):v("",!0),d(" "+c(_(s)("common.save")),1)],8,k_)])])],32)])])])])):v("",!0),I.value?(g(),o("div",S_,[l("div",{class:"modal-dialog",role:"document",onClick:t[16]||(t[16]=k(()=>{},["stop"]))},[l("div",E_,[l("div",C_,[l("h5",T_,c(_(s)("common.confirmDelete")),1),l("button",{type:"button",class:"close",onClick:U},t[31]||(t[31]=[l("span",{"aria-hidden":"true"},"×",-1)]))]),l("div",A_,[l("p",null,c(_(s)("settings.servers.deleteConfirm",{name:null==(i=x.value)?void 0:i.name})),1)]),l("div",I_,[l("button",{type:"button",class:"btn btn-secondary",onClick:U},c(_(s)("common.cancel")),1),l("button",{type:"button",class:"btn btn-danger",onClick:q},c(_(s)("common.delete")),1)])])])])):v("",!0)])}}}),x_=t("settings",()=>{const t=e({general:{siteName:"",siteUrl:"",adminEmail:"",defaultLanguage:"fr",timezone:"Europe/Paris",dateFormat:"DD/MM/YYYY",timeFormat:"24h",currency:"EUR",maintenanceMode:!1,maintenanceMessage:""},security:{twoFactorAuth:!1,sessionTimeout:30,passwordPolicy:{minLength:8,requireNumbers:!0,requireSymbols:!0,requireUppercase:!0},ipWhitelist:[],apiKeys:[]},billing:{vatRate:20,defaultPaymentTerms:30,paymentMethods:{stripe:{enabled:!1,testMode:!0,publishableKey:"",secretKey:""},paypal:{enabled:!1,testMode:!0,clientId:"",clientSecret:""}},invoicePrefix:"INV-",autoReminders:!0,reminderDays:[7,3,1]},notifications:{settings:{enableEmailNotifications:!1,smtpHost:"",smtpPort:587,smtpSecurity:"tls",smtpUsername:"",smtpPassword:"",emailFrom:"",emailFromName:""},types:[]},integrations:{smtp:{host:"",port:587,username:"",password:"",encryption:"tls"},webhooks:[]},automation:{misc:{db_cleanup_enabled:!0,db_cleanup_frequency:"weekly",cleanup_sessions:!0,cleanup_activity_logs:!0,cleanup_temp_data:!0,auto_backup_enabled:!1,backup_frequency:"weekly",backup_files:!0,backup_database:!0,compress_backup:!0,backups_to_keep:5,auto_reports_enabled:!1,daily_reports:!1,weekly_reports:!0,monthly_reports:!0,email_reports:!0}}}),a=e(!1),i=e(null),n=e(!1),r=s(()=>t.value.general),o=s(()=>t.value.security),l=s(()=>t.value.billing),c=s(()=>t.value.notifications),u=s(()=>t.value.automation);return{settings:t,loading:a,error:i,success:n,generalSettings:r,securitySettings:o,billingSettings:l,notificationSettings:c,automationSettings:u,fetchGeneralSettings:async()=>{var e,s;const n=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Chargement des paramètres généraux");const e=await _e.routes.admin.system.settings.getGeneralSettings();return t.value.general=e.data,e.data}catch(r){const t=(null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.message)||"Erreur lors de la récupération des paramètres généraux";throw ne.error("[SETTINGS STORE] Erreur lors du chargement des paramètres généraux",{error:r}),n.showError(t),i.value=t,r}finally{a.value=!1}},updateGeneralSettings:async e=>{var s,n;const r=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Mise à jour des paramètres généraux",{settings:e});const s=await _e.routes.admin.system.settings.updateGeneralSettings(e);return t.value.general={...t.value.general,...s.data},r.showSuccess("Paramètres généraux mis à jour avec succès"),s.data}catch(o){const e=(null==(n=null==(s=o.response)?void 0:s.data)?void 0:n.message)||"Erreur lors de la mise à jour des paramètres généraux";throw ne.error("[SETTINGS STORE] Erreur lors de la mise à jour des paramètres généraux",{error:o}),r.showError(e),i.value=e,o}finally{a.value=!1}},fetchSecuritySettings:async()=>{var e,s;const n=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Chargement des paramètres de sécurité");const e=await _e.routes.admin.system.settings.getSecuritySettings();return t.value.security=e.data,e.data}catch(r){const t=(null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.message)||"Erreur lors de la récupération des paramètres de sécurité";throw ne.error("[SETTINGS STORE] Erreur lors du chargement des paramètres de sécurité",{error:r}),n.showError(t),i.value=t,r}finally{a.value=!1}},updateSecuritySettings:async e=>{var s,n;const r=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Mise à jour des paramètres de sécurité",{settings:e});const s=await _e.routes.admin.system.settings.updateSecuritySettings(e);return t.value.security={...t.value.security,...s.data},r.showSuccess("Paramètres de sécurité mis à jour avec succès"),s.data}catch(o){const e=(null==(n=null==(s=o.response)?void 0:s.data)?void 0:n.message)||"Erreur lors de la mise à jour des paramètres de sécurité";throw ne.error("[SETTINGS STORE] Erreur lors de la mise à jour des paramètres de sécurité",{error:o}),r.showError(e),i.value=e,o}finally{a.value=!1}},fetchBillingSettings:async()=>{var e,s;const n=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Chargement des paramètres de facturation");const e=await _e.routes.admin.system.settings.getBillingSettings();return t.value.billing=e.data,e.data}catch(r){const t=(null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.message)||"Erreur lors de la récupération des paramètres de facturation";throw ne.error("[SETTINGS STORE] Erreur lors du chargement des paramètres de facturation",{error:r}),n.showError(t),i.value=t,r}finally{a.value=!1}},updateBillingSettings:async e=>{var s,n;const r=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Mise à jour des paramètres de facturation",{settings:e});const s=await _e.routes.admin.system.settings.updateBillingSettings(e);return t.value.billing={...t.value.billing,...s.data},r.showSuccess("Paramètres de facturation mis à jour avec succès"),s.data}catch(o){const e=(null==(n=null==(s=o.response)?void 0:s.data)?void 0:n.message)||"Erreur lors de la mise à jour des paramètres de facturation";throw ne.error("[SETTINGS STORE] Erreur lors de la mise à jour des paramètres de facturation",{error:o}),r.showError(e),i.value=e,o}finally{a.value=!1}},fetchNotificationSettings:async()=>{var e,s;const n=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Récupération des paramètres de notification");const e=await _e.routes.admin.system.settings.getNotificationSettings(),s={settings:e.data.settings||e.data,types:e.data.types||e.data.notificationTypes||[]};return ne.debug("[SETTINGS STORE] Paramètres de notification récupérés",{notificationSettings:s}),t.value.notifications=s,s}catch(r){const t=(null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.message)||"Erreur lors de la récupération des paramètres de notification";throw ne.error("[SETTINGS STORE] Erreur lors de la récupération des paramètres de notification",{error:r}),n.showError(t),i.value=t,r}finally{a.value=!1}},updateNotificationSettings:async e=>{var s,n;const r=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Mise à jour des paramètres de notification",{newSettings:e});const s={...e.settings,types:e.types},i=await _e.routes.admin.system.settings.updateNotificationSettings(s),n={settings:i.data.settings||i.data,types:i.data.types||i.data.notificationTypes||[]};t.value.notifications=n;const o="Paramètres de notification mis à jour avec succès";return ne.info("[SETTINGS STORE] Paramètres de notification mis à jour avec succès"),r.showSuccess(o),n}catch(o){const e=(null==(n=null==(s=o.response)?void 0:s.data)?void 0:n.message)||"Erreur lors de la mise à jour des paramètres de notification";throw ne.error("[SETTINGS STORE] Erreur lors de la mise à jour des paramètres de notification",{error:o}),r.showError(e),i.value=e,o}finally{a.value=!1}},fetchIntegrationSettings:async()=>{var e,s;const n=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Chargement des paramètres d'intégration");const e=await _e.routes.admin.system.settings.getIntegrationSettings();return t.value.integrations=e.data,e.data}catch(r){const t=(null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.message)||"Erreur lors de la récupération des paramètres d'intégration";throw ne.error("[SETTINGS STORE] Erreur lors du chargement des paramètres d'intégration",{error:r}),n.showError(t),i.value=t,r}finally{a.value=!1}},updateIntegrationSettings:async e=>{var s,n;const r=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Mise à jour des paramètres d'intégration",{settings:e});const s=await _e.routes.admin.system.settings.updateIntegrationSettings(e);return t.value.integrations={...t.value.integrations,...s.data},r.showSuccess("Paramètres d'intégration mis à jour avec succès"),s.data}catch(o){const e=(null==(n=null==(s=o.response)?void 0:s.data)?void 0:n.message)||"Erreur lors de la mise à jour des paramètres d'intégration";throw ne.error("[SETTINGS STORE] Erreur lors de la mise à jour des paramètres d'intégration",{error:o}),r.showError(e),i.value=e,o}finally{a.value=!1}},fetchAutomationSettings:async e=>{a.value=!0,i.value="",n.value=!1;try{ne.debug("[SETTINGS STORE] Récupération des paramètres d'automatisation",{group:e});const s=await _e.routes.admin.system.settings.getAutomationSettings(e);return t.value.automation=e?{...t.value.automation,[e]:s.data.settings||s.data}:s.data.settings||s.data,n.value=!0,t.value.automation}catch(s){throw i.value=s.message||"Erreur inconnue",ne.error("[SETTINGS STORE] Erreur lors de la récupération des paramètres d'automatisation",{error:s}),s}finally{a.value=!1}},updateAutomationSettings:async(e,s)=>{a.value=!0,i.value="",n.value=!1;try{ne.debug("[SETTINGS STORE] Mise à jour des paramètres d'automatisation",{settings:e,group:s});const a=await _e.routes.admin.system.settings.updateAutomationSettings(e,s);return t.value.automation=s?{...t.value.automation,[s]:{...t.value.automation[s],...a.data}}:{...t.value.automation,...a.data},n.value=!0,t.value.automation}catch(r){throw i.value=r.message||"Erreur inconnue",ne.error("[SETTINGS STORE] Erreur lors de la mise à jour des paramètres d'automatisation",{error:r}),r}finally{a.value=!1}},testSmtpConnection:async()=>{var e,t;const s=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Test de la connexion SMTP");const e=(await _e.routes.admin.system.settings.testSmtpConnection()).data;return e.success?s.showSuccess("Test de connexion SMTP réussi"):s.showError(`Échec du test SMTP: ${e.message}`),e}catch(n){const a=(null==(t=null==(e=n.response)?void 0:e.data)?void 0:t.message)||"Erreur lors du test de connexion SMTP";throw ne.error("[SETTINGS STORE] Erreur lors du test de connexion SMTP",{error:n}),s.showError(a),i.value=a,n}finally{a.value=!1}},testEmailNotification:async()=>{var e,t;const s=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Test d'envoi d'email de notification");const e=(await _e.routes.admin.system.settings.testEmailNotification()).data;return e.success?s.showSuccess("Email de test envoyé avec succès"):s.showError(`Échec de l'envoi: ${e.message}`),e}catch(n){const a=(null==(t=null==(e=n.response)?void 0:e.data)?void 0:t.message)||"Erreur lors du test d'email de notification";throw ne.error("[SETTINGS STORE] Erreur lors du test d'email de notification",{error:n}),s.showError(a),i.value=a,n}finally{a.value=!1}},generateApiKey:async()=>{var e,s;const n=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Génération d'une nouvelle clé API");const e=await _e.routes.admin.system.settings.generateApiKey();return t.value.security.apiKeys.push(e.data),n.showSuccess("Nouvelle clé API générée avec succès"),e.data}catch(r){const t=(null==(s=null==(e=r.response)?void 0:e.data)?void 0:s.message)||"Erreur lors de la génération d'une clé API";throw ne.error("[SETTINGS STORE] Erreur lors de la génération d'une clé API",{error:r}),n.showError(t),i.value=t,r}finally{a.value=!1}},deleteApiKey:async e=>{var s,n;const r=He();try{return a.value=!0,ne.debug("[SETTINGS STORE] Suppression d'une clé API",{keyId:e}),await _e.routes.admin.system.settings.deleteApiKey(e),t.value.security.apiKeys=t.value.security.apiKeys.filter(t=>t.id!==e),r.showSuccess("Clé API supprimée avec succès"),!0}catch(o){const t=(null==(n=null==(s=o.response)?void 0:s.data)?void 0:n.message)||"Erreur lors de la suppression de la clé API";throw ne.error("[SETTINGS STORE] Erreur lors de la suppression de la clé API",{error:o,keyId:e}),r.showError(t),i.value=t,o}finally{a.value=!1}},saveWebhook:async e=>{var t,s;const n=He();try{let t;if(a.value=!0,ne.debug("[SETTINGS STORE] Sauvegarde d'un webhook",{webhookId:e.id||"nouveau"}),e.id){const s=String(e.id);t=await _e.routes.admin.system.settings.updateWebhook(s,e)}else t=await _e.routes.admin.system.settings.createWebhook(e);return t.data.success?(n.showSuccess("Webhook sauvegardé avec succès"),t.data.webhook):null}catch(r){const a=(null==(s=null==(t=r.response)?void 0:t.data)?void 0:s.message)||"Erreur lors de la sauvegarde du webhook";throw ne.error("[SETTINGS STORE] Erreur lors de la sauvegarde du webhook",{error:r,webhookData:e}),n.showError(a),i.value=a,r}finally{a.value=!1}},deleteWebhook:async e=>{var t,s;const n=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Suppression d'un webhook",{webhookId:e});return!!(await _e.routes.admin.system.settings.deleteWebhook(e)).data.success&&(n.showSuccess("Webhook supprimé avec succès"),!0)}catch(r){const a=(null==(s=null==(t=r.response)?void 0:t.data)?void 0:s.message)||"Erreur lors de la suppression du webhook";throw ne.error("[SETTINGS STORE] Erreur lors de la suppression du webhook",{error:r,webhookId:e}),n.showError(a),i.value=a,r}finally{a.value=!1}},toggleWebhookStatus:async(e,t)=>{var s,n;const r=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Changement de statut d'un webhook",{webhookId:e,active:t});return!!(await _e.routes.admin.system.settings.toggleWebhookStatus(e,t)).data.success&&(r.showSuccess(`Webhook ${t?"activé":"désactivé"} avec succès`),!0)}catch(o){const a=(null==(n=null==(s=o.response)?void 0:s.data)?void 0:n.message)||`Erreur lors ${t?"de l'activation":"de la désactivation"} du webhook`;throw ne.error("[SETTINGS STORE] Erreur lors du changement de statut du webhook",{error:o,webhookId:e,active:t}),r.showError(a),i.value=a,o}finally{a.value=!1}},fetchLicenseInfo:async()=>{var e,t;const s=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Récupération des informations de licence");const e=await _e.routes.admin.system.license.getLicenseInfo();return e.data.success?e.data.license:{status:"invalid",message:e.data.message||"Erreur lors de la récupération des informations de licence"}}catch(n){const a=(null==(t=null==(e=n.response)?void 0:e.data)?void 0:t.message)||"Erreur lors de la récupération des informations de licence";throw ne.error("[SETTINGS STORE] Erreur lors de la récupération des informations de licence",{error:n}),s.showError(a),i.value=a,n}finally{a.value=!1}},activateLicense:async e=>{var t,s;const n=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Activation de la licence",{licenseKey:e});const t=await _e.routes.admin.system.license.activateLicense(e);if(t.data.success){const s=t.data.message||"Licence activée avec succès";return ne.info("[SETTINGS STORE] Activation de licence réussie",{licenseKey:e}),n.showSuccess(s),t.data}const s=t.data.message||"Erreur lors de l'activation de la licence";return ne.warn("[SETTINGS STORE] Échec de l'activation de licence",{message:s}),n.showError(s),i.value=s,t.data}catch(r){const e=(null==(s=null==(t=r.response)?void 0:t.data)?void 0:s.message)||"Erreur lors de l'activation de la licence";throw ne.error("[SETTINGS STORE] Erreur lors de l'activation de la licence",{error:r}),n.showError(e),i.value=e,r}finally{a.value=!1}},checkLicenseStatus:async()=>{var e,t;const s=He();try{a.value=!0,ne.debug("[SETTINGS STORE] Vérification du statut de la licence");const e=await _e.routes.admin.system.license.checkLicense();if(e.data.success){const t="Statut de la licence vérifié avec succès";return ne.info("[SETTINGS STORE] Vérification du statut de la licence réussie"),s.showSuccess(t),e.data.license}const t=e.data.message||"Erreur lors de la vérification de la licence";return ne.warn("[SETTINGS STORE] Problème lors de la vérification de la licence",{message:t}),s.showWarning(t),{status:"invalid",message:t}}catch(n){const a=(null==(t=null==(e=n.response)?void 0:e.data)?void 0:t.message)||"Erreur lors de la vérification de la licence";throw ne.error("[SETTINGS STORE] Erreur lors de la vérification de la licence",{error:n}),s.showError(a),i.value=a,n}finally{a.value=!1}},handleSettingsUpdate:e=>{"general"===e.type?t.value.general={...t.value.general,...e.data}:"security"===e.type?t.value.security={...t.value.security,...e.data}:"billing"===e.type?t.value.billing={...t.value.billing,...e.data}:"notifications"===e.type?t.value.notifications={...t.value.notifications,...e.data}:"integration"===e.type&&(t.value.integrations={...t.value.integrations,...e.data})}}}),O_={class:"view-container"},P_={class:"header-box"},N_={class:"page-description"},M_={class:"settings-section"},D_={key:0,class:"loading-state"},L_={class:"loading-state-text"},U_={class:"form-group"},q_={class:"form-label"},V_={class:"form-group"},$_={class:"form-label"},j_={class:"form-group"},F_={class:"form-label"},G_={class:"form-row"},B_={class:"form-group"},H_={class:"form-label"},W_={class:"form-group"},z_={class:"form-label"},K_={class:"form-row"},J_={class:"form-group"},Y_={class:"form-label"},X_={class:"form-group"},Q_={class:"form-label"},Z_={class:"form-group"},ek={class:"form-label"},tk={class:"form-group"},sk={class:"form-check"},ak={class:"form-check-label",for:"maintenanceMode"},ik={key:0,class:"form-group"},nk={class:"form-label"},rk={class:"form-actions"},ok=["disabled"],lk={key:0,class:"fas fa-spinner fa-spin"},ck=r({__name:"GeneralView",setup(t){const{t:s}=b(),a=x_(),n=He(),r=e(!0),u=e(!1),p=M({siteName:"",siteUrl:"",adminEmail:"",defaultLanguage:"fr",timezone:"Europe/Paris",dateFormat:"DD/MM/YYYY",timeFormat:"24h",currency:"EUR",maintenanceMode:!1,maintenanceMessage:""}),m=async()=>{try{u.value=!0,await a.updateGeneralSettings(p),n.success(s("settings.saveSuccess"))}catch(e){ne.error("Erreur lors de la sauvegarde des paramètres généraux",{error:e}),n.notificationError(s("settings.saveError"))}finally{u.value=!1}};return i(async()=>{await(async()=>{try{r.value=!0;const e=await a.fetchGeneralSettings();Object.assign(p,e)}catch(e){ne.error("Erreur lors du chargement des paramètres",{error:e}),n.notificationError(s("settings.loadError"))}finally{r.value=!1}})()}),(e,t)=>(g(),o("div",O_,[l("div",P_,[l("div",null,[l("h1",null,c(_(s)("settings.general.title")),1),l("div",N_,c(_(s)("settings.general.description")),1)])]),l("div",M_,[r.value?(g(),o("div",D_,[t[10]||(t[10]=l("div",{class:"loading-state-icon"},[l("i",{class:"fas fa-spinner fa-spin"})],-1)),l("div",L_,c(_(s)("common.loading")),1)])):(g(),o("form",{key:1,class:"table-box",onSubmit:k(m,["prevent"])},[l("div",U_,[l("label",q_,c(_(s)("settings.general.siteName")),1),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>p.siteName=e),type:"text",class:"form-control",required:""},null,512),[[S,p.siteName]])]),l("div",V_,[l("label",$_,c(_(s)("settings.general.siteUrl")),1),w(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>p.siteUrl=e),type:"url",class:"form-control",required:""},null,512),[[S,p.siteUrl]])]),l("div",j_,[l("label",F_,c(_(s)("settings.general.adminEmail")),1),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>p.adminEmail=e),type:"email",class:"form-control",required:""},null,512),[[S,p.adminEmail]])]),l("div",G_,[l("div",B_,[l("label",H_,c(_(s)("settings.general.language")),1),w(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>p.defaultLanguage=e),class:"form-control"},t[11]||(t[11]=[l("option",{value:"fr"},"Français",-1),l("option",{value:"en"},"English",-1),l("option",{value:"es"},"Español",-1)]),512),[[A,p.defaultLanguage]])]),l("div",W_,[l("label",z_,c(_(s)("settings.general.timezone")),1),w(l("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>p.timezone=e),class:"form-control"},t[12]||(t[12]=[l("option",{value:"Europe/Paris"},"Europe/Paris",-1),l("option",{value:"UTC"},"UTC",-1),l("option",{value:"America/New_York"},"America/New_York",-1)]),512),[[A,p.timezone]])])]),l("div",K_,[l("div",J_,[l("label",Y_,c(_(s)("settings.general.dateFormat")),1),w(l("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>p.dateFormat=e),class:"form-control"},t[13]||(t[13]=[l("option",{value:"DD/MM/YYYY"},"DD/MM/YYYY",-1),l("option",{value:"MM/DD/YYYY"},"MM/DD/YYYY",-1),l("option",{value:"YYYY-MM-DD"},"YYYY-MM-DD",-1)]),512),[[A,p.dateFormat]])]),l("div",X_,[l("label",Q_,c(_(s)("settings.general.timeFormat")),1),w(l("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>p.timeFormat=e),class:"form-control"},t[14]||(t[14]=[l("option",{value:"24h"},"24h",-1),l("option",{value:"12h"},"12h",-1)]),512),[[A,p.timeFormat]])]),l("div",Z_,[l("label",ek,c(_(s)("settings.general.currency")),1),w(l("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>p.currency=e),class:"form-control"},t[15]||(t[15]=[l("option",{value:"EUR"},"EUR (€)",-1),l("option",{value:"USD"},"USD ($)",-1),l("option",{value:"GBP"},"GBP (£)",-1)]),512),[[A,p.currency]])])]),l("div",tk,[l("div",sk,[w(l("input",{id:"maintenanceMode","onUpdate:modelValue":t[8]||(t[8]=e=>p.maintenanceMode=e),type:"checkbox",class:"form-check-input"},null,512),[[C,p.maintenanceMode]]),l("label",ak,c(_(s)("settings.general.maintenanceMode")),1)])]),p.maintenanceMode?(g(),o("div",ik,[l("label",nk,c(_(s)("settings.general.maintenanceMessage")),1),w(l("textarea",{"onUpdate:modelValue":t[9]||(t[9]=e=>p.maintenanceMessage=e),class:"form-control",rows:"3"},null,512),[[S,p.maintenanceMessage]])])):v("",!0),l("div",rk,[l("button",{type:"submit",class:"btn btn-primary",disabled:u.value},[u.value?(g(),o("i",lk)):v("",!0),d(" "+c(_(s)("common.save")),1)],8,ok)])],32))])]))}}),uk={class:"view-container"},dk={class:"header-box"},pk={class:"page-description"},mk={class:"settings-section"},vk={key:0,class:"loading-state"},hk={class:"loading-state-text"},fk={class:"settings-group"},gk={class:"form-group"},yk={class:"form-check"},bk={class:"form-check-label",for:"enableTwoFactor"},_k={class:"form-help"},kk={class:"form-group"},wk={class:"form-label"},Sk={value:"15"},Ek={value:"30"},Ck={value:"60"},Tk={value:"120"},Ak={value:"240"},Ik={value:"480"},Rk={value:"720"},xk={value:"1440"},Ok={class:"form-group"},Pk={class:"form-label"},Nk={class:"form-group"},Mk={class:"form-label"},Dk={value:"5"},Lk={value:"15"},Uk={value:"30"},qk={value:"60"},Vk={value:"120"},$k={class:"settings-group"},jk={class:"form-group"},Fk={class:"form-label"},Gk={class:"form-group"},Bk={class:"form-check"},Hk={class:"form-check-label",for:"requireUppercase"},Wk={class:"form-group"},zk={class:"form-check"},Kk={class:"form-check-label",for:"requireNumber"},Jk={class:"form-group"},Yk={class:"form-check"},Xk={class:"form-check-label",for:"requireSpecialChar"},Qk={class:"form-group"},Zk={class:"form-label"},ew={value:"0"},tw={value:"30"},sw={value:"60"},aw={value:"90"},iw={value:"180"},nw={value:"365"},rw={class:"settings-group"},ow={class:"form-group"},lw={class:"form-check"},cw={class:"form-check-label",for:"enableApiAccess"},uw={key:0,class:"form-group"},dw={class:"form-label"},pw={value:"1"},mw={value:"7"},vw={value:"30"},hw={value:"90"},fw={value:"365"},gw={value:"0"},yw={class:"form-actions"},bw=["disabled"],_w={key:0,class:"fas fa-spinner fa-spin"},kw=r({__name:"SecurityView",setup(t){const{t:s}=b(),a=x_(),n=He(),r=e(!0),u=e(!1),p=M({enableTwoFactor:!1,sessionTimeout:60,maxLoginAttempts:5,lockoutTime:15,minPasswordLength:8,requireUppercase:!0,requireNumber:!0,requireSpecialChar:!1,passwordExpiryDays:90,enableApiAccess:!0,apiTokenExpiry:30}),m=async()=>{try{u.value=!0,await a.updateSecuritySettings(p),n.success(s("settings.saveSuccess"))}catch(e){ne.error("Erreur lors de la sauvegarde des paramètres de sécurité",{error:e}),n.notificationError(s("settings.saveError"))}finally{u.value=!1}};return i(async()=>{await(async()=>{try{r.value=!0;const e=await a.fetchSecuritySettings();Object.assign(p,e)}catch(e){ne.error("Erreur lors du chargement des paramètres de sécurité",{error:e}),n.notificationError(s("settings.loadError"))}finally{r.value=!1}})()}),(e,t)=>(g(),o("div",uk,[l("div",dk,[l("div",null,[l("h1",null,c(_(s)("settings.security.title")),1),l("div",pk,c(_(s)("settings.security.description")),1)])]),l("div",mk,[r.value?(g(),o("div",vk,[t[11]||(t[11]=l("div",{class:"loading-state-icon"},[l("i",{class:"fas fa-spinner fa-spin"})],-1)),l("div",hk,c(_(s)("common.loading")),1)])):(g(),o("form",{key:1,class:"table-box",onSubmit:k(m,["prevent"])},[l("div",fk,[l("h3",null,c(_(s)("settings.security.authentication")),1),l("div",gk,[l("div",yk,[w(l("input",{id:"enableTwoFactor","onUpdate:modelValue":t[0]||(t[0]=e=>p.enableTwoFactor=e),type:"checkbox",class:"form-check-input"},null,512),[[C,p.enableTwoFactor]]),l("label",bk,c(_(s)("settings.security.enableTwoFactor")),1)]),l("div",_k,c(_(s)("settings.security.twoFactorHelp")),1)]),l("div",kk,[l("label",wk,c(_(s)("settings.security.sessionTimeout")),1),w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>p.sessionTimeout=e),class:"form-control"},[l("option",Sk,"15 "+c(_(s)("common.minutes")),1),l("option",Ek,"30 "+c(_(s)("common.minutes")),1),l("option",Ck,"1 "+c(_(s)("common.hour")),1),l("option",Tk,"2 "+c(_(s)("common.hours")),1),l("option",Ak,"4 "+c(_(s)("common.hours")),1),l("option",Ik,"8 "+c(_(s)("common.hours")),1),l("option",Rk,"12 "+c(_(s)("common.hours")),1),l("option",xk,"24 "+c(_(s)("common.hours")),1)],512),[[A,p.sessionTimeout]])]),l("div",Ok,[l("label",Pk,c(_(s)("settings.security.maxLoginAttempts")),1),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>p.maxLoginAttempts=e),type:"number",class:"form-control",min:"1",max:"10"},null,512),[[S,p.maxLoginAttempts]])]),l("div",Nk,[l("label",Mk,c(_(s)("settings.security.lockoutTime")),1),w(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>p.lockoutTime=e),class:"form-control"},[l("option",Dk,"5 "+c(_(s)("common.minutes")),1),l("option",Lk,"15 "+c(_(s)("common.minutes")),1),l("option",Uk,"30 "+c(_(s)("common.minutes")),1),l("option",qk,"1 "+c(_(s)("common.hour")),1),l("option",Vk,"2 "+c(_(s)("common.hours")),1)],512),[[A,p.lockoutTime]])])]),l("div",$k,[l("h3",null,c(_(s)("settings.security.passwords")),1),l("div",jk,[l("label",Fk,c(_(s)("settings.security.minPasswordLength")),1),w(l("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>p.minPasswordLength=e),type:"number",class:"form-control",min:"8",max:"32"},null,512),[[S,p.minPasswordLength]])]),l("div",Gk,[l("div",Bk,[w(l("input",{id:"requireUppercase","onUpdate:modelValue":t[5]||(t[5]=e=>p.requireUppercase=e),type:"checkbox",class:"form-check-input"},null,512),[[C,p.requireUppercase]]),l("label",Hk,c(_(s)("settings.security.requireUppercase")),1)])]),l("div",Wk,[l("div",zk,[w(l("input",{id:"requireNumber","onUpdate:modelValue":t[6]||(t[6]=e=>p.requireNumber=e),type:"checkbox",class:"form-check-input"},null,512),[[C,p.requireNumber]]),l("label",Kk,c(_(s)("settings.security.requireNumber")),1)])]),l("div",Jk,[l("div",Yk,[w(l("input",{id:"requireSpecialChar","onUpdate:modelValue":t[7]||(t[7]=e=>p.requireSpecialChar=e),type:"checkbox",class:"form-check-input"},null,512),[[C,p.requireSpecialChar]]),l("label",Xk,c(_(s)("settings.security.requireSpecialChar")),1)])]),l("div",Qk,[l("label",Zk,c(_(s)("settings.security.passwordExpiryDays")),1),w(l("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>p.passwordExpiryDays=e),class:"form-control"},[l("option",ew,c(_(s)("settings.security.never")),1),l("option",tw,"30 "+c(_(s)("common.days")),1),l("option",sw,"60 "+c(_(s)("common.days")),1),l("option",aw,"90 "+c(_(s)("common.days")),1),l("option",iw,"180 "+c(_(s)("common.days")),1),l("option",nw,"365 "+c(_(s)("common.days")),1)],512),[[A,p.passwordExpiryDays]])])]),l("div",rw,[l("h3",null,c(_(s)("settings.security.api")),1),l("div",ow,[l("div",lw,[w(l("input",{id:"enableApiAccess","onUpdate:modelValue":t[9]||(t[9]=e=>p.enableApiAccess=e),type:"checkbox",class:"form-check-input"},null,512),[[C,p.enableApiAccess]]),l("label",cw,c(_(s)("settings.security.enableApiAccess")),1)])]),p.enableApiAccess?(g(),o("div",uw,[l("label",dw,c(_(s)("settings.security.apiTokenExpiry")),1),w(l("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>p.apiTokenExpiry=e),class:"form-control"},[l("option",pw,"1 "+c(_(s)("common.day")),1),l("option",mw,"7 "+c(_(s)("common.days")),1),l("option",vw,"30 "+c(_(s)("common.days")),1),l("option",hw,"90 "+c(_(s)("common.days")),1),l("option",fw,"365 "+c(_(s)("common.days")),1),l("option",gw,c(_(s)("settings.security.never")),1)],512),[[A,p.apiTokenExpiry]])])):v("",!0)]),l("div",yw,[l("button",{type:"submit",class:"btn btn-primary",disabled:u.value},[u.value?(g(),o("i",_w)):v("",!0),d(" "+c(_(s)("common.save")),1)],8,bw)])],32))])]))}}),ww=Vt(kw,[["__scopeId","data-v-f9832089"]]),Sw={class:"view-container"},Ew={class:"header-box"},Cw={class:"page-description"},Tw={class:"settings-section"},Aw={key:0,class:"loading-state"},Iw={class:"loading-state-text"},Rw={class:"settings-group"},xw={class:"form-group"},Ow={class:"form-check"},Pw={class:"form-check-label",for:"enableEmailNotifications"},Nw={key:0},Mw={class:"form-group"},Dw={class:"form-label"},Lw={class:"form-row"},Uw={class:"form-group"},qw={class:"form-label"},Vw={class:"form-group"},$w={class:"form-label"},jw={value:"none"},Fw={class:"form-group"},Gw={class:"form-label"},Bw={class:"form-group"},Hw={class:"form-label"},Ww={class:"form-group"},zw={class:"form-label"},Kw={class:"form-group"},Jw={class:"form-label"},Yw={class:"form-actions-inline"},Xw=["disabled"],Qw={key:0,class:"fas fa-spinner fa-spin"},Zw={class:"settings-group"},eS={class:"notification-types"},tS={class:"notification-type-header"},sS={class:"form-check"},aS=["id","onUpdate:modelValue"],iS=["for"],nS={key:0,class:"notification-type-channels"},rS={class:"form-check"},oS=["id","onUpdate:modelValue","disabled"],lS=["for"],cS={class:"form-check"},uS=["id","onUpdate:modelValue"],dS=["for"],pS={class:"form-actions"},mS=["disabled"],vS={key:0,class:"fas fa-spinner fa-spin"},hS=r({__name:"NotificationsView",setup(t){const{t:s}=b(),a=x_(),n=He(),r=e(!0),u=e(!1),p=e(!1),m=e({enableEmailNotifications:!1,smtpHost:"",smtpPort:587,smtpSecurity:"tls",smtpUsername:"",smtpPassword:"",emailFrom:"",emailFromName:""}),y=e([{id:"new_client",name:s("settings.notifications.types.newClient"),enabled:!0,email:!0,inApp:!0},{id:"new_invoice",name:s("settings.notifications.types.newInvoice"),enabled:!0,email:!0,inApp:!0},{id:"payment_received",name:s("settings.notifications.types.paymentReceived"),enabled:!0,email:!0,inApp:!0},{id:"invoice_reminder",name:s("settings.notifications.types.invoiceReminder"),enabled:!0,email:!0,inApp:!1},{id:"new_ticket",name:s("settings.notifications.types.newTicket"),enabled:!0,email:!0,inApp:!0},{id:"ticket_reply",name:s("settings.notifications.types.ticketReply"),enabled:!0,email:!0,inApp:!0},{id:"service_expiry",name:s("settings.notifications.types.serviceExpiry"),enabled:!0,email:!0,inApp:!0},{id:"system_alert",name:s("settings.notifications.types.systemAlert"),enabled:!0,email:!0,inApp:!0}]),E=async()=>{try{u.value=!0;const e={settings:m.value,types:y.value};await a.updateNotificationSettings(e),n.success(s("settings.saveSuccess"))}catch(e){ne.error("Erreur lors de la sauvegarde des paramètres de notifications",{error:e}),n.notificationError(s("settings.saveError"))}finally{u.value=!1}},T=async()=>{try{p.value=!0,await a.testEmailNotification(),n.success(s("settings.notifications.testSuccess"))}catch(e){ne.error("Erreur lors du test de connexion email",{error:e}),n.notificationError(s("settings.notifications.testError"))}finally{p.value=!1}};return i(async()=>{await(async()=>{try{r.value=!0;const e=await a.fetchNotificationSettings();e.settings?m.value=e.settings:m.value={enableEmailNotifications:!1,smtpHost:"",smtpPort:587,smtpSecurity:"tls",smtpUsername:"",smtpPassword:"",emailFrom:"",emailFromName:""},e.types&&e.types.forEach(e=>{const t=y.value.find(t=>t.id===e.id);t&&(t.enabled=e.enabled,t.email=e.email,t.inApp=e.inApp)})}catch(e){ne.error("Erreur lors du chargement des paramètres de notifications",{error:e}),n.notificationError(s("settings.loadError"))}finally{r.value=!1}})()}),(e,t)=>(g(),o("div",Sw,[l("div",Ew,[l("div",null,[l("h1",null,c(_(s)("settings.notifications.title")),1),l("div",Cw,c(_(s)("settings.notifications.description")),1)])]),l("div",Tw,[r.value?(g(),o("div",Aw,[t[8]||(t[8]=l("div",{class:"loading-state-icon"},[l("i",{class:"fas fa-spinner fa-spin"})],-1)),l("div",Iw,c(_(s)("common.loading")),1)])):(g(),o("form",{key:1,class:"table-box",onSubmit:k(E,["prevent"])},[l("div",Rw,[l("h3",null,c(_(s)("settings.notifications.email")),1),l("div",xw,[l("div",Ow,[w(l("input",{id:"enableEmailNotifications","onUpdate:modelValue":t[0]||(t[0]=e=>m.value.enableEmailNotifications=e),type:"checkbox",class:"form-check-input"},null,512),[[C,m.value.enableEmailNotifications]]),l("label",Pw,c(_(s)("settings.notifications.enableEmailNotifications")),1)])]),m.value.enableEmailNotifications?(g(),o("div",Nw,[l("div",Mw,[l("label",Dw,c(_(s)("settings.notifications.smtpHost")),1),w(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>m.value.smtpHost=e),type:"text",class:"form-control",required:""},null,512),[[S,m.value.smtpHost]])]),l("div",Lw,[l("div",Uw,[l("label",qw,c(_(s)("settings.notifications.smtpPort")),1),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>m.value.smtpPort=e),type:"number",class:"form-control",required:""},null,512),[[S,m.value.smtpPort]])]),l("div",Vw,[l("label",$w,c(_(s)("settings.notifications.smtpSecurity")),1),w(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>m.value.smtpSecurity=e),class:"form-control"},[l("option",jw,c(_(s)("settings.notifications.none")),1),t[9]||(t[9]=l("option",{value:"ssl"},"SSL",-1)),t[10]||(t[10]=l("option",{value:"tls"},"TLS",-1))],512),[[A,m.value.smtpSecurity]])])]),l("div",Fw,[l("label",Gw,c(_(s)("settings.notifications.smtpUsername")),1),w(l("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>m.value.smtpUsername=e),type:"text",class:"form-control"},null,512),[[S,m.value.smtpUsername]])]),l("div",Bw,[l("label",Hw,c(_(s)("settings.notifications.smtpPassword")),1),w(l("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>m.value.smtpPassword=e),type:"password",class:"form-control"},null,512),[[S,m.value.smtpPassword]])]),l("div",Ww,[l("label",zw,c(_(s)("settings.notifications.emailFrom")),1),w(l("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>m.value.emailFrom=e),type:"email",class:"form-control",required:""},null,512),[[S,m.value.emailFrom]])]),l("div",Kw,[l("label",Jw,c(_(s)("settings.notifications.emailFromName")),1),w(l("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>m.value.emailFromName=e),type:"text",class:"form-control",required:""},null,512),[[S,m.value.emailFromName]])]),l("div",Yw,[l("button",{type:"button",class:"btn btn-secondary",disabled:p.value,onClick:T},[p.value?(g(),o("i",Qw)):v("",!0),d(" "+c(_(s)("settings.notifications.testConnection")),1)],8,Xw)])])):v("",!0)]),l("div",Zw,[l("h3",null,c(_(s)("settings.notifications.notificationTypes")),1),l("div",eS,[(g(!0),o(h,null,f(y.value,e=>(g(),o("div",{key:e.id,class:"notification-type"},[l("div",tS,[l("div",sS,[w(l("input",{id:`notification-${e.id}`,"onUpdate:modelValue":t=>e.enabled=t,type:"checkbox",class:"form-check-input"},null,8,aS),[[C,e.enabled]]),l("label",{class:"form-check-label",for:`notification-${e.id}`},c(e.name),9,iS)])]),e.enabled?(g(),o("div",nS,[l("div",rS,[w(l("input",{id:`notification-${e.id}-email`,"onUpdate:modelValue":t=>e.email=t,type:"checkbox",class:"form-check-input",disabled:!m.value.enableEmailNotifications},null,8,oS),[[C,e.email]]),l("label",{class:"form-check-label",for:`notification-${e.id}-email`},c(_(s)("settings.notifications.email")),9,lS)]),l("div",cS,[w(l("input",{id:`notification-${e.id}-inApp`,"onUpdate:modelValue":t=>e.inApp=t,type:"checkbox",class:"form-check-input"},null,8,uS),[[C,e.inApp]]),l("label",{class:"form-check-label",for:`notification-${e.id}-inApp`},c(_(s)("settings.notifications.inApp")),9,dS)])])):v("",!0)]))),128))])]),l("div",pS,[l("button",{type:"submit",class:"btn btn-primary",disabled:u.value},[u.value?(g(),o("i",vS)):v("",!0),d(" "+c(_(s)("common.save")),1)],8,mS)])],32))])]))}}),fS=Vt(hS,[["__scopeId","data-v-2bb72a76"]]),gS={class:"view-container"},yS={class:"header-box"},bS={class:"page-description"},_S={class:"settings-section"},kS={key:0,class:"loading-state"},wS={class:"loading-state-text"},SS={class:"settings-group"},ES={class:"form-group"},CS={class:"form-label"},TS={class:"form-group"},AS={class:"form-label"},IS={class:"form-group"},RS={class:"form-label"},xS={class:"form-group"},OS={class:"form-check"},PS={class:"form-check-label",for:"autoSendInvoices"},NS={class:"form-group"},MS={class:"form-check"},DS={class:"form-check-label",for:"autoSendReceipts"},LS={class:"settings-group"},US={class:"form-group"},qS={class:"form-check"},VS={class:"form-check-label",for:"enableTaxes"},$S={key:0},jS={class:"form-group"},FS={class:"form-label"},GS={class:"form-group"},BS={class:"form-label"},HS={class:"input-group"},WS={class:"form-group"},zS={class:"form-check"},KS={class:"form-check-label",for:"taxNumberRequired"},JS={class:"settings-group"},YS={class:"payment-methods"},XS={class:"payment-method-header"},QS={class:"form-check"},ZS=["id","onUpdate:modelValue"],eE=["for"],tE={key:0,class:"payment-method-settings"},sE={key:0,class:"payment-method-fields"},aE={class:"form-group"},iE={class:"form-label"},nE=["onUpdate:modelValue"],rE={class:"form-group"},oE={class:"form-label"},lE=["onUpdate:modelValue"],cE={key:1,class:"payment-method-fields"},uE={class:"form-group"},dE={class:"form-label"},pE=["onUpdate:modelValue"],mE={class:"form-group"},vE={class:"form-label"},hE=["onUpdate:modelValue"],fE={class:"form-group"},gE={class:"form-check"},yE=["onUpdate:modelValue"],bE={class:"form-check-label",for:"paypal-sandbox"},_E={key:2,class:"payment-method-fields"},kE={class:"form-group"},wE={class:"form-label"},SE=["onUpdate:modelValue"],EE={class:"form-actions"},CE=["disabled"],TE={key:0,class:"fas fa-spinner fa-spin"},AE=r({__name:"BillingView",setup(t){const{t:s}=b(),a=x_(),n=He(),r=e(!0),u=e(!1),p=e({invoicePrefix:"INV-",nextInvoiceNumber:1,defaultDueDays:15,autoSendInvoices:!0,autoSendReceipts:!0,enableTaxes:!0,defaultTaxName:"TVA",defaultTaxRate:20,taxNumberRequired:!1}),m=M([{id:"stripe",name:"Stripe",enabled:!1,config:{publicKey:"",secretKey:""}},{id:"paypal",name:"PayPal",enabled:!1,config:{clientId:"",clientSecret:"",sandbox:!0}},{id:"bank",name:s("settings.billing.bankTransfer"),enabled:!0,config:{details:""}},{id:"cash",name:s("settings.billing.cash"),enabled:!0,config:{}}]),y=async()=>{try{u.value=!0;const e={general:p.value,paymentMethods:m};await a.updateBillingSettings(e),n.success(s("settings.saveSuccess"))}catch(e){ne.error("Erreur lors de la sauvegarde des paramètres de facturation",{error:e}),n.notificationError(s("settings.saveError"))}finally{u.value=!1}};return i(async()=>{await(async()=>{try{r.value=!0;const e=await a.fetchBillingSettings();e.general&&(p.value=e.general),e.paymentMethods&&(Array.isArray(e.paymentMethods)?e.paymentMethods.forEach(e=>{const t=m.find(t=>t.id===e.id);t&&(t.enabled=e.enabled,e.config&&(t.config={...t.config,...e.config}))}):Object.entries(e.paymentMethods).forEach(([e,t])=>{const s=m.find(t=>t.id===e);s&&t&&(s.enabled=t.enabled,t.config&&(s.config={...s.config,...t.config}))}))}catch(e){ne.error("Erreur lors du chargement des paramètres de facturation",{error:e}),n.notificationError(s("settings.loadError"))}finally{r.value=!1}})()}),(e,t)=>(g(),o("div",gS,[l("div",yS,[l("div",null,[l("h1",null,c(_(s)("settings.billing.title")),1),l("div",bS,c(_(s)("settings.billing.description")),1)])]),l("div",_S,[r.value?(g(),o("div",kS,[t[9]||(t[9]=l("div",{class:"loading-state-icon"},[l("i",{class:"fas fa-spinner fa-spin"})],-1)),l("div",wS,c(_(s)("common.loading")),1)])):(g(),o("form",{key:1,class:"table-box",onSubmit:k(y,["prevent"])},[l("div",SS,[l("h3",null,c(_(s)("settings.billing.general")),1),l("div",ES,[l("label",CS,c(_(s)("settings.billing.invoicePrefix")),1),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>p.value.invoicePrefix=e),type:"text",class:"form-control",placeholder:"INV-"},null,512),[[S,p.value.invoicePrefix]])]),l("div",TS,[l("label",AS,c(_(s)("settings.billing.nextInvoiceNumber")),1),w(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>p.value.nextInvoiceNumber=e),type:"number",class:"form-control",min:"1"},null,512),[[S,p.value.nextInvoiceNumber]])]),l("div",IS,[l("label",RS,c(_(s)("settings.billing.defaultDueDays")),1),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>p.value.defaultDueDays=e),type:"number",class:"form-control",min:"0"},null,512),[[S,p.value.defaultDueDays]])]),l("div",xS,[l("div",OS,[w(l("input",{id:"autoSendInvoices","onUpdate:modelValue":t[3]||(t[3]=e=>p.value.autoSendInvoices=e),type:"checkbox",class:"form-check-input"},null,512),[[C,p.value.autoSendInvoices]]),l("label",PS,c(_(s)("settings.billing.autoSendInvoices")),1)])]),l("div",NS,[l("div",MS,[w(l("input",{id:"autoSendReceipts","onUpdate:modelValue":t[4]||(t[4]=e=>p.value.autoSendReceipts=e),type:"checkbox",class:"form-check-input"},null,512),[[C,p.value.autoSendReceipts]]),l("label",DS,c(_(s)("settings.billing.autoSendReceipts")),1)])])]),l("div",LS,[l("h3",null,c(_(s)("settings.billing.taxes")),1),l("div",US,[l("div",qS,[w(l("input",{id:"enableTaxes","onUpdate:modelValue":t[5]||(t[5]=e=>p.value.enableTaxes=e),type:"checkbox",class:"form-check-input"},null,512),[[C,p.value.enableTaxes]]),l("label",VS,c(_(s)("settings.billing.enableTaxes")),1)])]),p.value.enableTaxes?(g(),o("div",$S,[l("div",jS,[l("label",FS,c(_(s)("settings.billing.defaultTaxName")),1),w(l("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>p.value.defaultTaxName=e),type:"text",class:"form-control",placeholder:"TVA"},null,512),[[S,p.value.defaultTaxName]])]),l("div",GS,[l("label",BS,c(_(s)("settings.billing.defaultTaxRate")),1),l("div",HS,[w(l("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>p.value.defaultTaxRate=e),type:"number",class:"form-control",min:"0",step:"0.01"},null,512),[[S,p.value.defaultTaxRate]]),t[10]||(t[10]=l("div",{class:"input-group-append"},[l("span",{class:"input-group-text"},"%")],-1))])]),l("div",WS,[l("div",zS,[w(l("input",{id:"taxNumberRequired","onUpdate:modelValue":t[8]||(t[8]=e=>p.value.taxNumberRequired=e),type:"checkbox",class:"form-check-input"},null,512),[[C,p.value.taxNumberRequired]]),l("label",KS,c(_(s)("settings.billing.taxNumberRequired")),1)])])])):v("",!0)]),l("div",JS,[l("h3",null,c(_(s)("settings.billing.paymentMethods")),1),l("div",YS,[(g(!0),o(h,null,f(m,e=>(g(),o("div",{key:e.id,class:"payment-method"},[l("div",XS,[l("div",QS,[w(l("input",{id:`payment-${e.id}`,"onUpdate:modelValue":t=>e.enabled=t,type:"checkbox",class:"form-check-input"},null,8,ZS),[[C,e.enabled]]),l("label",{class:"form-check-label",for:`payment-${e.id}`},c(e.name),9,eE)])]),e.enabled?(g(),o("div",tE,["stripe"===e.id?(g(),o("div",sE,[l("div",aE,[l("label",iE,c(_(s)("settings.billing.stripePublicKey")),1),w(l("input",{"onUpdate:modelValue":t=>e.config.publicKey=t,type:"text",class:"form-control"},null,8,nE),[[S,e.config.publicKey]])]),l("div",rE,[l("label",oE,c(_(s)("settings.billing.stripeSecretKey")),1),w(l("input",{"onUpdate:modelValue":t=>e.config.secretKey=t,type:"password",class:"form-control"},null,8,lE),[[S,e.config.secretKey]])])])):v("",!0),"paypal"===e.id?(g(),o("div",cE,[l("div",uE,[l("label",dE,c(_(s)("settings.billing.paypalClientId")),1),w(l("input",{"onUpdate:modelValue":t=>e.config.clientId=t,type:"text",class:"form-control"},null,8,pE),[[S,e.config.clientId]])]),l("div",mE,[l("label",vE,c(_(s)("settings.billing.paypalClientSecret")),1),w(l("input",{"onUpdate:modelValue":t=>e.config.clientSecret=t,type:"password",class:"form-control"},null,8,hE),[[S,e.config.clientSecret]])]),l("div",fE,[l("div",gE,[w(l("input",{id:"paypal-sandbox","onUpdate:modelValue":t=>e.config.sandbox=t,type:"checkbox",class:"form-check-input"},null,8,yE),[[C,e.config.sandbox]]),l("label",bE,c(_(s)("settings.billing.paypalSandbox")),1)])])])):v("",!0),"bank"===e.id?(g(),o("div",_E,[l("div",kE,[l("label",wE,c(_(s)("settings.billing.bankDetails")),1),w(l("textarea",{"onUpdate:modelValue":t=>e.config.details=t,class:"form-control",rows:"4"},null,8,SE),[[S,e.config.details]])])])):v("",!0)])):v("",!0)]))),128))])]),l("div",EE,[l("button",{type:"submit",class:"btn btn-primary",disabled:u.value},[u.value?(g(),o("i",TE)):v("",!0),d(" "+c(_(s)("common.save")),1)],8,CE)])],32))])]))}}),IE=Vt(AE,[["__scopeId","data-v-1633698a"]]),RE={lessThanXSeconds:{one:"moins d’une seconde",other:"moins de {{count}} secondes"},xSeconds:{one:"1 seconde",other:"{{count}} secondes"},halfAMinute:"30 secondes",lessThanXMinutes:{one:"moins d’une minute",other:"moins de {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"environ 1 heure",other:"environ {{count}} heures"},xHours:{one:"1 heure",other:"{{count}} heures"},xDays:{one:"1 jour",other:"{{count}} jours"},aboutXWeeks:{one:"environ 1 semaine",other:"environ {{count}} semaines"},xWeeks:{one:"1 semaine",other:"{{count}} semaines"},aboutXMonths:{one:"environ 1 mois",other:"environ {{count}} mois"},xMonths:{one:"1 mois",other:"{{count}} mois"},aboutXYears:{one:"environ 1 an",other:"environ {{count}} ans"},xYears:{one:"1 an",other:"{{count}} ans"},overXYears:{one:"plus d’un an",other:"plus de {{count}} ans"},almostXYears:{one:"presqu’un an",other:"presque {{count}} ans"}},xE={date:K({formats:{full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},defaultWidth:"full"}),time:K({formats:{full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},defaultWidth:"full"}),dateTime:K({formats:{full:"{{date}} 'à' {{time}}",long:"{{date}} 'à' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},OE={lastWeek:"eeee 'dernier à' p",yesterday:"'hier à' p",today:"'aujourd’hui à' p",tomorrow:"'demain à' p'",nextWeek:"eeee 'prochain à' p",other:"P"},PE=["MMM","MMMM"],NE={code:"fr",formatDistance:(e,t,s)=>{let a;const i=RE[e];return a="string"==typeof i?i:1===t?i.one:i.other.replace("{{count}}",String(t)),(null==s?void 0:s.addSuffix)?s.comparison&&s.comparison>0?"dans "+a:"il y a "+a:a},formatLong:xE,formatRelative:(e,t,s,a)=>OE[e],localize:{preprocessor:(e,t)=>{if(1===e.getDate())return t;return t.some(e=>e.isToken&&PE.includes(e.value))?t.map(e=>e.isToken&&"do"===e.value?{isToken:!0,value:"d"}:e):t},ordinalNumber:(e,t)=>{const s=Number(e),a=null==t?void 0:t.unit;if(0===s)return"0";let i;return i=1===s?a&&["year","week","hour","minute","second"].includes(a)?"ère":"er":"ème",s+i},era:J({values:{narrow:["av. J.-C","ap. J.-C"],abbreviated:["av. J.-C","ap. J.-C"],wide:["avant Jésus-Christ","après Jésus-Christ"]},defaultWidth:"wide"}),quarter:J({values:{narrow:["T1","T2","T3","T4"],abbreviated:["1er trim.","2ème trim.","3ème trim.","4ème trim."],wide:["1er trimestre","2ème trimestre","3ème trimestre","4ème trimestre"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:J({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],wide:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"]},defaultWidth:"wide"}),day:J({values:{narrow:["D","L","M","M","J","V","S"],short:["di","lu","ma","me","je","ve","sa"],abbreviated:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],wide:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},defaultWidth:"wide"}),dayPeriod:J({values:{narrow:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"mat.",afternoon:"ap.m.",evening:"soir",night:"mat."},abbreviated:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"matin",afternoon:"après-midi",evening:"soir",night:"matin"},wide:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"du matin",afternoon:"de l’après-midi",evening:"du soir",night:"du matin"}},defaultWidth:"wide"})},match:{ordinalNumber:X({matchPattern:/^(\d+)(ième|ère|ème|er|e)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e)}),era:Y({matchPatterns:{narrow:/^(av\.J\.C|ap\.J\.C|ap\.J\.-C)/i,abbreviated:/^(av\.J\.-C|av\.J-C|apr\.J\.-C|apr\.J-C|ap\.J-C)/i,wide:/^(avant Jésus-Christ|après Jésus-Christ)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^av/i,/^ap/i]},defaultParseWidth:"any"}),quarter:Y({matchPatterns:{narrow:/^T?[1234]/i,abbreviated:/^[1234](er|ème|e)? trim\.?/i,wide:/^[1234](er|ème|e)? trimestre/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:Y({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(janv|févr|mars|avr|mai|juin|juill|juil|août|sept|oct|nov|déc)\.?/i,wide:/^(janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^av/i,/^ma/i,/^juin/i,/^juil/i,/^ao/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Y({matchPatterns:{narrow:/^[lmjvsd]/i,short:/^(di|lu|ma|me|je|ve|sa)/i,abbreviated:/^(dim|lun|mar|mer|jeu|ven|sam)\.?/i,wide:/^(dimanche|lundi|mardi|mercredi|jeudi|vendredi|samedi)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^di/i,/^lu/i,/^ma/i,/^me/i,/^je/i,/^ve/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Y({matchPatterns:{narrow:/^(a|p|minuit|midi|mat\.?|ap\.?m\.?|soir|nuit)/i,any:/^([ap]\.?\s?m\.?|du matin|de l'après[-\s]midi|du soir|de la nuit)/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^min/i,noon:/^mid/i,morning:/mat/i,afternoon:/ap/i,evening:/soir/i,night:/nuit/i}},defaultParseWidth:"any"})},options:{weekStartsOn:1,firstWeekContainsDate:4}},ME={class:"view-container"},DE={class:"header-box"},LE={class:"page-description"},UE={class:"settings-section"},qE={key:0,class:"loading-state"},VE={class:"loading-state-text"},$E={key:1},jE={class:"settings-group table-box"},FE={class:"settings-group-description"},GE={class:"api-keys-section"},BE={class:"api-keys-header"},HE=["disabled"],WE={key:0,class:"fas fa-spinner fa-spin"},zE={key:1,class:"fas fa-plus"},KE={key:0,class:"new-api-key"},JE={class:"alert alert-success"},YE={class:"alert-header"},XE={class:"alert-content"},QE={class:"api-key-display"},ZE={class:"api-keys-table"},eC={key:0},tC=["onClick"],sC={key:1,class:"no-keys"},aC={class:"settings-group table-box"},iC={class:"settings-group-description"},nC={class:"webhooks-section"},rC={class:"webhooks-header"},oC={class:"webhooks-table"},lC={key:0},cC={class:"webhook-url"},uC={key:0,class:"webhook-events"},dC={class:"event-badges"},pC={class:"action-buttons"},mC=["onClick"],vC=["onClick"],hC=["onClick"],fC={key:1,class:"no-webhooks"},gC={key:0,class:"modal-overlay"},yC={class:"modal-container"},bC={class:"modal-header"},_C={class:"modal-body"},kC={class:"form-group"},wC={class:"form-label"},SC={class:"form-group"},EC={class:"form-label"},CC={class:"form-group"},TC={for:"webhook-events"},AC={class:"webhook-events-selection"},IC=["id","value"],RC=["for"],xC={class:"form-group"},OC={class:"form-check"},PC={class:"form-check-label",for:"webhook-active"},NC={class:"form-group"},MC={class:"form-check"},DC={class:"form-check-label",for:"webhook-test"},LC={class:"modal-actions"},UC=["disabled"],qC={key:0,class:"fas fa-spinner fa-spin"},VC=Vt(r({__name:"IntegrationsView",setup(t){const{t:s}=b(),a=x_(),n=He(),r=e(!0),u=e([]),p=e([]),m=e(null),E=e(!1),T=e(!1),A=e(!1),I=e(null),R=e(null),x=M({id:null,name:"",url:"",events:[],active:!0,sendTest:!1,secret:""}),O=e([{id:"client.created",name:s("settings.integrations.events.clientCreated"),group:"clients"},{id:"client.updated",name:s("settings.integrations.events.clientUpdated"),group:"clients"},{id:"invoice.created",name:s("settings.integrations.events.invoiceCreated"),group:"billing"},{id:"invoice.paid",name:s("settings.integrations.events.invoicePaid"),group:"billing"},{id:"payment.received",name:s("settings.integrations.events.paymentReceived"),group:"billing"},{id:"ticket.created",name:s("settings.integrations.events.ticketCreated"),group:"support"},{id:"ticket.replied",name:s("settings.integrations.events.ticketReplied"),group:"support"},{id:"ticket.closed",name:s("settings.integrations.events.ticketClosed"),group:"support"},{id:"service.created",name:s("settings.integrations.events.serviceCreated"),group:"services"},{id:"service.updated",name:s("settings.integrations.events.serviceUpdated"),group:"services"},{id:"service.expired",name:s("settings.integrations.events.serviceExpired"),group:"services"}]),P=async()=>{try{E.value=!0;const e=await a.generateApiKey();m.value=e,e&&e.id&&u.value.push(e),n.showNotification({type:"success",title:s("common.success"),message:s("settings.integrations.keyGeneratedSuccess")})}catch(e){ne.error("Erreur lors de la génération de la clé API",{error:e}),n.showNotification({type:"error",title:s("common.error"),message:s("settings.integrations.keyGenerationError")})}finally{E.value=!1}},N=()=>{T.value=!1,setTimeout(()=>{x.id=null,x.name="",x.url="",x.events=[],x.active=!0,x.sendTest=!1},300)},D=()=>{x.id=null,x.name="",x.url="",x.events=[],x.active=!0,x.secret="",x.sendTest=!1,T.value=!0},L=async()=>{try{A.value=!0;const e={name:x.name,url:x.url,events:x.events,active:x.active,secret:x.secret,sendTest:x.sendTest};null!==x.id&&(e.id=x.id);const t=await a.saveWebhook(e);if(null!==x.id){const e=p.value.findIndex(e=>e.id===x.id);-1!==e&&t&&(p.value[e]=t)}else t&&p.value.push(t);n.showNotification({type:"success",title:s("common.success"),message:s("settings.integrations.webhookSavedSuccess")}),N()}catch(e){ne.error("Erreur lors de la sauvegarde du webhook",{webhook:x,error:e}),n.showNotification({type:"error",title:s("common.error"),message:s("settings.integrations.webhookSaveError")})}finally{A.value=!1}},U=e=>{if(!e)return"-";try{const t=new Date(e);return Q(t,"dd MMM yyyy HH:mm",{locale:NE})}catch{return e||"-"}};return i(async()=>{await(async()=>{try{r.value=!0;const e=await a.fetchIntegrationSettings();e.apiKeys&&(u.value=e.apiKeys),e.webhooks&&(p.value=e.webhooks)}catch(e){ne.error("Erreur lors du chargement des paramètres d'intégration",{error:e}),n.showNotification({type:"error",title:s("common.error"),message:s("settings.loadError")})}finally{r.value=!1}})()}),(e,t)=>(g(),o("div",ME,[l("div",DE,[l("div",null,[l("h1",null,c(_(s)("settings.integrations.title")),1),l("div",LE,c(_(s)("settings.integrations.description")),1)])]),l("div",UE,[r.value?(g(),o("div",qE,[t[6]||(t[6]=l("div",{class:"loading-state-icon"},[l("i",{class:"fas fa-spinner fa-spin"})],-1)),l("div",VE,c(_(s)("common.loading")),1)])):(g(),o("div",$E,[l("div",jE,[l("h3",null,c(_(s)("settings.integrations.apiKeys")),1),l("p",FE,c(_(s)("settings.integrations.apiKeysDescription")),1),l("div",GE,[l("div",BE,[l("button",{class:"btn btn-primary",disabled:E.value,onClick:P},[E.value?(g(),o("i",WE)):(g(),o("i",zE)),d(" "+c(_(s)("settings.integrations.generateKey")),1)],8,HE)]),m.value?(g(),o("div",KE,[l("div",JE,[l("div",YE,[t[7]||(t[7]=l("i",{class:"fas fa-check-circle"},null,-1)),d(" "+c(_(s)("settings.integrations.newKeyGenerated")),1)]),l("div",XE,[l("p",null,c(_(s)("settings.integrations.copyKeyWarning")),1),l("div",QE,[l("code",null,c(m.value.token),1),l("button",{class:"btn btn-icon",title:"Copier",onClick:t[0]||(t[0]=e=>{return t=m.value.token||"",void navigator.clipboard.writeText(t).then(()=>{n.showNotification({type:"success",title:s("common.success"),message:s("settings.integrations.keyCopiedSuccess")})}).catch(()=>{n.showNotification({type:"error",title:s("common.error"),message:s("settings.integrations.keyCopyError")})});var t})},t[8]||(t[8]=[l("i",{class:"fas fa-copy"},null,-1)]))])])])])):v("",!0),l("div",ZE,[u.value.length>0?(g(),o("table",eC,[l("thead",null,[l("tr",null,[l("th",null,c(_(s)("settings.integrations.keyName")),1),l("th",null,c(_(s)("settings.integrations.createdAt")),1),l("th",null,c(_(s)("settings.integrations.lastUsed")),1),l("th",null,c(_(s)("settings.integrations.expiresAt")),1),l("th",null,c(_(s)("common.actions")),1)])]),l("tbody",null,[(g(!0),o(h,null,f(u.value,e=>(g(),o("tr",{key:e.id},[l("td",null,c(e.name),1),l("td",null,c(U(e.createdAt)),1),l("td",null,c(e.lastUsed?U(e.lastUsed):_(s)("common.never")),1),l("td",null,c(e.expiresAt?U(e.expiresAt):_(s)("common.never")),1),l("td",null,[l("button",{class:"btn btn-icon btn-danger",title:"Supprimer",onClick:t=>(async e=>{if(confirm(s("settings.integrations.confirmDeleteKey")))try{I.value=e,await a.deleteApiKey(e.toString()),u.value=u.value.filter(t=>t.id!==e),n.showNotification({type:"success",title:s("common.success"),message:s("settings.integrations.keyDeletedSuccess")})}catch(t){ne.error("Erreur lors de la suppression de la clé API",{id:e,error:t}),n.showNotification({type:"error",title:s("common.error"),message:s("settings.integrations.keyDeletionError")})}finally{I.value=null}})(e.id)},t[9]||(t[9]=[l("i",{class:"fas fa-trash"},null,-1)]),8,tC)])]))),128))])])):(g(),o("div",sC,c(_(s)("settings.integrations.noKeysFound")),1))])])]),l("div",aC,[l("h3",null,c(_(s)("settings.integrations.webhooks")),1),l("p",iC,c(_(s)("settings.integrations.webhooksDescription")),1),l("div",nC,[l("div",rC,[l("button",{class:"btn btn-primary",onClick:D},[t[10]||(t[10]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(_(s)("settings.integrations.addWebhook")),1)])]),l("div",oC,[p.value.length>0?(g(),o("table",lC,[l("thead",null,[l("tr",null,[l("th",null,c(_(s)("settings.integrations.webhookName")),1),l("th",null,c(_(s)("settings.integrations.webhookUrl")),1),l("th",null,c(_(s)("settings.integrations.webhookEvents")),1),l("th",null,c(_(s)("settings.integrations.webhookStatus")),1),l("th",null,c(_(s)("common.actions")),1)])]),l("tbody",null,[(g(!0),o(h,null,f(p.value,e=>(g(),o("tr",{key:e.id},[l("td",null,c(e.name),1),l("td",cC,c(e.url),1),l("td",null,[e.events.length>0?(g(),o("div",uC,[l("label",null,c(_(s)("settings.integrations.events"))+":",1),l("div",dC,[(g(!0),o(h,null,f(e.events,e=>{var t;return g(),o("span",{key:e,class:"event-badge"},c((null==(t=O.value.find(t=>t.id===e))?void 0:t.name)||e),1)}),128))])])):v("",!0)]),l("td",null,[l("span",{class:y(["status-badge",e.active?"status-active":"status-inactive"])},c(e.active?_(s)("common.active"):_(s)("common.inactive")),3)]),l("td",null,[l("div",pC,[l("button",{class:"btn btn-icon",title:"Modifier",onClick:t=>(e=>{x.id=e.id,x.name=e.name,x.url=e.url,x.events=[...e.events],x.active=e.active,x.sendTest=!1,T.value=!0})(e)},t[11]||(t[11]=[l("i",{class:"fas fa-edit"},null,-1)]),8,mC),l("button",{class:"btn btn-icon",title:"Activer/Désactiver",onClick:t=>(async(e,t)=>{try{await a.toggleWebhookStatus(e.toString(),t);const i=p.value.find(t=>t.id===e);i&&(i.active=t),n.showNotification({type:"success",title:s("common.success"),message:s(t?"settings.integrations.webhookEnabled":"settings.integrations.webhookDisabled")})}catch(i){ne.error("Erreur lors de la modification du statut du webhook",{id:e,active:t,error:i}),n.showNotification({type:"error",title:s("common.error"),message:s("settings.integrations.webhookToggleError")})}})(e.id,!e.active)},[l("i",{class:y(e.active?"fas fa-toggle-on":"fas fa-toggle-off")},null,2)],8,vC),l("button",{class:"btn btn-icon btn-danger",title:"Supprimer",onClick:t=>(async e=>{if(confirm(s("settings.integrations.confirmDeleteWebhook")))try{R.value=e,await a.deleteWebhook(e.toString()),p.value=p.value.filter(t=>t.id!==e),n.showNotification({type:"success",title:s("common.success"),message:s("settings.integrations.webhookDeletedSuccess")})}catch(t){ne.error("Erreur lors de la suppression du webhook",{id:e,error:t}),n.showNotification({type:"error",title:s("common.error"),message:s("settings.integrations.webhookDeletionError")})}finally{R.value=null}})(e.id)},t[12]||(t[12]=[l("i",{class:"fas fa-trash"},null,-1)]),8,hC)])])]))),128))])])):(g(),o("div",fC,c(_(s)("settings.integrations.noWebhooksFound")),1))])])])]))]),T.value?(g(),o("div",gC,[l("div",yC,[l("div",bC,[l("h3",null,c(null!==x.id?_(s)("settings.integrations.editWebhook"):_(s)("settings.integrations.addWebhook")),1),l("button",{class:"btn-close",onClick:N},t[13]||(t[13]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",_C,[l("form",{onSubmit:k(L,["prevent"])},[l("div",kC,[l("label",wC,c(_(s)("settings.integrations.webhookName")),1),w(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>x.name=e),type:"text",class:"form-control",required:""},null,512),[[S,x.name]])]),l("div",SC,[l("label",EC,c(_(s)("settings.integrations.webhookUrl")),1),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>x.url=e),type:"url",class:"form-control",required:""},null,512),[[S,x.url]])]),l("div",CC,[l("label",TC,c(_(s)("settings.integrations.events")),1),l("div",AC,[(g(!0),o(h,null,f(O.value,e=>(g(),o("div",{key:e.id,class:"webhook-event-checkbox"},[w(l("input",{id:`event-${e.id}`,"onUpdate:modelValue":t[3]||(t[3]=e=>x.events=e),type:"checkbox",value:e.id},null,8,IC),[[C,x.events]]),l("label",{for:`event-${e.id}`},c(e.name),9,RC)]))),128))])]),l("div",xC,[l("div",OC,[w(l("input",{id:"webhook-active","onUpdate:modelValue":t[4]||(t[4]=e=>x.active=e),type:"checkbox",class:"form-check-input"},null,512),[[C,x.active]]),l("label",PC,c(_(s)("settings.integrations.webhookActive")),1)])]),l("div",NC,[l("div",MC,[w(l("input",{id:"webhook-test","onUpdate:modelValue":t[5]||(t[5]=e=>x.sendTest=e),type:"checkbox",class:"form-check-input"},null,512),[[C,x.sendTest]]),l("label",DC,c(_(s)("settings.integrations.sendTestEvent")),1)])]),l("div",LC,[l("button",{type:"button",class:"btn btn-secondary",onClick:N},c(_(s)("common.cancel")),1),l("button",{type:"submit",class:"btn btn-primary",disabled:A.value},[A.value?(g(),o("i",qC)):v("",!0),d(" "+c(_(s)("common.save")),1)],8,UC)])],32)])])])):v("",!0)]))}}),[["__scopeId","data-v-3041ca39"]]),$C={class:"view-container"},jC={class:"header-box"},FC={class:"page-description"},GC={class:"settings-section"},BC={key:0,class:"loading-state"},HC={class:"loading-state-text"},WC={key:1,class:"license-container"},zC={class:"settings-group"},KC={key:0,class:"license-info"},JC={class:"license-status valid"},YC={class:"license-details"},XC={class:"license-detail"},QC={class:"detail-label"},ZC={class:"detail-value"},eT={class:"license-detail"},tT={class:"detail-label"},sT={class:"detail-value"},aT={key:0,class:"license-detail"},iT={class:"detail-label"},nT={class:"detail-value"},rT={class:"license-detail"},oT={class:"detail-label"},lT={class:"detail-value"},cT={key:1,class:"license-info"},uT={class:"license-status invalid"},dT={class:"license-message"},pT={class:"license-actions"},mT=["disabled"],vT={key:0,class:"fas fa-spinner fa-spin"},hT={key:1,class:"fas fa-sync-alt"},fT={key:0,class:"settings-group"},gT={class:"license-features"},yT={class:"feature-icon"},bT={class:"feature-details"},_T={class:"feature-name"},kT={class:"feature-description"},wT={key:0,class:"modal-overlay"},ST={class:"modal-container"},ET={class:"modal-header"},CT={class:"modal-body"},TT={class:"form-group"},AT={class:"form-label"},IT={class:"form-text"},RT={class:"modal-actions"},xT=["disabled"],OT={key:0,class:"fas fa-spinner fa-spin"},PT=Vt(r({__name:"LicenseView",setup(t){const{t:a}=b(),n=x_(),r=He(),u=e(!0),p=e({status:"invalid",key:"",registered_to:"",product:"",expires_at:void 0,message:""}),m=e(""),E=e(!1),C=e(!1),T=e(!1),A=s(()=>{const e=e=>{var t,s;return(null==(t=p.value.product)?void 0:t.includes(e))||(null==(s=p.value.features)?void 0:s.includes(e))||!1};return[{name:a("settings.license.features.multipleUsers"),description:a("settings.license.features.multipleUsersDesc"),enabled:!0},{name:a("settings.license.features.api"),description:a("settings.license.features.apiDesc"),enabled:!0},{name:a("settings.license.features.whiteLabel"),description:a("settings.license.features.whiteLabelDesc"),enabled:e("white-label")},{name:a("settings.license.features.multipleServers"),description:a("settings.license.features.multipleServersDesc"),enabled:e("multiple-servers")},{name:a("settings.license.features.advancedReporting"),description:a("settings.license.features.advancedReportingDesc"),enabled:e("advanced-reporting")},{name:a("settings.license.features.prioritySupport"),description:a("settings.license.features.prioritySupportDesc"),enabled:e("priority-support")}]}),I=async()=>{try{C.value=!0;const e=await n.activateLicense(m.value);e&&e.success&&e.license?(p.value=e.license,r.success(a("settings.license.activationSuccess")),x()):e&&r.showNotification({title:"Erreur",message:e.message||"Erreur lors de l'activation de la licence",type:"error"})}catch(e){ne.error("Erreur lors de l'activation de la licence",{licenseKey:m.value,error:e}),r.notificationError(a("settings.license.activationError"))}finally{C.value=!1}},R=async()=>{try{T.value=!0;const e=await n.checkLicenseStatus();e&&(p.value=e,r.success(a("settings.license.checkSuccess")))}catch(e){ne.error("Erreur lors de la vérification de la licence",{error:e}),r.notificationError(a("settings.license.checkError"))}finally{T.value=!1}},x=()=>{E.value=!1,setTimeout(()=>{m.value=""},300)},O=e=>{if(!e)return"-";return new Date(e).toLocaleDateString()};return i(async()=>{await(async()=>{try{u.value=!0;const e=await n.fetchLicenseInfo();e&&(p.value=e)}catch(e){ne.error("Erreur lors du chargement des informations de licence",{error:e}),r.notificationError(a("settings.loadError"))}finally{u.value=!1}})()}),(e,t)=>{return g(),o("div",$C,[l("div",jC,[l("div",null,[l("h1",null,c(_(a)("settings.license.title")),1),l("div",FC,c(_(a)("settings.license.description")),1)])]),l("div",GC,[u.value?(g(),o("div",BC,[t[2]||(t[2]=l("div",{class:"loading-state-icon"},[l("i",{class:"fas fa-spinner fa-spin"})],-1)),l("div",HC,c(_(a)("common.loading")),1)])):(g(),o("div",WC,[l("div",zC,[l("h3",null,c(_(a)("settings.license.information")),1),"valid"===p.value.status?(g(),o("div",KC,[l("div",JC,[t[3]||(t[3]=l("i",{class:"fas fa-check-circle"},null,-1)),d(" "+c(_(a)("settings.license.valid")),1)]),l("div",YC,[l("div",XC,[l("div",QC,c(_(a)("settings.license.licenseKey")),1),l("div",ZC,c((s=p.value.key,s?s.length<8?s:s.substring(0,4)+"****"+s.substring(s.length-4):"")),1)]),l("div",eT,[l("div",tT,c(_(a)("settings.license.product")),1),l("div",sT,c(p.value.product),1)]),p.value.type?(g(),o("div",aT,[l("div",iT,c(_(a)("settings.license.type")),1),l("div",nT,c(p.value.type),1)])):v("",!0),l("div",rT,[l("div",oT,c(_(a)("settings.license.expiresAt")),1),l("div",lT,c(p.value.expires_at?O(p.value.expires_at):_(a)("common.never")),1)])])])):(g(),o("div",cT,[l("div",uT,[t[4]||(t[4]=l("i",{class:"fas fa-exclamation-circle"},null,-1)),d(" "+c(_(a)("settings.license.invalid")),1)]),l("div",dT,c(p.value.message||_(a)("settings.license.noLicense")),1)])),l("div",pT,[l("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=e=>E.value=!0)},c("valid"===p.value.status?_(a)("settings.license.update"):_(a)("settings.license.activate")),1),"valid"===p.value.status?(g(),o("button",{key:0,class:"btn btn-secondary",disabled:T.value,onClick:R},[T.value?(g(),o("i",vT)):(g(),o("i",hT)),d(" "+c(_(a)("settings.license.check")),1)],8,mT)):v("",!0)])]),"valid"===p.value.status?(g(),o("div",fT,[l("h3",null,c(_(a)("settings.license.features")),1),l("div",gT,[(g(!0),o(h,null,f(A.value,(e,t)=>(g(),o("div",{key:t,class:"license-feature"},[l("div",yT,[l("i",{class:y(e.enabled?"fas fa-check enabled":"fas fa-times disabled")},null,2)]),l("div",bT,[l("div",_T,c(e.name),1),l("div",kT,c(e.description),1)])]))),128))])])):v("",!0)]))]),E.value?(g(),o("div",wT,[l("div",ST,[l("div",ET,[l("h3",null,c("valid"===p.value.status?_(a)("settings.license.updateLicense"):_(a)("settings.license.activateLicense")),1),l("button",{class:"btn-close",onClick:x},t[5]||(t[5]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",CT,[l("form",{onSubmit:k(I,["prevent"])},[l("div",TT,[l("label",AT,c(_(a)("settings.license.licenseKey")),1),w(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e),type:"text",class:"form-control",required:"",placeholder:"XXXX-XXXX-XXXX-XXXX"},null,512),[[S,m.value]]),l("div",IT,c(_(a)("settings.license.licenseKeyHelp")),1)]),l("div",RT,[l("button",{type:"button",class:"btn btn-secondary",onClick:x},c(_(a)("common.cancel")),1),l("button",{type:"submit",class:"btn btn-primary",disabled:C.value},[C.value?(g(),o("i",OT)):v("",!0),d(" "+c(_(a)("common.save")),1)],8,xT)])],32)])])])):v("",!0)]);var s}}}),[["__scopeId","data-v-5371dfd7"]]),NT={class:"view-container"},MT={class:"header-box"},DT={class:"page-title"},LT={class:"page-description"},UT=["disabled"],qT={class:"filter-box"},VT={class:"filter-grid"},$T={class:"filter-group"},jT={class:"filter-label"},FT={class:"filter-input-wrapper"},GT=["placeholder"],BT={class:"filter-group"},HT={class:"filter-label"},WT={class:"filter-input-wrapper"},zT={value:""},KT={value:"active"},JT={value:"inactive"},YT={class:"filter-group"},XT={class:"filter-label"},QT={class:"filter-input-wrapper"},ZT={value:""},eA=["value"],tA={key:0,class:"modules-loading"},sA={key:1,class:"modules-grid"},aA={class:"module-card"},iA={class:"module-header"},nA={class:"module-info"},rA={class:"module-name"},oA={class:"module-version"},lA={class:"module-actions"},cA={class:"module-description"},uA={key:0,class:"module-features"},dA={class:"module-footer"},pA={class:"module-author"},mA={class:"module-status-control"},vA=["disabled","onClick"],hA={class:"module-status"},fA={key:0,class:"no-results"},gA={key:5,class:"field-description"},yA={key:1,class:"no-config"},bA={class:"dialog-footer"},_A={__name:"ModulesView",setup(t){const{t:a}=b(),n=He(),r=e({}),k=e(!0),E=e("servers"),C=e(""),T=e(""),I=e(""),x=e(!1),O=e(!1),P=e(""),N=e(""),M=e([]),D=e({}),L=s(()=>{const e={};return Object.entries(r.value).forEach(([t,s])=>{Object.keys(s).length>0&&(e[t]=s)}),e}),U=s(()=>{const e=I.value||E.value;if(!e||!L.value[e])return{};let t={...L.value[e]};if(C.value){const e=C.value.toLowerCase();t=Object.fromEntries(Object.entries(t).filter(([t,s])=>s.name.toLowerCase().includes(e)||s.description.toLowerCase().includes(e)||s.author.toLowerCase().includes(e)))}return T.value&&(t=Object.fromEntries(Object.entries(t).filter(([e,t])=>"active"===T.value?t.active:!t.active))),t});async function q(){k.value=!0;try{const e=await _e.routes.admin.module.list();if(e.data&&e.data.success){if(r.value=e.data.data,Object.keys(L.value).length>0&&!L.value[E.value]){const e=Object.keys(L.value);e.length>0&&(E.value=e[0])}}else n.notificationError(a("settings.modules.loadError"))}catch(e){ne.error("Erreur lors du chargement des modules",{error:e}),n.notificationError(a("settings.modules.loadError"))}finally{k.value=!1}}async function V(){await q(),n.notificationSuccess(a("settings.modules.refreshSuccess"))}function $(e){E.value=e.props.name}function j(e){return{servers:"fa-server",gateways:"fa-credit-card",addons:"fa-puzzle-piece",fraud:"fa-shield-alt",registrars:"fa-globe",reports:"fa-chart-bar",widgets:"fa-th"}[e]||"fa-cube"}async function F(){var e,t,s;x.value=!0;try{const t=await axios.post("/api/v1/modules/saveconfig",{type:P.value,name:N.value,config:D.value});t.data&&t.data.success?(O.value=!1,n.notificationSuccess("Configuration enregistrée avec succès"),n.notificationInfo("Configuration enregistrée. N'oubliez pas de configurer vos serveurs.")):n.notificationError((null==(e=t.data)?void 0:e.message)||"Erreur lors de la sauvegarde de la configuration")}catch(a){ne.error("Erreur lors de l'enregistrement de la configuration",{moduleType:P.value,moduleName:N.value,error:a}),n.notificationError((null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.message)||"Erreur lors de la sauvegarde de la configuration")}finally{x.value=!1}}return i(async()=>{await q()}),(e,t)=>{const s=m("el-skeleton"),i=m("el-button"),b=m("el-tooltip"),P=m("el-tab-pane"),N=m("el-tabs"),q=m("el-input"),G=m("el-option"),B=m("el-select"),H=m("el-input-number"),W=m("el-switch"),z=m("el-form-item"),K=m("el-form"),J=m("el-dialog");return g(),o("div",NT,[l("div",MT,[l("div",null,[l("h1",DT,c(_(a)("settings.modules.title")),1),l("span",LT,c(_(a)("settings.modules.description")||"Gérez les modules et extensions du système"),1)]),l("button",{class:"btn btn-gradient",disabled:k.value,onClick:V},[l("i",{class:y(["fas fa-sync",{"fa-spin":k.value}])},null,2),d(" "+c(_(a)("common.refresh")),1)],8,UT)]),l("div",qT,[l("div",VT,[l("div",$T,[l("label",jT,c(_(a)("common.search")),1),l("div",FT,[t[6]||(t[6]=l("i",{class:"fas fa-search"},null,-1)),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>C.value=e),type:"text",class:"filter-input",placeholder:_(a)("settings.modules.searchPlaceholder")||"Rechercher un module..."},null,8,GT),[[S,C.value]])])]),l("div",BT,[l("label",HT,c(_(a)("settings.modules.filterByStatus")),1),l("div",WT,[t[7]||(t[7]=l("i",{class:"fas fa-filter"},null,-1)),w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>T.value=e),class:"filter-input"},[l("option",zT,c(_(a)("settings.modules.statusAll")||"Tous"),1),l("option",KT,c(_(a)("settings.modules.statusActive")||"Actifs"),1),l("option",JT,c(_(a)("settings.modules.statusInactive")||"Inactifs"),1)],512),[[A,T.value]])])]),l("div",YT,[l("label",XT,c(_(a)("settings.modules.filterByType")||"Type de module"),1),l("div",QT,[t[8]||(t[8]=l("i",{class:"fas fa-tags"},null,-1)),w(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>I.value=e),class:"filter-input"},[l("option",ZT,c(_(a)("settings.modules.typeAll")||"Tous les types"),1),(g(!0),o(h,null,f(L.value,(e,t)=>(g(),o("option",{key:t,value:t},c(_(a)(`settings.modules.types.${t}`)||t),9,eA))),128))],512),[[A,I.value]])])])])]),u(N,{modelValue:E.value,"onUpdate:modelValue":t[3]||(t[3]=e=>E.value=e),class:"module-tabs",onTabClick:$},{default:p(()=>[(g(!0),o(h,null,f(L.value,(e,d)=>(g(),R(P,{key:d,label:_(a)(`settings.modules.types.${d}`)||d,name:d},{default:p(()=>[k.value?(g(),o("div",tA,[u(s,{animated:"",count:3})])):(g(),o("div",sA,[(g(!0),o(h,null,f(U.value,(e,t)=>(g(),o("div",{key:`${d}-${t}`,class:"module-wrapper"},[l("div",aA,[l("div",iA,[l("div",nA,[l("h3",rA,c(e.display_name||e.name),1),l("span",oA,"v"+c(e.version),1)]),l("div",lA,[u(b,{content:_(a)(`settings.modules.types.${d}`)||d,placement:"top"},{default:p(()=>[u(i,{type:"warning",size:"small",circle:"",onClick:()=>{}},{default:p(()=>[l("i",{class:y(["fas",j(d)])},null,2)]),_:2},1024)]),_:2},1032,["content"])])]),l("div",cA,[l("p",null,c(e.description),1)]),e.features&&Object.keys(e.features).length>0?(g(),o("div",uA,[(g(!0),o(h,null,f(e.features,(e,t)=>(g(),o("span",{key:t,class:y(["feature-badge",e?"feature-enabled":"feature-disabled"])},c(t),3))),128))])):v("",!0),l("div",dA,[l("span",pA,c(_(a)("settings.modules.by"))+" "+c(e.author),1),l("div",mA,[l("button",{class:y(["btn btn-xs module-toggle-btn",e.active?"btn-danger":"btn-success"]),disabled:k.value,onClick:s=>async function(e,t,s){var a,i,o,l,c,u,d,p,m;try{if(!e||!t)return ne.error("Type ou nom de module manquant",{type:e,name:t}),void n.notificationError("Erreur: type ou nom de module manquant");ne.debug("toggleModuleStatus paramètres",{type:e,name:t,isActive:s});const u=s?"activate":"deactivate";ne.debug(`Appel API modules/${u} avec payload`,{payload:{type:e,name:t}});const d={type:e,name:t};ne.debug("Envoi des données via API centralisée",d);const p=s?await _e.routes.admin.module.activate(d):await _e.routes.admin.module.deactivate(d);if(ne.debug(`Réponse API modules/${u} pour ${e}/${t}`,{response:p.data}),p.data&&p.data.success){(null==(i=null==(a=r.value)?void 0:a[e])?void 0:i[t])&&(r.value[e][t].active=s);const o=s?`Module ${t} activé avec succès`:`Module ${t} désactivé avec succès`;n.success(o)}else(null==(l=null==(o=r.value)?void 0:o[e])?void 0:l[t])&&(r.value[e][t].active=!s),n.notificationError((null==(c=p.data)?void 0:c.message)||"Erreur lors de l'action sur le module")}catch(v){ne.error("Erreur lors de la modification du statut du module",{moduleType:e,moduleName:t,error:v}),(null==(d=null==(u=r.value)?void 0:u[e])?void 0:d[t])&&(r.value[e][t].active=!s),n.notificationError((null==(m=null==(p=v.response)?void 0:p.data)?void 0:m.message)||"Erreur lors de l'action sur le module")}}(e.type||E.value,t,!e.active)},c(e.active?_(a)("common.deactivate")||"Désactiver":_(a)("common.activate")||"Activer"),11,vA),l("span",hA,c(e.active?_(a)("settings.modules.active"):_(a)("settings.modules.inactive")),1)])])])]))),128)),0!==U.value.length||k.value?v("",!0):(g(),o("div",fA,[t[9]||(t[9]=l("i",{class:"fas fa-search"},null,-1)),l("h3",null,c(_(a)("settings.modules.noModulesFound")),1),l("p",null,c(C.value?_(a)("settings.modules.noModulesMatchSearch"):T.value?_(a)("settings.modules.noModulesMatchFilter"):_(a)("settings.modules.noModulesAvailable")),1)]))]))]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"]),u(J,{modelValue:O.value,"onUpdate:modelValue":t[5]||(t[5]=e=>O.value=e),title:_(a)("settings.modules.configTitle"),width:"650px",class:"module-config-dialog","close-on-click-modal":!1},{footer:p(()=>[l("span",bA,[u(i,{onClick:t[4]||(t[4]=e=>O.value=!1)},{default:p(()=>[d(c(_(a)("common.cancel")),1)]),_:1}),u(i,{type:"primary",loading:x.value,onClick:F},{default:p(()=>[d(c(_(a)("common.save")),1)]),_:1},8,["loading"])])]),default:p(()=>[M.value.length>0?(g(),R(K,{key:0,class:"module-config-form","label-position":"top"},{default:p(()=>[(g(!0),o(h,null,f(M.value,e=>(g(),R(z,{key:e.name,label:e.label},{default:p(()=>["text"===e.type?(g(),R(q,{key:0,modelValue:D.value[e.name],"onUpdate:modelValue":t=>D.value[e.name]=t,placeholder:e.placeholder||""},null,8,["modelValue","onUpdate:modelValue","placeholder"])):"password"===e.type?(g(),R(q,{key:1,modelValue:D.value[e.name],"onUpdate:modelValue":t=>D.value[e.name]=t,type:"password",placeholder:e.placeholder||"","show-password":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])):"select"===e.type?(g(),R(B,{key:2,modelValue:D.value[e.name],"onUpdate:modelValue":t=>D.value[e.name]=t,placeholder:e.placeholder||_(a)("common.select"),style:{width:"100%"}},{default:p(()=>[(g(!0),o(h,null,f(e.options,e=>(g(),R(G,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):"number"===e.type?(g(),R(H,{key:3,modelValue:D.value[e.name],"onUpdate:modelValue":t=>D.value[e.name]=t,min:e.min||0,max:e.max||1/0,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue","min","max"])):"boolean"===e.type?(g(),R(W,{key:4,modelValue:D.value[e.name],"onUpdate:modelValue":t=>D.value[e.name]=t,"active-color":"#0066FF"},null,8,["modelValue","onUpdate:modelValue"])):v("",!0),e.description?(g(),o("div",gA,[l("small",null,c(e.description),1)])):v("",!0)]),_:2},1032,["label"]))),128))]),_:1})):(g(),o("div",yA,[t[10]||(t[10]=l("i",{class:"el-icon-info-circle"},null,-1)),l("p",null,c(_(a)("settings.modules.noConfigAvailable")),1)]))]),_:1},8,["modelValue","title"])])}}},kA={class:"card mb-4"},wA={class:"card-header d-flex justify-content-between align-items-center"},SA=["disabled"],EA={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},CA={key:1,class:"bi bi-save me-1"},TA={class:"card-body"},AA={class:"form-group mb-3"},IA={class:"form-check form-switch"},RA={key:0,class:"mt-2"},xA={class:"input-group"},OA={class:"form-group mb-3"},PA={class:"form-check form-switch"},NA={class:"form-group mb-3"},MA={class:"form-check form-switch"},DA={key:0,class:"mt-2"},LA={class:"input-group mb-2"},UA={class:"input-group mt-2"},qA={class:"form-group mb-3"},VA={class:"form-check form-switch"},$A={key:0,class:"mt-2"},jA={class:"form-group mb-3"},FA={class:"form-check form-switch"},GA={key:0,class:"mt-2"},BA=["value"];const HA={class:"card mb-4"},WA={class:"card-header d-flex justify-content-between align-items-center"},zA=["disabled"],KA={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},JA={key:1,class:"bi bi-save me-1"},YA={class:"card-body"},XA={class:"form-group mb-3"},QA={class:"form-check form-switch"},ZA={key:0,class:"mt-2"},eI={class:"input-group"},tI={class:"form-group mb-3"},sI={class:"row g-2 mb-2"},aI={class:"col"},iI={class:"input-group"},nI={class:"row g-2 mb-2"},rI={class:"col"},oI={class:"input-group"},lI={class:"row g-2 mb-2"},cI={class:"col"},uI={class:"input-group"},dI={class:"form-group mb-3"},pI={class:"form-check form-switch mb-2"},mI={key:0,class:"mt-2"},vI=["onUpdate:modelValue"],hI=["onClick"],fI={class:"form-group mb-3"},gI={class:"form-check form-switch"},yI={key:0,class:"mt-2"},bI={class:"form-group mb-3"},_I={class:"form-check form-switch"},kI={key:0,class:"mt-2"},wI={class:"row g-2"},SI={class:"col-md-6"},EI={class:"input-group"},CI={class:"col-md-6"},TI={class:"input-group"},AI={class:"form-group mb-3"},II={class:"form-check form-switch"},RI={key:0,class:"mt-2"},xI={class:"input-group"};const OI={class:"card mb-4"},PI={class:"card-header d-flex justify-content-between align-items-center"},NI=["disabled"],MI={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},DI={key:1,class:"bi bi-save me-1"},LI={class:"card-body"},UI={class:"form-group mb-3"},qI={class:"form-check form-switch"},VI={key:0,class:"mt-2"},$I={class:"input-group"},jI={class:"form-group mb-3"},FI={class:"form-check form-switch"},GI={key:0,class:"mt-2"},BI={class:"input-group"},HI={class:"form-group mb-3"},WI={class:"form-check form-switch"},zI={key:0,class:"mt-2"},KI={class:"input-group"},JI={class:"form-group mb-3"},YI={class:"form-check form-switch"},XI={key:0,class:"mt-2"},QI={class:"input-group"},ZI={class:"form-group mb-3"},eR={class:"form-check form-switch"},tR={key:0,class:"mt-2"},sR={class:"form-check"},aR={class:"form-check"},iR={class:"form-group mb-3"},nR={class:"form-check form-switch"},rR={key:0,class:"mt-2"};const oR={class:"card mb-4"},lR={class:"card-header d-flex justify-content-between align-items-center"},cR=["disabled"],uR={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},dR={key:1,class:"bi bi-save me-1"},pR={class:"card-body"},mR={class:"form-group mb-3"},vR={class:"row g-2 mb-2"},hR={class:"col"},fR={class:"input-group"},gR={class:"row g-2 mb-2"},yR={class:"col"},bR={class:"input-group"},_R={class:"row g-2"},kR={class:"col"},wR={class:"input-group"},SR={class:"form-group mb-3"},ER={class:"row g-2 mb-2"},CR={class:"col"},TR={class:"input-group"},AR={class:"row g-2"},IR={class:"col"},RR={class:"input-group"},xR={class:"form-group mb-3"},OR={class:"form-check form-switch mb-2"},PR={key:0,class:"mt-2"},NR={class:"form-check"},MR={class:"form-check"},DR={class:"form-group mb-3"},LR={class:"form-check form-switch"},UR={key:0,class:"mt-2"},qR={class:"form-group mb-3"},VR={class:"form-check form-switch"},$R={key:0,class:"mt-2"},jR={class:"form-check mt-2"},FR={class:"form-check"};const GR={class:"card mb-4"},BR={class:"card-header d-flex justify-content-between align-items-center"},HR=["disabled"],WR={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},zR={key:1,class:"bi bi-save me-1"},KR={class:"card-body"},JR={class:"form-group mb-3"},YR={class:"input-group mb-2"},XR={class:"input-group mb-2"},QR={class:"input-group mb-2"},ZR={class:"form-group mb-3"},ex={class:"form-check form-switch"},tx={key:0,class:"mt-2"},sx={class:"form-check"},ax={class:"form-check"},ix={class:"form-check"},nx={class:"form-group mb-3"},rx={class:"form-check form-switch"},ox={key:0,class:"mt-2"},lx={class:"form-check mb-2"},cx={class:"form-check mb-2"},ux={class:"form-check"},dx={class:"mt-2"},px={class:"form-group mb-3"},mx={class:"form-check form-switch"},vx={key:0,class:"mt-2"},hx={class:"row"},fx={class:"col-md-6"},gx={class:"form-check"},yx={class:"col-md-6"},bx={class:"form-check"},_x={class:"row mt-2"},kx={class:"col-md-6"},wx={class:"form-check"},Sx={class:"col-md-6"},Ex={class:"form-check"};const Cx={class:"automation-settings"},Tx={class:"card mb-4"},Ax={class:"card-body"},Ix={class:"mb-4"},Rx={class:"input-group"},xx=["value"],Ox={class:"table"},Px={key:0},Nx={key:1},Mx={key:0,class:"badge bg-success"},Dx={key:1,class:"badge bg-warning text-dark"},Lx={key:2,class:"badge bg-danger"},Ux={key:3,class:"badge bg-secondary"},qx={key:0,class:"text-muted"},Vx={key:1,class:"text-danger small mt-1"},$x={class:"text-end"},jx={class:"row"},Fx={class:"col-md-6"},Gx={class:"col-md-6"},Bx={class:"row mt-4"},Hx={class:"col-md-6"},Wx={class:"col-md-6"};const zx=Vt({name:"AutomationView",components:{TicketsAutomation:Vt({name:"TicketsAutomation",setup(){const t=He(),s=x_(),a=e(!1),n=e({auto_close_enabled:!1,close_inactive_days:30,notify_on_auto_close:!0,reminders_enabled:!1,first_reminder_hours:24,escalation_hours:48,auto_assign_enabled:!1,auto_assign_method:"round_robin",notify_new_tickets:!0,notify_admin_group:[]}),r=e([{id:1,name:"Support niveau 1"},{id:2,name:"Support niveau 2"},{id:3,name:"Administrateurs"}]);return i(()=>{(async()=>{try{await s.fetchAutomationSettings("tickets"),s.automationSettings.value&&s.automationSettings.value.tickets&&(n.value={...n.value,...s.automationSettings.value.tickets})}catch(e){t.showNotification({title:"Erreur de connexion",text:"Impossible de communiquer avec le serveur",type:"error"})}})()}),{settings:n,adminGroups:r,isSaving:a,saveSettings:async()=>{a.value=!0;try{await s.updateAutomationSettings({settings:n.value},"tickets"),s.success?t.showNotification({title:"Enregistrement réussi",text:"Paramètres d'automatisation des tickets enregistrés",type:"success"}):s.error&&t.showNotification({title:"Erreur d'enregistrement",text:"Erreur lors de l'enregistrement: "+s.error,type:"error"})}catch(e){t.showNotification({title:"Erreur de connexion",text:"Impossible de communiquer avec le serveur",type:"error"})}finally{a.value=!1}}}}},[["render",function(e,t,s,a,i,n){return g(),o("div",kA,[l("div",wA,[t[13]||(t[13]=l("h5",null,"Automatisation des tickets",-1)),l("button",{class:"btn btn-sm btn-primary",disabled:a.isSaving,onClick:t[0]||(t[0]=(...e)=>a.saveSettings&&a.saveSettings(...e))},[a.isSaving?(g(),o("span",EA)):(g(),o("i",CA)),t[12]||(t[12]=d(" Enregistrer "))],8,SA)]),l("div",TA,[l("form",{onSubmit:t[11]||(t[11]=k((...e)=>a.saveSettings&&a.saveSettings(...e),["prevent"]))},[l("div",AA,[l("div",IA,[w(l("input",{id:"enableAutoClose","onUpdate:modelValue":t[1]||(t[1]=e=>a.settings.auto_close_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.auto_close_enabled]]),t[14]||(t[14]=l("label",{class:"form-check-label",for:"enableAutoClose"},"Fermeture automatique des tickets inactifs",-1))]),a.settings.auto_close_enabled?(g(),o("div",RA,[l("div",xA,[w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>a.settings.close_inactive_days=e),type:"number",class:"form-control",min:"1",max:"365"},null,512),[[S,a.settings.close_inactive_days,void 0,{number:!0}]]),t[15]||(t[15]=l("span",{class:"input-group-text"},"jours",-1))]),t[16]||(t[16]=l("small",{class:"text-muted"},"Fermer automatiquement les tickets qui n'ont pas reçu de réponse pendant ce nombre de jours",-1))])):v("",!0)]),l("div",OA,[l("div",PA,[w(l("input",{id:"notifyOnClose","onUpdate:modelValue":t[3]||(t[3]=e=>a.settings.notify_on_auto_close=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.notify_on_auto_close]]),t[17]||(t[17]=l("label",{class:"form-check-label",for:"notifyOnClose"},"Notifier le client lors de la fermeture automatique",-1))])]),l("div",NA,[l("div",MA,[w(l("input",{id:"enableReminders","onUpdate:modelValue":t[4]||(t[4]=e=>a.settings.reminders_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.reminders_enabled]]),t[18]||(t[18]=l("label",{class:"form-check-label",for:"enableReminders"},"Rappels pour tickets sans réponse des administrateurs",-1))]),a.settings.reminders_enabled?(g(),o("div",DA,[l("div",LA,[w(l("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>a.settings.first_reminder_hours=e),type:"number",class:"form-control",min:"1",max:"48"},null,512),[[S,a.settings.first_reminder_hours,void 0,{number:!0}]]),t[19]||(t[19]=l("span",{class:"input-group-text"},"heures",-1))]),t[21]||(t[21]=l("small",{class:"text-muted"},"Envoyer le premier rappel après ce délai sans réponse d'un administrateur",-1)),l("div",UA,[w(l("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>a.settings.escalation_hours=e),type:"number",class:"form-control",min:"1",max:"72"},null,512),[[S,a.settings.escalation_hours,void 0,{number:!0}]]),t[20]||(t[20]=l("span",{class:"input-group-text"},"heures supplémentaires",-1))]),t[22]||(t[22]=l("small",{class:"text-muted"},"Escalader le ticket aux administrateurs seniors après ce délai additionnel",-1))])):v("",!0)]),l("div",qA,[l("div",VA,[w(l("input",{id:"enableAutoAssign","onUpdate:modelValue":t[7]||(t[7]=e=>a.settings.auto_assign_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.auto_assign_enabled]]),t[23]||(t[23]=l("label",{class:"form-check-label",for:"enableAutoAssign"},"Assignation automatique des tickets",-1))]),a.settings.auto_assign_enabled?(g(),o("div",$A,[w(l("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>a.settings.auto_assign_method=e),class:"form-select"},t[24]||(t[24]=[l("option",{value:"round_robin"},"Répartition équitable (Round-robin)",-1),l("option",{value:"load_balance"},"Équilibrage de charge (selon la charge actuelle)",-1),l("option",{value:"department_head"},"Au responsable du département",-1)]),512),[[A,a.settings.auto_assign_method]]),t[25]||(t[25]=l("small",{class:"text-muted"},"Méthode d'assignation automatique des nouveaux tickets",-1))])):v("",!0)]),l("div",jA,[l("div",FA,[w(l("input",{id:"notifyNewTickets","onUpdate:modelValue":t[9]||(t[9]=e=>a.settings.notify_new_tickets=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.notify_new_tickets]]),t[26]||(t[26]=l("label",{class:"form-check-label",for:"notifyNewTickets"},"Notifier les administrateurs des nouveaux tickets",-1))]),a.settings.notify_new_tickets?(g(),o("div",GA,[w(l("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>a.settings.notify_admin_group=e),class:"form-select",multiple:""},[(g(!0),o(h,null,f(a.adminGroups,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name),9,BA))),128))],512),[[A,a.settings.notify_admin_group]]),t[27]||(t[27]=l("small",{class:"text-muted"},"Groupes d'administrateurs à notifier (aucune sélection = tous)",-1))])):v("",!0)])],32)])])}]]),BillingAutomation:Vt({name:"BillingAutomation",setup(){const t=He(),s=x_(),a=e(!1),n=e({auto_invoice_enabled:!0,generate_days_before:7,first_reminder_days:7,second_reminder_days:3,final_reminder_days:1,post_due_reminders_enabled:!0,post_due_days:[1,5,10,15],auto_billing_enabled:!1,auto_billing_days_offset:0,late_fees_enabled:!1,late_fee_days:7,late_fee_amount:5,late_fee_type:"percentage",auto_cancellation_enabled:!1,cancellation_days:30});return i(()=>{(async()=>{try{if(await s.fetchAutomationSettings("billing"),s.automationSettings.value&&s.automationSettings.value.billing&&(n.value={...n.value,...s.automationSettings.value.billing},"string"==typeof n.value.post_due_days))try{n.value.post_due_days=JSON.parse(n.value.post_due_days)}catch{n.value.post_due_days=[1,5,10,15]}}catch(e){t.showNotification({title:"Erreur de connexion",text:"Impossible de communiquer avec le serveur",type:"error"})}})()}),{settings:n,isSaving:a,addPostDueDay:()=>{let e=1;n.value.post_due_days.length>0&&(e=Math.max(...n.value.post_due_days)+5),n.value.post_due_days.push(e)},removePostDueDay:e=>{n.value.post_due_days.splice(e,1)},saveSettings:async()=>{a.value=!0;try{await s.updateAutomationSettings({settings:n.value},"billing"),s.success?t.showNotification({title:"Enregistrement réussi",text:"Paramètres d'automatisation de facturation enregistrés",type:"success"}):s.error&&t.showNotification({title:"Erreur d'enregistrement",text:"Erreur lors de l'enregistrement: "+s.error,type:"error"})}catch(e){t.showNotification({title:"Erreur de connexion",text:"Impossible de communiquer avec le serveur",type:"error"})}finally{a.value=!1}}}}},[["render",function(e,t,s,a,i,n){return g(),o("div",HA,[l("div",WA,[t[18]||(t[18]=l("h5",null,"Automatisation de la facturation",-1)),l("button",{class:"btn btn-sm btn-primary",disabled:a.isSaving,onClick:t[0]||(t[0]=(...e)=>a.saveSettings&&a.saveSettings(...e))},[a.isSaving?(g(),o("span",KA)):(g(),o("i",JA)),t[17]||(t[17]=d(" Enregistrer "))],8,zA)]),l("div",YA,[l("form",{onSubmit:t[16]||(t[16]=k((...e)=>a.saveSettings&&a.saveSettings(...e),["prevent"]))},[l("div",XA,[l("div",QA,[w(l("input",{id:"enableAutoInvoice","onUpdate:modelValue":t[1]||(t[1]=e=>a.settings.auto_invoice_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.auto_invoice_enabled]]),t[19]||(t[19]=l("label",{class:"form-check-label",for:"enableAutoInvoice"},"Génération automatique de factures",-1))]),a.settings.auto_invoice_enabled?(g(),o("div",ZA,[l("div",eI,[w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>a.settings.generate_days_before=e),type:"number",class:"form-control",min:"1",max:"30"},null,512),[[S,a.settings.generate_days_before,void 0,{number:!0}]]),t[20]||(t[20]=l("span",{class:"input-group-text"},"jours",-1))]),t[21]||(t[21]=l("small",{class:"text-muted"},"Générer les factures ce nombre de jours avant la date de renouvellement",-1))])):v("",!0)]),l("div",tI,[t[28]||(t[28]=l("label",{class:"form-label"},"Rappels de paiement avant échéance",-1)),l("div",sI,[l("div",aI,[l("div",iI,[t[22]||(t[22]=l("span",{class:"input-group-text"},"Premier rappel",-1)),w(l("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>a.settings.first_reminder_days=e),type:"number",class:"form-control",min:"1",max:"30"},null,512),[[S,a.settings.first_reminder_days,void 0,{number:!0}]]),t[23]||(t[23]=l("span",{class:"input-group-text"},"jours avant",-1))])])]),l("div",nI,[l("div",rI,[l("div",oI,[t[24]||(t[24]=l("span",{class:"input-group-text"},"Second rappel",-1)),w(l("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>a.settings.second_reminder_days=e),type:"number",class:"form-control",min:"1",max:"15"},null,512),[[S,a.settings.second_reminder_days,void 0,{number:!0}]]),t[25]||(t[25]=l("span",{class:"input-group-text"},"jours avant",-1))])])]),l("div",lI,[l("div",cI,[l("div",uI,[t[26]||(t[26]=l("span",{class:"input-group-text"},"Rappel final",-1)),w(l("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>a.settings.final_reminder_days=e),type:"number",class:"form-control",min:"0",max:"5"},null,512),[[S,a.settings.final_reminder_days,void 0,{number:!0}]]),t[27]||(t[27]=l("span",{class:"input-group-text"},"jours avant",-1))])])])]),l("div",dI,[l("div",pI,[w(l("input",{id:"enablePostDueReminders","onUpdate:modelValue":t[6]||(t[6]=e=>a.settings.post_due_reminders_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.post_due_reminders_enabled]]),t[29]||(t[29]=l("label",{class:"form-check-label",for:"enablePostDueReminders"},"Rappels après la date d'échéance",-1))]),a.settings.post_due_reminders_enabled?(g(),o("div",mI,[(g(!0),o(h,null,f(a.settings.post_due_days,(e,s)=>(g(),o("div",{key:s,class:"input-group mb-2"},[w(l("input",{"onUpdate:modelValue":e=>a.settings.post_due_days[s]=e,type:"number",class:"form-control",min:"1",max:"60"},null,8,vI),[[S,a.settings.post_due_days[s],void 0,{number:!0}]]),t[31]||(t[31]=l("span",{class:"input-group-text"},"jours après",-1)),l("button",{type:"button",class:"btn btn-outline-danger",onClick:e=>a.removePostDueDay(s)},t[30]||(t[30]=[l("i",{class:"bi bi-trash"},null,-1)]),8,hI)]))),128)),l("button",{type:"button",class:"btn btn-sm btn-outline-secondary mt-1",onClick:t[7]||(t[7]=(...e)=>a.addPostDueDay&&a.addPostDueDay(...e))},t[32]||(t[32]=[l("i",{class:"bi bi-plus-circle me-1"},null,-1),d(" Ajouter un rappel ")]))])):v("",!0)]),l("div",fI,[l("div",gI,[w(l("input",{id:"enableAutoBilling","onUpdate:modelValue":t[8]||(t[8]=e=>a.settings.auto_billing_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.auto_billing_enabled]]),t[33]||(t[33]=l("label",{class:"form-check-label",for:"enableAutoBilling"},"Tenter le prélèvement automatique",-1))]),a.settings.auto_billing_enabled?(g(),o("div",yI,[w(l("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>a.settings.auto_billing_days_offset=e),class:"form-select"},t[34]||(t[34]=[D('<option value="-1">1 jour avant l&#39;échéance</option><option value="0">Le jour même de l&#39;échéance</option><option value="1">1 jour après l&#39;échéance</option><option value="3">3 jours après l&#39;échéance</option><option value="5">5 jours après l&#39;échéance</option><option value="7">1 semaine après l&#39;échéance</option>',6)]),512),[[A,a.settings.auto_billing_days_offset]]),t[35]||(t[35]=l("small",{class:"text-muted"},"Quand tenter le prélèvement automatique",-1))])):v("",!0)]),l("div",bI,[l("div",_I,[w(l("input",{id:"enableLateFees","onUpdate:modelValue":t[10]||(t[10]=e=>a.settings.late_fees_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.late_fees_enabled]]),t[36]||(t[36]=l("label",{class:"form-check-label",for:"enableLateFees"},"Appliquer des frais de retard",-1))]),a.settings.late_fees_enabled?(g(),o("div",kI,[l("div",wI,[l("div",SI,[l("div",EI,[w(l("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>a.settings.late_fee_days=e),type:"number",class:"form-control",min:"1",max:"30"},null,512),[[S,a.settings.late_fee_days,void 0,{number:!0}]]),t[37]||(t[37]=l("span",{class:"input-group-text"},"jours après",-1))])]),l("div",CI,[l("div",TI,[w(l("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>a.settings.late_fee_amount=e),type:"number",class:"form-control",min:"0",step:"0.01"},null,512),[[S,a.settings.late_fee_amount,void 0,{number:!0}]]),w(l("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>a.settings.late_fee_type=e),class:"form-select",style:{"max-width":"120px"}},t[38]||(t[38]=[l("option",{value:"percentage"},"% du total",-1),l("option",{value:"fixed"},"Montant fixe",-1)]),512),[[A,a.settings.late_fee_type]])])])]),t[39]||(t[39]=l("small",{class:"text-muted"},"Appliquer des frais de retard après le nombre de jours spécifié",-1))])):v("",!0)]),l("div",AI,[l("div",II,[w(l("input",{id:"enableAutoCancellation","onUpdate:modelValue":t[14]||(t[14]=e=>a.settings.auto_cancellation_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.auto_cancellation_enabled]]),t[40]||(t[40]=l("label",{class:"form-check-label",for:"enableAutoCancellation"},"Annulation automatique des services impayés",-1))]),a.settings.auto_cancellation_enabled?(g(),o("div",RI,[l("div",xI,[w(l("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>a.settings.cancellation_days=e),type:"number",class:"form-control",min:"1",max:"60"},null,512),[[S,a.settings.cancellation_days,void 0,{number:!0}]]),t[41]||(t[41]=l("span",{class:"input-group-text"},"jours après l'échéance",-1))]),t[42]||(t[42]=l("small",{class:"text-muted"},"Annuler automatiquement les services impayés après ce nombre de jours",-1))])):v("",!0)])],32)])])}]]),ServicesAutomation:Vt({name:"ServicesAutomation",setup(){const t=He(),s=x_(),a=e(!1),n=e({auto_suspend_enabled:!1,suspend_days:14,pre_suspend_email:!0,pre_suspend_days:2,auto_terminate_enabled:!1,terminate_days:30,pre_terminate_email:!0,pre_terminate_days:7,auto_renew_enabled:!0,renew_only_with_card:!0,create_invoices_for_renewal:!0,service_notifications:!1,service_notification_frequency:"quarterly"});return i(()=>{(async()=>{try{await s.fetchAutomationSettings("services"),s.automationSettings.value&&s.automationSettings.value.services&&(n.value={...n.value,...s.automationSettings.value.services})}catch(e){t.showNotification({title:"Erreur de connexion",text:"Impossible de communiquer avec le serveur",type:"error"})}})()}),{settings:n,isSaving:a,saveSettings:async()=>{a.value=!0;try{await s.updateAutomationSettings({settings:n.value},"services"),s.success?t.showNotification({title:"Enregistrement réussi",text:"Paramètres d'automatisation des services enregistrés",type:"success"}):s.error&&t.showNotification({title:"Erreur d'enregistrement",text:"Erreur lors de l'enregistrement: "+s.error,type:"error"})}catch(e){t.showNotification({title:"Erreur de connexion",text:"Impossible de communiquer avec le serveur",type:"error"})}finally{a.value=!1}}}}},[["render",function(e,t,s,a,i,n){return g(),o("div",OI,[l("div",PI,[t[16]||(t[16]=l("h5",null,"Automatisation des services",-1)),l("button",{class:"btn btn-sm btn-primary",disabled:a.isSaving,onClick:t[0]||(t[0]=(...e)=>a.saveSettings&&a.saveSettings(...e))},[a.isSaving?(g(),o("span",MI)):(g(),o("i",DI)),t[15]||(t[15]=d(" Enregistrer "))],8,NI)]),l("div",LI,[l("form",{onSubmit:t[14]||(t[14]=k((...e)=>a.saveSettings&&a.saveSettings(...e),["prevent"]))},[l("div",UI,[l("div",qI,[w(l("input",{id:"enableAutoSuspend","onUpdate:modelValue":t[1]||(t[1]=e=>a.settings.auto_suspend_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.auto_suspend_enabled]]),t[17]||(t[17]=l("label",{class:"form-check-label",for:"enableAutoSuspend"},"Suspension automatique des services impayés",-1))]),a.settings.auto_suspend_enabled?(g(),o("div",VI,[l("div",$I,[w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>a.settings.suspend_days=e),type:"number",class:"form-control",min:"1",max:"60"},null,512),[[S,a.settings.suspend_days,void 0,{number:!0}]]),t[18]||(t[18]=l("span",{class:"input-group-text"},"jours après l'échéance",-1))]),t[19]||(t[19]=l("small",{class:"text-muted"},"Suspendre automatiquement les services impayés après ce nombre de jours",-1))])):v("",!0)]),l("div",jI,[l("div",FI,[w(l("input",{id:"enablePreSuspendEmail","onUpdate:modelValue":t[3]||(t[3]=e=>a.settings.pre_suspend_email=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.pre_suspend_email]]),t[20]||(t[20]=l("label",{class:"form-check-label",for:"enablePreSuspendEmail"},"Email de pré-suspension",-1))]),a.settings.pre_suspend_email?(g(),o("div",GI,[l("div",BI,[w(l("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>a.settings.pre_suspend_days=e),type:"number",class:"form-control",min:"1",max:"30"},null,512),[[S,a.settings.pre_suspend_days,void 0,{number:!0}]]),t[21]||(t[21]=l("span",{class:"input-group-text"},"jours avant la suspension",-1))]),t[22]||(t[22]=l("small",{class:"text-muted"},"Envoyer un avertissement avant la suspension automatique",-1))])):v("",!0)]),l("div",HI,[l("div",WI,[w(l("input",{id:"enableAutoTerminate","onUpdate:modelValue":t[5]||(t[5]=e=>a.settings.auto_terminate_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.auto_terminate_enabled]]),t[23]||(t[23]=l("label",{class:"form-check-label",for:"enableAutoTerminate"},"Résiliation automatique des services suspendus",-1))]),a.settings.auto_terminate_enabled?(g(),o("div",zI,[l("div",KI,[w(l("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>a.settings.terminate_days=e),type:"number",class:"form-control",min:"1",max:"90"},null,512),[[S,a.settings.terminate_days,void 0,{number:!0}]]),t[24]||(t[24]=l("span",{class:"input-group-text"},"jours après la suspension",-1))]),t[25]||(t[25]=l("small",{class:"text-muted"},"Résilier automatiquement les services suspendus après ce nombre de jours",-1))])):v("",!0)]),l("div",JI,[l("div",YI,[w(l("input",{id:"enablePreTerminateEmail","onUpdate:modelValue":t[7]||(t[7]=e=>a.settings.pre_terminate_email=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.pre_terminate_email]]),t[26]||(t[26]=l("label",{class:"form-check-label",for:"enablePreTerminateEmail"},"Email de pré-résiliation",-1))]),a.settings.pre_terminate_email?(g(),o("div",XI,[l("div",QI,[w(l("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>a.settings.pre_terminate_days=e),type:"number",class:"form-control",min:"1",max:"30"},null,512),[[S,a.settings.pre_terminate_days,void 0,{number:!0}]]),t[27]||(t[27]=l("span",{class:"input-group-text"},"jours avant la résiliation",-1))]),t[28]||(t[28]=l("small",{class:"text-muted"},"Envoyer un avertissement avant la résiliation automatique",-1))])):v("",!0)]),l("div",ZI,[l("div",eR,[w(l("input",{id:"enableAutoRenew","onUpdate:modelValue":t[9]||(t[9]=e=>a.settings.auto_renew_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.auto_renew_enabled]]),t[29]||(t[29]=l("label",{class:"form-check-label",for:"enableAutoRenew"},"Renouvellement automatique des services",-1))]),a.settings.auto_renew_enabled?(g(),o("div",tR,[l("div",sR,[w(l("input",{id:"renewOnlyWithCard","onUpdate:modelValue":t[10]||(t[10]=e=>a.settings.renew_only_with_card=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.renew_only_with_card]]),t[30]||(t[30]=l("label",{class:"form-check-label",for:"renewOnlyWithCard"},"Uniquement pour les clients avec carte de crédit enregistrée",-1))]),l("div",aR,[w(l("input",{id:"createInvoicesForRenew","onUpdate:modelValue":t[11]||(t[11]=e=>a.settings.create_invoices_for_renewal=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.create_invoices_for_renewal]]),t[31]||(t[31]=l("label",{class:"form-check-label",for:"createInvoicesForRenew"},"Créer des factures pour les clients sans paiement automatique",-1))])])):v("",!0)]),l("div",iR,[l("div",nR,[w(l("input",{id:"enableServiceNotifications","onUpdate:modelValue":t[12]||(t[12]=e=>a.settings.service_notifications=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.service_notifications]]),t[32]||(t[32]=l("label",{class:"form-check-label",for:"enableServiceNotifications"},"Notifications périodiques des services actifs",-1))]),a.settings.service_notifications?(g(),o("div",rR,[w(l("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>a.settings.service_notification_frequency=e),class:"form-select"},t[33]||(t[33]=[D('<option value="monthly">Mensuelle</option><option value="quarterly">Trimestrielle</option><option value="biannually">Semestrielle</option><option value="annually">Annuelle</option><option value="never">Jamais</option>',5)]),512),[[A,a.settings.service_notification_frequency]]),t[34]||(t[34]=l("small",{class:"text-muted"},"Fréquence des notifications récapitulatives des services actifs",-1))])):v("",!0)])],32)])])}]]),DomainsAutomation:Vt({name:"DomainsAutomation",setup(){const t=He(),s=x_(),a=e(!1),n=e({first_reminder_days:30,second_reminder_days:14,final_reminder_days:7,expired_first_reminder_days:1,expired_second_reminder_days:7,auto_renewal_enabled:!0,auto_renewal_days:15,renew_only_active:!0,create_invoices:!0,whois_sync_enabled:!0,whois_sync_frequency:"weekly",price_sync_enabled:!1,price_sync_frequency:"monthly",update_existing_pricing:!1,alert_on_changes:!0});return i(()=>{(async()=>{try{await s.fetchAutomationSettings("domains"),s.automationSettings.value&&s.automationSettings.value.domains&&(n.value={...n.value,...s.automationSettings.value.domains})}catch(e){t.showNotification({title:"Erreur de connexion",text:"Impossible de communiquer avec le serveur",type:"error"})}})()}),{settings:n,isSaving:a,saveSettings:async()=>{a.value=!0;try{await s.updateAutomationSettings({settings:n.value},"domains"),s.success?t.showNotification({title:"Enregistrement réussi",text:"Paramètres d'automatisation des domaines enregistrés",type:"success"}):s.error&&t.showNotification({title:"Erreur d'enregistrement",text:"Erreur lors de l'enregistrement: "+s.error,type:"error"})}catch(e){t.showNotification({title:"Erreur de connexion",text:"Impossible de communiquer avec le serveur",type:"error"})}finally{a.value=!1}}}}},[["render",function(e,t,s,a,i,n){return g(),o("div",oR,[l("div",lR,[t[18]||(t[18]=l("h5",null,"Automatisation des domaines",-1)),l("button",{class:"btn btn-sm btn-primary",disabled:a.isSaving,onClick:t[0]||(t[0]=(...e)=>a.saveSettings&&a.saveSettings(...e))},[a.isSaving?(g(),o("span",uR)):(g(),o("i",dR)),t[17]||(t[17]=d(" Enregistrer "))],8,cR)]),l("div",pR,[l("form",{onSubmit:t[16]||(t[16]=k((...e)=>a.saveSettings&&a.saveSettings(...e),["prevent"]))},[l("div",mR,[t[25]||(t[25]=l("label",{class:"form-label"},"Rappels de renouvellement de domaines",-1)),l("div",vR,[l("div",hR,[l("div",fR,[t[19]||(t[19]=l("span",{class:"input-group-text"},"Premier rappel",-1)),w(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>a.settings.first_reminder_days=e),type:"number",class:"form-control",min:"1",max:"90"},null,512),[[S,a.settings.first_reminder_days,void 0,{number:!0}]]),t[20]||(t[20]=l("span",{class:"input-group-text"},"jours avant expiration",-1))])])]),l("div",gR,[l("div",yR,[l("div",bR,[t[21]||(t[21]=l("span",{class:"input-group-text"},"Second rappel",-1)),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>a.settings.second_reminder_days=e),type:"number",class:"form-control",min:"1",max:"30"},null,512),[[S,a.settings.second_reminder_days,void 0,{number:!0}]]),t[22]||(t[22]=l("span",{class:"input-group-text"},"jours avant expiration",-1))])])]),l("div",_R,[l("div",kR,[l("div",wR,[t[23]||(t[23]=l("span",{class:"input-group-text"},"Rappel final",-1)),w(l("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>a.settings.final_reminder_days=e),type:"number",class:"form-control",min:"1",max:"10"},null,512),[[S,a.settings.final_reminder_days,void 0,{number:!0}]]),t[24]||(t[24]=l("span",{class:"input-group-text"},"jours avant expiration",-1))])])])]),l("div",SR,[t[30]||(t[30]=l("label",{class:"form-label"},"Rappels après expiration",-1)),l("div",ER,[l("div",CR,[l("div",TR,[t[26]||(t[26]=l("span",{class:"input-group-text"},"Premier rappel",-1)),w(l("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>a.settings.expired_first_reminder_days=e),type:"number",class:"form-control",min:"1",max:"10"},null,512),[[S,a.settings.expired_first_reminder_days,void 0,{number:!0}]]),t[27]||(t[27]=l("span",{class:"input-group-text"},"jours après expiration",-1))])])]),l("div",AR,[l("div",IR,[l("div",RR,[t[28]||(t[28]=l("span",{class:"input-group-text"},"Second rappel",-1)),w(l("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>a.settings.expired_second_reminder_days=e),type:"number",class:"form-control",min:"5",max:"30"},null,512),[[S,a.settings.expired_second_reminder_days,void 0,{number:!0}]]),t[29]||(t[29]=l("span",{class:"input-group-text"},"jours après expiration",-1))])])])]),l("div",xR,[l("div",OR,[w(l("input",{id:"enableAutoRenew","onUpdate:modelValue":t[6]||(t[6]=e=>a.settings.auto_renewal_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.auto_renewal_enabled]]),t[31]||(t[31]=l("label",{class:"form-check-label",for:"enableAutoRenew"},"Renouvellement automatique des domaines",-1))]),a.settings.auto_renewal_enabled?(g(),o("div",PR,[w(l("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>a.settings.auto_renewal_days=e),class:"form-select mb-2"},t[32]||(t[32]=[D('<option value="30">30 jours avant expiration</option><option value="15">15 jours avant expiration</option><option value="10">10 jours avant expiration</option><option value="7">7 jours avant expiration</option><option value="3">3 jours avant expiration</option>',5)]),512),[[A,a.settings.auto_renewal_days]]),l("div",NR,[w(l("input",{id:"renewOnlyActive","onUpdate:modelValue":t[8]||(t[8]=e=>a.settings.renew_only_active=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.renew_only_active]]),t[33]||(t[33]=l("label",{class:"form-check-label",for:"renewOnlyActive"},"Uniquement les domaines avec renouvellement automatique activé",-1))]),l("div",MR,[w(l("input",{id:"createInvoices","onUpdate:modelValue":t[9]||(t[9]=e=>a.settings.create_invoices=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.create_invoices]]),t[34]||(t[34]=l("label",{class:"form-check-label",for:"createInvoices"},"Créer des factures pour les domaines sans carte enregistrée",-1))])])):v("",!0)]),l("div",DR,[l("div",LR,[w(l("input",{id:"enableWhoisSync","onUpdate:modelValue":t[10]||(t[10]=e=>a.settings.whois_sync_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.whois_sync_enabled]]),t[35]||(t[35]=l("label",{class:"form-check-label",for:"enableWhoisSync"},"Synchronisation des dates d'expiration WHOIS",-1))]),a.settings.whois_sync_enabled?(g(),o("div",UR,[w(l("select",{"onUpdate:modelValue":t[11]||(t[11]=e=>a.settings.whois_sync_frequency=e),class:"form-select"},t[36]||(t[36]=[l("option",{value:"daily"},"Quotidienne",-1),l("option",{value:"weekly"},"Hebdomadaire",-1),l("option",{value:"biweekly"},"Bihebdomadaire",-1),l("option",{value:"monthly"},"Mensuelle",-1)]),512),[[A,a.settings.whois_sync_frequency]]),t[37]||(t[37]=l("small",{class:"text-muted"},"Fréquence de vérification WHOIS pour synchroniser les dates d'expiration",-1))])):v("",!0)]),l("div",qR,[l("div",VR,[w(l("input",{id:"enablePriceSync","onUpdate:modelValue":t[12]||(t[12]=e=>a.settings.price_sync_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.price_sync_enabled]]),t[38]||(t[38]=l("label",{class:"form-check-label",for:"enablePriceSync"},"Synchronisation automatique des prix TLD",-1))]),a.settings.price_sync_enabled?(g(),o("div",$R,[w(l("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>a.settings.price_sync_frequency=e),class:"form-select"},t[39]||(t[39]=[l("option",{value:"weekly"},"Hebdomadaire",-1),l("option",{value:"biweekly"},"Bihebdomadaire",-1),l("option",{value:"monthly"},"Mensuelle",-1),l("option",{value:"quarterly"},"Trimestrielle",-1)]),512),[[A,a.settings.price_sync_frequency]]),t[42]||(t[42]=l("small",{class:"text-muted"},"Fréquence de synchronisation des prix avec les registrars",-1)),l("div",jR,[w(l("input",{id:"updateExistingPricing","onUpdate:modelValue":t[14]||(t[14]=e=>a.settings.update_existing_pricing=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.update_existing_pricing]]),t[40]||(t[40]=l("label",{class:"form-check-label",for:"updateExistingPricing"},"Mettre à jour les prix des domaines existants",-1))]),l("div",FR,[w(l("input",{id:"alertOnChanges","onUpdate:modelValue":t[15]||(t[15]=e=>a.settings.alert_on_changes=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.alert_on_changes]]),t[41]||(t[41]=l("label",{class:"form-check-label",for:"alertOnChanges"},"Alerter les administrateurs lors des changements de prix",-1))])])):v("",!0)])],32)])])}]]),MiscAutomation:Vt({name:"MiscAutomation",setup(){const t=He(),s=x_(),a=e(!1),n=e({...s.automationSettings.value.misc});return i(()=>{(async()=>{try{await s.fetchAutomationSettings("misc"),n.value={...s.automationSettings.value.misc}}catch(e){t.showNotification({title:"Erreur de connexion",text:"Impossible de communiquer avec le serveur",type:"error"})}})()}),{settings:n,isSaving:a,saveSettings:async()=>{a.value=!0;try{await s.updateAutomationSettings({settings:n.value},"misc"),s.success?t.showNotification({title:"Enregistrement réussi",text:"Paramètres divers enregistrés",type:"success"}):s.error&&t.showNotification({title:"Erreur d'enregistrement",text:"Erreur lors de l'enregistrement: "+s.error,type:"error"})}catch(e){ne.error("[MiscAutomation] Erreur lors de l'enregistrement des paramètres d'automatisation",{error:e}),t.showNotification({title:"Erreur de connexion",text:"Impossible de communiquer avec le serveur",type:"error"})}finally{a.value=!1}}}}},[["render",function(e,t,s,a,i,n){return g(),o("div",GR,[l("div",BR,[t[22]||(t[22]=l("h5",null,"Paramètres divers",-1)),l("button",{class:"btn btn-sm btn-primary",disabled:a.isSaving,onClick:t[0]||(t[0]=(...e)=>a.saveSettings&&a.saveSettings(...e))},[a.isSaving?(g(),o("span",WR)):(g(),o("i",zR)),t[21]||(t[21]=d(" Enregistrer "))],8,HR)]),l("div",KR,[l("form",{onSubmit:t[20]||(t[20]=k((...e)=>a.saveSettings&&a.saveSettings(...e),["prevent"]))},[l("div",JR,[t[29]||(t[29]=l("label",{class:"form-label"},"Rétention des données",-1)),l("div",YR,[t[23]||(t[23]=l("span",{class:"input-group-text"},"Logs du système",-1)),w(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>a.settings.system_logs_retention=e),type:"number",class:"form-control",min:"1",max:"365"},null,512),[[S,a.settings.system_logs_retention,void 0,{number:!0}]]),t[24]||(t[24]=l("span",{class:"input-group-text"},"jours",-1))]),l("div",XR,[t[25]||(t[25]=l("span",{class:"input-group-text"},"Logs des tâches cron",-1)),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>a.settings.cron_logs_retention=e),type:"number",class:"form-control",min:"1",max:"365"},null,512),[[S,a.settings.cron_logs_retention,void 0,{number:!0}]]),t[26]||(t[26]=l("span",{class:"input-group-text"},"jours",-1))]),l("div",QR,[t[27]||(t[27]=l("span",{class:"input-group-text"},"Emails archivés",-1)),w(l("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>a.settings.email_logs_retention=e),type:"number",class:"form-control",min:"1",max:"365"},null,512),[[S,a.settings.email_logs_retention,void 0,{number:!0}]]),t[28]||(t[28]=l("span",{class:"input-group-text"},"jours",-1))])]),l("div",ZR,[l("div",ex,[w(l("input",{id:"enableDbCleanup","onUpdate:modelValue":t[4]||(t[4]=e=>a.settings.db_cleanup_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.db_cleanup_enabled]]),t[30]||(t[30]=l("label",{class:"form-check-label",for:"enableDbCleanup"},"Nettoyage périodique de la base de données",-1))]),a.settings.db_cleanup_enabled?(g(),o("div",tx,[w(l("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>a.settings.db_cleanup_frequency=e),class:"form-select mb-2"},t[31]||(t[31]=[l("option",{value:"daily"},"Quotidien",-1),l("option",{value:"weekly"},"Hebdomadaire",-1),l("option",{value:"monthly"},"Mensuel",-1)]),512),[[A,a.settings.db_cleanup_frequency]]),l("div",sx,[w(l("input",{id:"cleanupSessions","onUpdate:modelValue":t[6]||(t[6]=e=>a.settings.cleanup_sessions=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.cleanup_sessions]]),t[32]||(t[32]=l("label",{class:"form-check-label",for:"cleanupSessions"},"Nettoyer les sessions expirées",-1))]),l("div",ax,[w(l("input",{id:"cleanupActivityLogs","onUpdate:modelValue":t[7]||(t[7]=e=>a.settings.cleanup_activity_logs=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.cleanup_activity_logs]]),t[33]||(t[33]=l("label",{class:"form-check-label",for:"cleanupActivityLogs"},"Nettoyer les logs d'activité anciens",-1))]),l("div",ix,[w(l("input",{id:"cleanupTempData","onUpdate:modelValue":t[8]||(t[8]=e=>a.settings.cleanup_temp_data=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.cleanup_temp_data]]),t[34]||(t[34]=l("label",{class:"form-check-label",for:"cleanupTempData"},"Nettoyer les données temporaires",-1))])])):v("",!0)]),l("div",nx,[l("div",rx,[w(l("input",{id:"enableAutoBackup","onUpdate:modelValue":t[9]||(t[9]=e=>a.settings.auto_backup_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.auto_backup_enabled]]),t[35]||(t[35]=l("label",{class:"form-check-label",for:"enableAutoBackup"},"Sauvegarde automatique",-1))]),a.settings.auto_backup_enabled?(g(),o("div",ox,[w(l("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>a.settings.backup_frequency=e),class:"form-select mb-2"},t[36]||(t[36]=[l("option",{value:"daily"},"Quotidienne",-1),l("option",{value:"weekly"},"Hebdomadaire",-1),l("option",{value:"biweekly"},"Bihebdomadaire",-1),l("option",{value:"monthly"},"Mensuelle",-1)]),512),[[A,a.settings.backup_frequency]]),l("div",lx,[w(l("input",{id:"backupFiles","onUpdate:modelValue":t[11]||(t[11]=e=>a.settings.backup_files=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.backup_files]]),t[37]||(t[37]=l("label",{class:"form-check-label",for:"backupFiles"},"Inclure les fichiers",-1))]),l("div",cx,[w(l("input",{id:"backupDatabase","onUpdate:modelValue":t[12]||(t[12]=e=>a.settings.backup_database=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.backup_database]]),t[38]||(t[38]=l("label",{class:"form-check-label",for:"backupDatabase"},"Inclure la base de données",-1))]),l("div",ux,[w(l("input",{id:"compressBackup","onUpdate:modelValue":t[13]||(t[13]=e=>a.settings.compress_backup=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.compress_backup]]),t[39]||(t[39]=l("label",{class:"form-check-label",for:"compressBackup"},"Compresser la sauvegarde",-1))]),l("div",dx,[w(l("input",{"onUpdate:modelValue":t[14]||(t[14]=e=>a.settings.backups_to_keep=e),type:"number",class:"form-control",min:"1",max:"99",placeholder:"Nombre de sauvegardes à conserver"},null,512),[[S,a.settings.backups_to_keep,void 0,{number:!0}]]),t[40]||(t[40]=l("small",{class:"text-muted"},"Nombre de sauvegardes à conserver (0 = illimité)",-1))])])):v("",!0)]),l("div",px,[l("div",mx,[w(l("input",{id:"enableAutoReports","onUpdate:modelValue":t[15]||(t[15]=e=>a.settings.auto_reports_enabled=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.auto_reports_enabled]]),t[41]||(t[41]=l("label",{class:"form-check-label",for:"enableAutoReports"},"Génération automatique de rapports",-1))]),a.settings.auto_reports_enabled?(g(),o("div",vx,[l("div",hx,[l("div",fx,[l("div",gx,[w(l("input",{id:"dailyReports","onUpdate:modelValue":t[16]||(t[16]=e=>a.settings.daily_reports=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.daily_reports]]),t[42]||(t[42]=l("label",{class:"form-check-label",for:"dailyReports"},"Rapports quotidiens",-1))])]),l("div",yx,[l("div",bx,[w(l("input",{id:"weeklyReports","onUpdate:modelValue":t[17]||(t[17]=e=>a.settings.weekly_reports=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.weekly_reports]]),t[43]||(t[43]=l("label",{class:"form-check-label",for:"weeklyReports"},"Rapports hebdomadaires",-1))])])]),l("div",_x,[l("div",kx,[l("div",wx,[w(l("input",{id:"monthlyReports","onUpdate:modelValue":t[18]||(t[18]=e=>a.settings.monthly_reports=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.monthly_reports]]),t[44]||(t[44]=l("label",{class:"form-check-label",for:"monthlyReports"},"Rapports mensuels",-1))])]),l("div",Sx,[l("div",Ex,[w(l("input",{id:"emailReports","onUpdate:modelValue":t[19]||(t[19]=e=>a.settings.email_reports=e),class:"form-check-input",type:"checkbox"},null,512),[[C,a.settings.email_reports]]),t[45]||(t[45]=l("label",{class:"form-check-label",for:"emailReports"},"Envoyer par email",-1))])])])])):v("",!0)])],32)])])}]])},setup(){const t=He(),a=e(!0),n=e([]),r=e(null),o=e(""),l=e(""),c=s(()=>`*/5 * * * * php ${l.value}`),u=e(!1),d=async()=>{a.value=!0;try{const e=(await _e.routes.admin.settings.getCronStatus()).data;e.success?(n.value=e.jobs,o.value=e.server_path||"",l.value=e.cron_script_path||"",u.value=e.has_domain_feature||!1):t.showError("Erreur de chargement","Erreur lors du chargement des tâches cron: "+e.message)}catch(e){ne.error("[AutomationView] Erreur lors du chargement des tâches cron",{error:e}),t.showError("Erreur de connexion","Impossible de communiquer avec le serveur")}finally{a.value=!1}};return i(()=>{d()}),{isLoading:a,cronJobs:n,cronCommand:c,cronCommandInput:r,cronScriptPath:l,hasDomainFeature:u,refreshStatus:d,copyCommand:()=>{r.value&&(r.value.select(),document.execCommand("copy"),t.showSuccess("Copie réussie","Commande copiée dans le presse-papier"))},formatDate:e=>{if(!e)return"Jamais";const t=new Date(e),s=new Date;if(t.toDateString()===s.toDateString())return`Aujourd'hui à ${t.toLocaleTimeString()}`;const a=new Date;return a.setDate(a.getDate()-1),t.toDateString()===a.toDateString()?`Hier à ${t.toLocaleTimeString()}`:t.toLocaleString()}}}},[["render",function(e,t,s,a,i,n){const r=m("tickets-automation"),p=m("billing-automation"),b=m("services-automation"),_=m("domains-automation"),k=m("misc-automation");return g(),o("div",Cx,[t[17]||(t[17]=l("div",{class:"page-header"},[l("div",{class:"page-title"},[l("h3",null,[l("i",{class:"bi bi-clock-history"}),d(" Paramètres d'automatisation ")])])],-1)),l("div",Tx,[t[16]||(t[16]=l("div",{class:"card-header"},[l("h5",null,"Statut des tâches cron")],-1)),l("div",Ax,[t[15]||(t[15]=l("div",{class:"alert alert-info"},[l("i",{class:"bi bi-info-circle me-2"}),l("strong",null,"TechCMS"),d(" nécessite l'invocation régulière et fréquente d'un fichier via cron pour automatiser les tâches. ")],-1)),l("div",Ix,[t[3]||(t[3]=l("h6",null,"Commande Cron",-1)),t[4]||(t[4]=l("p",null,"La commande ci-dessous est fournie pour votre convenance. Vous devez configurer une tâche cron pour s'exécuter toutes les 5 minutes en utilisant cette commande dans votre utilitaire cron ou votre panneau de contrôle d'hébergement.",-1)),l("div",Rx,[l("input",{ref:"cronCommandInput",type:"text",class:"form-control",readonly:"",value:a.cronCommand},null,8,xx),l("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[0]||(t[0]=(...e)=>a.copyCommand&&a.copyCommand(...e))},t[2]||(t[2]=[l("i",{class:"bi bi-clipboard"},null,-1)]))]),t[5]||(t[5]=l("small",{class:"text-muted"},"Fréquence recommandée : Toutes les 5 minutes, ou aussi fréquemment que votre hébergeur le permet",-1))]),l("div",null,[t[14]||(t[14]=l("h6",null,"Statut des tâches",-1)),l("table",Ox,[t[12]||(t[12]=l("thead",null,[l("tr",null,[l("th",null,"Tâche"),l("th",null,"Statut"),l("th",null,"Description")])],-1)),l("tbody",null,[a.isLoading?(g(),o("tr",Px,t[6]||(t[6]=[l("td",{colspan:"3",class:"text-center"},[l("div",{class:"spinner-border spinner-border-sm",role:"status"},[l("span",{class:"visually-hidden"},"Chargement...")]),d(" Chargement des tâches... ")],-1)]))):0===a.cronJobs.length?(g(),o("tr",Nx,t[7]||(t[7]=[l("td",{colspan:"3",class:"text-center"},"Aucune tâche cron configurée",-1)]))):v("",!0),(g(!0),o(h,null,f(a.cronJobs,e=>(g(),o("tr",{key:e.id,class:y({"table-danger":"error"===e.status,"table-warning":"warning"===e.status})},[l("td",null,c(e.display_name),1),l("td",null,["success"===e.status?(g(),o("span",Mx,t[8]||(t[8]=[l("i",{class:"bi bi-check-circle me-1"},null,-1),d(" OK ")]))):"warning"===e.status?(g(),o("span",Dx,t[9]||(t[9]=[l("i",{class:"bi bi-exclamation-triangle me-1"},null,-1),d(" Attention ")]))):"error"===e.status?(g(),o("span",Lx,t[10]||(t[10]=[l("i",{class:"bi bi-x-circle me-1"},null,-1),d(" Erreur ")]))):(g(),o("span",Ux,t[11]||(t[11]=[l("i",{class:"bi bi-question-circle me-1"},null,-1),d(" Inconnu ")])))]),l("td",null,[l("div",null,c(e.description),1),e.last_run?(g(),o("small",qx,"Dernière exécution : "+c(a.formatDate(e.last_run)),1)):v("",!0),e.error?(g(),o("div",Vx,c(e.error),1)):v("",!0)])],2))),128))])]),l("div",$x,[l("button",{class:"btn btn-primary btn-sm",onClick:t[1]||(t[1]=(...e)=>a.refreshStatus&&a.refreshStatus(...e))},t[13]||(t[13]=[l("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),d(" Actualiser ")]))])])])]),l("div",jx,[l("div",Fx,[u(r)]),l("div",Gx,[u(p)])]),l("div",Bx,[l("div",Hx,[u(b)]),l("div",Wx,[a.hasDomainFeature?(g(),R(_,{key:0})):(g(),R(k,{key:1}))])])])}],["__scopeId","data-v-c1a55d36"]]),Kx={class:"update-status-card"},Jx={class:"card-header"},Yx={class:"card-content"},Xx={class:"status-grid"},Qx={class:"status-item"},Zx={class:"status-label"},eO={class:"status-value"},tO={class:"status-item"},sO={class:"status-label"},aO={class:"status-value"},iO={class:"status-item"},nO={class:"status-label"},rO={class:"status-value"},oO={class:"status-item"},lO={class:"status-label"},cO={class:"status-value"},uO={class:"automation-status"},dO={class:"automation-grid"},pO={class:"automation-item"},mO={class:"automation-info"},vO={class:"automation-label"},hO={class:"automation-status-text"},fO={class:"automation-item"},gO={class:"automation-info"},yO={class:"automation-label"},bO={class:"automation-status-text"},_O={class:"automation-item"},kO={class:"automation-info"},wO={class:"automation-label"},SO={class:"automation-status-text"},EO={class:"card-actions"},CO=["disabled"],TO=r({__name:"UpdateStatusCard",props:{data:{},loading:{type:Boolean,default:!1},availableVersions:{default:()=>[]}},emits:["check-updates","download-update"],setup(e,{emit:t}){const a=e,i=t,{t:n}=b(),r=s(()=>a.loading?"status-checking":a.data.updates_available>0?"status-updates-available":"status-up-to-date"),u=s(()=>a.loading?"icon-refresh spinning":a.data.updates_available>0?"icon-alert-circle":"icon-check-circle"),p=s(()=>a.loading?n("updates.checking"):a.data.updates_available>0?n("updates.updates_available_count",{count:a.data.updates_available}):n("updates.up_to_date")),m=s(()=>{if(!a.data.last_check)return n("updates.never");const e=new Date(a.data.last_check),t=(new Date).getTime()-e.getTime(),s=Math.floor(t/36e5),i=Math.floor(s/24);return s<1?n("updates.just_now"):s<24?n("updates.hours_ago",{count:s}):i<7?n("updates.days_ago",{count:i}):e.toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"})}),h=s(()=>{if(!a.data.last_update)return n("updates.never");return new Date(a.data.last_update).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})}),f=()=>{a.availableVersions&&a.availableVersions.length>0&&i("download-update",a.availableVersions[0])};return(e,t)=>(g(),o("div",Kx,[l("div",Jx,[l("h3",null,c(e.$t("updates.system_status")),1),l("div",{class:y(["status-indicator",r.value])},[l("i",{class:y(u.value)},null,2),l("span",null,c(p.value),1)],2)]),l("div",Yx,[l("div",Xx,[l("div",Qx,[l("div",Zx,c(e.$t("updates.current_version")),1),l("div",eO,[t[1]||(t[1]=l("i",{class:"icon-tag"},null,-1)),l("span",null,c(e.data.current_version),1)])]),l("div",tO,[l("div",sO,c(e.$t("updates.available_updates")),1),l("div",aO,[t[2]||(t[2]=l("i",{class:"icon-download"},null,-1)),l("span",{class:y(["update-count",{"has-updates":e.data.updates_available>0}])},c(e.data.updates_available),3)])]),l("div",iO,[l("div",nO,c(e.$t("updates.last_check")),1),l("div",rO,[t[3]||(t[3]=l("i",{class:"icon-clock"},null,-1)),l("span",null,c(m.value),1)])]),l("div",oO,[l("div",lO,c(e.$t("updates.last_update")),1),l("div",cO,[t[4]||(t[4]=l("i",{class:"icon-calendar"},null,-1)),l("span",null,c(h.value),1)])])]),l("div",uO,[l("h4",null,c(e.$t("updates.automation_status")),1),l("div",dO,[l("div",pO,[l("div",{class:y(["automation-toggle",{enabled:e.data.auto_check_enabled}])},[l("i",{class:y(e.data.auto_check_enabled?"icon-check":"icon-x")},null,2)],2),l("div",mO,[l("span",vO,c(e.$t("updates.auto_check")),1),l("span",hO,c(e.data.auto_check_enabled?e.$t("common.enabled"):e.$t("common.disabled")),1)])]),l("div",fO,[l("div",{class:y(["automation-toggle",{enabled:e.data.auto_download_enabled}])},[l("i",{class:y(e.data.auto_download_enabled?"icon-check":"icon-x")},null,2)],2),l("div",gO,[l("span",yO,c(e.$t("updates.auto_download")),1),l("span",bO,c(e.data.auto_download_enabled?e.$t("common.enabled"):e.$t("common.disabled")),1)])]),l("div",_O,[l("div",{class:y(["automation-toggle",{enabled:e.data.auto_install_enabled}])},[l("i",{class:y(e.data.auto_install_enabled?"icon-check":"icon-x")},null,2)],2),l("div",kO,[l("span",wO,c(e.$t("updates.auto_install")),1),l("span",SO,c(e.data.auto_install_enabled?e.$t("common.enabled"):e.$t("common.disabled")),1)])])])])]),l("div",EO,[l("button",{class:"btn btn-secondary",onClick:t[0]||(t[0]=t=>e.$emit("check-updates")),disabled:e.loading},[l("i",{class:y(["icon-refresh",{spinning:e.loading}])},null,2),d(" "+c(e.$t("updates.check_now")),1)],8,CO),e.data.updates_available>0?(g(),o("button",{key:0,class:"btn btn-primary",onClick:f},[t[5]||(t[5]=l("i",{class:"icon-download"},null,-1)),d(" "+c(e.$t("updates.download_latest")),1)])):v("",!0)])]))}}),AO={class:"update-history-table"},IO={class:"table-filters"},RO={class:"filter-group"},xO={value:""},OO={value:"pending"},PO={value:"downloading"},NO={value:"installing"},MO={value:"completed"},DO={value:"failed"},LO={value:"rolled_back"},UO={class:"filter-group"},qO=["placeholder"],VO={class:"filter-group"},$O={class:"filter-group"},jO={class:"table-container"},FO={class:"data-table"},GO=["onClick"],BO={key:0},HO=["colspan"],WO={class:"loading-content"},zO={key:1},KO=["colspan"],JO={class:"empty-content"},YO={class:"version-cell"},XO={class:"version-info"},QO={class:"version-from"},ZO={class:"version-to"},eP={class:"status-cell"},tP={class:"date-cell"},sP={class:"duration-cell"},aP={class:"size-cell"},iP={class:"actions-cell"},nP={class:"action-buttons"},rP=["onClick","title"],oP=["onClick","title"],lP=["onClick","title"],cP={key:0,class:"table-pagination"},uP={class:"pagination-info"},dP={class:"pagination-controls"},pP=["disabled"],mP={class:"page-numbers"},vP=["onClick"],hP=["disabled"],fP={class:"modal-container changelog-modal"},gP={class:"modal-header"},yP={class:"modal-content"},bP=["innerHTML"],_P={class:"modal-actions"},kP={class:"modal-container error-modal"},wP={class:"modal-header"},SP={class:"modal-content"},EP={class:"error-content"},CP={class:"error-message"},TP={key:0,class:"error-context"},AP={key:0},IP={class:"modal-actions"},RP=r({__name:"UpdateHistoryTable",props:{data:{},loading:{type:Boolean,default:!1},pagination:{}},emits:["page-change","sort-change","filter-change","retry-update"],setup(t,{emit:i}){const n=t,r=i,{t:u}=b(),p=e("created_at"),m=e("desc"),_=M({status:"",version:"",date_from:"",date_to:""}),E=M({show:!1,version:"",content:""}),C=M({show:!1,message:"",update:null}),T=[{key:"version",label:u("updates.version"),sortable:!0,width:"200px"},{key:"status",label:u("updates.status"),sortable:!0,width:"150px"},{key:"created_at",label:u("updates.date"),sortable:!0,width:"150px"},{key:"duration",label:u("updates.duration"),sortable:!1,width:"120px"},{key:"file_size",label:u("updates.size"),sortable:!0,width:"100px"},{key:"actions",label:u("common.actions"),sortable:!1,width:"120px"}],I=s(()=>{let e=[...n.data];return _.status&&(e=e.filter(e=>e.status===_.status)),_.version&&(e=e.filter(e=>e.version_to.toLowerCase().includes(_.version.toLowerCase())||e.version_from.toLowerCase().includes(_.version.toLowerCase()))),_.date_from&&(e=e.filter(e=>new Date(e.created_at)>=new Date(_.date_from))),_.date_to&&(e=e.filter(e=>new Date(e.created_at)<=new Date(_.date_to))),e}),R=s(()=>{const e=(n.pagination.current_page-1)*n.pagination.per_page,t=e+n.pagination.per_page;return I.value.slice(e,t)}),x=s(()=>Math.ceil(I.value.length/n.pagination.per_page)),O=s(()=>{const e=n.pagination.current_page,t=x.value;let s=Math.max(1,e-2),a=Math.min(t,e+2);a-s<4&&(1===s?a=Math.min(t,s+4):s=Math.max(1,a-4));const i=[];for(let n=s;n<=a;n++)i.push(n);return i}),P=e=>{r("page-change",e)},D=()=>{r("filter-change",{..._})},L=()=>{_.status="",_.version="",_.date_from="",_.date_to="",D()},U=e=>e?new Date(e).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",q=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["B","KB","MB","GB"][t]},V=e=>{if(!e.started_at)return"-";const t=new Date(e.started_at),s=(e.completed_at?new Date(e.completed_at):new Date).getTime()-t.getTime(),a=Math.floor(s/6e4);if(a<1)return"< 1 min";if(a<60)return`${a} min`;return`${Math.floor(a/60)}h ${a%60}min`},$=e=>{r("retry-update",e),C.show=!1};return a(_,()=>{D()},{deep:!0}),(e,t)=>(g(),o("div",AO,[l("div",IO,[l("div",RO,[l("label",null,c(e.$t("updates.filter_status")),1),w(l("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>_.status=e),onChange:D},[l("option",xO,c(e.$t("common.all")),1),l("option",OO,c(e.$t("updates.status.pending")),1),l("option",PO,c(e.$t("updates.status.downloading")),1),l("option",NO,c(e.$t("updates.status.installing")),1),l("option",MO,c(e.$t("updates.status.completed")),1),l("option",DO,c(e.$t("updates.status.failed")),1),l("option",LO,c(e.$t("updates.status.rolled_back")),1)],544),[[A,_.status]])]),l("div",UO,[l("label",null,c(e.$t("updates.filter_version")),1),w(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>_.version=e),type:"text",placeholder:e.$t("updates.filter_version_placeholder"),onInput:D},null,40,qO),[[S,_.version]])]),l("div",VO,[l("label",null,c(e.$t("updates.filter_date_from")),1),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>_.date_from=e),type:"date",onChange:D},null,544),[[S,_.date_from]])]),l("div",$O,[l("label",null,c(e.$t("updates.filter_date_to")),1),w(l("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>_.date_to=e),type:"date",onChange:D},null,544),[[S,_.date_to]])]),l("button",{class:"btn btn-secondary btn-sm",onClick:L},[t[13]||(t[13]=l("i",{class:"icon-x"},null,-1)),d(" "+c(e.$t("common.clear_filters")),1)])]),l("div",jO,[l("table",FO,[l("thead",null,[l("tr",null,[(g(),o(h,null,f(T,e=>l("th",{key:e.key,class:y({sortable:e.sortable,sorted:p.value===e.key,[`sorted-${m.value}`]:p.value===e.key}),style:N({width:e.width}),onClick:t=>{return e.sortable&&(s=e.key,p.value===s?m.value="asc"===m.value?"desc":"asc":(p.value=s,m.value="asc"),void r("sort-change",{field:p.value,direction:m.value}));var s}},[d(c(e.label)+" ",1),e.sortable?(g(),o("i",{key:0,class:y(["sort-icon",{"icon-chevron-up":p.value===e.key&&"asc"===m.value,"icon-chevron-down":p.value===e.key&&"desc"===m.value,"icon-chevrons-up-down":p.value!==e.key}])},null,2)):v("",!0)],14,GO)),64))])]),l("tbody",null,[e.loading?(g(),o("tr",BO,[l("td",{colspan:T.length,class:"loading-row"},[l("div",WO,[t[14]||(t[14]=l("i",{class:"icon-loader spinning"},null,-1)),l("span",null,c(e.$t("common.loading")),1)])],8,HO)])):0===I.value.length?(g(),o("tr",zO,[l("td",{colspan:T.length,class:"empty-row"},[l("div",JO,[t[15]||(t[15]=l("i",{class:"icon-inbox"},null,-1)),l("span",null,c(e.$t("updates.no_history")),1)])],8,KO)])):(g(!0),o(h,{key:2},f(R.value,s=>{return g(),o("tr",{key:s.id,class:y(["data-row",`status-${s.status}`])},[l("td",YO,[l("div",XO,[l("span",QO,c(s.version_from),1),t[16]||(t[16]=l("i",{class:"icon-arrow-right"},null,-1)),l("span",ZO,c(s.version_to),1)])]),l("td",eP,[l("span",{class:y(["status-badge",`status-${s.status}`])},[l("i",{class:y((a=s.status,{pending:"icon-clock",downloading:"icon-download",installing:"icon-settings",completed:"icon-check-circle",failed:"icon-x-circle",rolled_back:"icon-rotate-ccw"}[a]||"icon-help-circle"))},null,2),d(" "+c(e.$t(`updates.status.${s.status}`)),1)],2)]),l("td",tP,c(U(s.created_at)),1),l("td",sP,c(V(s)),1),l("td",aP,c(s.file_size?q(s.file_size):"-"),1),l("td",iP,[l("div",nP,[s.changelog?(g(),o("button",{key:0,class:"btn btn-sm btn-secondary",onClick:e=>(e=>{E.version=e.version_to,E.content=e.changelog||u("updates.no_changelog"),E.show=!0})(s),title:e.$t("updates.view_changelog")},t[17]||(t[17]=[l("i",{class:"icon-file-text"},null,-1)]),8,rP)):v("",!0),s.error_message?(g(),o("button",{key:1,class:"btn btn-sm btn-danger",onClick:e=>(e=>{C.message=e.error_message||u("updates.unknown_error"),C.update=e,C.show=!0})(s),title:e.$t("updates.view_error")},t[18]||(t[18]=[l("i",{class:"icon-alert-triangle"},null,-1)]),8,oP)):v("",!0),"failed"===s.status?(g(),o("button",{key:2,class:"btn btn-sm btn-warning",onClick:e=>$(s),title:e.$t("updates.retry")},t[19]||(t[19]=[l("i",{class:"icon-refresh"},null,-1)]),8,lP)):v("",!0)])])],2);var a}),128))])])]),x.value>1?(g(),o("div",cP,[l("div",uP,c(e.$t("common.showing_results",{from:(e.pagination.current_page-1)*e.pagination.per_page+1,to:Math.min(e.pagination.current_page*e.pagination.per_page,e.pagination.total),total:e.pagination.total})),1),l("div",dP,[l("button",{class:"btn btn-sm btn-secondary",disabled:1===e.pagination.current_page,onClick:t[4]||(t[4]=t=>P(e.pagination.current_page-1))},t[20]||(t[20]=[l("i",{class:"icon-chevron-left"},null,-1)]),8,pP),l("span",mP,[(g(!0),o(h,null,f(O.value,t=>(g(),o("button",{key:t,class:y(["btn btn-sm",{"btn-primary":t===e.pagination.current_page,"btn-secondary":t!==e.pagination.current_page}]),onClick:e=>P(t)},c(t),11,vP))),128))]),l("button",{class:"btn btn-sm btn-secondary",disabled:e.pagination.current_page===x.value,onClick:t[5]||(t[5]=t=>P(e.pagination.current_page+1))},t[21]||(t[21]=[l("i",{class:"icon-chevron-right"},null,-1)]),8,hP)])])):v("",!0),E.show?(g(),o("div",{key:1,class:"modal-overlay",onClick:t[8]||(t[8]=k(e=>E.show=!1,["self"]))},[l("div",fP,[l("div",gP,[l("h3",null,c(e.$t("updates.changelog_title",{version:E.version})),1),l("button",{class:"modal-close",onClick:t[6]||(t[6]=e=>E.show=!1)},t[22]||(t[22]=[l("i",{class:"icon-x"},null,-1)]))]),l("div",yP,[l("div",{class:"changelog-content",innerHTML:E.content},null,8,bP)]),l("div",_P,[l("button",{class:"btn btn-secondary",onClick:t[7]||(t[7]=e=>E.show=!1)},c(e.$t("common.close")),1)])])])):v("",!0),C.show?(g(),o("div",{key:2,class:"modal-overlay",onClick:t[12]||(t[12]=k(e=>C.show=!1,["self"]))},[l("div",kP,[l("div",wP,[l("h3",null,c(e.$t("updates.error_details")),1),l("button",{class:"modal-close",onClick:t[9]||(t[9]=e=>C.show=!1)},t[23]||(t[23]=[l("i",{class:"icon-x"},null,-1)]))]),l("div",SP,[l("div",EP,[l("div",CP,c(C.message),1),C.update?(g(),o("div",TP,[l("h4",null,c(e.$t("updates.update_context")),1),l("p",null,[l("strong",null,c(e.$t("updates.version"))+":",1),d(" "+c(C.update.version_to),1)]),l("p",null,[l("strong",null,c(e.$t("updates.started_at"))+":",1),d(" "+c(U(C.update.started_at)),1)]),C.update.completed_at?(g(),o("p",AP,[l("strong",null,c(e.$t("updates.failed_at"))+":",1),d(" "+c(U(C.update.completed_at)),1)])):v("",!0)])):v("",!0)])]),l("div",IP,[l("button",{class:"btn btn-secondary",onClick:t[10]||(t[10]=e=>C.show=!1)},c(e.$t("common.close")),1),C.update?(g(),o("button",{key:0,class:"btn btn-warning",onClick:t[11]||(t[11]=e=>$(C.update))},c(e.$t("updates.retry")),1)):v("",!0)])])])):v("",!0)]))}}),xP={class:"modal-container update-settings-modal"},OP={class:"modal-header"},PP={class:"settings-section"},NP={class:"setting-item"},MP={class:"setting-control"},DP={class:"toggle-switch"},LP={class:"setting-info"},UP={class:"setting-label"},qP={class:"setting-description"},VP={key:0,class:"setting-item"},$P={class:"setting-control"},jP={value:3600},FP={value:21600},GP={value:43200},BP={value:86400},HP={value:172800},WP={value:604800},zP={class:"setting-info"},KP={class:"setting-label"},JP={class:"setting-description"},YP={class:"settings-section"},XP={class:"setting-item"},QP={class:"setting-control"},ZP={class:"toggle-switch"},eN=["disabled"],tN={class:"setting-info"},sN={class:"setting-label"},aN={class:"setting-description"},iN={key:0,class:"setting-warning"},nN={class:"settings-section"},rN={class:"setting-item"},oN={class:"setting-control"},lN={class:"toggle-switch"},cN=["disabled"],uN={class:"setting-info"},dN={class:"setting-label"},pN={class:"setting-description"},mN={key:0,class:"setting-warning"},vN={class:"settings-section"},hN={class:"setting-item"},fN={class:"setting-control"},gN={class:"toggle-switch"},yN={class:"setting-info"},bN={class:"setting-label"},_N={class:"setting-description"},kN={class:"settings-section"},wN={class:"setting-item"},SN={class:"setting-control"},EN=["placeholder"],CN={class:"setting-info"},TN={class:"setting-label"},AN={class:"setting-description"},IN={key:0,class:"validation-errors"},RN={class:"settings-preview"},xN={class:"preview-grid"},ON={class:"preview-item"},PN={class:"preview-label"},NN={key:0,class:"preview-item"},MN={class:"preview-label"},DN={class:"preview-value"},LN={class:"preview-item"},UN={class:"preview-label"},qN={class:"preview-item"},VN={class:"preview-label"},$N={class:"preview-item"},jN={class:"preview-label"},FN={class:"modal-actions"},GN=["disabled"],BN=["disabled"],HN=["disabled"],WN={key:0,class:"icon-loader spinning"},zN={key:1,class:"icon-save"},KN=r({__name:"UpdateSettingsForm",props:{settings:{},loading:{type:Boolean,default:!1}},emits:["save","close"],setup(t,{emit:n}){const r=t,u=n,{t:p}=b(),m=M({auto_check:!0,auto_download:!1,auto_install:!1,check_interval:86400,backup_before_update:!0,notification_email:""}),_=e(null),E=e([]),T=s(()=>!!_.value&&Object.keys(m).some(e=>{const t=e;return m[t]!==_.value[t]})),I=()=>{r.settings&&(m.auto_check=r.settings.auto_check,m.auto_download=r.settings.auto_download,m.auto_install=r.settings.auto_install,m.check_interval=r.settings.check_interval,m.backup_before_update=r.settings.backup_before_update,m.notification_email=r.settings.notification_email||"",_.value={...m})},R=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),x=()=>{m.auto_check||(m.auto_download=!1,m.auto_install=!1)},O=()=>{m.auto_download||(m.auto_install=!1)},P=()=>{m.auto_check=!0,m.auto_download=!1,m.auto_install=!1,m.check_interval=86400,m.backup_before_update=!0,m.notification_email="",E.value=[]},N=()=>{E.value=[],m.notification_email&&!R(m.notification_email)&&E.value.push(p("updates.invalid_email")),m.check_interval<3600&&E.value.push(p("updates.interval_too_short")),m.auto_install&&!m.auto_download&&E.value.push(p("updates.auto_install_requires_download")),m.auto_download&&!m.auto_check&&E.value.push(p("updates.auto_download_requires_check")),0===E.value.length&&u("save",{...m})},D=()=>{u("close")};return a(()=>r.settings,I,{immediate:!0}),i(()=>{I()}),(e,t)=>{return g(),o("div",{class:"modal-overlay",onClick:k(D,["self"])},[l("div",xP,[l("div",OP,[l("h3",null,c(e.$t("updates.settings_title")),1),l("button",{class:"modal-close",onClick:D},t[6]||(t[6]=[l("i",{class:"icon-x"},null,-1)]))]),l("form",{onSubmit:k(N,["prevent"]),class:"modal-content"},[l("div",PP,[l("h4",null,c(e.$t("updates.automatic_checking")),1),l("div",NP,[l("div",MP,[l("label",DP,[w(l("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>m.auto_check=e),onChange:x},null,544),[[C,m.auto_check]]),t[7]||(t[7]=l("span",{class:"toggle-slider"},null,-1))])]),l("div",LP,[l("div",UP,c(e.$t("updates.enable_auto_check")),1),l("div",qP,c(e.$t("updates.auto_check_description")),1)])]),m.auto_check?(g(),o("div",VP,[l("div",$P,[w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>m.check_interval=e),class:"form-select"},[l("option",jP,c(e.$t("updates.interval_1h")),1),l("option",FP,c(e.$t("updates.interval_6h")),1),l("option",GP,c(e.$t("updates.interval_12h")),1),l("option",BP,c(e.$t("updates.interval_24h")),1),l("option",HP,c(e.$t("updates.interval_48h")),1),l("option",WP,c(e.$t("updates.interval_7d")),1)],512),[[A,m.check_interval]])]),l("div",zP,[l("div",KP,c(e.$t("updates.check_interval")),1),l("div",JP,c(e.$t("updates.check_interval_description")),1)])])):v("",!0)]),l("div",YP,[l("h4",null,c(e.$t("updates.automatic_download")),1),l("div",XP,[l("div",QP,[l("label",ZP,[w(l("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>m.auto_download=e),disabled:!m.auto_check,onChange:O},null,40,eN),[[C,m.auto_download]]),l("span",{class:y(["toggle-slider",{disabled:!m.auto_check}])},null,2)])]),l("div",tN,[l("div",sN,c(e.$t("updates.enable_auto_download")),1),l("div",aN,c(e.$t("updates.auto_download_description")),1),m.auto_check?v("",!0):(g(),o("div",iN,c(e.$t("updates.requires_auto_check")),1))])])]),l("div",nN,[l("h4",null,c(e.$t("updates.automatic_installation")),1),l("div",rN,[l("div",oN,[l("label",lN,[w(l("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>m.auto_install=e),disabled:!m.auto_download},null,8,cN),[[C,m.auto_install]]),l("span",{class:y(["toggle-slider",{disabled:!m.auto_download}])},null,2)])]),l("div",uN,[l("div",dN,c(e.$t("updates.enable_auto_install")),1),l("div",pN,c(e.$t("updates.auto_install_description")),1),m.auto_download?v("",!0):(g(),o("div",mN,c(e.$t("updates.requires_auto_download")),1))])])]),l("div",vN,[l("h4",null,c(e.$t("updates.backup_settings")),1),l("div",hN,[l("div",fN,[l("label",gN,[w(l("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>m.backup_before_update=e)},null,512),[[C,m.backup_before_update]]),t[8]||(t[8]=l("span",{class:"toggle-slider"},null,-1))])]),l("div",yN,[l("div",bN,c(e.$t("updates.backup_before_update")),1),l("div",_N,c(e.$t("updates.backup_description")),1)])])]),l("div",kN,[l("h4",null,c(e.$t("updates.notification_settings")),1),l("div",wN,[l("div",SN,[w(l("input",{type:"email","onUpdate:modelValue":t[5]||(t[5]=e=>m.notification_email=e),class:"form-input",placeholder:e.$t("updates.notification_email_placeholder")},null,8,EN),[[S,m.notification_email]])]),l("div",CN,[l("div",TN,c(e.$t("updates.notification_email")),1),l("div",AN,c(e.$t("updates.notification_email_description")),1)])])]),E.value.length>0?(g(),o("div",IN,[l("h4",null,c(e.$t("common.validation_errors")),1),l("ul",null,[(g(!0),o(h,null,f(E.value,e=>(g(),o("li",{key:e},c(e),1))),128))])])):v("",!0),l("div",RN,[l("h4",null,c(e.$t("updates.configuration_preview")),1),l("div",xN,[l("div",ON,[l("span",PN,c(e.$t("updates.auto_check"))+":",1),l("span",{class:y(["preview-value",{enabled:m.auto_check}])},c(m.auto_check?e.$t("common.enabled"):e.$t("common.disabled")),3)]),m.auto_check?(g(),o("div",NN,[l("span",MN,c(e.$t("updates.check_frequency"))+":",1),l("span",DN,c((s=m.check_interval,s<3600?p("updates.minutes",{count:Math.floor(s/60)}):s<86400?p("updates.hours",{count:Math.floor(s/3600)}):p("updates.days",{count:Math.floor(s/86400)}))),1)])):v("",!0),l("div",LN,[l("span",UN,c(e.$t("updates.auto_download"))+":",1),l("span",{class:y(["preview-value",{enabled:m.auto_download}])},c(m.auto_download?e.$t("common.enabled"):e.$t("common.disabled")),3)]),l("div",qN,[l("span",VN,c(e.$t("updates.auto_install"))+":",1),l("span",{class:y(["preview-value",{enabled:m.auto_install}])},c(m.auto_install?e.$t("common.enabled"):e.$t("common.disabled")),3)]),l("div",$N,[l("span",jN,c(e.$t("updates.backup_enabled"))+":",1),l("span",{class:y(["preview-value",{enabled:m.backup_before_update}])},c(m.backup_before_update?e.$t("common.enabled"):e.$t("common.disabled")),3)])])])],32),l("div",FN,[l("button",{type:"button",class:"btn btn-secondary",onClick:D,disabled:e.loading},c(e.$t("common.cancel")),9,GN),l("button",{type:"button",class:"btn btn-warning",onClick:P,disabled:e.loading},c(e.$t("updates.reset_defaults")),9,BN),l("button",{type:"submit",class:"btn btn-primary",onClick:N,disabled:e.loading||!T.value},[e.loading?(g(),o("i",WN)):(g(),o("i",zN)),d(" "+c(e.$t("common.save")),1)],8,HN)])])]);var s}}}),JN={class:"modal-container update-progress-modal"},YN={class:"modal-header"},XN={class:"modal-content"},QN={key:0,class:"progress-section"},ZN={class:"progress-info"},eM={class:"progress-status"},tM={class:"progress-text"},sM={key:0,class:"progress-percentage"},aM={class:"progress-bar-container"},iM={key:0,class:"progress-message"},nM={key:1,class:"progress-error"},rM={key:2,class:"version-details"},oM={class:"detail-item"},lM={class:"detail-label"},cM={class:"detail-value"},uM={key:0,class:"detail-item"},dM={class:"detail-label"},pM={class:"detail-value"},mM={key:1,class:"general-progress"},vM={class:"progress-steps"},hM={class:"step-indicator"},fM={key:0,class:"icon-x"},gM={key:1,class:"icon-check"},yM={key:2,class:"icon-loader spinning"},bM={key:3},_M={class:"step-content"},kM={class:"step-title"},wM={key:0,class:"step-description"},SM={key:1,class:"step-error"},EM={class:"modal-actions"},CM=r({__name:"UpdateProgressModal",props:{data:{}},emits:["close","cancel","continue","retry"],setup(t,{emit:a}){const i=t,n=a,{t:r}=b(),u=e(0),d=s(()=>{if(!i.data.progress)return!1;const e=i.data.progress.status;return"downloading"===e||"installing"===e}),p=s(()=>!!i.data.progress&&"completed"===i.data.progress.status),m=s(()=>!!i.data.progress&&("failed"===i.data.progress.status||!!i.data.progress.error)),_=s(()=>i.data.progress?Math.min(100,Math.max(0,i.data.progress.progress||0)):0),w=s(()=>m.value?"#ef4444":p.value?"#10b981":"#3b82f6"),S=s(()=>m.value?"icon-alert-triangle":p.value?"icon-check-circle":d.value?"icon-loader spinning":"icon-download"),E=s(()=>{if(!i.data.progress)return"download"===i.data.type?r("updates.preparing_download"):"install"===i.data.type?r("updates.preparing_install"):r("updates.preparing");switch(i.data.progress.status){case"downloading":return r("updates.downloading");case"installing":return r("updates.installing");case"completed":return r("updates.completed");case"failed":return r("updates.failed");default:return r("updates.processing")}}),C=s(()=>"download"===i.data.type?[{title:r("updates.step_validate_token"),description:r("updates.step_validate_token_desc"),error:null},{title:r("updates.step_download_file"),description:r("updates.step_download_file_desc"),error:null},{title:r("updates.step_verify_integrity"),description:r("updates.step_verify_integrity_desc"),error:null},{title:r("updates.step_complete"),description:r("updates.step_complete_desc"),error:null}]:"install"===i.data.type?[{title:r("updates.step_backup"),description:r("updates.step_backup_desc"),error:null},{title:r("updates.step_extract"),description:r("updates.step_extract_desc"),error:null},{title:r("updates.step_apply"),description:r("updates.step_apply_desc"),error:null},{title:r("updates.step_cleanup"),description:r("updates.step_cleanup_desc"),error:null}]:[]),T=()=>{d.value||n("close")},A=()=>{n("cancel")},I=()=>{n("continue")},R=()=>{n("retry")};return(e,t)=>{var s,a;return e.data.show?(g(),o("div",{key:0,class:"modal-overlay",onClick:k(T,["self"])},[l("div",JN,[l("div",YN,[l("h3",null,c(e.data.title),1),d.value?v("",!0):(g(),o("button",{key:0,class:"modal-close",onClick:T},t[0]||(t[0]=[l("i",{class:"icon-x"},null,-1)])))]),l("div",XN,["download"===e.data.type||"install"===e.data.type?(g(),o("div",QN,[l("div",ZN,[l("div",eM,[l("i",{class:y(S.value),style:N({color:w.value})},null,6),l("span",tM,c(E.value),1)]),e.data.progress?(g(),o("div",sM,c(Math.round(e.data.progress.progress))+"% ",1)):v("",!0)]),l("div",aM,[l("div",{class:"progress-bar",style:N({width:_.value+"%",backgroundColor:w.value})},null,4)]),(null==(s=e.data.progress)?void 0:s.message)?(g(),o("div",iM,c(e.data.progress.message),1)):v("",!0),(null==(a=e.data.progress)?void 0:a.error)?(g(),o("div",nM,[t[1]||(t[1]=l("i",{class:"icon-alert-triangle"},null,-1)),l("span",null,c(e.data.progress.error),1)])):v("",!0),e.data.version?(g(),o("div",rM,[l("h4",null,c(e.$t("updates.version_details")),1),l("div",oM,[l("span",lM,c(e.$t("updates.version"))+":",1),l("span",cM,c(e.data.version),1)]),e.data.update_id?(g(),o("div",uM,[l("span",dM,c(e.$t("updates.update_id"))+":",1),l("span",pM,"#"+c(e.data.update_id),1)])):v("",!0)])):v("",!0)])):"progress"===e.data.type?(g(),o("div",mM,[l("div",vM,[(g(!0),o(h,null,f(C.value,(e,t)=>(g(),o("div",{key:t,class:y(["progress-step",{active:t===u.value,completed:t<u.value,error:e.error}])},[l("div",hM,[e.error?(g(),o("i",fM)):t<u.value?(g(),o("i",gM)):t===u.value?(g(),o("i",yM)):(g(),o("span",bM,c(t+1),1))]),l("div",_M,[l("div",kM,c(e.title),1),e.description?(g(),o("div",wM,c(e.description),1)):v("",!0),e.error?(g(),o("div",SM,c(e.error),1)):v("",!0)])],2))),128))])])):v("",!0)]),l("div",EM,[d.value?v("",!0):(g(),o("button",{key:0,class:"btn btn-secondary",onClick:T},c(e.$t("common.close")),1)),d.value?(g(),o("button",{key:1,class:"btn btn-danger",onClick:A},c(e.$t("common.cancel")),1)):v("",!0),p.value&&!m.value?(g(),o("button",{key:2,class:"btn btn-primary",onClick:I},c(e.$t("common.continue")),1)):v("",!0),m.value?(g(),o("button",{key:3,class:"btn btn-warning",onClick:R},c(e.$t("common.retry")),1)):v("",!0)])])])):v("",!0)}}}),TM={class:"updates-view"},AM={class:"page-header"},IM={class:"page-title"},RM={class:"page-description"},xM={class:"page-actions"},OM=["disabled"],PM={key:0,class:"available-updates-section"},NM={class:"section-header"},MM={class:"badge badge-info"},DM={class:"available-updates-grid"},LM={class:"version-header"},UM={class:"version-info"},qM={class:"release-date"},VM={key:0,class:"file-size"},$M={key:0,class:"version-changelog"},jM=["innerHTML"],FM={class:"version-actions"},GM=["onClick","disabled"],BM={key:1,class:"btn btn-secondary btn-sm",disabled:""},HM={class:"history-section"},WM={class:"section-header"},zM={class:"section-actions"},KM=["disabled"],JM=r({__name:"UpdatesView",setup(t){const{t:a}=b(),n=He(),r=e(!1),p=e(!1),m=e(!1),_=e(!1),k=e(!1),w=e(!1),S=e(!1),E=e([]),C=e(null),T=e([]),A=e(null),I=M({current_page:1,per_page:10,total:0,total_pages:0}),x=M({show:!1,type:"progress",title:""}),O=s(()=>{var e,t,s,a,i,n;return{current_version:(null==(e=A.value)?void 0:e.current_version)||"1.0.0",updates_available:E.value.length,last_check:null==(t=A.value)?void 0:t.last_check,last_update:null==(s=T.value.find(e=>"completed"===e.status))?void 0:s.completed_at,auto_check_enabled:(null==(a=C.value)?void 0:a.auto_check)||!1,auto_download_enabled:(null==(i=C.value)?void 0:i.auto_download)||!1,auto_install_enabled:(null==(n=C.value)?void 0:n.auto_install)||!1}}),P=async()=>{var e,t;p.value=!0;try{const e=await _e.routes.admin.system.updates.check();A.value=e.data,e.data.updates_available?(E.value=e.data.versions,n.addNotification({type:"info",title:a("updates.check_success"),message:a("updates.updates_found",{count:e.data.versions.length})})):(E.value=[],n.addNotification({type:"success",title:a("updates.check_success"),message:a("updates.no_updates")}))}catch(s){n.addNotification({type:"error",title:a("updates.check_error"),message:(null==(t=null==(e=s.response)?void 0:e.data)?void 0:t.message)||a("common.error_occurred")})}finally{p.value=!1}},N=async e=>{var t,s;if(e.download_token){m.value=!0,x.show=!0,x.type="download",x.title=a("updates.downloading_version",{version:e.version}),x.version=e.version;try{const t=await _e.routes.admin.system.updates.download({token:e.download_token,version:e.version});if(!t.data.success)throw new Error(t.data.error||"Erreur de téléchargement");n.addNotification({type:"success",title:a("updates.download_success"),message:a("updates.download_completed",{version:e.version})}),await $(),x.type="install",x.title=a("updates.installing_version",{version:e.version}),await new Promise(e=>setTimeout(e,1e3)),await D(e)}catch(i){n.addNotification({type:"error",title:a("updates.download_error"),message:(null==(s=null==(t=i.response)?void 0:t.data)?void 0:s.message)||i.message||a("common.error_occurred")})}finally{m.value=!1,x.show=!1}}},D=async e=>{var t,s,i,r;const o=T.value.find(t=>t.version_to===e.version&&("completed"===t.status||"pending"===t.status));if(o){try{if(!(await _e.routes.admin.system.updates.checkRequirements()).data.all_passed)return void n.addNotification({type:"error",title:a("updates.requirements_not_met"),message:a("updates.check_requirements_first")})}catch(l){return void n.addNotification({type:"error",title:a("updates.requirements_check_error"),message:(null==(s=null==(t=l.response)?void 0:t.data)?void 0:s.message)||a("common.error_occurred")})}_.value=!0,x.show=!0,x.type="install",x.title=a("updates.installing_version",{version:e.version}),x.version=e.version,x.update_id=o.id;try{const t=await _e.routes.admin.system.updates.install({update_id:o.id});if(!t.data.success)throw new Error(t.data.error||"Erreur d'installation");n.addNotification({type:"success",title:a("updates.install_success"),message:a("updates.install_completed",{version:e.version})}),await Promise.all([$(),P()])}catch(l){n.addNotification({type:"error",title:a("updates.install_error"),message:(null==(r=null==(i=l.response)?void 0:i.data)?void 0:r.message)||l.message||a("common.error_occurred")})}finally{_.value=!1,x.show=!1}}else n.addNotification({type:"error",title:a("updates.install_error"),message:a("updates.no_downloaded_version")})},L=async e=>{if("failed"===e.status&&e.version_to){const t=E.value.find(t=>t.version===e.version_to);t&&(e.file_path?await D(t):await N(t))}},U=async e=>{var t,s;if(e.backup_id){if(confirm(a("updates.confirm_rollback",{version:e.version_to})))try{const t=await _e.routes.admin.system.updates.rollback({update_id:e.id,backup_id:e.backup_id});if(!t.data.success)throw new Error(t.data.error||"Erreur de rollback");n.addNotification({type:"success",title:a("updates.rollback_success"),message:a("updates.rollback_completed",{version:e.version_to})}),await $()}catch(i){n.addNotification({type:"error",title:a("updates.rollback_error"),message:(null==(s=null==(t=i.response)?void 0:t.data)?void 0:s.message)||i.message||a("common.error_occurred")})}}else n.addNotification({type:"error",title:a("updates.rollback_error"),message:a("updates.no_backup_available")})},q=async()=>{try{const e=await _e.routes.admin.system.updates.getSettings();C.value=e.data.data}catch(e){}},V=async e=>{var t,s;w.value=!0;try{const t=await _e.routes.admin.system.updates.updateSettings(e);if(!t.data.success)throw new Error(t.data.message||"Erreur de sauvegarde");C.value=t.data.data,S.value=!1,n.addNotification({type:"success",title:a("updates.settings_saved"),message:a("updates.settings_updated")})}catch(i){n.addNotification({type:"error",title:a("updates.settings_error"),message:(null==(s=null==(t=i.response)?void 0:t.data)?void 0:s.message)||i.message||a("common.error_occurred")})}finally{w.value=!1}},$=async()=>{k.value=!0;try{const e=await _e.routes.admin.system.updates.history({page:I.current_page,limit:I.per_page});T.value=e.data.data,I.total=e.data.total,I.total_pages=Math.ceil(e.data.total/I.per_page)}catch(e){}finally{k.value=!1}},j=()=>{$()},F=e=>{I.current_page=e,$()},G=e=>{},B=async()=>{var e,t;try{const e=await _e.routes.admin.system.updates.cleanup();n.addNotification({type:"success",title:a("updates.cleanup_success"),message:a("updates.cleanup_completed",{files:e.data.deleted_files,records:e.data.deleted_records})}),await $()}catch(s){n.addNotification({type:"error",title:a("updates.cleanup_error"),message:(null==(t=null==(e=s.response)?void 0:e.data)?void 0:t.message)||a("common.error_occurred")})}},H=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["B","KB","MB","GB"][t]};return i(async()=>{r.value=!0;try{await Promise.all([q(),$(),P()])}finally{r.value=!1}}),(e,t)=>(g(),o("div",TM,[l("div",AM,[l("div",IM,[l("h1",null,c(e.$t("updates.title")),1),l("p",RM,c(e.$t("updates.description")),1)]),l("div",xM,[l("button",{class:"btn btn-secondary",onClick:P,disabled:p.value},[l("i",{class:y(["icon-refresh",{spinning:p.value}])},null,2),d(" "+c(e.$t("updates.check_now")),1)],8,OM),l("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=e=>S.value=!0)},[t[3]||(t[3]=l("i",{class:"icon-settings"},null,-1)),d(" "+c(e.$t("updates.settings")),1)])])]),u(TO,{data:O.value,loading:r.value,onCheckUpdates:P,onDownloadUpdate:N},null,8,["data","loading"]),E.value.length>0?(g(),o("div",PM,[l("div",NM,[l("h2",null,c(e.$t("updates.available_versions")),1),l("span",MM,c(E.value.length),1)]),l("div",DM,[(g(!0),o(h,null,f(E.value,s=>{return g(),o("div",{key:s.version,class:"version-card"},[l("div",LM,[l("h3",null,c(e.$t("updates.version"))+" "+c(s.version),1),l("span",{class:y(["version-status",`status-${s.status}`])},c(e.$t(`updates.status.${s.status}`)),3)]),l("div",UM,[l("p",qM,[t[4]||(t[4]=l("i",{class:"icon-calendar"},null,-1)),d(" "+c((a=s.release_date,new Date(a).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"}))),1)]),s.file_size?(g(),o("p",VM,[t[5]||(t[5]=l("i",{class:"icon-download"},null,-1)),d(" "+c(H(s.file_size)),1)])):v("",!0)]),s.changelog?(g(),o("div",$M,[l("h4",null,c(e.$t("updates.changelog")),1),l("div",{class:"changelog-content",innerHTML:s.changelog},null,8,jM)])):v("",!0),l("div",FM,[s.download_token?(g(),o("button",{key:0,class:"btn btn-primary btn-sm",onClick:e=>(async e=>{if(!e.download_token)return;T.value.find(t=>t.version_to===e.version&&"completed"===t.status&&t.file_path)?await D(e):await N(e)})(s),disabled:m.value||_.value},[t[6]||(t[6]=l("i",{class:"icon-refresh"},null,-1)),d(" "+c(e.$t("updates.update_to_version")),1)],8,GM)):v("",!0),s.download_token?v("",!0):(g(),o("button",BM,[t[7]||(t[7]=l("i",{class:"icon-lock"},null,-1)),d(" "+c(e.$t("updates.not_available")),1)]))])]);var a}),128))])])):v("",!0),l("div",HM,[l("div",WM,[l("h2",null,c(e.$t("updates.history")),1),l("div",zM,[l("button",{class:"btn btn-secondary btn-sm",onClick:j,disabled:k.value},[l("i",{class:y(["icon-refresh",{spinning:k.value}])},null,2),d(" "+c(e.$t("common.refresh")),1)],8,KM),l("button",{class:"btn btn-secondary btn-sm",onClick:B},[t[8]||(t[8]=l("i",{class:"icon-trash"},null,-1)),d(" "+c(e.$t("updates.cleanup")),1)])])]),u(RP,{data:T.value,loading:k.value,pagination:I,onPageChange:F,onSortChange:G,onRetryUpdate:L,onRollbackUpdate:U},null,8,["data","loading","pagination"])]),S.value?(g(),R(KN,{key:1,settings:C.value,loading:w.value,onSave:V,onClose:t[1]||(t[1]=e=>S.value=!1)},null,8,["settings","loading"])):v("",!0),x.show?(g(),R(CM,{key:2,data:x,onClose:t[2]||(t[2]=e=>x.show=!1)},null,8,["data"])):v("",!0)]))}}),YM=t("license",()=>{const t=e(null),s=e(!1),a=e(null),i=He();return{licenseInfo:t,loading:s,error:a,fetchLicenseInfo:async()=>{var e,i;s.value=!0,a.value=null;try{const e=await _e.routes.admin.system.license.getLicenseInfo();return t.value=e.data.data,e.data.data}catch(n){return ne.error("Erreur lors de la récupération des infos de licence",{err:n}),a.value=(null==(i=null==(e=n.response)?void 0:e.data)?void 0:i.message)||"Erreur lors de la récupération des informations de licence",null}finally{s.value=!1}},updateLicense:async e=>{var n,r;s.value=!0,a.value=null;try{const s=await _e.routes.admin.system.license.activateLicense(e);return t.value=s.data.data,i.showNotification({title:"Licence mise à jour",message:s.data.message||"La licence a été mise à jour avec succès",type:s.data.success?"success":"error"}),s.data}catch(o){return ne.error("Erreur lors de la mise à jour de la licence",{err:o}),a.value=(null==(r=null==(n=o.response)?void 0:n.data)?void 0:r.message)||"Erreur lors de la mise à jour de la licence",i.showNotification({title:"Erreur",message:"string"==typeof a.value?a.value:"Erreur lors de la mise à jour de la licence",type:"error"}),null}finally{s.value=!1}}}}),XM={class:"view-container license-invalid-container"},QM={class:"license-form-container"},ZM={class:"license-form"},eD={class:"form-group"},tD={key:0,class:"error-message"},sD={key:1,class:"success-message"},aD={class:"form-actions"},iD=["disabled"],nD={key:0,class:"fas fa-spinner fa-spin"},rD=r({__name:"InvalidLicenseView",setup(t){const s=YM(),a=T(),i=e(""),n=e(!1),r=e(null),u=e(null),p=async()=>{if(i.value){n.value=!0,r.value=null,u.value=null;try{const e=await s.updateLicense(i.value);e&&e.success?(u.value="Licence activée avec succès ! Redirection vers le panneau d'administration...",setTimeout(()=>{a.push("/dashboard")},2e3)):r.value=(null==e?void 0:e.message)||"Erreur lors de la mise à jour de la licence"}catch(e){r.value=e.message||"Une erreur est survenue"}finally{n.value=!1}}else r.value="Veuillez entrer une clé de licence"};return(e,t)=>(g(),o("div",XM,[t[6]||(t[6]=D('<div class="header-box" data-v-76e4f46b><h1 class="page-title" data-v-76e4f46b>Licence Invalide</h1><p class="page-description" data-v-76e4f46b> Votre licence TechCMS est invalide ou a expiré. Veuillez entrer une clé de licence valide pour continuer. </p></div><div class="alert-box alert-warning" data-v-76e4f46b><i class="fas fa-exclamation-triangle" data-v-76e4f46b></i><div data-v-76e4f46b><h3 data-v-76e4f46b>Attention</h3><p data-v-76e4f46b>L&#39;accès au panneau d&#39;administration est limité jusqu&#39;à ce qu&#39;une licence valide soit fournie.</p></div></div>',2)),l("div",QM,[l("div",ZM,[t[3]||(t[3]=l("h3",null,"Activer votre licence",-1)),t[4]||(t[4]=l("div",{class:"license-format-hint"},[l("i",{class:"fas fa-info-circle"}),l("span",null,"Format: XXXX-XXXX-XXXX-XXXX")],-1)),l("form",{onSubmit:k(p,["prevent"])},[l("div",eD,[t[1]||(t[1]=l("label",{for:"licenseKey"},"Clé de Licence",-1)),w(l("input",{id:"licenseKey","onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),type:"text",placeholder:"Entrez votre clé de licence",class:"form-control",required:""},null,512),[[S,i.value]])]),r.value?(g(),o("div",tD,c(r.value),1)):v("",!0),u.value?(g(),o("div",sD,[t[2]||(t[2]=l("i",{class:"fas fa-check-circle"},null,-1)),d(" "+c(u.value),1)])):v("",!0),l("div",aD,[l("button",{type:"submit",class:"btn btn-primary",disabled:n.value},[n.value?(g(),o("i",nD)):v("",!0),d(" "+c(n.value?"Activation...":"Activer la licence"),1)],8,iD)])],32)]),t[5]||(t[5]=l("div",{class:"license-help"},[l("h3",null,"Besoin d'aide ?"),l("p",null,"Si vous avez perdu votre clé de licence ou si vous rencontrez des problèmes, veuillez contacter notre support :"),l("a",{href:"mailto:support@tech-cms.com",class:"support-link"},[l("i",{class:"fas fa-envelope"}),d(" support@tech-cms.com ")])],-1))])]))}}),oD=Vt(rD,[["__scopeId","data-v-76e4f46b"]]),lD={class:"view-container not-found-container"},cD={class:"header-box"},uD={class:"page-title"},dD={class:"page-description"},pD={class:"not-found-content"},mD={class:"not-found-message"},vD={class:"alert-box alert-info"},hD={class:"suggestions"},fD={class:"action-buttons"},gD=r({__name:"NotFoundView",setup(e){const t=T(),s=()=>{t.go(-1)};return(e,t)=>{const a=m("router-link");return g(),o("div",lD,[l("div",cD,[l("h1",uD,c(e.$t("notFound.title")),1),l("p",dD,c(e.$t("notFound.description")),1)]),l("div",pD,[t[3]||(t[3]=l("div",{class:"not-found-illustration"},[l("i",{class:"fas fa-search fa-4x"}),l("div",{class:"error-code"},"404")],-1)),l("div",mD,[l("div",vD,[t[0]||(t[0]=l("i",{class:"fas fa-info-circle"},null,-1)),l("div",null,[l("h3",null,c(e.$t("notFound.whatHappened")),1),l("p",null,c(e.$t("notFound.urlNotFound")),1)])]),l("div",hD,[l("h3",null,c(e.$t("notFound.suggestions")),1),l("ul",null,[l("li",null,c(e.$t("notFound.checkUrl")),1),l("li",null,c(e.$t("notFound.goBack")),1),l("li",null,c(e.$t("notFound.goToDashboard")),1)])]),l("div",fD,[l("button",{class:"btn btn-secondary",onClick:s},[t[1]||(t[1]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(e.$t("notFound.backButton")),1)]),u(a,{to:"/dashboard",class:"btn btn-primary"},{default:p(()=>[t[2]||(t[2]=l("i",{class:"fas fa-home"},null,-1)),d(" "+c(e.$t("notFound.dashboardButton")),1)]),_:1,__:[2]})])])])])}}}),yD=Vt(gD,[["__scopeId","data-v-5b2e590c"]]),bD={class:"datatable"},_D={class:"datatable-inner"},kD=["onClick"],wD={key:0,class:"fas fa-sort"},SD={key:0,class:"loading-row"},ED=["colspan"],CD={class:"loading-spinner"},TD={key:1,class:"empty-row"},AD=["colspan"],ID=["onClick"],RD=["innerHTML"],xD=r({__name:"DataTable",props:{columns:{},data:{},loading:{type:Boolean,default:!1},sortBy:{default:""},sortDesc:{type:Boolean,default:!1}},emits:["sort","row-click"],setup(e,{emit:t}){const a=e,i=t,n=s(()=>a.sortBy?[...a.data].sort((e,t)=>{const s=e[a.sortBy],i=t[a.sortBy];return a.sortDesc?s>i?-1:s<i?1:0:s<i?-1:s>i?1:0}):a.data);return(e,t)=>(g(),o("div",bD,[l("div",_D,[l("table",null,[l("thead",null,[l("tr",null,[(g(!0),o(h,null,f(e.columns,t=>(g(),o("th",{key:t.key,class:y({sortable:t.sortable,sorted:e.sortBy===t.key,"sort-desc":e.sortDesc&&e.sortBy===t.key}),onClick:e=>(e=>{if(!e.sortable)return;const t=a.sortBy===e.key&&!a.sortDesc;i("sort",e.key,t)})(t)},[d(c(t.label)+" ",1),t.sortable?(g(),o("i",wD)):v("",!0)],10,kD))),128))])]),l("tbody",null,[e.loading?(g(),o("tr",SD,[l("td",{colspan:e.columns.length},[l("div",CD,[t[0]||(t[0]=l("i",{class:"fas fa-spinner fa-spin"},null,-1)),d(" "+c(e.$t("common.loading")),1)])],8,ED)])):0===n.value.length?(g(),o("tr",TD,[l("td",{colspan:e.columns.length},c(e.$t("common.noData")),9,AD)])):(g(!0),o(h,{key:2},f(n.value,(t,s)=>(g(),o("tr",{key:s,onClick:e=>i("row-click",t)},[(g(!0),o(h,null,f(e.columns,e=>(g(),o("td",{key:e.key},[e.formatter?(g(),o("span",{key:0,innerHTML:e.formatter(t[e.key],t)},null,8,RD)):(g(),o(h,{key:1},[d(c(t[e.key]),1)],64))]))),128))],8,ID))),128))])])])]))}}),OD=Vt(xD,[["__scopeId","data-v-b1a4eaf5"]]),PD={class:"notifications-view"},ND={class:"page-header"},MD={class:"header-actions"},DD=["disabled"],LD=["disabled"],UD={class:"statistics-cards"},qD={class:"stat-card"},VD={class:"stat-content"},$D={class:"stat-value"},jD={class:"stat-label"},FD={class:"stat-card"},GD={class:"stat-content"},BD={class:"stat-value"},HD={class:"stat-label"},WD={class:"stat-card"},zD={class:"stat-content"},KD={class:"stat-value"},JD={class:"stat-label"},YD={class:"filters"},XD={class:"status-filters"},QD=["onClick"],ZD={class:"type-filters"},eL={class:"type-selector"},tL={class:"type-chips"},sL=["onClick"],aL={class:"search-bar"},iL=["placeholder"],nL=r({__name:"NotificationsView",setup(t){const{t:a}=b(),n=He(),r=e([]),p=e(!0),m=e("all"),v=e(""),k=e([]),E=[{value:"ticket",label:a("notifications.types.ticket")},{value:"invoice",label:a("notifications.types.invoice")},{value:"payment",label:a("notifications.types.payment")},{value:"client",label:a("notifications.types.client")},{value:"system",label:a("notifications.types.system")}],C=[{key:"type",label:a("notifications.columns.type"),sortable:!0,formatter:e=>({ticket:a("notifications.types.ticket"),invoice:a("notifications.types.invoice"),payment:a("notifications.types.payment"),client:a("notifications.types.client"),system:a("notifications.types.system")}[e]||e)},{key:"title",label:a("notifications.columns.title"),sortable:!0},{key:"message",label:a("notifications.columns.message"),sortable:!1},{key:"createdAt",label:a("notifications.columns.date"),sortable:!0,formatter:e=>new Date(e).toLocaleString()},{key:"status",label:a("notifications.columns.status"),sortable:!0,formatter:e=>({unread:a("notifications.status.unread"),read:a("notifications.status.read")}[e]||e)}],T=s(()=>{let e=[...r.value];if("all"!==m.value&&(e=e.filter(e=>e.status===m.value)),k.value.length>0&&(e=e.filter(e=>k.value.includes(e.type))),v.value){const t=v.value.toLowerCase();e=e.filter(e=>{var s,a;return((null==(s=e.title)?void 0:s.toLowerCase().includes(t))??!1)||((null==(a=e.message)?void 0:a.toLowerCase().includes(t))??!1)})}return e}),A=s(()=>({total:r.value.length,unread:r.value.filter(e=>"unread"===e.status).length,today:r.value.filter(e=>{if(!e.createdAt)return!1;const t=new Date(e.createdAt),s=new Date;return t.toDateString()===s.toDateString()}).length})),I=async e=>{try{const t="string"==typeof e.id?parseInt(e.id,10):e.id;await n.markAsRead(t);const s=r.value.findIndex(t=>t.id===e.id);-1!==s&&(r.value[s].status="read")}catch(t){ne.error("Erreur lors du marquage de la notification",{error:t,notificationId:e.id}),n.showNotification({type:"error",title:a("common.error"),message:a("notifications.markAsReadError")})}},R=async()=>{try{await n.markAllAsRead(),r.value=r.value.map(e=>({...e,status:"read"}))}catch(e){ne.error("Erreur lors du marquage des notifications",{error:e}),n.showNotification({type:"error",title:a("common.error"),message:a("notifications.markAllAsReadError")})}finally{p.value=!1}},x=async e=>{try{const t="string"==typeof e.id?parseInt(e.id,10):e.id;await n.deleteNotification(t),r.value=r.value.filter(t=>t.id!==e.id)}catch(t){ne.error("Erreur lors de la suppression de la notification",{error:t}),n.showNotification({type:"error",title:a("common.error"),message:a("notifications.deleteError")})}},O=async()=>{try{p.value=!0,await n.clearAll(),r.value=[]}catch(e){ne.error("Erreur lors de la suppression des notifications",{error:e}),n.showNotification({type:"error",title:a("common.error"),message:a("notifications.clearAllError")})}finally{p.value=!1}};return i(()=>{(async()=>{try{p.value=!0;const e=await n.fetchNotifications();r.value=e}catch(e){ne.error("Erreur lors du chargement des notifications",{error:e}),n.showNotification({type:"error",title:a("common.error"),message:a("notifications.loadError")})}finally{p.value=!1}})()}),(e,t)=>(g(),o("div",PD,[l("div",ND,[l("h1",null,c(_(a)("notifications.title")),1),l("div",MD,[l("button",{class:"btn btn-outline",disabled:!A.value.unread,onClick:R},[t[1]||(t[1]=l("i",{class:"fas fa-check-double"},null,-1)),d(" "+c(_(a)("notifications.markAllAsRead")),1)],8,DD),l("button",{class:"btn btn-danger",disabled:!r.value.length,onClick:O},[t[2]||(t[2]=l("i",{class:"fas fa-trash"},null,-1)),d(" "+c(_(a)("notifications.clearAll")),1)],8,LD)])]),l("div",UD,[l("div",qD,[t[3]||(t[3]=l("div",{class:"stat-icon"},[l("i",{class:"fas fa-bell"})],-1)),l("div",VD,[l("div",$D,c(A.value.total),1),l("div",jD,c(_(a)("notifications.stats.total")),1)])]),l("div",FD,[t[4]||(t[4]=l("div",{class:"stat-icon"},[l("i",{class:"fas fa-envelope"})],-1)),l("div",GD,[l("div",BD,c(A.value.unread),1),l("div",HD,c(_(a)("notifications.stats.unread")),1)])]),l("div",WD,[t[5]||(t[5]=l("div",{class:"stat-icon"},[l("i",{class:"fas fa-calendar-day"})],-1)),l("div",zD,[l("div",KD,c(A.value.today),1),l("div",JD,c(_(a)("notifications.stats.today")),1)])])]),l("div",YD,[l("div",XD,[(g(),o(h,null,f(["all","unread","read"],e=>l("button",{key:e,class:y([[m.value===e?"btn-primary":"btn-outline",`status-${e}`],"btn"]),onClick:t=>m.value=e},c(_(a)(`notifications.status.${e}`)),11,QD)),64))]),l("div",ZD,[l("div",eL,[l("label",null,c(_(a)("notifications.filterByType"))+":",1),l("div",tL,[(g(),o(h,null,f(E,e=>l("div",{key:e.value,class:y(["type-chip",{active:k.value.includes(e.value)}]),onClick:t=>k.value.includes(e.value)?k.value=k.value.filter(t=>t!==e.value):k.value.push(e.value)},c(e.label),11,sL)),64))])])]),l("div",aL,[w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),type:"text",placeholder:_(a)("notifications.search")},null,8,iL),[[S,v.value]]),t[6]||(t[6]=l("i",{class:"fas fa-search"},null,-1))])]),u(OD,{columns:C,data:T.value,loading:p.value,actions:[{icon:"fas fa-check",label:_(a)("notifications.markAsRead"),show:e=>"unread"===e.status,action:I},{icon:"fas fa-trash",label:_(a)("notifications.delete"),action:x}]},null,8,["data","loading","actions"])]))}}),rL=Vt(nL,[["__scopeId","data-v-f69a6297"]]),oL={id:"servicesList",class:"view-container"},lL={class:"header-box"},cL={class:"page-title"},uL={class:"page-description"},dL={class:"filter-box"},pL={class:"filter-grid"},mL={class:"filter-group"},vL={class:"filter-label"},hL={class:"filter-input-wrapper"},fL=["placeholder"],gL={class:"filter-group"},yL={class:"filter-label"},bL={class:"filter-input-wrapper"},_L={value:""},kL={value:"pending"},wL={value:"active"},SL={value:"suspended"},EL={value:"cancelled"},CL={value:"terminated"},TL={value:"fraud"},AL={class:"filter-group"},IL={class:"filter-label"},RL={class:"filter-input-wrapper"},xL={value:""},OL=["value"],PL={class:"filter-group"},NL={class:"filter-label"},ML={class:"filter-input-wrapper"},DL={value:""},LL=["value"],UL={key:0,class:"loading-state box"},qL={key:1,class:"empty-state box"},VL={class:"empty-title"},$L={class:"empty-description"},jL={key:2,class:"table-box"},FL={key:0,class:"data-table"},GL=["onClick"],BL={class:"actions"},HL={class:"action-buttons"},WL=["title","onClick"],zL=["title","onClick"],KL=["title","onClick"],JL={key:3,class:"pagination"},YL=["disabled"],XL=["onClick"],QL=["disabled"],ZL={key:4,class:"modal show",style:{display:"flex","align-items":"center","justify-content":"center"}},eU={class:"modal-content",style:{position:"fixed","z-index":"1052","max-height":"80vh","backdrop-filter":"none"}},tU={class:"modal-header"},sU={class:"modal-body"},aU={class:"warning"},iU={class:"modal-footer"},nU=["disabled"],rU=["disabled"],oU={key:0},lU={key:1},cU=r({__name:"ServicesView",setup(t){const n=Ss(),r=ws(),u=ha(),p=Be(),m=T(),{t:E}=b(),C=e(""),I=e(""),R=e(""),x=e(""),O=e("id"),P=e("DESC"),N=e(!1),M=e(null),D=e(!1),L=s(()=>n.services),U=s(()=>n.loading),q=s(()=>n.currentPage),V=s(()=>n.total),$=s(()=>n.perPage),j=s(()=>Math.ceil(V.value/$.value)),F=s(()=>r.clients),G=s(()=>u.products),B=s(()=>{const e=[];if(j.value<=5)for(let t=1;t<=j.value;t++)e.push(t);else if(q.value<=3){for(let t=1;t<=4;t++)e.push(t);e.push("..."),e.push(j.value)}else if(q.value>=j.value-2){e.push(1),e.push("...");for(let t=j.value-3;t<=j.value;t++)e.push(t)}else{e.push(1),e.push("...");for(let t=q.value-1;t<=q.value+1;t++)e.push(t);e.push("..."),e.push(j.value)}return e}),H=e=>{try{return Q(new Date(e),"dd/MM/yyyy",{locale:NE})}catch(t){return ne.warn("Failed to format date",{date:e,error:t}),e}},W=async()=>{try{await n.fetchServiceStats();const e={};C.value&&(e.search=C.value),I.value&&(e.status=I.value),R.value&&(e.client_id=R.value),x.value&&(e.product_id=x.value),e.sort_by=O.value,e.sort_dir=P.value,await n.fetchServices(q.value,e),await r.fetchClients(),await u.fetchProducts()}catch(e){ne.error("Erreur lors du chargement des données:",{error:e})}},z=e=>{"string"!=typeof e&&(e<1||e>j.value||e===q.value||W())},K=e=>{O.value===e?P.value="ASC"===P.value?"DESC":"ASC":(O.value=e,P.value="DESC"),W()},J=()=>{m.push({name:"create-service"})},Y=e=>{void 0!==e&&m.push({name:"service-details",params:{id:e.toString()}})},X=async()=>{if(ne.info(`[ServicesView] confirmDelete appelé pour le service ${M.value}`),M.value)try{ne.debug(`[ServicesView] Appel de servicesStore.deleteService pour le service ${M.value}`),D.value=!0,await n.deleteService(M.value),ne.info(`[ServicesView] Service ${M.value} supprimé avec succès`),N.value=!1,M.value=null,W()}catch(e){ne.error("Erreur lors de la suppression du service",{serviceId:M.value,error:e})}finally{D.value=!1}};return a([C,I,R,x],()=>{W()}),i(async()=>{await W(),(()=>{try{p.isInitialized||(ne.debug("[ServicesView] Initialisation du store realtime"),p.init()),n.initRealtimeListeners(),ne.info("[ServicesView] Fonctionnalités temps réel initialisées avec succès")}catch(e){ne.error("[ServicesView] Erreur lors de l'initialisation du temps réel",{error:e})}})(),ne.info("[ServicesView] Composant monté et temps réel initialisé")}),(e,t)=>(g(),o("div",oL,[l("div",lL,[l("div",null,[l("h1",cL,c(_(E)("services.title")),1),l("span",uL,c(_(E)("services.description")),1)]),l("button",{class:"btn btn-gradient",onClick:J},[t[12]||(t[12]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(_(E)("services.add_new")),1)])]),l("div",dL,[l("div",pL,[l("div",mL,[l("label",vL,c(_(E)("services.filters.search")),1),l("div",hL,[t[13]||(t[13]=l("i",{class:"fas fa-search"},null,-1)),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>C.value=e),type:"text",class:"filter-input",placeholder:_(E)("services.filters.search_placeholder")},null,8,fL),[[S,C.value]])])]),l("div",gL,[l("label",yL,c(_(E)("services.filters.status")),1),l("div",bL,[t[14]||(t[14]=l("i",{class:"fas fa-tag"},null,-1)),w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>I.value=e),class:"filter-input"},[l("option",_L,c(_(E)("services.status.all")),1),l("option",kL,c(_(E)("services.status.pending")),1),l("option",wL,c(_(E)("services.status.active")),1),l("option",SL,c(_(E)("services.status.suspended")),1),l("option",EL,c(_(E)("services.status.cancelled")),1),l("option",CL,c(_(E)("services.status.terminated")),1),l("option",TL,c(_(E)("services.status.fraud")),1)],512),[[A,I.value]])])]),l("div",AL,[l("label",IL,c(_(E)("services.filters.client")),1),l("div",RL,[t[15]||(t[15]=l("i",{class:"fas fa-user"},null,-1)),w(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>R.value=e),class:"filter-input"},[l("option",xL,c(_(E)("services.filters.all_clients")),1),(g(!0),o(h,null,f(F.value,e=>(g(),o("option",{key:(null==e?void 0:e.id)||"",value:(null==e?void 0:e.id)||""},c((null==e?void 0:e.firstname)||"")+" "+c((null==e?void 0:e.lastname)||""),9,OL))),128))],512),[[A,R.value]])])]),l("div",PL,[l("label",NL,c(_(E)("services.filters.product")),1),l("div",ML,[t[16]||(t[16]=l("i",{class:"fas fa-box"},null,-1)),w(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>x.value=e),class:"filter-input"},[l("option",DL,c(_(E)("services.filters.all_products")),1),(g(!0),o(h,null,f(G.value,e=>(g(),o("option",{key:(null==e?void 0:e.id)||"",value:(null==e?void 0:e.id)||""},c((null==e?void 0:e.name)||""),9,LL))),128))],512),[[A,x.value]])])])])]),U.value?(g(),o("div",UL,[t[17]||(t[17]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(E)("common.loading")),1)])):0===L.value.length?(g(),o("div",qL,[t[18]||(t[18]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-server"})],-1)),l("h3",VL,c(_(E)("services.empty.title")),1),l("p",$L,c(_(E)("services.empty.message")),1),l("button",{class:"btn btn-primary",onClick:J},c(_(E)("services.add_new")),1)])):(g(),o("div",jL,[!U.value&&L.value.length>0?(g(),o("table",FL,[l("thead",null,[l("tr",null,[l("th",{class:y(["sortable",{active:"id"===O.value}]),onClick:t[4]||(t[4]=e=>K("id"))},[t[19]||(t[19]=d(" ID ")),"id"===O.value?(g(),o("i",{key:0,class:y("ASC"===P.value?"fas fa-sort-up":"fas fa-sort-down")},null,2)):v("",!0)],2),l("th",null,c(_(E)("services.table.client")),1),l("th",null,c(_(E)("services.table.product")),1),l("th",null,c(_(E)("services.table.domain")),1),l("th",{class:y(["sortable",{active:"status"===O.value}]),onClick:t[5]||(t[5]=e=>K("status"))},[d(c(_(E)("services.table.status"))+" ",1),"status"===O.value?(g(),o("i",{key:0,class:y("ASC"===P.value?"fas fa-sort-up":"fas fa-sort-down")},null,2)):v("",!0)],2),l("th",{class:y(["sortable",{active:"next_due_date"===O.value}]),onClick:t[6]||(t[6]=e=>K("next_due_date"))},[d(c(_(E)("services.table.next_due_date"))+" ",1),"next_due_date"===O.value?(g(),o("i",{key:0,class:y("ASC"===P.value?"fas fa-sort-up":"fas fa-sort-down")},null,2)):v("",!0)],2),l("th",null,c(_(E)("services.table.recurring_amount")),1),l("th",null,c(_(E)("services.table.actions")),1)])]),l("tbody",null,[(g(!0),o(h,null,f(L.value,e=>{return g(),o("tr",{key:e.id,onClick:t=>Y(e.id)},[l("td",null,"#"+c(e.id),1),l("td",null,c(e.client_name),1),l("td",null,c(e.product_name),1),l("td",null,c(e.domain||"-"),1),l("td",null,[l("span",{class:y(["status-badge","status-"+e.status])},c(_(E)(`services.status.${e.status}`)),3)]),l("td",null,c(e.next_due_date?H(e.next_due_date):"-"),1),l("td",null,c((s=e.recurring_amount,void 0===s?"-":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(s))),1),l("td",BL,[l("div",HL,[l("button",{class:"btn-icon",title:_(E)("services.actions.view"),onClick:k(t=>Y(e.id),["stop"])},t[20]||(t[20]=[l("i",{class:"fas fa-eye"},null,-1)]),8,WL),l("button",{class:"btn-icon",title:_(E)("services.actions.edit"),onClick:k(t=>{var s;void 0!==(s=e.id)&&m.push({name:"edit-service",params:{id:s.toString()}})},["stop"])},t[21]||(t[21]=[l("i",{class:"fas fa-edit"},null,-1)]),8,zL),l("button",{class:"btn-icon",title:_(E)("services.actions.delete"),onClick:k(t=>{var s;void 0!==(s=e.id)&&(M.value=s,N.value=!0)},["stop"])},t[22]||(t[22]=[l("i",{class:"fas fa-trash"},null,-1)]),8,KL)])])],8,GL);var s}),128))])])):v("",!0)])),j.value>1?(g(),o("div",JL,[l("button",{class:"pagination-btn",disabled:1===q.value,onClick:t[7]||(t[7]=e=>z(q.value-1))},t[23]||(t[23]=[l("i",{class:"fas fa-chevron-left"},null,-1)]),8,YL),(g(!0),o(h,null,f(B.value,e=>(g(),o("button",{key:e,class:y(["pagination-btn",{active:e===q.value}]),onClick:t=>z(e)},c(e),11,XL))),128)),l("button",{class:"pagination-btn",disabled:q.value===j.value,onClick:t[8]||(t[8]=e=>z(q.value+1))},t[24]||(t[24]=[l("i",{class:"fas fa-chevron-right"},null,-1)]),8,QL)])):v("",!0),N.value?(g(),o("div",ZL,[l("div",{class:"modal-backdrop",onClick:t[9]||(t[9]=e=>N.value=!1)}),l("div",eU,[l("div",tU,[l("h3",null,c(_(E)("services.delete_modal.title")),1),l("button",{class:"close-btn",onClick:t[10]||(t[10]=e=>N.value=!1)},t[25]||(t[25]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",sU,[l("p",null,c(_(E)("services.delete_modal.confirmation")),1),l("p",aU,c(_(E)("services.delete_modal.warning")),1)]),l("div",iU,[l("button",{class:"btn btn-secondary",disabled:D.value,onClick:t[11]||(t[11]=e=>N.value=!1)},c(_(E)("common.cancel")),9,nU),l("button",{class:"btn btn-danger",disabled:D.value,onClick:X},[D.value?(g(),o("span",oU,[t[26]||(t[26]=l("span",{class:"spinner-border spinner-border-sm mr-2"},null,-1)),d(" "+c(_(E)("common.deleting"))+"... ",1)])):(g(),o("span",lU,c(_(E)("common.delete")),1))],8,rU)])])])):v("",!0)]))}}),uU=Vt(cU,[["__scopeId","data-v-17417738"]]),dU={id:"serviceForm",class:"view-container"},pU={class:"header-box"},mU={class:"page-title"},vU={class:"page-description"},hU={class:"content-box"},fU={class:"form-section"},gU={class:"section-title"},yU={class:"form-group"},bU={for:"client_id"},_U={class:"select-wrapper"},kU=["disabled"],wU={value:""},SU=["value"],EU={key:0,class:"error-message"},CU={class:"form-group"},TU={for:"product_id"},AU={class:"select-wrapper"},IU=["disabled"],RU={value:""},xU=["value"],OU={key:0,class:"error-message"},PU={class:"form-section"},NU={class:"section-title"},MU={class:"form-group"},DU={for:"domain"},LU={class:"input-wrapper"},UU=["placeholder","disabled"],qU={key:0,class:"error-message"},VU={class:"form-row"},$U={class:"form-group flex-1"},jU={for:"username"},FU={class:"input-wrapper"},GU=["placeholder","disabled"],BU={key:0,class:"error-message"},HU={class:"form-group flex-1"},WU={for:"password"},zU={class:"input-wrapper password-input"},KU=["type","placeholder","disabled"],JU={key:0,class:"error-message"},YU={class:"form-group"},XU={for:"server_id"},QU={class:"select-wrapper"},ZU=["disabled"],eq={value:""},tq=["value"],sq={key:0,class:"error-message"},aq={class:"form-group"},iq={for:"status"},nq={class:"select-wrapper"},rq=["disabled"],oq={value:"pending"},lq={value:"active"},cq={value:"suspended"},uq={value:"cancelled"},dq={value:"terminated"},pq={value:"fraud"},mq={key:0,class:"error-message"},vq={class:"form-section"},hq={class:"section-title"},fq={class:"form-row"},gq={class:"form-group flex-1"},yq={for:"billing_cycle"},bq={class:"select-wrapper"},_q=["disabled"],kq={value:"monthly"},wq={value:"quarterly"},Sq={value:"semi_annually"},Eq={value:"annually"},Cq={value:"biennially"},Tq={value:"triennially"},Aq={key:0,class:"error-message"},Iq={class:"form-group flex-1"},Rq={for:"next_due_date"},xq={class:"input-wrapper with-button"},Oq=["disabled"],Pq=["title","disabled"],Nq={key:0,class:"error-message"},Mq={class:"form-row"},Dq={class:"form-group flex-1"},Lq={for:"recurring_amount"},Uq={class:"input-wrapper"},qq=["placeholder","disabled"],Vq={key:0,class:"error-message"},$q={class:"form-group flex-1"},jq={for:"setup_fee"},Fq={class:"input-wrapper"},Gq=["placeholder","disabled"],Bq={key:0,class:"error-message"},Hq={class:"form-section"},Wq={class:"section-title"},zq={class:"form-group"},Kq={for:"notes"},Jq=["placeholder","disabled"],Yq={key:0,class:"error-message"},Xq={key:0,class:"form-section"},Qq={class:"section-title"},Zq={class:"config-entries"},eV={class:"form-row"},tV={class:"form-group flex-1"},sV={class:"input-wrapper"},aV=["onUpdate:modelValue","disabled","onInput"],iV={class:"form-group flex-2"},nV={class:"input-wrapper"},rV=["onUpdate:modelValue","disabled"],oV={class:"form-group flex-0"},lV={class:"invisible"},cV=["disabled","onClick"],uV=["disabled"],dV={class:"form-actions"},pV=["disabled"],mV=["disabled"],vV={key:0,class:"fas fa-spinner fa-spin"},hV=Vt(r({__name:"ServiceFormView",setup(t){const a=Ss(),n=ws(),r=ha(),u=_y(),p=He(),m=T(),C=I(),{t:R}=b(),x=e(!1),O=e(!1),P=M({}),N=M({}),D=s(()=>{const e=C.params.id;return e?parseInt(e.toString()):null}),L=s(()=>null!==D.value),U=M({client_id:"",product_id:"",status:"pending",domain:"",server_id:"",username:"",password:"",next_due_date:"",billing_cycle:"monthly",recurring_amount:0,setup_fee:0,notes:"",configuration:{}}),q=s(()=>n.clients),V=s(()=>r.products),$=s(()=>u.servers),j=()=>{m.push({name:"services"})},F=async()=>{if(Object.keys(P).forEach(e=>delete P[e]),U.client_id||(P.client_id=R("services.form.errors.client_required")),U.product_id||(P.product_id=R("services.form.errors.product_required")),U.status||(P.status=R("services.form.errors.status_required")),U.next_due_date&&!/^\d{4}-\d{2}-\d{2}$/.test(U.next_due_date)&&(P.next_due_date=R("services.form.errors.invalid_date")),U.recurring_amount&&U.recurring_amount<0&&(P.recurring_amount=R("services.form.errors.negative_amount")),U.setup_fee&&U.setup_fee<0&&(P.setup_fee=R("services.form.errors.negative_fee")),0===Object.keys(P).length){x.value=!0;try{const e={client_id:parseInt(U.client_id),product_id:parseInt(U.product_id),status:U.status,domain:U.domain,server_id:U.server_id?parseInt(U.server_id):void 0,username:U.username,password:U.password,next_due_date:U.next_due_date,billing_cycle:U.billing_cycle,recurring_amount:U.recurring_amount,setup_fee:U.setup_fee,notes:U.notes,configuration:U.configuration};L.value&&D.value?(await a.updateService(D.value,e),p.showNotification({title:R("services.form.success_update_title"),message:R("services.form.success_update_message"),type:"success"})):(await a.createService(e),p.showNotification({title:R("services.form.success_create_title"),message:R("services.form.success_create_message"),type:"success"})),m.push({name:"services"})}catch(e){ne.error("Erreur lors de la soumission du formulaire",{error:e}),p.showNotification({title:R("common.error"),message:R("services.form.error_submit"),type:"error"})}finally{x.value=!1}}},G=()=>{const e=`config_${Date.now()}`;U.configuration[e]="",N[e]=""};function B(){const e=new Date;let t=new Date(e);switch(U.billing_cycle){case"monthly":default:t.setMonth(e.getMonth()+1);break;case"quarterly":t.setMonth(e.getMonth()+3);break;case"semi_annually":t.setMonth(e.getMonth()+6);break;case"annually":t.setFullYear(e.getFullYear()+1);break;case"biennially":t.setFullYear(e.getFullYear()+2);break;case"triennially":t.setFullYear(e.getFullYear()+3)}const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");U.next_due_date=`${s}-${a}-${i}`}return i(()=>{(async()=>{x.value=!0;try{if(await Promise.all([n.fetchClients(),r.fetchProducts(),u.fetchServers()]),L.value&&D.value){const e=await a.fetchServiceById(D.value);if(e){const t=U,s=e;Object.keys(t).forEach(a=>{a in e&&(t[a]=s[a])}),e.configuration&&(U.configuration={...e.configuration},Object.keys(e.configuration).forEach(e=>{N[e]=e}))}else ne.warn(`Service avec ID ${D.value} non trouvé`),p.showNotification({title:R("common.error"),message:R("services.form.not_found"),type:"error"})}}catch(e){ne.error("Erreur lors du chargement des données",{error:e}),p.showNotification({title:R("common.error"),message:R("services.form.error_loading"),type:"error"})}finally{x.value=!1}})(),L.value||U.next_due_date||B()}),(e,t)=>(g(),o("div",dU,[l("div",pU,[l("div",null,[l("h1",mU,c(L.value?_(R)("services.edit.title"):_(R)("services.create.title")),1),l("span",vU,c(L.value?_(R)("services.edit.description"):_(R)("services.create.description")),1)]),l("button",{class:"btn btn-outline",onClick:j},[t[13]||(t[13]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(_(R)("common.back")),1)])]),l("div",hU,[l("form",{class:"form-container",onSubmit:k(F,["prevent"])},[l("div",fU,[l("h3",gU,c(_(R)("services.form.section.client_product")),1),l("div",yU,[l("label",bU,[d(c(_(R)("services.form.client"))+" ",1),t[14]||(t[14]=l("span",{class:"required"},"*",-1))]),l("div",_U,[t[15]||(t[15]=l("i",{class:"fas fa-user"},null,-1)),w(l("select",{id:"client_id","onUpdate:modelValue":t[0]||(t[0]=e=>U.client_id=e),class:"form-control",disabled:x.value||L.value,required:""},[l("option",wU,c(_(R)("services.form.select_client")),1),(g(!0),o(h,null,f(q.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.firstname)+" "+c(e.lastname)+" ("+c(e.email)+") ",9,SU))),128))],8,kU),[[A,U.client_id]])]),P.client_id?(g(),o("span",EU,c(P.client_id),1)):v("",!0)]),l("div",CU,[l("label",TU,[d(c(_(R)("services.form.product"))+" ",1),t[16]||(t[16]=l("span",{class:"required"},"*",-1))]),l("div",AU,[t[17]||(t[17]=l("i",{class:"fas fa-box"},null,-1)),w(l("select",{id:"product_id","onUpdate:modelValue":t[1]||(t[1]=e=>U.product_id=e),class:"form-control",disabled:x.value||L.value,required:""},[l("option",RU,c(_(R)("services.form.select_product")),1),(g(!0),o(h,null,f(V.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name),9,xU))),128))],8,IU),[[A,U.product_id]])]),P.product_id?(g(),o("span",OU,c(P.product_id),1)):v("",!0)])]),l("div",PU,[l("h3",NU,c(_(R)("services.form.section.details")),1),l("div",MU,[l("label",DU,c(_(R)("services.form.domain")),1),l("div",LU,[t[18]||(t[18]=l("i",{class:"fas fa-globe"},null,-1)),w(l("input",{id:"domain","onUpdate:modelValue":t[2]||(t[2]=e=>U.domain=e),type:"text",class:"form-control",placeholder:_(R)("services.form.domain_placeholder"),disabled:x.value},null,8,UU),[[S,U.domain]])]),P.domain?(g(),o("span",qU,c(P.domain),1)):v("",!0)]),l("div",VU,[l("div",$U,[l("label",jU,c(_(R)("services.form.username")),1),l("div",FU,[t[19]||(t[19]=l("i",{class:"fas fa-user-tag"},null,-1)),w(l("input",{id:"username","onUpdate:modelValue":t[3]||(t[3]=e=>U.username=e),type:"text",class:"form-control",placeholder:_(R)("services.form.username_placeholder"),disabled:x.value},null,8,GU),[[S,U.username]])]),P.username?(g(),o("span",BU,c(P.username),1)):v("",!0)]),l("div",HU,[l("label",WU,c(_(R)("services.form.password")),1),l("div",zU,[t[20]||(t[20]=l("i",{class:"fas fa-lock"},null,-1)),w(l("input",{id:"password","onUpdate:modelValue":t[4]||(t[4]=e=>U.password=e),type:O.value?"text":"password",class:"form-control",placeholder:_(R)("services.form.password_placeholder"),disabled:x.value},null,8,KU),[[E,U.password]]),l("button",{type:"button",class:"password-toggle",onClick:t[5]||(t[5]=e=>O.value=!O.value)},[l("i",{class:y(O.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])]),P.password?(g(),o("span",JU,c(P.password),1)):v("",!0)])]),l("div",YU,[l("label",XU,c(_(R)("services.form.server")),1),l("div",QU,[t[21]||(t[21]=l("i",{class:"fas fa-server"},null,-1)),w(l("select",{id:"server_id","onUpdate:modelValue":t[6]||(t[6]=e=>U.server_id=e),class:"form-control",disabled:x.value},[l("option",eq,c(_(R)("services.form.select_server")),1),(g(!0),o(h,null,f($.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name)+" ("+c(e.hostname)+") ",9,tq))),128))],8,ZU),[[A,U.server_id]])]),P.server_id?(g(),o("span",sq,c(P.server_id),1)):v("",!0)]),l("div",aq,[l("label",iq,[d(c(_(R)("services.form.status"))+" ",1),t[22]||(t[22]=l("span",{class:"required"},"*",-1))]),l("div",nq,[t[23]||(t[23]=l("i",{class:"fas fa-tag"},null,-1)),w(l("select",{id:"status","onUpdate:modelValue":t[7]||(t[7]=e=>U.status=e),class:"form-control",disabled:x.value,required:""},[l("option",oq,c(_(R)("services.status.pending")),1),l("option",lq,c(_(R)("services.status.active")),1),l("option",cq,c(_(R)("services.status.suspended")),1),l("option",uq,c(_(R)("services.status.cancelled")),1),l("option",dq,c(_(R)("services.status.terminated")),1),l("option",pq,c(_(R)("services.status.fraud")),1)],8,rq),[[A,U.status]])]),P.status?(g(),o("span",mq,c(P.status),1)):v("",!0)])]),l("div",vq,[l("h3",hq,c(_(R)("services.form.section.billing")),1),l("div",fq,[l("div",gq,[l("label",yq,c(_(R)("services.form.billing_cycle")),1),l("div",bq,[t[24]||(t[24]=l("i",{class:"fas fa-sync"},null,-1)),w(l("select",{id:"billing_cycle","onUpdate:modelValue":t[8]||(t[8]=e=>U.billing_cycle=e),class:"form-control",disabled:x.value,onChange:B},[l("option",kq,c(_(R)("services.billing_cycles.monthly")),1),l("option",wq,c(_(R)("services.billing_cycles.quarterly")),1),l("option",Sq,c(_(R)("services.billing_cycles.semi_annually")),1),l("option",Eq,c(_(R)("services.billing_cycles.annually")),1),l("option",Cq,c(_(R)("services.billing_cycles.biennially")),1),l("option",Tq,c(_(R)("services.billing_cycles.triennially")),1)],40,_q),[[A,U.billing_cycle]])]),P.billing_cycle?(g(),o("span",Aq,c(P.billing_cycle),1)):v("",!0)]),l("div",Iq,[l("label",Rq,c(_(R)("services.form.next_due_date")),1),l("div",xq,[t[26]||(t[26]=l("i",{class:"fas fa-calendar"},null,-1)),w(l("input",{id:"next_due_date","onUpdate:modelValue":t[9]||(t[9]=e=>U.next_due_date=e),type:"date",class:"form-control",disabled:x.value},null,8,Oq),[[S,U.next_due_date]]),l("button",{type:"button",class:"btn btn-icon",title:_(R)("services.form.calculate_due_date"),disabled:x.value,onClick:B},t[25]||(t[25]=[l("i",{class:"fas fa-calculator"},null,-1)]),8,Pq)]),P.next_due_date?(g(),o("span",Nq,c(P.next_due_date),1)):v("",!0)])]),l("div",Mq,[l("div",Dq,[l("label",Lq,c(_(R)("services.form.recurring_amount")),1),l("div",Uq,[t[27]||(t[27]=l("i",{class:"fas fa-euro-sign"},null,-1)),w(l("input",{id:"recurring_amount","onUpdate:modelValue":t[10]||(t[10]=e=>U.recurring_amount=e),type:"number",step:"0.01",min:"0",class:"form-control",placeholder:_(R)("services.form.amount_placeholder"),disabled:x.value},null,8,qq),[[S,U.recurring_amount,void 0,{number:!0}]])]),P.recurring_amount?(g(),o("span",Vq,c(P.recurring_amount),1)):v("",!0)]),l("div",$q,[l("label",jq,c(_(R)("services.form.setup_fee")),1),l("div",Fq,[t[28]||(t[28]=l("i",{class:"fas fa-euro-sign"},null,-1)),w(l("input",{id:"setup_fee","onUpdate:modelValue":t[11]||(t[11]=e=>U.setup_fee=e),type:"number",step:"0.01",min:"0",class:"form-control",placeholder:_(R)("services.form.fee_placeholder"),disabled:x.value},null,8,Gq),[[S,U.setup_fee,void 0,{number:!0}]])]),P.setup_fee?(g(),o("span",Bq,c(P.setup_fee),1)):v("",!0)])])]),l("div",Hq,[l("h3",Wq,c(_(R)("services.form.section.notes")),1),l("div",zq,[l("label",Kq,c(_(R)("services.form.notes")),1),w(l("textarea",{id:"notes","onUpdate:modelValue":t[12]||(t[12]=e=>U.notes=e),class:"form-control textarea",placeholder:_(R)("services.form.notes_placeholder"),disabled:x.value,rows:"4"},null,8,Jq),[[S,U.notes]]),P.notes?(g(),o("span",Yq,c(P.notes),1)):v("",!0)])]),Object.keys(U.configuration||{}).length>0||L.value?(g(),o("div",Xq,[l("h3",Qq,c(_(R)("services.form.section.configurations")),1),l("div",Zq,[(g(!0),o(h,null,f(U.configuration,(e,s)=>(g(),o("div",{key:s,class:"config-entry"},[l("div",eV,[l("div",tV,[l("label",null,c(_(R)("services.form.config_name")),1),l("div",sV,[t[29]||(t[29]=l("i",{class:"fas fa-key"},null,-1)),w(l("input",{"onUpdate:modelValue":e=>N[s]=e,type:"text",class:"form-control",disabled:x.value,onInput:e=>(e=>{const t=N[e];t&&t!==e&&(U.configuration[t]=U.configuration[e],delete U.configuration[e],delete N[e],N[t]=t)})(s)},null,40,aV),[[S,N[s]]])])]),l("div",iV,[l("label",null,c(_(R)("services.form.config_value")),1),l("div",nV,[t[30]||(t[30]=l("i",{class:"fas fa-cog"},null,-1)),w(l("input",{"onUpdate:modelValue":e=>U.configuration[s]=e,type:"text",class:"form-control",disabled:x.value},null,8,rV),[[S,U.configuration[s]]])])]),l("div",oV,[l("label",lV,c(_(R)("services.form.action")),1),l("button",{type:"button",class:"btn btn-danger",disabled:x.value,onClick:e=>(e=>{delete U.configuration[e],delete N[e]})(s)},t[31]||(t[31]=[l("i",{class:"fas fa-trash"},null,-1)]),8,cV)])])]))),128))]),l("button",{type:"button",class:"btn btn-outline-secondary mt-3",disabled:x.value,onClick:G},[t[32]||(t[32]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(_(R)("services.form.add_config")),1)],8,uV)])):v("",!0),l("div",dV,[l("button",{type:"button",class:"btn btn-secondary",disabled:x.value,onClick:j},c(_(R)("common.cancel")),9,pV),l("button",{type:"submit",class:"btn btn-primary",disabled:x.value},[x.value?(g(),o("i",vV)):v("",!0),d(" "+c(L.value?_(R)("common.update"):_(R)("common.create")),1)],8,mV)])],32)])]))}}),[["__scopeId","data-v-095616a9"]]),fV={id:"serviceDetail",class:"view-container"},gV={class:"header-box"},yV={class:"page-title"},bV={class:"page-description"},_V={class:"action-buttons"},kV={key:0,class:"loading-container"},wV={key:1,class:"error-container"},SV={key:2,class:"service-detail-container box"},EV={class:"service-header"},CV={class:"service-basic-info"},TV={class:"service-id"},AV={key:0,class:"service-domain"},IV={class:"service-status"},RV={key:0,class:"status-actions"},xV=["onClick"],OV={class:"detail-grid"},PV={class:"detail-card"},NV={class:"card-header"},MV={class:"card-content"},DV={class:"info-item"},LV={class:"info-label"},UV={class:"info-value"},qV={class:"info-item"},VV={class:"info-label"},$V={class:"info-value"},jV={class:"card-actions"},FV={class:"detail-card"},GV={class:"card-header"},BV={class:"card-content"},HV={class:"info-item"},WV={class:"info-label"},zV={class:"info-value"},KV={class:"card-actions"},JV={class:"detail-card"},YV={class:"card-header"},XV={class:"card-content"},QV={key:0},ZV={class:"info-item"},e$={class:"info-label"},t$={class:"info-value"},s$={class:"card-actions"},a$={key:1,class:"empty-info"},i$={class:"detail-card"},n$={class:"card-header"},r$={class:"card-content"},o$={class:"info-item"},l$={class:"info-label"},c$={class:"info-value"},u$={class:"info-item"},d$={class:"info-label"},p$={class:"info-value"},m$={class:"info-item"},v$={class:"info-label"},h$={class:"info-value"},f$={class:"info-item"},g$={class:"info-label"},y$={class:"info-value"},b$={class:"detail-card"},_$={class:"card-header"},k$={class:"card-content"},w$={class:"info-item"},S$={class:"info-label"},E$={class:"info-value"},C$={key:0,class:"info-item"},T$={class:"info-label"},A$={class:"info-value"},I$={key:1,class:"info-item"},R$={class:"info-label"},x$={class:"info-value"},O$={key:2,class:"info-item"},P$={class:"info-label"},N$={class:"info-value"},M$={class:"detail-card"},D$={class:"card-header"},L$={class:"card-content"},U$={key:0},q$={key:0,class:"info-item"},V$={class:"info-label"},$$={class:"info-value"},j$={key:1,class:"info-item"},F$={class:"info-label"},G$={class:"info-value password-field"},B$={key:0},H$={key:1},W$={key:1,class:"empty-info"},z$={key:0,class:"detail-card"},K$={class:"card-header"},J$={class:"card-content"},Y$={class:"info-label"},X$={class:"info-value"},Q$={key:1,class:"detail-card"},Z$={class:"card-header"},ej={class:"card-content"},tj={class:"notes-content"},sj={key:3,class:"modal show",style:{display:"flex","align-items":"center","justify-content":"center"}},aj={class:"modal-content",style:{position:"fixed","z-index":"1052","max-height":"80vh","backdrop-filter":"none"}},ij={class:"modal-header"},nj={class:"modal-body"},rj={class:"form-group"},oj={for:"status-notes"},lj=["placeholder"],cj={class:"modal-footer"},uj=["disabled"],dj={key:0,class:"fas fa-spinner fa-spin"},pj=Vt(r({__name:"ServiceDetailView",setup(t){const n=Ss(),r=He(),u=T(),p=I(),{t:m}=b(),k=e(!1),E=e(""),C=e(!1),A=e(!1),R=e(""),x=e(""),O=e(!1),P=s(()=>{const e=p.params.id;return e?parseInt(e.toString()):null}),N=s(()=>n.currentService),M=s(()=>{if(!N.value)return[];switch(N.value.status){case"pending":case"suspended":return["activate","cancel","terminate"];case"active":return["suspend","cancel","terminate"];case"cancelled":return["activate","terminate"];default:return[]}}),D=e=>{try{return Q(new Date(e),"dd/MM/yyyy",{locale:NE})}catch{return e}},L=e=>{try{return Q(new Date(e),"dd/MM/yyyy HH:mm",{locale:NE})}catch{return e}},U=e=>void 0===e?"-":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e),q=e=>{switch(e){case"activate":return"fas fa-check-circle";case"suspend":return"fas fa-pause-circle";case"cancel":return"fas fa-times-circle";case"terminate":return"fas fa-trash-alt";default:return"fas fa-cog"}},V=e=>{switch(e){case"activate":return"btn-success";case"suspend":return"btn-warning";case"cancel":return"btn-danger-light";case"terminate":return"btn-danger";default:return"btn-secondary"}},$=e=>{switch(e){case"activate":return"btn-success";case"suspend":return"btn-warning";case"cancel":case"terminate":return"btn-danger";default:return"btn-secondary"}},j=async()=>{if(P.value){k.value=!0,E.value="";try{await n.fetchServiceById(P.value)}catch(e){ne.error("Erreur lors de la récupération du service",{error:e}),E.value=m("services.details.error_loading")}finally{k.value=!1}}},F=()=>{u.push({name:"services"})},G=()=>{P.value&&u.push({name:"edit-service",params:{id:P.value.toString()}})},B=()=>{A.value=!1,R.value="",x.value=""},H=async()=>{if(ne.debug(`[ServiceDetailView] confirmStatusChange appelé pour l'action ${R.value}`),P.value){O.value=!0;try{let e="";switch(R.value){case"activate":e="active";break;case"suspend":e="suspended";break;case"cancel":e="cancelled";break;case"terminate":e="terminated";break;default:throw new Error(m("services.status_change.invalid_action"))}ne.debug(`[ServiceDetailView] Appel de servicesStore.changeServiceStatus pour le service ${P.value} avec le nouveau statut ${e}`),await n.changeServiceStatus(P.value,e,x.value),ne.info(`Statut du service ${P.value} changé avec succès en ${e}`),r.showNotification({title:m("services.status_change.success_title"),message:m(`services.status_change.${R.value}_success`),type:"success"}),B()}catch(e){ne.error("Erreur lors du changement de statut",{error:e}),r.showNotification({title:m("common.error"),message:m("services.status_change.error"),type:"error"})}finally{O.value=!1}}};return i(()=>{j(),ne.info("[SERVICE DETAIL] Initialisation des écouteurs temps réel"),n.realtimeInitialized||n.initRealtimeListeners(),a(()=>n.lastRealtimeEvent,e=>{if(!e||!P.value)return;const{action:t,service:s}=e;s&&s.id===P.value&&(ne.info(`[SERVICE DETAIL] Événement temps réel reçu pour le service courant: ${t}`,{service_id:s.id,action:t}),"delete"===t||"deleted"===t?(r.showNotification({title:"Service supprimé",message:"Le service que vous consultez a été supprimé",type:"warning"}),F()):j())},{deep:!0})}),(e,t)=>{return g(),o("div",fV,[l("div",gV,[l("div",null,[l("h1",yV,c(_(m)("services.details.title")),1),l("span",bV,c(_(m)("services.details.description")),1)]),l("div",_V,[l("button",{class:"btn btn-outline",onClick:F},[t[5]||(t[5]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(_(m)("common.back")),1)]),l("button",{class:"btn btn-outline",onClick:G},[t[6]||(t[6]=l("i",{class:"fas fa-edit"},null,-1)),d(" "+c(_(m)("common.edit")),1)])])]),k.value?(g(),o("div",kV,[t[7]||(t[7]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(m)("common.loading")),1)])):E.value?(g(),o("div",wV,[t[8]||(t[8]=l("div",{class:"error-icon"},[l("i",{class:"fas fa-exclamation-triangle"})],-1)),l("h3",null,c(_(m)("common.error_occurred")),1),l("p",null,c(E.value),1),l("button",{class:"btn btn-primary",onClick:j},c(_(m)("common.retry")),1)])):N.value?(g(),o("div",SV,[l("div",EV,[l("div",CV,[l("h2",null,[d(c(N.value.product_name||_(m)("services.details.unknown_product"))+" ",1),l("span",TV,"#"+c(N.value.id),1)]),N.value.domain?(g(),o("p",AV,c(N.value.domain),1)):v("",!0)]),l("div",IV,[l("span",{class:y(["status-badge","status-"+N.value.status])},c(_(m)(`services.status.${N.value.status}`)),3),"terminated"!==N.value.status?(g(),o("div",RV,[(g(!0),o(h,null,f(M.value,e=>(g(),o("button",{key:e,class:y(["btn btn-sm",V(e)]),onClick:t=>(e=>{R.value=e,x.value="",A.value=!0})(e)},[l("i",{class:y(q(e))},null,2),d(" "+c(_(m)(`services.actions.${e}`)),1)],10,xV))),128))])):v("",!0)])]),l("div",OV,[l("div",PV,[l("div",NV,[l("h3",null,[t[9]||(t[9]=l("i",{class:"fas fa-user"},null,-1)),d(" "+c(_(m)("services.details.client")),1)])]),l("div",MV,[l("div",DV,[l("div",LV,c(_(m)("services.details.client_name")),1),l("div",UV,c(N.value.client_name||_(m)("services.details.unknown")),1)]),l("div",qV,[l("div",VV,c(_(m)("services.details.client_email")),1),l("div",$V,c(N.value.client_email||_(m)("services.details.unknown")),1)]),l("div",jV,[l("button",{class:"btn btn-sm btn-outline",onClick:t[0]||(t[0]=e=>{return t=N.value.client_id,void u.push({name:"client-details",params:{id:t.toString()}});var t})},c(_(m)("services.details.view_client")),1)])])]),l("div",FV,[l("div",GV,[l("h3",null,[t[10]||(t[10]=l("i",{class:"fas fa-box"},null,-1)),d(" "+c(_(m)("services.details.product")),1)])]),l("div",BV,[l("div",HV,[l("div",WV,c(_(m)("services.details.product_name")),1),l("div",zV,c(N.value.product_name||_(m)("services.details.unknown")),1)]),l("div",KV,[l("button",{class:"btn btn-sm btn-outline",onClick:t[1]||(t[1]=e=>{return t=N.value.product_id,void u.push({name:"product-details",params:{id:t.toString()}});var t})},c(_(m)("services.details.view_product")),1)])])]),l("div",JV,[l("div",YV,[l("h3",null,[t[11]||(t[11]=l("i",{class:"fas fa-server"},null,-1)),d(" "+c(_(m)("services.details.server")),1)])]),l("div",XV,[N.value.server_id?(g(),o("div",QV,[l("div",ZV,[l("div",e$,c(_(m)("services.details.server_name")),1),l("div",t$,c(N.value.server_name||_(m)("services.details.unknown")),1)]),l("div",s$,[l("button",{class:"btn btn-sm btn-outline",onClick:t[2]||(t[2]=e=>{return t=N.value.server_id,void u.push({name:"server-details",params:{id:t.toString()}});var t})},c(_(m)("services.details.view_server")),1)])])):(g(),o("div",a$,c(_(m)("services.details.no_server")),1))])]),l("div",i$,[l("div",n$,[l("h3",null,[t[12]||(t[12]=l("i",{class:"fas fa-file-invoice-dollar"},null,-1)),d(" "+c(_(m)("services.details.billing")),1)])]),l("div",r$,[l("div",o$,[l("div",l$,c(_(m)("services.details.billing_cycle")),1),l("div",c$,c((s=N.value.billing_cycle,m(s?`services.billing_cycles.${s}`:"services.details.not_set"))),1)]),l("div",u$,[l("div",d$,c(_(m)("services.details.next_due_date")),1),l("div",p$,c(N.value.next_due_date?D(N.value.next_due_date):_(m)("services.details.not_set")),1)]),l("div",m$,[l("div",v$,c(_(m)("services.details.recurring_amount")),1),l("div",h$,c(U(N.value.recurring_amount)),1)]),l("div",f$,[l("div",g$,c(_(m)("services.details.setup_fee")),1),l("div",y$,c(U(N.value.setup_fee)),1)])])]),l("div",b$,[l("div",_$,[l("h3",null,[t[13]||(t[13]=l("i",{class:"fas fa-calendar-alt"},null,-1)),d(" "+c(_(m)("services.details.important_dates")),1)])]),l("div",k$,[l("div",w$,[l("div",S$,c(_(m)("services.details.created_at")),1),l("div",E$,c(N.value.created_at?L(N.value.created_at):_(m)("services.details.unknown")),1)]),"suspended"===N.value.status&&N.value.suspension_date?(g(),o("div",C$,[l("div",T$,c(_(m)("services.details.suspension_date")),1),l("div",A$,c(L(N.value.suspension_date)),1)])):v("",!0),"cancelled"===N.value.status&&N.value.cancellation_date?(g(),o("div",I$,[l("div",R$,c(_(m)("services.details.cancellation_date")),1),l("div",x$,c(L(N.value.cancellation_date)),1)])):v("",!0),"terminated"===N.value.status&&N.value.termination_date?(g(),o("div",O$,[l("div",P$,c(_(m)("services.details.termination_date")),1),l("div",N$,c(L(N.value.termination_date)),1)])):v("",!0)])]),l("div",M$,[l("div",D$,[l("h3",null,[t[14]||(t[14]=l("i",{class:"fas fa-key"},null,-1)),d(" "+c(_(m)("services.details.login_details")),1)])]),l("div",L$,[N.value.username||N.value.password?(g(),o("div",U$,[N.value.username?(g(),o("div",q$,[l("div",V$,c(_(m)("services.details.username")),1),l("div",$$,c(N.value.username),1)])):v("",!0),N.value.password?(g(),o("div",j$,[l("div",F$,c(_(m)("services.details.password")),1),l("div",G$,[C.value?(g(),o("span",B$,c(N.value.password),1)):(g(),o("span",H$,"••••••••")),l("button",{class:"btn-icon",onClick:t[3]||(t[3]=e=>C.value=!C.value)},[l("i",{class:y(C.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])])):v("",!0)])):(g(),o("div",W$,c(_(m)("services.details.no_login_details")),1))])]),N.value.configuration&&Object.keys(N.value.configuration).length>0?(g(),o("div",z$,[l("div",K$,[l("h3",null,[t[15]||(t[15]=l("i",{class:"fas fa-cogs"},null,-1)),d(" "+c(_(m)("services.details.configuration")),1)])]),l("div",J$,[(g(!0),o(h,null,f(N.value.configuration,(e,t)=>(g(),o("div",{key:t,class:"info-item"},[l("div",Y$,c(t),1),l("div",X$,c(e),1)]))),128))])])):v("",!0),N.value.notes?(g(),o("div",Q$,[l("div",Z$,[l("h3",null,[t[16]||(t[16]=l("i",{class:"fas fa-sticky-note"},null,-1)),d(" "+c(_(m)("services.details.notes")),1)])]),l("div",ej,[l("div",tj,c(N.value.notes),1)])])):v("",!0)])])):v("",!0),A.value?(g(),o("div",sj,[l("div",{class:"modal-backdrop",onClick:B}),l("div",aj,[l("div",ij,[l("h3",null,c(_(m)(`services.status_change.${R.value}_title`)),1),l("button",{class:"close-btn",onClick:B},t[17]||(t[17]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",nj,[l("p",null,c(_(m)(`services.status_change.${R.value}_confirmation`)),1),l("div",rj,[l("label",oj,c(_(m)("services.status_change.notes")),1),w(l("textarea",{id:"status-notes","onUpdate:modelValue":t[4]||(t[4]=e=>x.value=e),class:"form-control",placeholder:_(m)("services.status_change.notes_placeholder"),rows:"3"},null,8,lj),[[S,x.value]])])]),l("div",cj,[l("button",{class:"btn btn-secondary",onClick:B},c(_(m)("common.cancel")),1),l("button",{class:y(["btn",$(R.value)]),disabled:O.value,onClick:H},[O.value?(g(),o("i",dj)):(g(),o("i",{key:1,class:y(q(R.value))},null,2)),d(" "+c(_(m)(`services.actions.${R.value}`)),1)],10,uj)])])])):v("",!0)]);var s}}}),[["__scopeId","data-v-7bcc2fd4"]]),mj={id:"clientForm",class:"view-container"},vj={class:"header-box"},hj={class:"page-title"},fj={class:"page-description"},gj={class:"action-buttons"},yj={class:"form-container box"},bj={class:"form-section"},_j={class:"section-title"},kj={class:"form-grid"},wj={class:"form-group"},Sj={for:"firstname",class:"form-label"},Ej=["placeholder"],Cj={key:0,class:"form-error"},Tj={class:"form-group"},Aj={for:"lastname",class:"form-label"},Ij=["placeholder"],Rj={key:0,class:"form-error"},xj={class:"form-group"},Oj={for:"email",class:"form-label"},Pj=["placeholder"],Nj={key:0,class:"form-error"},Mj={class:"form-group"},Dj={for:"phone",class:"form-label"},Lj=["placeholder"],Uj={key:0,class:"form-error"},qj={class:"form-group"},Vj={for:"company",class:"form-label"},$j=["placeholder"],jj={key:0,class:"form-error"},Fj={class:"form-group"},Gj={for:"status",class:"form-label"},Bj={value:"active"},Hj={value:"inactive"},Wj={value:"pending"},zj={key:0,class:"form-error"},Kj={class:"form-section"},Jj={class:"section-title"},Yj={class:"form-grid"},Xj={class:"form-group"},Qj={for:"password",class:"form-label"},Zj={key:0,class:"optional-text"},eF=["placeholder","required"],tF={key:0,class:"form-error"},sF={key:1,class:"form-text text-muted"},aF={class:"form-section"},iF={class:"section-title"},nF={class:"form-grid"},rF={class:"form-group"},oF={for:"address",class:"form-label"},lF=["placeholder"],cF={key:0,class:"form-error"},uF={class:"form-group"},dF={for:"postal_code",class:"form-label"},pF=["placeholder"],mF={key:0,class:"form-error"},vF={class:"form-group"},hF={for:"city",class:"form-label"},fF=["placeholder"],gF={key:0,class:"form-error"},yF={class:"form-group"},bF={for:"country",class:"form-label"},_F=["placeholder"],kF={key:0,class:"form-error"},wF={class:"form-actions"},SF=["disabled"],EF={key:0},CF={key:1},TF=Vt(r({__name:"ClientFormView",setup(t){const a=I(),n=T(),{t:r}=b(),u=ws(),p=e({firstname:"",lastname:"",email:"",password:"",phone:"",company:"",address:"",postal_code:"",city:"",country:"",status:"active"}),m=e({firstname:"",lastname:"",email:"",password:"",phone:"",company:"",address:"",postal_code:"",city:"",country:"",status:""}),h=e(!1),f=s(()=>a.params.id?parseInt(a.params.id):null),y=s(()=>!!f.value),E=async()=>{if((()=>{let e=!0;return m.value={firstname:"",lastname:"",email:"",password:"",phone:"",company:"",address:"",postal_code:"",city:"",country:"",status:""},p.value.firstname||(m.value.firstname=r("clients.validation.firstname_required"),e=!1),p.value.lastname||(m.value.lastname=r("clients.validation.lastname_required"),e=!1),p.value.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p.value.email)||(m.value.email=r("clients.validation.email_invalid"),e=!1):(m.value.email=r("clients.validation.email_required"),e=!1),y.value||p.value.password||(m.value.password=r("clients.validation.password_required"),e=!1),e})()){h.value=!0;try{if(y.value&&null!==f.value)await u.updateClient(f.value,p.value),n.push({name:"client-details",params:{id:f.value.toString()}});else{const e=await u.createClient(p.value);ne.debug("Nouveau client créé",{newClient:e}),e&&e.id?(ne.debug("Redirection vers la page de détails du client",{clientId:e.id}),n.push({name:"client-details",params:{id:e.id.toString()}})):(ne.error("Impossible de rediriger: ID du client non disponible",{newClient:e}),n.push({name:"clients"}))}}catch(e){ne.error("Erreur lors de la soumission du formulaire",{error:e})}finally{h.value=!1}}},C=()=>{n.push({name:"clients"})};return i(async()=>{if(y.value&&null!==f.value)try{0===u.clients.length&&(ne.debug("Chargement de la liste des clients..."),await u.fetchClients()),ne.debug("Récupération du client",{clientId:f.value});const e=f.value,t=await u.getClient(e);if(ne.debug("Client récupéré",{client:t}),t)ne.debug("Préremplissage du formulaire avec les données du client"),p.value={...p.value,firstname:t.firstname||"",lastname:t.lastname||"",email:t.email||"",password:"",phone:t.phone||"",company:t.company||"",address:t.address||"",postal_code:t.postal_code||"",city:t.city||"",country:t.country||"",status:t.status||"active"},ne.debug("Formulaire mis à jour",{form:p.value});else{ne.warn("Aucun client retourné par getClient");const e=u.clients.find(e=>e.id===f.value);e&&(ne.debug("Client trouvé dans le store",{existingClient:e}),p.value={...p.value,firstname:e.firstname||"",lastname:e.lastname||"",email:e.email||"",password:"",phone:e.phone||"",company:e.company||"",address:e.address||"",postal_code:e.postal_code||"",city:e.city||"",country:e.country||"",status:e.status||"active"})}}catch(e){ne.error("Erreur lors de la récupération du client",{error:e})}}),(e,t)=>(g(),o("div",mj,[l("div",vj,[l("div",null,[l("h1",hj,c(y.value?_(r)("clients.edit.title"):_(r)("clients.add.title")),1),l("span",fj,c(y.value?_(r)("clients.edit.description"):_(r)("clients.add.description")),1)]),l("div",gj,[l("button",{class:"btn btn-outline",onClick:C},[t[11]||(t[11]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(_(r)("common.back")),1)])])]),l("div",yj,[l("form",{onSubmit:k(E,["prevent"])},[l("div",bj,[l("h2",_j,c(_(r)("clients.form.personal_info")),1),l("div",kj,[l("div",wj,[l("label",Sj,c(_(r)("clients.form.firstname")),1),w(l("input",{id:"firstname","onUpdate:modelValue":t[0]||(t[0]=e=>p.value.firstname=e),type:"text",class:"form-control",placeholder:_(r)("clients.form.firstname_placeholder"),required:""},null,8,Ej),[[S,p.value.firstname]]),m.value.firstname?(g(),o("div",Cj,c(m.value.firstname),1)):v("",!0)]),l("div",Tj,[l("label",Aj,c(_(r)("clients.form.lastname")),1),w(l("input",{id:"lastname","onUpdate:modelValue":t[1]||(t[1]=e=>p.value.lastname=e),type:"text",class:"form-control",placeholder:_(r)("clients.form.lastname_placeholder"),required:""},null,8,Ij),[[S,p.value.lastname]]),m.value.lastname?(g(),o("div",Rj,c(m.value.lastname),1)):v("",!0)]),l("div",xj,[l("label",Oj,c(_(r)("clients.form.email")),1),w(l("input",{id:"email","onUpdate:modelValue":t[2]||(t[2]=e=>p.value.email=e),type:"email",class:"form-control",placeholder:_(r)("clients.form.email_placeholder"),required:""},null,8,Pj),[[S,p.value.email]]),m.value.email?(g(),o("div",Nj,c(m.value.email),1)):v("",!0)]),l("div",Mj,[l("label",Dj,c(_(r)("clients.form.phone")),1),w(l("input",{id:"phone","onUpdate:modelValue":t[3]||(t[3]=e=>p.value.phone=e),type:"tel",class:"form-control",placeholder:_(r)("clients.form.phone_placeholder")},null,8,Lj),[[S,p.value.phone]]),m.value.phone?(g(),o("div",Uj,c(m.value.phone),1)):v("",!0)]),l("div",qj,[l("label",Vj,c(_(r)("clients.form.company")),1),w(l("input",{id:"company","onUpdate:modelValue":t[4]||(t[4]=e=>p.value.company=e),type:"text",class:"form-control",placeholder:_(r)("clients.form.company_placeholder")},null,8,$j),[[S,p.value.company]]),m.value.company?(g(),o("div",jj,c(m.value.company),1)):v("",!0)]),l("div",Fj,[l("label",Gj,c(_(r)("clients.form.status")),1),w(l("select",{id:"status","onUpdate:modelValue":t[5]||(t[5]=e=>p.value.status=e),class:"form-control"},[l("option",Bj,c(_(r)("clients.status.active")),1),l("option",Hj,c(_(r)("clients.status.inactive")),1),l("option",Wj,c(_(r)("clients.status.pending")),1)],512),[[A,p.value.status]]),m.value.status?(g(),o("div",zj,c(m.value.status),1)):v("",!0)])])]),l("div",Kj,[l("h2",Jj,c(_(r)("clients.form.password")),1),l("div",Yj,[l("div",Xj,[l("label",Qj,[d(c(_(r)("clients.form.password"))+" ",1),y.value?(g(),o("span",Zj,c(_(r)("clients.form.password_optional")),1)):v("",!0)]),w(l("input",{id:"password","onUpdate:modelValue":t[6]||(t[6]=e=>p.value.password=e),type:"password",class:"form-control",placeholder:_(r)("clients.form.password_placeholder"),required:!y.value},null,8,eF),[[S,p.value.password]]),m.value.password?(g(),o("div",tF,c(m.value.password),1)):v("",!0),y.value?(g(),o("small",sF,c(_(r)("clients.form.password_leave_empty")),1)):v("",!0)])])]),l("div",aF,[l("h2",iF,c(_(r)("clients.form.address_title")),1),l("div",nF,[l("div",rF,[l("label",oF,c(_(r)("clients.form.address")),1),w(l("input",{id:"address","onUpdate:modelValue":t[7]||(t[7]=e=>p.value.address=e),type:"text",class:"form-control",placeholder:_(r)("clients.form.address_placeholder")},null,8,lF),[[S,p.value.address]]),m.value.address?(g(),o("div",cF,c(m.value.address),1)):v("",!0)]),l("div",uF,[l("label",dF,c(_(r)("clients.form.postal_code")),1),w(l("input",{id:"postal_code","onUpdate:modelValue":t[8]||(t[8]=e=>p.value.postal_code=e),type:"text",class:"form-control",placeholder:_(r)("clients.form.postal_code_placeholder")},null,8,pF),[[S,p.value.postal_code]]),m.value.postal_code?(g(),o("div",mF,c(m.value.postal_code),1)):v("",!0)]),l("div",vF,[l("label",hF,c(_(r)("clients.form.city")),1),w(l("input",{id:"city","onUpdate:modelValue":t[9]||(t[9]=e=>p.value.city=e),type:"text",class:"form-control",placeholder:_(r)("clients.form.city_placeholder")},null,8,fF),[[S,p.value.city]]),m.value.city?(g(),o("div",gF,c(m.value.city),1)):v("",!0)]),l("div",yF,[l("label",bF,c(_(r)("clients.form.country")),1),w(l("input",{id:"country","onUpdate:modelValue":t[10]||(t[10]=e=>p.value.country=e),type:"text",class:"form-control",placeholder:_(r)("clients.form.country_placeholder")},null,8,_F),[[S,p.value.country]]),m.value.country?(g(),o("div",kF,c(m.value.country),1)):v("",!0)])])]),l("div",wF,[l("button",{type:"button",class:"btn btn-secondary",onClick:C},c(_(r)("common.cancel")),1),l("button",{type:"submit",class:"btn btn-primary",disabled:h.value},[h.value?(g(),o("span",EF,[t[12]||(t[12]=l("span",{class:"spinner-border spinner-border-sm mr-2"},null,-1)),d(" "+c(_(r)("common.saving")),1)])):(g(),o("span",CF,c(y.value?_(r)("common.save"):_(r)("common.create")),1))],8,SF)])],32)])]))}}),[["__scopeId","data-v-13526ab4"]]);const AF=ee(Z()),IF={id:"clientDetail",class:"view-container"},RF={class:"header-box"},xF={class:"page-title"},OF={class:"page-description"},PF={class:"action-buttons"},NF={key:0,class:"loading-container"},MF={key:1,class:"error-container"},DF={key:2,class:"client-detail-container box"},LF={class:"client-header"},UF={class:"client-basic-info"},qF={class:"client-avatar-container"},VF=["src"],$F={class:"client-title"},jF={class:"client-id"},FF={class:"client-status"},GF={class:"client-actions"},BF={class:"tabs-container"},HF={class:"tabs-header"},WF=["onClick"],zF={key:0,class:"tab-content"},KF={class:"detail-section"},JF={class:"section-title"},YF={class:"detail-grid"},XF={class:"detail-item"},QF={class:"detail-label"},ZF={class:"detail-value"},eG={class:"detail-item"},tG={class:"detail-label"},sG={class:"detail-value"},aG={class:"detail-item"},iG={class:"detail-label"},nG={class:"detail-value"},rG={class:"detail-item"},oG={class:"detail-label"},lG={class:"detail-value"},cG={class:"detail-item"},uG={class:"detail-label"},dG={class:"detail-value"},pG={class:"detail-item"},mG={class:"detail-label"},vG={class:"detail-value"},hG={class:"detail-section"},fG={class:"section-title"},gG={class:"detail-grid"},yG={class:"detail-item"},bG={class:"detail-label"},_G={class:"detail-value"},kG={class:"detail-item"},wG={class:"detail-label"},SG={class:"detail-value"},EG={class:"detail-item"},CG={class:"detail-label"},TG={class:"detail-value"},AG={class:"detail-item"},IG={class:"detail-label"},RG={class:"detail-value"},xG={key:1,class:"tab-content"},OG={class:"services-header"},PG={class:"section-title"},NG={key:0,class:"empty-state-small"},MG={key:1,class:"services-list"},DG=["onClick"],LG={class:"service-card-header"},UG={class:"service-card-body"},qG={key:0,class:"service-domain"},VG={class:"service-details"},$G={class:"service-detail-item"},jG={class:"detail-label"},FG={class:"detail-value"},GG={class:"service-detail-item"},BG={class:"detail-label"},HG={class:"detail-value"},WG={key:2,class:"tab-content"},zG={class:"section-title"},KG={class:"empty-state-small"},JG={key:3,class:"modal show",style:{display:"flex","align-items":"center","justify-content":"center"}},YG={class:"modal-content",style:{position:"fixed","z-index":"1052","max-height":"80vh","backdrop-filter":"none"}},XG={class:"modal-header"},QG={class:"modal-body"},ZG={class:"warning"},eB={class:"modal-footer"},tB=["disabled"],sB=["disabled"],aB={key:0},iB={key:1},nB=r({__name:"ClientDetailView",setup(t){const n=I(),r=T(),{t:u}=b(),p=ws(),m=Ss(),k=He(),w=s(()=>parseInt(n.params.id)),S=s(()=>p.currentClient),E=e([]),C=e(!0),A=e(""),R=e("info"),x=e(!1),O=e(!1),P=[{id:"info",name:u("clients.details.tab_info"),icon:"fas fa-user"},{id:"services",name:u("clients.details.tab_services"),icon:"fas fa-server"},{id:"invoices",name:u("clients.details.tab_invoices"),icon:"fas fa-file-invoice"}],N=async()=>{C.value=!0,A.value="";try{0===p.clients.length&&(ne.debug("Chargement de la liste des clients..."),await p.fetchClients());const t=w.value,s=await p.getClient(t);if(p.$patch({currentClient:s}),ne.debug("[ClientDetailView] Client récupéré",{client:p.currentClient}),!p.currentClient){ne.debug("[ClientDetailView] Recherche du client dans le store...");const e=p.clients.find(e=>e.id===t);e?(ne.debug("[ClientDetailView] Client trouvé dans le store",{client:e}),p.$patch({currentClient:e})):(ne.error("[ClientDetailView] Client non trouvé dans le store"),A.value=u("clients.details.not_found"))}try{ne.debug("[ClientDetailView] Récupération des services du client...");const e=await m.fetchClientServices(t);ne.debug("[ClientDetailView] Services du client récupérés",{response:e}),e&&Array.isArray(e.data)?E.value=e.data:e&&e.data?E.value=Array.isArray(e.data)?e.data:[e.data]:(ne.debug("Aucun service trouvé pour ce client"),E.value=[])}catch(e){ne.error("Erreur lors de la récupération des services du client",{error:e}),E.value=[]}}catch(t){ne.error("Erreur lors de la récupération du client",{error:t}),A.value=u("clients.details.error_loading")}finally{C.value=!1}},M=e=>{try{return Q(new Date(e),"dd/MM/yyyy",{locale:NE})}catch{return e}},D=()=>{r.push({name:"clients"})},L=()=>{r.push({name:"edit-client",params:{id:n.params.id}})},U=()=>{x.value=!0},q=async()=>{if(S.value)try{O.value=!0,await p.deleteClient(S.value.id),r.push({name:"clients"})}catch(e){ne.error("Erreur lors de la suppression du client",{error:e}),A.value=u("clients.details.error_deleting")}finally{O.value=!1,x.value=!1}},V=()=>{r.push({name:"create-service",query:{client_id:S.value?S.value.id.toString():""}})};return i(()=>{N(),p.realtimeInitialized||p.initRealtimeListeners(),a(()=>p.lastRealtimeEvent,e=>{var t,s;if(ne.info("[ClientDetailView] DIAGNOSTIC - Watcher déclenché sur lastRealtimeEvent",{hasNewEvent:!!e,currentClientId:w.value,newEventClientId:null==(t=null==e?void 0:e.client)?void 0:t.id,actionType:null==e?void 0:e.action,time:(new Date).toISOString()}),e&&w.value&&e.client&&e.client.id===w.value){ne.info("[ClientDetailView] Événement temps réel détecté pour le client courant",{action:e.action,clientId:w.value,currentStoreClientId:(null==(s=p.currentClient)?void 0:s.id)||"aucun"});const t=e.action;"delete"===t?(k.showNotification({title:u("clients.deleted"),message:u("clients.client_deleted_message"),type:"warning"}),r.push({name:"clients"})):(ne.info("[ClientDetailView] Rechargement explicite des données client après événement temps réel",{action:t,clientId:w.value}),N())}},{deep:!0})}),(e,t)=>(g(),o("div",IF,[l("div",RF,[l("div",null,[l("h1",xF,c(_(u)("clients.details.title")),1),l("span",OF,c(_(u)("clients.details.description")),1)]),l("div",PF,[l("button",{class:"btn btn-outline",onClick:D},[t[3]||(t[3]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(_(u)("common.back")),1)]),l("button",{class:"btn btn-outline",onClick:L},[t[4]||(t[4]=l("i",{class:"fas fa-edit"},null,-1)),d(" "+c(_(u)("common.edit")),1)])])]),C.value?(g(),o("div",NF,[t[5]||(t[5]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(u)("common.loading")),1)])):A.value?(g(),o("div",MF,[t[6]||(t[6]=l("div",{class:"error-icon"},[l("i",{class:"fas fa-exclamation-triangle"})],-1)),l("h3",null,c(_(u)("common.error_occurred")),1),l("p",null,c(A.value),1),l("button",{class:"btn btn-primary",onClick:N},c(_(u)("common.retry")),1)])):S.value?(g(),o("div",DF,[l("div",LF,[l("div",UF,[l("div",qF,[l("img",{src:`https://www.gravatar.com/avatar/${_(AF)(S.value.email.toLowerCase())}?s=80&d=mp`,alt:"Avatar",class:"client-avatar"},null,8,VF)]),l("div",$F,[l("h2",null,c(S.value.firstname)+" "+c(S.value.lastname),1),l("span",jF,"#"+c(S.value.id),1),l("div",FF,[l("span",{class:y(`status-badge status-${S.value.status}`)},c(_(u)(`clients.status.${S.value.status}`)),3)])])]),l("div",GF,[l("button",{class:"btn btn-outline-danger",onClick:U},[t[7]||(t[7]=l("i",{class:"fas fa-trash"},null,-1)),d(" "+c(_(u)("clients.actions.delete")),1)])])]),l("div",BF,[l("div",HF,[(g(),o(h,null,f(P,e=>l("button",{key:e.id,class:y(["tab-button",{active:R.value===e.id}]),onClick:t=>R.value=e.id},[l("i",{class:y(e.icon)},null,2),d(" "+c(e.name),1)],10,WF)),64))]),"info"===R.value?(g(),o("div",zF,[l("div",KF,[l("h3",JF,c(_(u)("clients.details.personal_info")),1),l("div",YF,[l("div",XF,[l("span",QF,c(_(u)("clients.form.firstname")),1),l("span",ZF,c(S.value.firstname),1)]),l("div",eG,[l("span",tG,c(_(u)("clients.form.lastname")),1),l("span",sG,c(S.value.lastname),1)]),l("div",aG,[l("span",iG,c(_(u)("clients.form.email")),1),l("span",nG,c(S.value.email),1)]),l("div",rG,[l("span",oG,c(_(u)("clients.form.phone")),1),l("span",lG,c(S.value.phone||"-"),1)]),l("div",cG,[l("span",uG,c(_(u)("clients.form.company")),1),l("span",dG,c(S.value.company||"-"),1)]),l("div",pG,[l("span",mG,c(_(u)("clients.form.status")),1),l("span",vG,[l("span",{class:y(`status-badge status-${S.value.status}`)},c(_(u)(`clients.status.${S.value.status}`)),3)])])])]),l("div",hG,[l("h3",fG,c(_(u)("clients.details.address")),1),l("div",gG,[l("div",yG,[l("span",bG,c(_(u)("clients.form.address")),1),l("span",_G,c(S.value.address||"-"),1)]),l("div",kG,[l("span",wG,c(_(u)("clients.form.city")),1),l("span",SG,c(S.value.city||"-"),1)]),l("div",EG,[l("span",CG,c(_(u)("clients.form.postal_code")),1),l("span",TG,c(S.value.postal_code||"-"),1)]),l("div",AG,[l("span",IG,c(_(u)("clients.form.country")),1),l("span",RG,c(S.value.country||"-"),1)])])])])):"services"===R.value?(g(),o("div",xG,[l("div",OG,[l("h3",PG,c(_(u)("clients.details.services")),1),l("button",{class:"btn btn-sm btn-gradient",onClick:V},[t[8]||(t[8]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(_(u)("services.add_new")),1)])]),0===E.value.length?(g(),o("div",NG,[t[9]||(t[9]=l("i",{class:"fas fa-server"},null,-1)),l("p",null,c(_(u)("clients.details.no_services")),1)])):(g(),o("div",MG,[(g(!0),o(h,null,f(E.value,e=>{return g(),o("div",{key:e.id,class:"service-card",onClick:t=>{return s=e.id,void r.push({name:"service-details",params:{id:s.toString()}});var s}},[l("div",LG,[l("h4",null,c(e.product_name||_(u)("services.details.unknown_product")),1),l("span",{class:y(`status-badge status-${e.status}`)},c(_(u)(`services.status.${e.status}`)),3)]),l("div",UG,[e.domain?(g(),o("div",qG,[t[10]||(t[10]=l("i",{class:"fas fa-globe"},null,-1)),l("span",null,c(e.domain),1)])):v("",!0),l("div",VG,[l("div",$G,[l("span",jG,c(_(u)("services.table.next_due_date")),1),l("span",FG,c(e.next_due_date?M(e.next_due_date):"-"),1)]),l("div",GG,[l("span",BG,c(_(u)("services.table.recurring_amount")),1),l("span",HG,c((s=e.recurring_amount,void 0===s?"-":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(s))),1)])])])],8,DG);var s}),128))]))])):"invoices"===R.value?(g(),o("div",WG,[l("h3",zG,c(_(u)("clients.details.invoices")),1),l("div",KG,[t[11]||(t[11]=l("i",{class:"fas fa-file-invoice"},null,-1)),l("p",null,c(_(u)("clients.details.no_invoices")),1)])])):v("",!0)])])):v("",!0),x.value?(g(),o("div",JG,[l("div",{class:"modal-backdrop",onClick:t[0]||(t[0]=e=>x.value=!1)}),l("div",YG,[l("div",XG,[l("h3",null,c(_(u)("clients.delete_modal.title")),1),l("button",{class:"close-btn",onClick:t[1]||(t[1]=e=>x.value=!1)},t[12]||(t[12]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",QG,[l("p",null,c(_(u)("clients.delete_modal.confirmation")),1),l("p",ZG,c(_(u)("clients.delete_modal.warning")),1)]),l("div",eB,[l("button",{class:"btn btn-secondary",disabled:O.value,onClick:t[2]||(t[2]=e=>x.value=!1)},c(_(u)("common.cancel")),9,tB),l("button",{class:"btn btn-danger",disabled:O.value,onClick:q},[O.value?(g(),o("span",aB,[t[13]||(t[13]=l("span",{class:"spinner-border spinner-border-sm mr-2"},null,-1)),d(" "+c(_(u)("common.deleting"))+"... ",1)])):(g(),o("span",iB,c(_(u)("common.delete")),1))],8,sB)])])])):v("",!0)]))}}),rB=Vt(nB,[["__scopeId","data-v-ecf229c9"]]),oB={class:"payment-form-view view-container"},lB={class:"header-box"},cB={class:"header-content"},uB={class:"breadcrumb"},dB={class:"breadcrumb-current"},pB={class:"page-title"},mB={class:"page-description"},vB={class:"form-container box"},hB={class:"form-section"},fB={class:"section-title"},gB={class:"form-grid"},yB={class:"form-group"},bB={class:"form-label"},_B={value:""},kB=["value"],wB={class:"form-group"},SB={class:"form-label"},EB={class:"form-group"},CB={class:"form-label"},TB={value:""},AB=["value"],IB={class:"form-group"},RB={class:"form-label"},xB={value:"completed"},OB={value:"pending"},PB={value:"failed"},NB={value:"refunded"},MB={class:"form-section"},DB={class:"section-title"},LB={class:"form-group"},UB={class:"form-label"},qB=["placeholder"],VB={class:"form-group"},$B={class:"form-label"},jB=["placeholder"],FB={class:"form-actions"},GB=["disabled"],BB={key:0},HB={key:1},WB=r({__name:"PaymentFormView",setup(t){const{t:a}=b(),n=T(),r=I(),v=gh(),y=Rv(),E=He(),C=e(!1),R=e([]),x=e([]),O=e({invoice_id:"",amount:"",method:"",status:"completed",transaction_id:"",notes:""}),P=s(()=>!!r.params.id),N=s(()=>r.params.id?parseInt(r.params.id):null),M=async()=>{try{await y.fetchInvoices(),R.value=y.invoices}catch(e){ne.error("Erreur lors du chargement des factures",{error:e})}},D=async()=>{C.value=!0;try{if(P.value){const e={invoice_id:Number(O.value.invoice_id),amount:Number(O.value.amount),payment_method:O.value.method,status:O.value.status,transaction_id:O.value.transaction_id,notes:O.value.notes};await v.updatePayment(N.value,e),E.addNotification({type:"success",title:a("common.success"),message:a("payments.success.updated")})}else{const e={invoice_id:Number(O.value.invoice_id),amount:Number(O.value.amount),payment_method:O.value.method,status:O.value.status,transaction_id:O.value.transaction_id,notes:O.value.notes};await v.createPayment(e),E.addNotification({type:"success",title:a("common.success"),message:a("payments.success.created")})}n.push("/payments")}catch(e){ne.error("Erreur lors de la sauvegarde du paiement",{error:e}),E.addNotification({type:"error",title:a("common.error"),message:P.value?a("payments.errors.update_failed"):a("payments.errors.create_failed")})}finally{C.value=!1}},L=()=>{n.push("/payments")},U=async()=>{try{ne.debug("Chargement des modules de paiement");const e=(await _e.routes.admin.system.module.list("gateways")).data;if(e.success&&e.data&&e.data.gateways){const t=[];Object.entries(e.data.gateways).forEach(([e,s])=>{const a=s;a.active&&t.push({key:e,name:a.name})}),x.value=t,ne.info("Modules de paiement chargés",{count:t.length})}else ne.warn("Format de réponse inattendu pour les modules de paiement",{data:e}),x.value=[]}catch(e){ne.error("Erreur lors du chargement des modules de paiement",{error:e}),x.value=[]}};return i(async()=>{await Promise.all([M(),U()]),P.value&&await(async()=>{if(N.value)try{const e=await v.fetchPayment(N.value);e&&(O.value={invoice_id:e.invoice_id,amount:e.amount.toString(),method:e.payment_method,status:e.status,transaction_id:e.transaction_id||"",notes:e.notes||""})}catch(e){ne.error("Erreur lors du chargement du paiement",{error:e}),E.addNotification({type:"error",title:a("common.error"),message:a("payments.errors.load_failed")}),n.push("/payments")}})()}),(e,t)=>{const s=m("router-link");return g(),o("div",oB,[l("div",lB,[l("div",cB,[l("div",uB,[u(s,{to:"/payments",class:"breadcrumb-link"},{default:p(()=>[t[6]||(t[6]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(_(a)("payments.title")),1)]),_:1,__:[6]}),t[7]||(t[7]=l("span",{class:"breadcrumb-separator"},"/",-1)),l("span",dB,c(P.value?_(a)("payments.edit_title"):_(a)("payments.create_title")),1)]),l("h1",pB,c(P.value?_(a)("payments.edit_title"):_(a)("payments.create_title")),1),l("span",mB,c(P.value?_(a)("payments.edit_description"):_(a)("payments.create_description")),1)])]),l("div",vB,[l("form",{onSubmit:k(D,["prevent"])},[l("div",hB,[l("h2",fB,c(_(a)("payments.form.basic_info")),1),l("div",gB,[l("div",yB,[l("label",bB,c(_(a)("payments.form.invoice")),1),w(l("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>O.value.invoice_id=e),class:"form-control",required:""},[l("option",_B,c(_(a)("payments.form.select_invoice")),1),(g(!0),o(h,null,f(R.value,e=>{return g(),o("option",{key:e.id,value:e.id}," #"+c(e.id)+" - "+c(e.client_name)+" ("+c((t=e.amount,new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(t)))+") ",9,kB);var t}),128))],512),[[A,O.value.invoice_id]])]),l("div",wB,[l("label",SB,c(_(a)("payments.form.amount")),1),w(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>O.value.amount=e),type:"number",class:"form-control",step:"0.01",min:"0",required:""},null,512),[[S,O.value.amount]])]),l("div",EB,[l("label",CB,c(_(a)("payments.form.method")),1),w(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>O.value.method=e),class:"form-control",required:""},[l("option",TB,c(_(a)("payments.form.select_method")),1),(g(!0),o(h,null,f(x.value,e=>(g(),o("option",{key:e.key,value:e.key},c(e.name),9,AB))),128))],512),[[A,O.value.method]])]),l("div",IB,[l("label",RB,c(_(a)("payments.form.status")),1),w(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>O.value.status=e),class:"form-control",required:""},[l("option",xB,c(_(a)("payments.status.completed")),1),l("option",OB,c(_(a)("payments.status.pending")),1),l("option",PB,c(_(a)("payments.status.failed")),1),l("option",NB,c(_(a)("payments.status.refunded")),1)],512),[[A,O.value.status]])])])]),l("div",MB,[l("h2",DB,c(_(a)("payments.form.additional_info")),1),l("div",LB,[l("label",UB,c(_(a)("payments.form.transaction_id")),1),w(l("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>O.value.transaction_id=e),type:"text",class:"form-control",placeholder:_(a)("payments.form.transaction_id_placeholder")},null,8,qB),[[S,O.value.transaction_id]])]),l("div",VB,[l("label",$B,c(_(a)("payments.form.notes")),1),w(l("textarea",{"onUpdate:modelValue":t[5]||(t[5]=e=>O.value.notes=e),class:"form-control",rows:"4",placeholder:_(a)("payments.form.notes_placeholder")},null,8,jB),[[S,O.value.notes]])])]),l("div",FB,[l("button",{type:"button",class:"btn btn-secondary",onClick:L},c(_(a)("common.cancel")),1),l("button",{type:"submit",class:"btn btn-primary",disabled:C.value},[C.value?(g(),o("span",BB,[t[8]||(t[8]=l("span",{class:"spinner-border spinner-border-sm mr-2"},null,-1)),d(" "+c(_(a)("common.saving")),1)])):(g(),o("span",HB,c(P.value?_(a)("common.save"):_(a)("common.create")),1))],8,GB)])],32)])])}}}),zB=Vt(WB,[["__scopeId","data-v-476b9f3b"]]),KB={class:"payment-details-view view-container"},JB={class:"header-box"},YB={class:"header-content"},XB={class:"breadcrumb"},QB={class:"breadcrumb-current"},ZB={class:"page-title"},eH={class:"page-description"},tH={class:"header-actions"},sH={key:0,class:"loading-state box"},aH={key:1,class:"empty-state"},iH={class:"empty-state-text"},nH={class:"empty-state-description"},rH={key:2,class:"details-container box"},oH={class:"details-card"},lH={class:"card-title"},cH={class:"info-grid"},uH={class:"info-item"},dH={class:"info-label"},pH={class:"info-value"},mH={class:"info-item"},vH={class:"info-label"},hH={class:"info-item"},fH={class:"info-label"},gH={class:"info-value amount"},yH={class:"info-item"},bH={class:"info-label"},_H={class:"info-value"},kH={class:"info-item"},wH={class:"info-label"},SH={class:"info-value"},EH={key:0,class:"info-item"},CH={class:"info-label"},TH={class:"info-value"},AH={class:"details-card"},IH={class:"card-title"},RH={class:"info-grid"},xH={class:"info-item"},OH={class:"info-label"},PH={class:"info-item"},NH={class:"info-label"},MH={key:0,class:"info-item"},DH={class:"info-label"},LH={class:"info-value"},UH={key:0,class:"details-card full-width"},qH={class:"card-title"},VH={class:"notes-content"},$H={class:"details-card full-width"},jH={class:"card-title"},FH={class:"history-timeline"},GH={class:"timeline-item"},BH={class:"timeline-content"},HH={key:0,class:"timeline-item"},WH={class:"timeline-content"},zH={key:1,class:"timeline-item"},KH={class:"timeline-content"},JH=r({__name:"PaymentDetailsView",setup(t){const{t:n}=b(),r=I(),h=T(),f=gh(),k=He(),w=e(!1),S=s(()=>r.params.id),E=s(()=>f.currentPayment),C=async()=>{w.value=!0;try{await f.fetchPayment(parseInt(S.value))}catch(e){ne.error("Erreur lors du chargement du paiement",{error:e}),k.addNotification({type:"error",title:n("common.error"),message:n("payments.errors.load_failed")}),h.push("/payments")}finally{w.value=!1}},A=async()=>{if(confirm(n("payments.confirm_refund")))try{await f.processRefund(parseInt(S.value),"Remboursement administrateur"),await C(),k.addNotification({type:"success",title:n("common.success"),message:n("payments.success.refunded")})}catch(e){ne.error("Erreur lors du remboursement",{error:e}),k.addNotification({type:"error",title:n("common.error"),message:n("payments.errors.refund_failed")})}},R=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e),x=e=>e?new Date(e).toLocaleString("fr-FR"):"",O=e=>{if(!e)return"";return{stripe:"Stripe",paypal:"PayPal",bank_transfer:n("payments.methods.bank_transfer"),cash:n("payments.methods.cash")}[e]||e};return i(async()=>{ne.info("[PAYMENT-DETAIL] Component monté, initialisation..."),await C(),ne.info("[PAYMENT-DETAIL] Paiement chargé, initialisation du temps réel"),ne.info("[PAYMENT-DETAIL] Initialisation des écouteurs temps réel"),f.initRealtimeListeners(),ne.info("[PAYMENT-DETAIL] Écouteurs temps réel initialisés"),a(()=>f.lastRealtimeEvent,e=>{var t,s;if(ne.info("[PAYMENT-DETAIL] Watcher déclenché pour lastRealtimeEvent",{event_exists:!!e,event_type:null==e?void 0:e.action,event_payment_id:null==(t=null==e?void 0:e.payment)?void 0:t.id,current_payment_id:null==(s=E.value)?void 0:s.id}),!e||!e.payment||!e.action)return void ne.info("[PAYMENT-DETAIL] Événement incomplet, ignoré");if(!E.value||!S.value)return void ne.info("[PAYMENT-DETAIL] Paiement courant non défini, ignoré");const a=parseInt(S.value);parseInt(e.payment.id)===a&&(ne.info(`[PAYMENT-DETAIL] Événement ${e.action} reçu pour le paiement #${a}`),"delete"===e.action?(k.addNotification({type:"warning",title:n("common.info"),message:n("payments.realtime.deleted",{fallback:"Ce paiement a été supprimé"})}),h.push("/payments")):["update","refund"].includes(e.action)&&(ne.info(`[PAYMENT-DETAIL] Mise à jour directe du paiement #${a} depuis l'événement ${e.action}`),e.payment?(f.currentPayment=e.payment,ne.info(`[PAYMENT-DETAIL] Paiement #${a} mis à jour directement depuis les données temps réel`),k.addNotification({type:"info",title:n("common.info"),message:n("payments.realtime.updated",{fallback:"Ce paiement a été mis à jour"})})):(ne.warn("[PAYMENT-DETAIL] Données incomplètes dans l'événement, rechargement complet nécessaire"),C())))},{deep:!0,immediate:!0}),ne.info("[PAYMENT-DETAIL] Temps réel initialisé avec succès")}),(e,t)=>{const s=m("router-link");return g(),o("div",KB,[l("div",JB,[l("div",YB,[l("div",XB,[u(s,{to:"/payments",class:"breadcrumb-link"},{default:p(()=>[t[0]||(t[0]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(_(n)("payments.title")),1)]),_:1,__:[0]}),t[1]||(t[1]=l("span",{class:"breadcrumb-separator"},"/",-1)),l("span",QB,c(_(n)("payments.details_title",{id:S.value})),1)]),l("h1",ZB,c(_(n)("payments.details_title",{id:S.value})),1),l("span",eH,c(_(n)("payments.details_description")),1)]),l("div",tH,[E.value&&"completed"===E.value.status?(g(),o("button",{key:0,class:"btn btn-warning",onClick:A},[t[2]||(t[2]=l("i",{class:"fas fa-undo"},null,-1)),d(" "+c(_(n)("payments.actions.refund")),1)])):v("",!0),u(s,{to:`/payments/${S.value}/edit`,class:"btn btn-primary"},{default:p(()=>[t[3]||(t[3]=l("i",{class:"fas fa-edit"},null,-1)),d(" "+c(_(n)("payments.actions.edit")),1)]),_:1,__:[3]},8,["to"])])]),w.value?(g(),o("div",sH,[t[4]||(t[4]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(n)("common.loading")),1)])):E.value?(g(),o("div",rH,[l("div",oH,[l("h3",lH,c(_(n)("payments.details.main_info")),1),l("div",cH,[l("div",uH,[l("label",dH,c(_(n)("payments.details.id")),1),l("span",pH,"#"+c(E.value.id),1)]),l("div",mH,[l("label",vH,c(_(n)("payments.details.status")),1),l("span",{class:y(`status-badge status-${E.value.status}`)},c((i=E.value.status,{completed:n("payments.status.completed"),pending:n("payments.status.pending"),failed:n("payments.status.failed"),refunded:n("payments.status.refunded")}[i]||i)),3)]),l("div",hH,[l("label",fH,c(_(n)("payments.details.amount")),1),l("span",gH,c(R(E.value.amount)),1)]),l("div",yH,[l("label",bH,c(_(n)("payments.details.method")),1),l("span",_H,c(O(E.value.method||E.value.payment_method)),1)]),l("div",kH,[l("label",wH,c(_(n)("payments.details.date")),1),l("span",SH,c((a=E.value.created_at,a?new Date(a).toLocaleDateString("fr-FR"):"")),1)]),E.value.transaction_id?(g(),o("div",EH,[l("label",CH,c(_(n)("payments.details.transaction_id")),1),l("span",TH,c(E.value.transaction_id),1)])):v("",!0)])]),l("div",AH,[l("h3",IH,c(_(n)("payments.details.client_invoice")),1),l("div",RH,[l("div",xH,[l("label",OH,c(_(n)("payments.details.client")),1),u(s,{to:`/clients/${E.value.client_id}`,class:"info-link"},{default:p(()=>[d(c(E.value.client_name),1)]),_:1},8,["to"])]),l("div",PH,[l("label",NH,c(_(n)("payments.details.invoice")),1),u(s,{to:`/invoices/${E.value.invoice_id}`,class:"info-link"},{default:p(()=>[d(" #"+c(E.value.invoice_id),1)]),_:1},8,["to"])]),E.value.invoice_total?(g(),o("div",MH,[l("label",DH,c(_(n)("payments.details.invoice_total")),1),l("span",LH,c(R(E.value.invoice_total)),1)])):v("",!0)])]),E.value.notes?(g(),o("div",UH,[l("h3",qH,c(_(n)("payments.details.notes")),1),l("div",VH,[l("p",null,c(E.value.notes),1)])])):v("",!0),l("div",$H,[l("h3",jH,c(_(n)("payments.details.history")),1),l("div",FH,[l("div",GH,[t[6]||(t[6]=l("div",{class:"timeline-marker created"},null,-1)),l("div",BH,[l("h4",null,c(_(n)("payments.history.created")),1),l("p",null,c(x(E.value.created_at)),1)])]),E.value.updated_at!==E.value.created_at?(g(),o("div",HH,[t[7]||(t[7]=l("div",{class:"timeline-marker updated"},null,-1)),l("div",WH,[l("h4",null,c(_(n)("payments.history.updated")),1),l("p",null,c(x(E.value.updated_at)),1)])])):v("",!0),"refunded"===E.value.status?(g(),o("div",zH,[t[8]||(t[8]=l("div",{class:"timeline-marker refunded"},null,-1)),l("div",KH,[l("h4",null,c(_(n)("payments.history.refunded")),1),l("p",null,c(x(E.value.refunded_at)),1)])])):v("",!0)])])])):(g(),o("div",aH,[t[5]||(t[5]=l("div",{class:"empty-state-icon"},[l("i",{class:"fas fa-exclamation-triangle"})],-1)),l("div",iH,c(_(n)("payments.not_found.title")),1),l("p",nH,c(_(n)("payments.not_found.description")),1)]))]);var a,i}}}),YH=Vt(JH,[["__scopeId","data-v-9eedabc0"]]),XH={class:"invoice-form-view view-container"},QH={class:"header-box"},ZH={class:"header-content"},eW={class:"breadcrumb"},tW={class:"breadcrumb-current"},sW={class:"page-title"},aW={class:"page-description"},iW={class:"form-container box"},nW={class:"form-section"},rW={class:"section-title"},oW={class:"form-grid"},lW={class:"form-group"},cW={class:"form-label"},uW={value:""},dW=["value"],pW={class:"form-group"},mW={class:"form-label"},vW={value:""},hW=["value"],fW={class:"form-section"},gW={class:"section-title"},yW={class:"form-grid"},bW={class:"form-group"},_W={class:"form-label"},kW={class:"form-group"},wW={class:"form-label"},SW={class:"form-group"},EW={class:"form-label"},CW={value:"unpaid"},TW={value:"paid"},AW={value:"overdue"},IW={value:"cancelled"},RW={class:"form-group"},xW={class:"form-label"},OW={class:"form-section full-width"},PW={class:"section-title"},NW={class:"invoice-items"},MW={class:"item-row"},DW={class:"item-field"},LW={class:"form-label"},UW=["onUpdate:modelValue","placeholder"],qW={class:"item-field quantity"},VW={class:"form-label"},$W=["onUpdate:modelValue","onInput"],jW={class:"item-field price"},FW={class:"form-label"},GW=["onUpdate:modelValue","onInput"],BW={class:"item-field total"},HW={class:"form-label"},WW={class:"total-display"},zW={class:"item-actions"},KW=["disabled","onClick"],JW={class:"form-section"},YW={class:"section-title"},XW={class:"form-group"},QW=["placeholder"],ZW={class:"invoice-summary"},ez={class:"summary-row"},tz={class:"summary-label"},sz={class:"summary-value"},az={class:"summary-row"},iz={class:"summary-label"},nz={class:"summary-value"},rz={class:"summary-row total-row"},oz={class:"summary-label"},lz={class:"summary-value"},cz={class:"form-actions"},uz=["disabled"],dz={key:0},pz={key:1},mz=r({__name:"InvoiceFormView",setup(t){const{t:n}=b(),r=T(),v=I(),y=Rv(),E=ws(),C=He(),R=e(!1),x=e(null);v.params.id&&(x.value=v.params.id,R.value=!0);const O=e(!1),P=e([]),N=e([]),M=e(20),D=e({client_id:"",service_id:"",product_id:0,date:(new Date).toISOString().split("T")[0],due_date:(()=>{const e=new Date;return e.setDate(e.getDate()+30),e.toISOString().split("T")[0]})(),status:"unpaid",amount:0,notes:"",items:[{description:"",quantity:1,unit_price:0,total:0}]});!function(){if(D.value||(ne.warn("[INVOICE-FORM] form.value est undefined"),D.value={client_id:"",service_id:"",product_id:0,date:"",due_date:"",status:"pending",amount:0,notes:"",items:[]}),D.value.items||(ne.warn("[INVOICE-FORM] form.value.items est undefined"),D.value.items=[]),!Array.isArray(D.value.items)){ne.warn("[INVOICE-FORM] form.value.items n'est pas un tableau",{type:typeof D.value.items});try{D.value.items=Array.isArray(D.value.items)?D.value.items:[]}catch(e){ne.error("[INVOICE-FORM] Erreur lors de la conversion en tableau",{error:e}),D.value.items=[]}}}();const L=s(()=>{if(!D.value||!D.value.items||!Array.isArray(D.value.items))return 0;try{return D.value.items.reduce((e,t)=>t?e+(Number(t.total)||0):e,0)}catch(e){return ne.error("[INVOICE-FORM] Erreur lors du calcul du sous-total",{error:e}),0}}),U=s(()=>L.value*(M.value/100)),q=s(()=>L.value+U.value);a(q,e=>{D.value.amount=e,ne.info("Montant total mis à jour:",{amount:e})});const V=()=>{D.value.client_id?(async e=>{try{ne.info(`Chargement des services pour le client ${e}`);const t=await _e.routes.admin.service.getClientServices(e.toString());ne.info(`Statut de la réponse API: ${t.status}`),ne.info("Données reçues de l'API:",{data:t.data});const s=t.data;let a=[];(null==s?void 0:s.services)?a=s.services:Array.isArray(s)?a=s:(null==s?void 0:s.data)&&(a=s.data),N.value=a.map(t=>{ne.debug("Structure du service brut:",t);const s=t.product_name||(t.product?t.product.name:null)||t.title||t.name||`Service ${t.id||"inconnu"}`;return{id:t.id||0,name:s,description:t.description||"",price:parseFloat(t.price||t.amount||t.cost||0),client_id:Number(e),product_id:t.product_id||t.id||0}}),ne.info("Données brutes des services:",{data:a}),ne.info("Services normalisés:",{services:N.value}),ne.info(`${N.value.length} services chargés pour le client ${e}`)}catch(t){ne.error("Erreur lors du chargement des services du client",{error:t}),N.value=[],C.addNotification({type:"error",title:n("common.error"),message:"Impossible de charger les services. Veuillez vérifier votre connexion ou contacter l'administrateur."})}})(D.value.client_id):N.value=[],D.value.service_id="",D.value.product_id=0},$=()=>{if(ne.info("Service sélectionné:",{serviceId:D.value.service_id}),D.value.service_id){const e=N.value.find(e=>String(e.id)===String(D.value.service_id));if(e){ne.info("Service trouvé:",e);const t=e.product_id||e.id;if(D.value.product_id=parseInt(String(t)),0===D.value.amount){const t=e.price||0;D.value.amount=t,ne.info("Prix associé au service:",{price:t})}ne.info("Product ID associé:",{productId:D.value.product_id}),ne.info("Montant associé:",{amount:D.value.amount})}else ne.error("Service sélectionné non trouvé dans la liste des services disponibles",{selectedId:D.value.service_id,availableServices:N.value.map(e=>({id:e.id,name:e.name}))})}else D.value.product_id=0},j=()=>{D.value.items.push({description:"",quantity:1,unit_price:0,total:0})},F=e=>{const t=D.value.items[e];t.total=(t.quantity||0)*(t.unit_price||0)},G=async()=>{O.value=!0;try{R.value&&x.value?(await y.updateInvoice({...D.value,id:parseInt(x.value),status:D.value.status}),C.addNotification({type:"success",title:n("common.success"),message:n("invoices.success.updated")})):(await y.createInvoice({...D.value,status:D.value.status}),C.addNotification({type:"success",title:n("common.success"),message:n("invoices.success.created")})),r.push("/invoices")}catch(e){ne.error("Erreur lors de l'enregistrement de la facture",{error:e}),C.addNotification({type:"error",title:n("common.error"),message:n("invoices.error.save_failed")})}finally{O.value=!1}},B=()=>{r.push("/invoices")},H=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e);return i(async()=>{await(async()=>{try{await E.fetchClients(),P.value=E.clients}catch(e){ne.error("Erreur lors du chargement des clients",{error:e}),C.addNotification({type:"error",title:n("common.error"),message:n("invoices.error.load_clients")})}})(),R.value&&await(async()=>{if(R.value&&x.value)try{const e=await y.fetchInvoice(parseInt(x.value));if(!e)return void ne.warn("[INVOICE-FORM] Aucune donnée de facture reçue");const t=e,s=[...D.value.items];let a=[];a=Array.isArray(t.items)?t.items.map(e=>({description:e.description,quantity:Number(e.quantity),unit_price:"string"==typeof e.unit_price?parseFloat(e.unit_price):Number(e.unit_price),total:Number(e.total)})):s;const i={...D.value,id:t.id,client_id:t.client_id?String(t.client_id):"",product_id:t.product_id,amount:t.amount,due_date:t.due_date,status:t.status,notes:t.notes||"",service_id:t.service_id?String(t.service_id):"",items:a};D.value=i,ne.info("[INVOICE-FORM] Formulaire initialisé avec les données de la facture",{form:D.value,invoice:t})}catch(e){ne.error("Erreur lors du chargement de la facture",{error:e}),C.addNotification({type:"error",title:n("common.error"),message:n("invoices.errors.load_failed")}),r.push("/invoices")}})()}),(e,t)=>{const s=m("router-link");return g(),o("div",XH,[l("div",QH,[l("div",ZH,[l("div",eW,[u(s,{to:"/invoices",class:"breadcrumb-link"},{default:p(()=>[t[7]||(t[7]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(_(n)("invoices.title")),1)]),_:1,__:[7]}),t[8]||(t[8]=l("span",{class:"breadcrumb-separator"},"/",-1)),l("span",tW,c(R.value?_(n)("invoices.edit_title"):_(n)("invoices.create_title")),1)]),l("h1",sW,c(R.value?_(n)("invoices.edit_title"):_(n)("invoices.create_title")),1),l("span",aW,c(R.value?_(n)("invoices.edit_description"):_(n)("invoices.create_description")),1)])]),l("div",iW,[l("form",{onSubmit:k(G,["prevent"])},[l("div",nW,[l("h2",rW,c(_(n)("invoices.form.client_info")),1),l("div",oW,[l("div",lW,[l("label",cW,c(_(n)("invoices.form.client")),1),w(l("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>D.value.client_id=e),class:"form-control",required:"",onChange:V},[l("option",uW,c(_(n)("invoices.form.select_client")),1),(g(!0),o(h,null,f(P.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name)+" ("+c(e.email)+") ",9,dW))),128))],544),[[A,D.value.client_id]])]),l("div",pW,[l("label",mW,c(_(n)("invoices.form.service")),1),w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>D.value.service_id=e),class:"form-control",onChange:$},[l("option",vW,c(_(n)("invoices.form.select_service")),1),(g(!0),o(h,null,f(N.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name)+" - "+c(H(e.price)),9,hW))),128))],544),[[A,D.value.service_id]])])])]),l("div",fW,[l("h2",gW,c(_(n)("invoices.form.invoice_details")),1),l("div",yW,[l("div",bW,[l("label",_W,c(_(n)("invoices.form.date")),1),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>D.value.date=e),type:"date",class:"form-control",required:""},null,512),[[S,D.value.date]])]),l("div",kW,[l("label",wW,c(_(n)("invoices.form.due_date")),1),w(l("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>D.value.due_date=e),type:"date",class:"form-control"},null,512),[[S,D.value.due_date]])]),l("div",SW,[l("label",EW,c(_(n)("invoices.form.status")),1),w(l("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>D.value.status=e),class:"form-control",required:""},[l("option",CW,c(_(n)("invoices.status.unpaid")),1),l("option",TW,c(_(n)("invoices.status.paid")),1),l("option",AW,c(_(n)("invoices.status.overdue")),1),l("option",IW,c(_(n)("invoices.status.cancelled")),1)],512),[[A,D.value.status]])]),l("div",RW,[l("label",xW,c(_(n)("invoices.form.amount")),1),w(l("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>D.value.amount=e),type:"number",class:"form-control",step:"0.01",min:"0",required:""},null,512),[[S,D.value.amount]])])])]),l("div",OW,[l("h3",PW,c(_(n)("invoices.form.items")),1),l("div",NW,[(g(!0),o(h,null,f(D.value.items,(e,s)=>(g(),o("div",{key:s,class:"invoice-item"},[l("div",MW,[l("div",DW,[l("label",LW,c(_(n)("invoices.form.item_description")),1),w(l("input",{"onUpdate:modelValue":t=>e.description=t,type:"text",class:"form-input",placeholder:_(n)("invoices.form.item_description_placeholder")},null,8,UW),[[S,e.description]])]),l("div",qW,[l("label",VW,c(_(n)("invoices.form.quantity")),1),w(l("input",{"onUpdate:modelValue":t=>e.quantity=t,type:"number",class:"form-input",min:"1",onInput:e=>F(s)},null,40,$W),[[S,e.quantity]])]),l("div",jW,[l("label",FW,c(_(n)("invoices.form.unit_price")),1),w(l("input",{"onUpdate:modelValue":t=>e.unit_price=t,type:"number",class:"form-input",step:"0.01",onInput:e=>F(s)},null,40,GW),[[S,e.unit_price]])]),l("div",BW,[l("label",HW,c(_(n)("invoices.form.total")),1),l("div",WW,c(H(e.total||0)),1)]),l("div",zW,[l("button",{type:"button",class:"btn-icon btn-danger",disabled:1===D.value.items.length,onClick:e=>(e=>{D.value.items.length>1&&D.value.items.splice(e,1)})(s)},t[9]||(t[9]=[l("i",{class:"fas fa-trash"},null,-1)]),8,KW)])])]))),128)),l("button",{type:"button",class:"btn btn-secondary",onClick:j},[t[10]||(t[10]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(_(n)("invoices.form.add_item")),1)])])]),l("div",JW,[l("h2",YW,c(_(n)("invoices.form.notes")),1),l("div",XW,[w(l("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>D.value.notes=e),class:"form-control",rows:"4",placeholder:_(n)("invoices.form.notes_placeholder")},null,8,QW),[[S,D.value.notes]])])]),l("div",ZW,[l("div",ez,[l("span",tz,c(_(n)("invoices.form.subtotal")),1),l("span",sz,c(H(L.value)),1)]),l("div",az,[l("span",iz,c(_(n)("invoices.form.tax"))+" ("+c(M.value)+"%)",1),l("span",nz,c(H(U.value)),1)]),l("div",rz,[l("span",oz,c(_(n)("invoices.form.total")),1),l("span",lz,c(H(q.value)),1)])]),l("div",cz,[l("button",{type:"button",class:"btn btn-secondary",onClick:B},c(_(n)("common.cancel")),1),l("button",{type:"submit",class:"btn btn-primary",disabled:O.value},[O.value?(g(),o("span",dz,[t[11]||(t[11]=l("span",{class:"spinner-border spinner-border-sm mr-2"},null,-1)),d(" "+c(_(n)("common.saving")),1)])):(g(),o("span",pz,c(R.value?_(n)("common.save"):_(n)("common.create")),1))],8,uz)])],32)])])}}}),vz=Vt(mz,[["__scopeId","data-v-7e8ac326"]]),hz={class:"invoice-details-view view-container"},fz={class:"header-box"},gz={class:"header-content"},yz={class:"breadcrumb"},bz={class:"breadcrumb-current"},_z={class:"page-title"},kz={class:"page-description"},wz={class:"header-actions"},Sz={key:0,class:"loading-state box"},Ez={key:1,class:"empty-state box"},Cz={class:"empty-title"},Tz={class:"empty-description"},Az={key:2,class:"details-grid"},Iz={class:"details-card"},Rz={class:"card-title"},xz={class:"info-grid"},Oz={class:"info-item"},Pz={class:"info-label"},Nz={class:"info-value"},Mz={class:"info-item"},Dz={class:"info-label"},Lz={class:"info-item"},Uz={class:"info-label"},qz={class:"info-value"},Vz={class:"info-item"},$z={class:"info-label"},jz={class:"info-value"},Fz={class:"info-item"},Gz={class:"info-label"},Bz={class:"info-value amount"},Hz={class:"details-card"},Wz={class:"card-title"},zz={class:"info-grid"},Kz={class:"info-item"},Jz={class:"info-label"},Yz={key:0,class:"info-item"},Xz={class:"info-label"},Qz={class:"info-value"},Zz={key:1,class:"info-item"},eK={class:"info-label"},tK={class:"info-value"},sK={key:0,class:"details-card full-width"},aK={class:"card-title"},iK={class:"items-table"},nK={class:"data-table"},rK={class:"invoice-totals"},oK={class:"total-row"},lK={class:"total-label"},cK={class:"total-value"},uK={key:0,class:"total-row"},dK={class:"total-label"},pK={class:"total-value"},mK={class:"total-row final-total"},vK={class:"total-label"},hK={class:"total-value"},fK={key:1,class:"details-card full-width"},gK={class:"card-title"},yK={class:"payments-list"},bK={class:"payment-info"},_K={class:"payment-amount"},kK={class:"payment-method"},wK={class:"payment-date"},SK={key:2,class:"details-card full-width"},EK={class:"card-title"},CK={class:"notes-content"},TK={class:"details-card full-width"},AK={class:"card-title"},IK={class:"history-timeline"},RK={class:"timeline-item"},xK={class:"timeline-content"},OK={key:0,class:"timeline-item"},PK={class:"timeline-content"},NK={key:1,class:"timeline-item"},MK={class:"timeline-content"},DK=r({__name:"InvoiceDetailsView",setup(t){const{t:n}=b(),r=I(),k=T(),w=Rv(),S=He(),E=e(!1),C=s(()=>r.params.id),A=s(()=>{if(!w.currentInvoice)return{};const e=w.currentInvoice;return{...e,client_id:e.client_id||0,total:e.amount||0}}),R=async()=>{E.value=!0;try{await w.fetchInvoice(parseInt(C.value))}catch(e){ne.error("Erreur lors du chargement de la facture",{error:e}),S.addNotification({type:"error",title:n("common.error"),message:n("invoices.errors.load_failed")}),k.push("/invoices")}finally{E.value=!1}},x=async()=>{if(confirm(n("invoices.confirm_mark_paid")))try{await w.updateInvoice({id:parseInt(C.value),status:"paid"})&&(await R(),S.addNotification({type:"success",title:n("common.success"),message:n("invoices.success.marked_paid")}))}catch(e){ne.error("Erreur lors du marquage comme payé",{error:e}),S.addNotification({type:"error",title:n("common.error"),message:n("invoices.errors.mark_paid_failed")})}},O=async()=>{try{S.addNotification({type:"info",title:n("common.info"),message:"Téléchargement PDF à implémenter"})}catch(e){ne.error("Erreur lors du téléchargement PDF",{error:e}),S.addNotification({type:"error",title:n("common.error"),message:n("invoices.errors.download_failed")})}},P=e=>{if(void 0===e)return"";const t="string"==typeof e?parseFloat(e):e;return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(t)},N=e=>{if(!e)return"";return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})},M=e=>{if(!e)return"";return new Date(e).toLocaleString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})};return i(async()=>{ne.info("[INVOICE-DETAIL] Component monté, initialisation..."),await R(),ne.info("[INVOICE-DETAIL] Facture chargée, initialisation du temps réel"),ne.info("[INVOICE-DETAIL] Initialisation des écouteurs temps réel"),w.initRealtimeListeners(),ne.info("[INVOICE-DETAIL] Écouteurs temps réel initialisés"),a(()=>w.lastRealtimeEvent,e=>{var t,s;if(ne.info("[INVOICE-DETAIL] Watcher déclenché pour lastRealtimeEvent",{event_exists:!!e,event_type:null==e?void 0:e.action,event_invoice_id:null==(t=null==e?void 0:e.invoice)?void 0:t.id,current_invoice_id:null==(s=A.value)?void 0:s.id}),!e||!e.invoice||!e.action)return void ne.info("[INVOICE-DETAIL] Événement incomplet, ignoré");if(!A.value||!C.value)return void ne.info("[INVOICE-DETAIL] Facture courante non définie, ignoré");const a=parseInt(C.value);parseInt(e.invoice.id)===a&&(ne.info(`[INVOICE-DETAIL] Événement ${e.action} reçu pour la facture #${a}`),"delete"===e.action?(S.addNotification({type:"warning",title:n("common.info"),message:n("invoices.realtime.deleted")}),k.push("/invoices")):"update"===e.action&&(ne.info(`[INVOICE-DETAIL] Mise à jour directe de la facture #${a} depuis l'événement update`),e.invoice&&Object.keys(e.invoice).length>0?(w.currentInvoice=e.invoice,ne.info(`[INVOICE-DETAIL] Facture #${a} mise à jour directement depuis les données temps réel`),S.addNotification({type:"info",title:n("common.info"),message:n("invoices.realtime.updated")})):(ne.warn("[INVOICE-DETAIL] Données incomplètes dans l'événement, rechargement complet nécessaire"),R())))},{deep:!0,immediate:!0}),ne.info("[INVOICE-DETAIL] Temps réel initialisé avec succès")}),(e,t)=>{const s=m("router-link");return g(),o("div",hz,[l("div",fz,[l("div",gz,[l("div",yz,[u(s,{to:"/invoices",class:"breadcrumb-link"},{default:p(()=>[t[0]||(t[0]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(_(n)("invoices.title")),1)]),_:1,__:[0]}),t[1]||(t[1]=l("span",{class:"breadcrumb-separator"},"/",-1)),l("span",bz,c(_(n)("invoices.details_title",{id:C.value})),1)]),l("h1",_z,c(_(n)("invoices.details_title",{id:C.value})),1),l("span",kz,c(_(n)("invoices.details_description")),1)]),l("div",wz,[A.value&&"paid"!==A.value.status?(g(),o("button",{key:0,class:"btn btn-success",onClick:x},[t[2]||(t[2]=l("i",{class:"fas fa-credit-card"},null,-1)),d(" "+c(_(n)("invoices.actions.mark_paid")),1)])):v("",!0),l("button",{class:"btn btn-secondary",onClick:O},[t[3]||(t[3]=l("i",{class:"fas fa-download"},null,-1)),d(" "+c(_(n)("invoices.actions.download_pdf")),1)]),u(s,{to:`/invoices/${C.value}/edit`,class:"btn btn-primary"},{default:p(()=>[t[4]||(t[4]=l("i",{class:"fas fa-edit"},null,-1)),d(" "+c(_(n)("invoices.actions.edit")),1)]),_:1,__:[4]},8,["to"])])]),E.value?(g(),o("div",Sz,[t[5]||(t[5]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(n)("common.loading")),1)])):A.value?(g(),o("div",Az,[l("div",Iz,[l("h3",Rz,c(_(n)("invoices.details.main_info")),1),l("div",xz,[l("div",Oz,[l("label",Pz,c(_(n)("invoices.details.id")),1),l("span",Nz,"#"+c(A.value.id),1)]),l("div",Mz,[l("label",Dz,c(_(n)("invoices.details.status")),1),l("span",{class:y(`status-badge status-${A.value.status}`)},c((a=A.value.status,{paid:n("invoices.status.paid"),unpaid:n("invoices.status.pending"),pending:n("invoices.status.pending"),overdue:n("invoices.status.overdue"),cancelled:n("invoices.status.cancelled")}[a]||a)),3)]),l("div",Lz,[l("label",Uz,c(_(n)("invoices.details.date")),1),l("span",qz,c(N(A.value.date)),1)]),l("div",Vz,[l("label",$z,c(_(n)("invoices.details.due_date")),1),l("span",jz,c(A.value.due_date?N(A.value.due_date):"-"),1)]),l("div",Fz,[l("label",Gz,c(_(n)("invoices.details.amount")),1),l("span",Bz,c(P(A.value.amount)),1)])])]),l("div",Hz,[l("h3",Wz,c(_(n)("invoices.details.client_info")),1),l("div",zz,[l("div",Kz,[l("label",Jz,c(_(n)("invoices.details.client")),1),u(s,{to:`/clients/${A.value.client_id}`,class:"info-link"},{default:p(()=>[d(c(A.value.client_name),1)]),_:1},8,["to"])]),A.value.client_email?(g(),o("div",Yz,[l("label",Xz,c(_(n)("invoices.details.email")),1),l("span",Qz,c(A.value.client_email),1)])):v("",!0),A.value.service_name?(g(),o("div",Zz,[l("label",eK,c(_(n)("invoices.details.service")),1),l("span",tK,c(A.value.service_name),1)])):v("",!0)])]),A.value.items&&A.value.items.length?(g(),o("div",sK,[l("h3",aK,c(_(n)("invoices.details.items")),1),l("div",iK,[l("table",nK,[l("thead",null,[l("tr",null,[l("th",null,c(_(n)("invoices.details.description")),1),l("th",null,c(_(n)("invoices.details.quantity")),1),l("th",null,c(_(n)("invoices.details.unit_price")),1),l("th",null,c(_(n)("invoices.details.total")),1)])]),l("tbody",null,[(g(!0),o(h,null,f(A.value.items,e=>(g(),o("tr",{key:e.id},[l("td",null,c(e.description),1),l("td",null,c(e.quantity),1),l("td",null,c(P(e.unit_price)),1),l("td",null,c(P(e.total)),1)]))),128))])]),l("div",rK,[l("div",oK,[l("span",lK,c(_(n)("invoices.details.subtotal")),1),l("span",cK,c(P(A.value.subtotal||0)),1)]),A.value.tax_amount?(g(),o("div",uK,[l("span",dK,c(_(n)("invoices.details.tax")),1),l("span",pK,c(P(A.value.tax_amount)),1)])):v("",!0),l("div",mK,[l("span",vK,c(_(n)("invoices.details.total")),1),l("span",hK,c(P(A.value.amount)),1)])])])])):v("",!0),A.value.payments&&A.value.payments.length?(g(),o("div",fK,[l("h3",gK,c(_(n)("invoices.details.payments")),1),l("div",yK,[(g(!0),o(h,null,f(A.value.payments,e=>(g(),o("div",{key:e.id,class:"payment-item"},[l("div",bK,[l("span",_K,c(P(e.amount)),1),l("span",kK,c(e.method),1),l("span",wK,c(N(e.date)),1)]),u(s,{to:`/payments/${e.id}`,class:"payment-link"},{default:p(()=>t[7]||(t[7]=[l("i",{class:"fas fa-external-link-alt"},null,-1)])),_:2,__:[7]},1032,["to"])]))),128))])])):v("",!0),A.value.notes?(g(),o("div",SK,[l("h3",EK,c(_(n)("invoices.details.notes")),1),l("div",CK,[l("p",null,c(A.value.notes),1)])])):v("",!0),l("div",TK,[l("h3",AK,c(_(n)("invoices.details.history")),1),l("div",IK,[l("div",RK,[t[8]||(t[8]=l("div",{class:"timeline-marker created"},null,-1)),l("div",xK,[l("h4",null,c(_(n)("invoices.history.created")),1),l("p",null,c(M(A.value.created_at)),1)])]),A.value.updated_at!==A.value.created_at?(g(),o("div",OK,[t[9]||(t[9]=l("div",{class:"timeline-marker updated"},null,-1)),l("div",PK,[l("h4",null,c(_(n)("invoices.history.updated")),1),l("p",null,c(M(A.value.updated_at)),1)])])):v("",!0),"paid"===A.value.status&&A.value.paid_at?(g(),o("div",NK,[t[10]||(t[10]=l("div",{class:"timeline-marker paid"},null,-1)),l("div",MK,[l("h4",null,c(_(n)("invoices.history.paid")),1),l("p",null,c(M(A.value.paid_at)),1)])])):v("",!0)])])])):(g(),o("div",Ez,[t[6]||(t[6]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-exclamation-triangle"})],-1)),l("h3",Cz,c(_(n)("invoices.not_found.title")),1),l("p",Tz,c(_(n)("invoices.not_found.description")),1)]))]);var a}}}),LK=Vt(DK,[["__scopeId","data-v-98a8947f"]]),UK={class:"subscription-form-view view-container"},qK={class:"header-box"},VK={class:"header-content"},$K={class:"breadcrumb"},jK={class:"breadcrumb-current"},FK={class:"page-title"},GK={class:"page-description"},BK={class:"form-container box"},HK={class:"form-section"},WK={class:"section-title"},zK={class:"form-grid"},KK={class:"form-row"},JK={class:"form-group"},YK={class:"form-label required"},XK={value:""},QK=["value"],ZK={class:"form-group"},eJ={class:"form-label required"},tJ={value:""},sJ=["value"],aJ={class:"form-section"},iJ={class:"section-title"},nJ={class:"form-row"},rJ={class:"form-group"},oJ={class:"form-label required"},lJ={class:"form-group"},cJ={class:"form-label"},uJ={class:"form-row"},dJ={class:"form-group"},pJ={class:"form-label required"},mJ={value:"monthly"},vJ={value:"quarterly"},hJ={value:"semi_annual"},fJ={value:"annual"},gJ={class:"form-group"},yJ={class:"form-label"},bJ={class:"form-row"},_J={class:"form-group"},kJ={class:"form-label required"},wJ={class:"input-with-currency"},SJ={class:"form-group"},EJ={class:"form-label required"},CJ={value:"pending"},TJ={value:"active"},AJ={value:"cancelled"},IJ={value:"expired"},RJ={class:"form-section"},xJ={class:"section-title"},OJ={class:"form-row"},PJ={class:"form-group"},NJ={class:"form-label"},MJ={value:""},DJ=["value"],LJ={class:"form-group"},UJ={class:"form-label"},qJ=["placeholder"],VJ={class:"form-group"},$J={class:"form-label"},jJ=["placeholder"],FJ={class:"form-section"},GJ={class:"section-title"},BJ={class:"form-row"},HJ={class:"form-group"},WJ={class:"form-label"},zJ={class:"checkbox-wrapper"},KJ={for:"auto_renew",class:"checkbox-label"},JJ={class:"form-group"},YJ={class:"form-label"},XJ={class:"checkbox-wrapper"},QJ={for:"send_notifications",class:"checkbox-label"},ZJ={class:"form-section full-width"},eY={class:"section-title"},tY={class:"form-group"},sY=["placeholder"],aY={class:"form-actions"},iY=["disabled"],nY=r({__name:"SubscriptionFormView",setup(t){const{t:n}=b(),r=T(),v=I(),y=nf(),E=ws(),R=ha(),x=_y(),O=He(),P=e(!1),N=e([]),M=e([]),D=e([]),L=e({client_id:"",product_id:"",start_date:(new Date).toISOString().split("T")[0],end_date:"",billing_cycle:"monthly",next_billing_date:"",price:0,status:"pending",server_id:"",domain:"",username:"",auto_renew:!0,send_notifications:!0,notes:""}),U=s(()=>!!v.params.id),q=s(()=>v.params.id?parseInt(v.params.id):null);a(()=>L.value.start_date,()=>{j()}),a(()=>L.value.billing_cycle,()=>{j()});const V=()=>{L.value.username="",L.value.domain=""},$=()=>{const e=M.value.find(e=>e.id==L.value.product_id);e&&void 0!==e.price&&(L.value.price=e.price)},j=()=>{if(!L.value.start_date)return;const e=new Date(L.value.start_date);let t=new Date(e);switch(L.value.billing_cycle){case"monthly":t.setMonth(t.getMonth()+1);break;case"quarterly":t.setMonth(t.getMonth()+3);break;case"semi_annual":t.setMonth(t.getMonth()+6);break;case"annual":t.setFullYear(t.getFullYear()+1)}L.value.next_billing_date=t.toISOString().split("T")[0]},F=async()=>{P.value=!0;try{const e={client_id:Number(L.value.client_id),product_id:Number(L.value.product_id),start_date:L.value.start_date,end_date:L.value.end_date||null,billing_cycle:L.value.billing_cycle,next_billing_date:L.value.next_billing_date,price:L.value.price,status:L.value.status,server_id:L.value.server_id?Number(L.value.server_id):null,domain:L.value.domain,username:L.value.username,auto_renew:L.value.auto_renew,send_notifications:L.value.send_notifications,notes:L.value.notes};U.value&&q.value?(e.id=q.value,await y.updateSubscription(q.value,e),O.addNotification({type:"success",title:n("common.success"),message:n("subscriptions.success.updated")})):(await y.createSubscription(e),O.addNotification({type:"success",title:n("common.success"),message:n("subscriptions.success.created")})),r.push("/subscriptions")}catch(e){ne.error("Erreur lors de la sauvegarde",{error:e}),O.addNotification({type:"error",title:n("common.error"),message:U.value?n("subscriptions.errors.update_failed"):n("subscriptions.errors.create_failed")})}finally{P.value=!1}},G=()=>{r.push("/subscriptions")};return i(async()=>{await(async()=>{try{await Promise.all([E.fetchClients(),R.fetchProducts(),x.fetchServers()]),N.value=E.clients||[],M.value=R.products||[],D.value=x.servers||[]}catch(e){ne.error("Erreur lors du chargement des données",{error:e})}})(),U.value?await(async()=>{if(q.value)try{await y.fetchSubscription(q.value);const e=y.currentSubscription;e&&(L.value={client_id:e.client_id||"",product_id:e.product_id||"",start_date:e.start_date||"",end_date:e.end_date||"",billing_cycle:e.billing_cycle||"monthly",next_billing_date:e.renewal_date||"",price:e.price||0,status:e.status||"pending",server_id:"",domain:"",username:"",auto_renew:e.auto_renew||!1,send_notifications:!0,notes:e.notes||""},"server_id"in e&&(L.value.server_id=String(e.server_id||"")),"domain"in e&&(L.value.domain=String(e.domain||"")),"username"in e&&(L.value.username=String(e.username||"")),"send_notifications"in e&&(L.value.send_notifications=Boolean(e.send_notifications)))}catch(e){ne.error("Erreur lors du chargement de l'abonnement",{error:e}),O.addNotification({type:"error",title:n("common.error"),message:n("subscriptions.errors.load_failed")}),r.push("/subscriptions")}})():j()}),(e,t)=>{const s=m("router-link");return g(),o("div",UK,[l("div",qK,[l("div",VK,[l("div",$K,[u(s,{to:"/subscriptions",class:"breadcrumb-link"},{default:p(()=>[t[14]||(t[14]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(_(n)("subscriptions.title")),1)]),_:1,__:[14]}),t[15]||(t[15]=l("span",{class:"breadcrumb-separator"},"/",-1)),l("span",jK,c(U.value?_(n)("subscriptions.edit_title"):_(n)("subscriptions.create_title")),1)]),l("h1",FK,c(U.value?_(n)("subscriptions.edit_title"):_(n)("subscriptions.create_title")),1),l("span",GK,c(U.value?_(n)("subscriptions.edit_description"):_(n)("subscriptions.create_description")),1)])]),l("div",BK,[l("form",{onSubmit:k(F,["prevent"])},[l("div",HK,[l("h2",WK,c(_(n)("subscriptions.form.client_product")),1),l("div",zK,[l("div",KK,[l("div",JK,[l("label",YK,c(_(n)("subscriptions.form.client")),1),w(l("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>L.value.client_id=e),class:"form-input",required:"",onChange:V},[l("option",XK,c(_(n)("subscriptions.form.select_client")),1),(g(!0),o(h,null,f(N.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name)+" ("+c(e.email)+") ",9,QK))),128))],544),[[A,L.value.client_id]])]),l("div",ZK,[l("label",eJ,c(_(n)("subscriptions.form.product")),1),w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>L.value.product_id=e),class:"form-input",required:"",onChange:$},[l("option",tJ,c(_(n)("subscriptions.form.select_product")),1),(g(!0),o(h,null,f(M.value,e=>{return g(),o("option",{key:e.id,value:e.id},c(e.name)+" - "+c((t=e.price||0,new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(t))),9,sJ);var t}),128))],544),[[A,L.value.product_id]])])])]),l("div",aJ,[l("h3",iJ,c(_(n)("subscriptions.form.subscription_details")),1),l("div",nJ,[l("div",rJ,[l("label",oJ,c(_(n)("subscriptions.form.start_date")),1),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>L.value.start_date=e),type:"date",class:"form-input",required:""},null,512),[[S,L.value.start_date]])]),l("div",lJ,[l("label",cJ,c(_(n)("subscriptions.form.end_date")),1),w(l("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>L.value.end_date=e),type:"date",class:"form-input"},null,512),[[S,L.value.end_date]])])]),l("div",uJ,[l("div",dJ,[l("label",pJ,c(_(n)("subscriptions.form.billing_cycle")),1),w(l("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>L.value.billing_cycle=e),class:"form-input",required:"",onChange:j},[l("option",mJ,c(_(n)("subscriptions.cycles.monthly")),1),l("option",vJ,c(_(n)("subscriptions.cycles.quarterly")),1),l("option",hJ,c(_(n)("subscriptions.cycles.semi_annual")),1),l("option",fJ,c(_(n)("subscriptions.cycles.annual")),1)],544),[[A,L.value.billing_cycle]])]),l("div",gJ,[l("label",yJ,c(_(n)("subscriptions.form.next_billing")),1),w(l("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>L.value.next_billing_date=e),type:"date",class:"form-input",readonly:""},null,512),[[S,L.value.next_billing_date]])])]),l("div",bJ,[l("div",_J,[l("label",kJ,c(_(n)("subscriptions.form.price")),1),l("div",wJ,[w(l("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>L.value.price=e),type:"number",class:"form-input",step:"0.01",min:"0",required:""},null,512),[[S,L.value.price]]),t[16]||(t[16]=l("span",{class:"currency-symbol"},"€",-1))])]),l("div",SJ,[l("label",EJ,c(_(n)("subscriptions.form.status")),1),w(l("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>L.value.status=e),class:"form-input",required:""},[l("option",CJ,c(_(n)("subscriptions.status.pending")),1),l("option",TJ,c(_(n)("subscriptions.status.active")),1),l("option",AJ,c(_(n)("subscriptions.status.cancelled")),1),l("option",IJ,c(_(n)("subscriptions.status.expired")),1)],512),[[A,L.value.status]])])])]),l("div",RJ,[l("h3",xJ,c(_(n)("subscriptions.form.service_config")),1),l("div",OJ,[l("div",PJ,[l("label",NJ,c(_(n)("subscriptions.form.server")),1),w(l("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>L.value.server_id=e),class:"form-input"},[l("option",MJ,c(_(n)("subscriptions.form.select_server")),1),(g(!0),o(h,null,f(D.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name)+" ("+c(e.type)+") ",9,DJ))),128))],512),[[A,L.value.server_id]])]),l("div",LJ,[l("label",UJ,c(_(n)("subscriptions.form.domain")),1),w(l("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>L.value.domain=e),type:"text",class:"form-input",placeholder:_(n)("subscriptions.form.domain_placeholder")},null,8,qJ),[[S,L.value.domain]])])]),l("div",VJ,[l("label",$J,c(_(n)("subscriptions.form.username")),1),w(l("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>L.value.username=e),type:"text",class:"form-input",placeholder:_(n)("subscriptions.form.username_placeholder")},null,8,jJ),[[S,L.value.username]])])]),l("div",FJ,[l("h3",GJ,c(_(n)("subscriptions.form.advanced_options")),1),l("div",BJ,[l("div",HJ,[l("label",WJ,c(_(n)("subscriptions.form.auto_renew")),1),l("div",zJ,[w(l("input",{id:"auto_renew","onUpdate:modelValue":t[11]||(t[11]=e=>L.value.auto_renew=e),type:"checkbox",class:"form-checkbox"},null,512),[[C,L.value.auto_renew]]),l("label",KJ,c(_(n)("subscriptions.form.auto_renew_description")),1)])]),l("div",JJ,[l("label",YJ,c(_(n)("subscriptions.form.send_notifications")),1),l("div",XJ,[w(l("input",{id:"send_notifications","onUpdate:modelValue":t[12]||(t[12]=e=>L.value.send_notifications=e),type:"checkbox",class:"form-checkbox"},null,512),[[C,L.value.send_notifications]]),l("label",QJ,c(_(n)("subscriptions.form.send_notifications_description")),1)])])])]),l("div",ZJ,[l("h3",eY,c(_(n)("subscriptions.form.notes")),1),l("div",tY,[w(l("textarea",{"onUpdate:modelValue":t[13]||(t[13]=e=>L.value.notes=e),class:"form-input",rows:"4",placeholder:_(n)("subscriptions.form.notes_placeholder")},null,8,sY),[[S,L.value.notes]])])])]),l("div",aY,[l("button",{type:"button",class:"btn btn-secondary",onClick:G},[t[17]||(t[17]=l("i",{class:"fas fa-times"},null,-1)),d(" "+c(_(n)("common.cancel")),1)]),l("button",{type:"submit",class:"btn btn-primary",disabled:P.value},[t[18]||(t[18]=l("i",{class:"fas fa-save"},null,-1)),d(" "+c(U.value?_(n)("common.update"):_(n)("common.create")),1)],8,iY)])],32)])])}}}),rY=Vt(nY,[["__scopeId","data-v-94611a2a"]]),oY={class:"subscription-details-view view-container"},lY={class:"header-box"},cY={class:"header-content"},uY={class:"breadcrumb"},dY={class:"breadcrumb-current"},pY={class:"page-title"},mY={class:"page-description"},vY={class:"header-actions"},hY={key:0,class:"loading-state box"},fY={key:1,class:"empty-state box"},gY={class:"empty-title"},yY={class:"empty-description"},bY={key:2,class:"details-grid"},_Y={class:"details-card"},kY={class:"card-title"},wY={class:"info-grid"},SY={class:"info-item"},EY={class:"info-label"},CY={class:"info-value"},TY={class:"info-item"},AY={class:"info-label"},IY={class:"info-item"},RY={class:"info-label"},xY={class:"info-value amount"},OY={class:"info-item"},PY={class:"info-label"},NY={class:"info-value"},MY={class:"details-card"},DY={class:"card-title"},LY={class:"info-grid"},UY={class:"info-item"},qY={class:"info-label"},VY={class:"info-item"},$Y={class:"info-label"},jY={class:"info-value"},FY={key:0,class:"info-item"},GY={class:"info-label"},BY={class:"info-value"},HY={key:1,class:"info-item"},WY={class:"info-label"},zY={class:"info-value"},KY={class:"details-card"},JY={class:"card-title"},YY={class:"info-grid"},XY={class:"info-item"},QY={class:"info-label"},ZY={class:"info-value"},eX={class:"info-item"},tX={class:"info-label"},sX={class:"info-value"},aX={key:0,class:"info-item"},iX={class:"info-label"},nX={class:"info-value"},rX={class:"details-card"},oX={class:"card-title"},lX={class:"info-grid"},cX={key:0,class:"info-item"},uX={class:"info-label"},dX={class:"info-value"},pX={class:"info-item"},mX={class:"info-label"},vX={class:"info-value"},hX={class:"info-item"},fX={class:"info-label"},gX={class:"info-value"},yX={key:0,class:"details-card full-width"},bX={class:"card-title"},_X={class:"invoices-list"},kX={class:"invoice-info"},wX={class:"invoice-id"},SX={class:"invoice-amount"},EX={class:"invoice-date"},CX={key:1,class:"details-card full-width"},TX={class:"card-title"},AX={class:"notes-content"},IX={class:"details-card full-width"},RX={class:"card-title"},xX={class:"history-timeline"},OX={class:"timeline-item"},PX={class:"timeline-content"},NX={key:0,class:"timeline-item"},MX={class:"timeline-content"},DX={key:1,class:"timeline-item"},LX={class:"timeline-content"},UX=r({__name:"SubscriptionDetailsView",setup(t){const{t:a}=b(),n=I(),r=T(),k=nf(),w=He(),S=e(!1),E=e(null),C=s(()=>Number(n.params.id)),A=async()=>{S.value=!0;try{await k.fetchSubscription(C.value);const e=k.currentSubscription;e&&(E.value=e,E.value&&"invoices"in E.value&&Array.isArray(E.value.invoices)&&E.value.invoices.sort((e,t)=>{const s=new Date(e.invoice_date||"");return new Date(t.invoice_date||"").getTime()-s.getTime()}))}catch(e){ne.error("Erreur lors du chargement de l'abonnement",{error:e}),w.addNotification({type:"error",title:a("common.error"),message:a("subscriptions.errors.load_failed")}),r.push("/subscriptions")}finally{S.value=!1}},R=async()=>{if(confirm(a("subscriptions.confirm_cancel")))try{await k.cancelSubscription(C.value),await A(),w.addNotification({type:"success",title:a("common.success"),message:a("subscriptions.success.cancelled")})}catch(e){ne.error("Erreur lors de l'annulation",{error:e}),w.addNotification({type:"error",title:a("common.error"),message:a("subscriptions.errors.cancel_failed")})}},x=async()=>{try{await k.renewSubscription(C.value),await A(),w.addNotification({type:"success",title:a("common.success"),message:a("subscriptions.success.renewed")})}catch(e){ne.error("Erreur lors du renouvellement",{error:e}),w.addNotification({type:"error",title:a("common.error"),message:a("subscriptions.errors.renew_failed")})}},O=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e),P=e=>e?new Intl.DateTimeFormat("fr-FR").format(new Date(e)):"",N=e=>{if(!e)return"";const t=new Date(e);return new Intl.DateTimeFormat("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)},M=e=>{const t={active:a("subscriptions.status.active"),pending:a("subscriptions.status.pending"),cancelled:a("subscriptions.status.cancelled"),expired:a("subscriptions.status.expired")};return e in t?t[e]:e},D=e=>{const t={monthly:a("subscriptions.billing_cycle.monthly"),quarterly:a("subscriptions.billing_cycle.quarterly"),semi_annual:a("subscriptions.billing_cycle.semi_annual"),annual:a("subscriptions.billing_cycle.annual")};return e in t?t[e]:e};return i(async()=>{await A()}),(e,t)=>{const s=m("router-link");return g(),o("div",oY,[l("div",lY,[l("div",cY,[l("div",uY,[u(s,{to:"/subscriptions",class:"breadcrumb-link"},{default:p(()=>[t[0]||(t[0]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(_(a)("subscriptions.title")),1)]),_:1,__:[0]}),t[1]||(t[1]=l("span",{class:"breadcrumb-separator"},"/",-1)),l("span",dY,c(_(a)("subscriptions.details_title",{id:C.value})),1)]),l("h1",pY,c(_(a)("subscriptions.details_title",{id:C.value})),1),l("span",mY,c(_(a)("subscriptions.details_description")),1)]),l("div",vY,[E.value&&"active"===E.value.status?(g(),o("button",{key:0,class:"btn btn-warning",onClick:R},[t[2]||(t[2]=l("i",{class:"fas fa-ban"},null,-1)),d(" "+c(_(a)("subscriptions.actions.cancel")),1)])):v("",!0),E.value&&"active"!==E.value.status?(g(),o("button",{key:1,class:"btn btn-success",onClick:x},[t[3]||(t[3]=l("i",{class:"fas fa-sync"},null,-1)),d(" "+c(_(a)("subscriptions.actions.renew")),1)])):v("",!0),u(s,{to:`/subscriptions/${C.value}/edit`,class:"btn btn-primary"},{default:p(()=>[t[4]||(t[4]=l("i",{class:"fas fa-edit"},null,-1)),d(" "+c(_(a)("subscriptions.actions.edit")),1)]),_:1,__:[4]},8,["to"])])]),S.value?(g(),o("div",hY,[t[5]||(t[5]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(a)("common.loading")),1)])):E.value?(g(),o("div",bY,[l("div",_Y,[l("h3",kY,c(_(a)("subscriptions.details.main_info")),1),l("div",wY,[l("div",SY,[l("label",EY,c(_(a)("subscriptions.details.id")),1),l("span",CY,"#"+c(E.value.id),1)]),l("div",TY,[l("label",AY,c(_(a)("subscriptions.details.status")),1),l("span",{class:y(`status-badge status-${E.value.status}`)},c(M(E.value.status)),3)]),l("div",IY,[l("label",RY,c(_(a)("subscriptions.details.price")),1),l("span",xY,c(O(E.value.price)),1)]),l("div",OY,[l("span",PY,c(_(a)("subscriptions.fields.billing_cycle")),1),l("span",NY,c(D(E.value.billing_cycle)),1)])])]),l("div",MY,[l("h3",DY,c(_(a)("subscriptions.details.client_product")),1),l("div",LY,[l("div",UY,[l("label",qY,c(_(a)("subscriptions.details.client")),1),u(s,{to:`/clients/${E.value.client_id}`,class:"info-link"},{default:p(()=>[d(c(E.value.client_name),1)]),_:1},8,["to"])]),l("div",VY,[l("label",$Y,c(_(a)("subscriptions.details.product")),1),l("span",jY,c(E.value.product_name),1)]),E.value.domain?(g(),o("div",FY,[l("label",GY,c(_(a)("subscriptions.details.domain")),1),l("span",BY,c(E.value.domain),1)])):v("",!0),E.value.username?(g(),o("div",HY,[l("label",WY,c(_(a)("subscriptions.details.username")),1),l("span",zY,c(E.value.username),1)])):v("",!0)])]),l("div",KY,[l("h3",JY,c(_(a)("subscriptions.details.dates")),1),l("div",YY,[l("div",XY,[l("label",QY,c(_(a)("subscriptions.details.start_date")),1),l("span",ZY,c(P(E.value.start_date)),1)]),l("div",eX,[l("label",tX,c(_(a)("subscriptions.details.next_billing")),1),l("span",sX,c(E.value.next_billing_date?P(E.value.next_billing_date):"-"),1)]),E.value.end_date?(g(),o("div",aX,[l("label",iX,c(_(a)("subscriptions.details.end_date")),1),l("span",nX,c(P(E.value.end_date)),1)])):v("",!0)])]),l("div",rX,[l("h3",oX,c(_(a)("subscriptions.details.service_config")),1),l("div",lX,[E.value.server_name?(g(),o("div",cX,[l("label",uX,c(_(a)("subscriptions.details.server")),1),l("span",dX,c(E.value.server_name),1)])):v("",!0),l("div",pX,[l("label",mX,c(_(a)("subscriptions.details.auto_renew")),1),l("span",vX,[l("i",{class:y(E.value.auto_renew?"fas fa-check text-success":"fas fa-times text-danger")},null,2),d(" "+c(E.value.auto_renew?_(a)("common.yes"):_(a)("common.no")),1)])]),l("div",hX,[l("label",fX,c(_(a)("subscriptions.details.notifications")),1),l("span",gX,[l("i",{class:y(E.value.send_notifications?"fas fa-check text-success":"fas fa-times text-danger")},null,2),d(" "+c(E.value.send_notifications?_(a)("common.enabled"):_(a)("common.disabled")),1)])])])]),E.value.invoices&&E.value.invoices.length?(g(),o("div",yX,[l("h3",bX,c(_(a)("subscriptions.details.invoices")),1),l("div",_X,[(g(!0),o(h,null,f(E.value.invoices,e=>(g(),o("div",{key:e.id,class:"invoice-item"},[l("div",kX,[l("span",wX,"#"+c(e.id),1),l("span",SX,c(O(e.amount)),1),l("span",{class:y(`status-badge status-${e.status}`)},c(e.status),3),l("span",EX,c(P(e.date)),1)]),u(s,{to:`/invoices/${e.id}`,class:"invoice-link"},{default:p(()=>t[7]||(t[7]=[l("i",{class:"fas fa-external-link-alt"},null,-1)])),_:2,__:[7]},1032,["to"])]))),128))])])):v("",!0),E.value.notes?(g(),o("div",CX,[l("h3",TX,c(_(a)("subscriptions.details.notes")),1),l("div",AX,[l("p",null,c(E.value.notes),1)])])):v("",!0),l("div",IX,[l("h3",RX,c(_(a)("subscriptions.details.history")),1),l("div",xX,[l("div",OX,[t[8]||(t[8]=l("div",{class:"timeline-marker created"},null,-1)),l("div",PX,[l("h4",null,c(_(a)("subscriptions.history.created")),1),l("p",null,c(N(E.value.created_at)),1)])]),E.value.updated_at!==E.value.created_at?(g(),o("div",NX,[t[9]||(t[9]=l("div",{class:"timeline-marker updated"},null,-1)),l("div",MX,[l("h4",null,c(_(a)("subscriptions.history.updated")),1),l("p",null,c(N(E.value.updated_at)),1)])])):v("",!0),"cancelled"===E.value.status&&E.value.cancelled_at?(g(),o("div",DX,[t[10]||(t[10]=l("div",{class:"timeline-marker cancelled"},null,-1)),l("div",LX,[l("h4",null,c(_(a)("subscriptions.history.cancelled")),1),l("p",null,c(N(E.value.cancelled_at)),1)])])):v("",!0)])])])):(g(),o("div",fY,[t[6]||(t[6]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-exclamation-triangle"})],-1)),l("h3",gY,c(_(a)("subscriptions.not_found.title")),1),l("p",yY,c(_(a)("subscriptions.not_found.description")),1)]))])}}}),qX=Vt(UX,[["__scopeId","data-v-3a5639ba"]]),VX={class:"ticket-form-view view-container"},$X={class:"header-box"},jX={class:"header-content"},FX={class:"breadcrumb"},GX={class:"breadcrumb-current"},BX={class:"page-title"},HX={class:"page-description"},WX={class:"form-container box"},zX={class:"form-section"},KX={class:"section-title"},JX={class:"form-row"},YX={class:"form-group"},XX={class:"form-label required"},QX={value:""},ZX=["value"],eQ={class:"form-group"},tQ={class:"form-label"},sQ={value:""},aQ=["value"],iQ={class:"form-group"},nQ={class:"form-label"},rQ=["placeholder"],oQ={class:"form-section"},lQ={class:"section-title"},cQ={class:"form-row"},uQ={class:"form-group"},dQ={class:"form-label required"},pQ={value:"low"},mQ={value:"medium"},vQ={value:"high"},hQ={value:"urgent"},fQ={class:"form-group"},gQ={class:"form-label required"},yQ={value:"open"},bQ={value:"answered"},_Q={value:"customer-reply"},kQ={value:"closed"},wQ={class:"form-section full-width"},SQ={class:"section-title"},EQ={class:"form-group"},CQ={class:"form-label"},TQ=["placeholder"],AQ={class:"form-section"},IQ={class:"section-title"},RQ={class:"form-row"},xQ={class:"form-group"},OQ={class:"form-label"},PQ={value:""},NQ=["value"],MQ={class:"form-group"},DQ={class:"form-label"},LQ={value:""},UQ=["value"],qQ={class:"form-section"},VQ={class:"section-title"},$Q={class:"form-row"},jQ={class:"form-group"},FQ={class:"form-label"},GQ={class:"checkbox-wrapper"},BQ={for:"notify_client",class:"checkbox-label"},HQ={class:"form-group"},WQ={class:"form-label"},zQ={class:"checkbox-wrapper"},KQ={for:"auto_close",class:"checkbox-label"},JQ={class:"form-section full-width"},YQ={class:"section-title"},XQ={class:"form-group"},QQ={class:"form-label"},ZQ={class:"tags-input"},eZ={class:"selected-tags"},tZ=["onClick"],sZ=["placeholder","onKeydown"],aZ={class:"form-section"},iZ={class:"section-title"},nZ={class:"form-group"},rZ={class:"form-label"},oZ=["placeholder"],lZ={class:"form-help"},cZ={class:"form-actions"},uZ={type:"submit",class:"btn btn-primary"},dZ=Vt(r({__name:"TicketFormView",setup(t){const{t:n}=b(),r=T(),v=I(),y=Jf(),E=ws(),R=He(),x=e(null),O=s(()=>null!==x.value);i(async()=>{await $(),v.params.id&&(x.value=parseInt(v.params.id,10),await G())});const P=e(!1),N=e([]),M=e([]),D=e([]),U=e([]),q=e(""),V=e({client_id:"",department_id:"",subject:"",message:"",priority:"medium",status:"open",assigned_to:"",service_id:"",notify_client:!0,auto_close:!1,tags:[],internal_notes:""});a(()=>V.value.client_id,async e=>{e?await j(parseInt(e)):U.value=[]});const $=async()=>{try{P.value=!0,await E.fetchClients(),N.value=E.clients;try{const e=await _e.routes.admin.ticket.departments.list();ne.debug("Structure de la réponse des départements:",e.data),e.data&&(void 0!==e.data.departments?M.value=e.data.departments||[]:e.data.data&&void 0!==e.data.data.departments?M.value=e.data.data.departments||[]:(ne.error("Format de réponse inattendu pour les départements",{data:e.data}),M.value=[],R.showError(n("tickets.departments.errors.fetch"))))}catch(e){ne.error("Erreur lors du chargement des départements:",{error:e}),R.showError(n("tickets.departments.errors.fetch"))}try{const e=await _e.routes.admin.admins.list();ne.debug("Structure de la réponse des administrateurs:",e.data),e.data&&(void 0!==e.data.admins?D.value=e.data.admins||[]:e.data.data&&void 0!==e.data.data.admins?D.value=e.data.data.admins||[]:(ne.error("Format de réponse inattendu pour les administrateurs",{data:e.data}),D.value=[]))}catch(e){ne.error("Erreur lors du chargement des administrateurs:",{error:e})}}catch(e){ne.error("Erreur lors du chargement des données initiales du formulaire",{error:e})}},j=async e=>{try{const t=await _e.routes.admin.service.getClientServices(e.toString());ne.debug("Réponse des services clients:",t.data),t.data&&(Array.isArray(t.data.data)?(U.value=t.data.data||[],ne.debug("Services clients chargés (format tableau):",U.value)):t.data.services?(U.value=t.data.services||[],ne.debug("Services clients chargés (format services):",U.value)):t.data.data&&t.data.data.services?(U.value=t.data.data.services||[],ne.debug("Services clients chargés (format data.services):",U.value)):(ne.error("Format de réponse inattendu pour les services clients",{data:t.data}),U.value=[]))}catch(t){ne.error("Erreur lors du chargement des services pour le client",{clientId:e,error:t}),U.value=[]}},F=()=>{const e=q.value.trim().replace(",","");e&&!V.value.tags.includes(e)&&(V.value.tags.push(e),q.value="")},G=async()=>{if(x.value)try{P.value=!0;const e=await y.getTicket(x.value);e?(V.value={client_id:e.client_id?e.client_id.toString():"",department_id:e.department_id?e.department_id.toString():"",subject:e.subject||"",message:e.message||"",priority:e.priority||"medium",status:e.status||"open",assigned_to:e.assigned_to?e.assigned_to.toString():"",service_id:e.service_id?e.service_id.toString():"",notify_client:void 0===e.notify_client||e.notify_client,auto_close:void 0!==e.auto_close&&e.auto_close,tags:e.tags||[],internal_notes:e.internal_notes||""},e.client_id&&await j(e.client_id)):(ne.warn(`Ticket avec ID ${x.value} non trouvé`),R.showNotification({title:"Erreur",message:`Impossible de trouver le ticket #${x.value}`,type:"error"}),r.push({name:"tickets"}))}catch(e){ne.error("Erreur lors du chargement du ticket pour édition",{ticketId:x.value,error:e}),R.showNotification({type:"error",title:n("common.error"),message:n("tickets.errors.load_failed")}),r.push("/tickets")}finally{P.value=!1}},B=async()=>{try{P.value=!0;const e={...V.value,client_id:V.value.client_id?parseInt(V.value.client_id,10):void 0,department_id:V.value.department_id?parseInt(V.value.department_id,10):void 0,service_id:V.value.service_id?parseInt(V.value.service_id,10):void 0,assigned_to:V.value.assigned_to?parseInt(V.value.assigned_to,10):void 0};O.value&&x.value?(await y.updateTicket(x.value,e),R.showNotification({type:"success",title:n("common.success"),message:n("tickets.success.updated")})):(await y.createTicket(e),R.showNotification({type:"success",title:n("common.success"),message:n("tickets.success.created")})),r.push("/tickets")}catch(e){ne.error("Erreur lors de la sauvegarde du ticket",{ticketId:x.value,isEdit:O.value,error:e}),R.showNotification({type:"error",title:n("common.error"),message:O.value?n("tickets.errors.update_failed"):n("tickets.errors.create_failed")})}finally{P.value=!1}},H=()=>{r.push("/tickets")};return i(async()=>{await $(),O.value&&await G()}),(e,t)=>{const s=m("router-link");return g(),o("div",VX,[l("div",$X,[l("div",jX,[l("div",FX,[u(s,{to:"/tickets",class:"breadcrumb-link"},{default:p(()=>[t[12]||(t[12]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(_(n)("tickets.title")),1)]),_:1,__:[12]}),t[13]||(t[13]=l("span",{class:"breadcrumb-separator"},"/",-1)),l("span",GX,c(O.value?_(n)("tickets.edit_title"):_(n)("tickets.create_title")),1)]),l("h1",BX,c(O.value?_(n)("tickets.edit_title"):_(n)("tickets.create_title")),1),l("span",HX,c(O.value?_(n)("tickets.edit_description"):_(n)("tickets.create_description")),1)])]),l("div",WX,[l("form",{onSubmit:k(B,["prevent"])},[l("div",zX,[l("h3",KX,c(_(n)("tickets.form.basic_info")),1),l("div",JX,[l("div",YX,[l("label",XX,c(_(n)("tickets.form.client")),1),w(l("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>V.value.client_id=e),class:"form-input"},[l("option",QX,c(_(n)("tickets.form.select_client")),1),(g(!0),o(h,null,f(N.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name)+" ("+c(e.email)+") ",9,ZX))),128))],512),[[A,V.value.client_id]])]),l("div",eQ,[l("label",tQ,c(_(n)("tickets.form.department")),1),w(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>V.value.department_id=e),class:"form-input"},[l("option",sQ,c(_(n)("tickets.form.select_department")),1),(g(!0),o(h,null,f(M.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name),9,aQ))),128))],512),[[A,V.value.department_id]])])]),l("div",iQ,[l("label",nQ,c(_(n)("tickets.form.subject")),1),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>V.value.subject=e),type:"text",class:"form-input",placeholder:_(n)("tickets.form.subject_placeholder")},null,8,rQ),[[S,V.value.subject]])])]),l("div",oQ,[l("h3",lQ,c(_(n)("tickets.form.priority_status")),1),l("div",cQ,[l("div",uQ,[l("label",dQ,c(_(n)("tickets.form.priority")),1),w(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>V.value.priority=e),class:"form-input"},[l("option",pQ,c(_(n)("tickets.priority.low")),1),l("option",mQ,c(_(n)("tickets.priority.medium")),1),l("option",vQ,c(_(n)("tickets.priority.high")),1),l("option",hQ,c(_(n)("tickets.priority.urgent")),1)],512),[[A,V.value.priority]])]),l("div",fQ,[l("label",gQ,c(_(n)("tickets.form.status")),1),w(l("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>V.value.status=e),class:"form-input"},[l("option",yQ,c(_(n)("tickets.status.open")),1),l("option",bQ,c(_(n)("tickets.status.answered")||"Répondu"),1),l("option",_Q,c(_(n)("tickets.status.customer_reply")||"Réponse client"),1),l("option",kQ,c(_(n)("tickets.status.closed")),1)],512),[[A,V.value.status]])])])]),l("div",wQ,[l("h3",SQ,c(_(n)("tickets.form.message")),1),l("div",EQ,[l("label",CQ,c(_(n)("tickets.form.description")),1),w(l("textarea",{"onUpdate:modelValue":t[5]||(t[5]=e=>V.value.message=e),class:"form-input message-textarea",rows:"8",placeholder:_(n)("tickets.form.message_placeholder")},null,8,TQ),[[S,V.value.message]])])]),l("div",AQ,[l("h3",IQ,c(_(n)("tickets.form.assignment")),1),l("div",RQ,[l("div",xQ,[l("label",OQ,c(_(n)("tickets.form.assigned_to")),1),w(l("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>V.value.assigned_to=e),class:"form-input"},[l("option",PQ,c(_(n)("tickets.form.unassigned")),1),(g(!0),o(h,null,f(D.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.firstname)+" "+c(e.lastname)+" ("+c(e.username)+") ",9,NQ))),128))],512),[[A,V.value.assigned_to]])]),l("div",MQ,[l("label",DQ,c(_(n)("tickets.form.service_related")),1),w(l("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>V.value.service_id=e),class:"form-input"},[l("option",LQ,c(_(n)("tickets.form.no_service")),1),(g(!0),o(h,null,f(U.value,e=>(g(),o("option",{key:e.id,value:e.id},c(e.name)+" - "+c(e.domain),9,UQ))),128))],512),[[A,V.value.service_id]])])])]),l("div",qQ,[l("h3",VQ,c(_(n)("tickets.form.advanced_options")),1),l("div",$Q,[l("div",jQ,[l("label",FQ,c(_(n)("tickets.form.notify_client")),1),l("div",GQ,[w(l("input",{id:"notify_client","onUpdate:modelValue":t[8]||(t[8]=e=>V.value.notify_client=e),type:"checkbox",class:"form-checkbox"},null,512),[[C,V.value.notify_client]]),l("label",BQ,c(_(n)("tickets.form.notify_client_description")),1)])]),l("div",HQ,[l("label",WQ,c(_(n)("tickets.form.auto_close")),1),l("div",zQ,[w(l("input",{id:"auto_close","onUpdate:modelValue":t[9]||(t[9]=e=>V.value.auto_close=e),type:"checkbox",class:"form-checkbox"},null,512),[[C,V.value.auto_close]]),l("label",KQ,c(_(n)("tickets.form.auto_close_description")),1)])])])]),l("div",JQ,[l("h3",YQ,c(_(n)("tickets.form.tags")),1),l("div",XQ,[l("label",QQ,c(_(n)("tickets.form.tags_label")),1),l("div",ZQ,[l("div",eZ,[(g(!0),o(h,null,f(V.value.tags,e=>(g(),o("span",{key:e,class:"tag-item"},[d(c(e)+" ",1),l("button",{type:"button",class:"tag-remove",onClick:t=>{return s=e,void(V.value.tags=V.value.tags.filter(e=>e!==s));var s}},t[14]||(t[14]=[l("i",{class:"fas fa-times"},null,-1)]),8,tZ)]))),128))]),w(l("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>q.value=e),type:"text",class:"form-input",placeholder:_(n)("tickets.form.tags_placeholder"),onKeydown:L(k(F,["prevent"]),["enter"])},null,40,sZ),[[S,q.value]])])])]),l("div",aZ,[l("h2",iZ,c(_(n)("tickets.form.internal_notes")),1),l("div",nZ,[l("label",rZ,c(_(n)("tickets.form.notes")),1),w(l("textarea",{"onUpdate:modelValue":t[11]||(t[11]=e=>V.value.internal_notes=e),class:"form-control",rows:"4",placeholder:_(n)("tickets.form.notes_placeholder")},null,8,oZ),[[S,V.value.internal_notes]]),l("small",lZ,c(_(n)("tickets.form.notes_help")),1)])]),l("div",cZ,[l("button",{type:"button",class:"btn btn-secondary",onClick:H},[t[15]||(t[15]=l("i",{class:"fas fa-times"},null,-1)),d(" "+c(_(n)("common.cancel")),1)]),l("button",uZ,[t[16]||(t[16]=l("i",{class:"fas fa-save"},null,-1)),d(" "+c(O.value?_(n)("common.update"):_(n)("common.create")),1)])])],32)])])}}}),[["__scopeId","data-v-67c7067b"]]),pZ={key:0,class:"pagination-container"},mZ={class:"pagination-info"},vZ={class:"page-indicator"},hZ={class:"total-items"},fZ={class:"pagination-controls"},gZ=["disabled"],yZ={class:"page-numbers"},bZ=["onClick"],_Z=["disabled"],kZ=Vt(r({__name:"PaginationComponent",props:{currentPage:{},totalPages:{},total:{},perPage:{default:7}},emits:["pageChange"],setup(e,{emit:t}){const a=e,i=t,n=s(()=>{const e=[];if(a.totalPages<=5)for(let t=1;t<=a.totalPages;t++)e.push(t);else{let t=Math.max(1,a.currentPage-2),s=Math.min(a.totalPages,a.currentPage+2);a.currentPage<=3&&(s=Math.min(a.totalPages,5)),a.currentPage>=a.totalPages-2&&(t=Math.max(1,a.totalPages-4));for(let a=t;a<=s;a++)e.push(a)}return e}),r=e=>{e>=1&&e<=a.totalPages&&e!==a.currentPage&&i("pageChange",e)};return(e,t)=>e.totalPages>1?(g(),o("div",pZ,[l("div",mZ,[l("span",vZ," Page "+c(e.currentPage)+" sur "+c(e.totalPages),1),l("span",hZ,c(e.total)+" "+c(e.total>1?"éléments":"élément")+" au total ",1)]),l("div",fZ,[l("button",{class:"btn btn-outline btn-sm pagination-btn",disabled:e.currentPage<=1,onClick:t[0]||(t[0]=t=>r(e.currentPage-1))},t[2]||(t[2]=[l("i",{class:"fas fa-chevron-left"},null,-1),d(" Précédent ")]),8,gZ),l("div",yZ,[(g(!0),o(h,null,f(n.value,t=>(g(),o("button",{key:t,class:y(["btn","btn-sm","page-btn",{"btn-primary":t===e.currentPage,"btn-outline":t!==e.currentPage}]),onClick:e=>r(t)},c(t),11,bZ))),128))]),l("button",{class:"btn btn-outline btn-sm pagination-btn",disabled:e.currentPage>=e.totalPages,onClick:t[1]||(t[1]=t=>r(e.currentPage+1))},t[3]||(t[3]=[d(" Suivant "),l("i",{class:"fas fa-chevron-right"},null,-1)]),8,_Z)])])):v("",!0)}}),[["__scopeId","data-v-4ff3cac9"]]),wZ={class:"ticket-details-view view-container"},SZ={class:"header-box"},EZ={class:"header-content"},CZ={class:"breadcrumb"},TZ={class:"breadcrumb-current"},AZ={class:"page-title"},IZ={class:"page-description"},RZ={class:"header-actions"},xZ={key:0,class:"loading-state box"},OZ={key:1,class:"empty-state box"},PZ={class:"empty-title"},NZ={class:"empty-description"},MZ={key:2,class:"details-grid"},DZ={class:"details-card"},LZ={class:"card-title"},UZ={class:"info-grid"},qZ={class:"info-item"},VZ={class:"info-label"},$Z={class:"info-value"},jZ={class:"info-item"},FZ={class:"info-label"},GZ={class:"detail-row"},BZ={class:"detail-label"},HZ={class:"info-item"},WZ={class:"info-label"},zZ={class:"info-value"},KZ={class:"details-card"},JZ={class:"card-title"},YZ={class:"info-grid"},XZ={class:"info-item"},QZ={class:"info-label"},ZZ={key:0,class:"info-item"},e1={class:"info-label"},t1={class:"info-value"},s1={key:1,class:"info-item"},a1={class:"info-label"},i1={class:"info-value"},n1={key:2,class:"info-item"},r1={class:"info-label"},o1={class:"info-value"},l1={class:"details-card full-width"},c1={class:"card-title"},u1={class:"subject-content"},d1={class:"ticket-subject"},p1={class:"ticket-message"},m1={class:"message-header"},v1={class:"message-author"},h1={class:"message-date"},f1={class:"message-content"},g1={key:0,class:"details-card full-width"},y1={class:"card-title"},b1={class:"replies-list"},_1={class:"reply-header"},k1={class:"reply-author"},w1={class:"author-name"},S1={key:0,class:"staff-badge"},E1={class:"reply-date"},C1={class:"reply-content"},T1={class:"details-card full-width"},A1={class:"card-title"},I1={class:"form-group"},R1=["placeholder"],x1={class:"reply-actions"},O1={class:"reply-options"},P1={class:"checkbox-wrapper"},N1={class:"checkbox-label"},M1={class:"checkbox-wrapper"},D1={class:"checkbox-label"},L1=["disabled"],U1={key:1,class:"details-card"},q1={class:"card-title"},V1={class:"tags-list"},$1={key:2,class:"details-card"},j1={class:"card-title"},F1={class:"notes-content"},G1={class:"details-card full-width"},B1={class:"card-title"},H1={class:"history-timeline"},W1={class:"timeline-item"},z1={class:"timeline-content"},K1={key:0,class:"timeline-item"},J1={class:"timeline-content"},Y1={key:1,class:"timeline-item"},X1={class:"timeline-content"},Q1={key:2,class:"timeline-item"},Z1={class:"timeline-content"},e0=Vt(r({__name:"TicketDetailsView",setup(t){const{t:r}=b(),E=I(),A=T(),x=Jf(),O=He(),P=G0(),N=e(!1),M=e(!1),D=e(""),L=e(!0),q=e(!1),V=e(1),$=e(1),j=e(0),F=e(7),G=e(null),B=s(()=>E.params.id),H=s(()=>x.currentTicket),W=async(e=1)=>{try{N.value=!0;const t=await x.getTicket(parseInt(B.value),e,F.value);x.$patch({currentTicket:t}),(null==t?void 0:t.pagination)&&(V.value=t.pagination.current_page,$.value=t.pagination.total_pages,j.value=t.pagination.total),ne.debug("[admin-frontend] Ticket récupéré",{ticket:t,pagination:null==t?void 0:t.pagination})}catch(t){ne.error("Erreur lors du chargement du ticket",{ticketId:B.value,error:t}),O.addNotification({type:"error",title:r("common.error"),message:r("tickets.errors.load_failed")}),A.push("/tickets")}finally{N.value=!1}},z=async()=>{var e,t,s,a,i,n,o,l,c,u;if(D.value.trim()){M.value=!0;try{ne.debug("[TicketDetails] Ajout de réponse admin",{ticketId:B.value,message:D.value,notifyClient:L.value,closeAfterReply:q.value}),ne.info("[ADMIN TICKET] Avant addReply - État currentTicket",{hasCurrentTicket:!!x.currentTicket,currentTicketId:null==(e=x.currentTicket)?void 0:e.id,repliesCount:(null==(s=null==(t=x.currentTicket)?void 0:t.replies)?void 0:s.length)||0});const r=await x.addReply(parseInt(B.value),{message:D.value,user_id:P.user.id,user_type:"admin"});ne.info("[ADMIN TICKET] Après addReply - État currentTicket",{hasCurrentTicket:!!x.currentTicket,currentTicketId:null==(a=x.currentTicket)?void 0:a.id,repliesCount:(null==(n=null==(i=x.currentTicket)?void 0:i.replies)?void 0:n.length)||0,replyResult:!!r,ticketComputedReplies:(null==(l=null==(o=H.value)?void 0:o.replies)?void 0:l.length)||0}),r&&x.currentTicket&&(await U(),ne.info("[ADMIN TICKET] Réactivité forcée avec nextTick",{ticketRepliesAfterNextTick:(null==(u=null==(c=H.value)?void 0:c.replies)?void 0:u.length)||0})),D.value="",L.value=!1,q.value=!1,ne.info("[ADMIN TICKET] Réponse envoyée, mise à jour via événement temps réel"),q.value&&await x.closeTicket(parseInt(B.value)),ne.debug("[TicketDetails] Réponse ajoutée avec succès")}catch(d){ne.error("[TicketDetails] Erreur lors de l'ajout de la réponse",{ticketId:B.value,error:d}),O.addNotification({type:"error",title:r("common.error"),message:r("tickets.errors.reply_failed")})}finally{M.value=!1}}},K=async()=>{if(confirm(r("tickets.confirm_close")))try{await x.closeTicket(parseInt(B.value)),await W(),O.addNotification({type:"success",title:r("common.success"),message:r("tickets.success.closed")})}catch(e){ne.error("Erreur lors de la fermeture du ticket",{ticketId:B.value,error:e}),O.addNotification({type:"error",title:r("common.error"),message:r("tickets.errors.close_failed")})}},J=async()=>{try{await x.reopenTicket(parseInt(B.value)),await W(),O.addNotification({type:"success",title:r("common.success"),message:r("tickets.success.reopened")})}catch(e){ne.error("Erreur lors de la réouverture du ticket",{ticketId:B.value,error:e}),O.addNotification({type:"error",title:r("common.error"),message:r("tickets.errors.reopen_failed")})}},Y=e=>e?new Date(e).toLocaleString("fr-FR"):"-",X=e=>{const t={open:r("tickets.status.open"),pending:r("tickets.status.pending"),resolved:r("tickets.status.resolved"),closed:r("tickets.status.closed")};return e in t?t[e]:e},Q=e=>{const t={low:r("tickets.priority.low"),medium:r("tickets.priority.medium"),high:r("tickets.priority.high"),urgent:r("tickets.priority.urgent")};return e in t?t[e]:e},Z=async e=>{await W(e);const t=document.querySelector(".details-card.full-width");t&&t.scrollIntoView({behavior:"smooth"})},ee=(e,t)=>{var s,a,i;if("admin"!==(null==(s=e.author)?void 0:s.type))switch(t){case"reply":x.getTicket(parseInt(B.value),V.value,F.value),O.addNotification({type:"info",title:"Nouvelle réponse",message:`Nouvelle réponse de ${(null==(a=e.author)?void 0:a.name)||"Client"}`}),ne.info("[ADMIN TICKET] Mise à jour dynamique après nouvelle réponse client");break;case"status_change":e.ticket&&x.currentTicket&&(x.currentTicket.status=e.ticket.status),O.addNotification({type:"info",title:"Statut modifié",message:`Statut changé par ${(null==(i=e.author)?void 0:i.name)||"Client"}`}),ne.info("[ADMIN TICKET] Mise à jour dynamique statut sans rechargement");break;case"update":e.ticket&&x.currentTicket&&Object.assign(x.currentTicket,e.ticket),ne.info("[ADMIN TICKET] Mise à jour dynamique données ticket")}};return i(()=>{W(),x.realtimeInitialized||(x.initRealtimeListeners(),ne.info("[admin-frontend] Écouteurs temps réel initialisés pour les tickets")),a(()=>x.lastRealtimeEvent,e=>{var t;e&&(ne.info("[admin-frontend] DIAGNOSTIC - Watcher déclenché sur lastRealtimeEvent",{hasNewEvent:!!e,currentTicketId:B.value,newEventTicketId:null==(t=null==e?void 0:e.ticket)?void 0:t.id,actionType:null==e?void 0:e.action,time:(new Date).toISOString()}),e&&B.value&&e.ticket&&e.ticket.id===B.value&&(ne.info("[admin-frontend] Événement temps réel détecté pour le ticket courant",{action:e.action,ticketId:B.value}),"delete"===e.action?(O.addNotification({type:"warning",title:r("common.info"),message:r("tickets.realtime.deleted",{fallback:"Ce ticket a été supprimé"})}),A.push("/tickets")):["update","reply","status_change"].includes(e.action)&&(ne.info(`[admin-frontend] Mise à jour directe du ticket #${B.value} depuis l'événement ${e.action}`),e.ticket&&Object.keys(e.ticket).length>0?(x.currentTicket=e.ticket,ne.info(`[admin-frontend] Ticket #${B.value} mis à jour directement depuis les données temps réel`),O.addNotification({type:"info",title:r("common.info"),message:r("tickets.realtime.updated",{fallback:"Ce ticket a été mis à jour"})})):(ne.warn("[admin-frontend] Données incomplètes dans l'événement, rechargement complet nécessaire"),W()))))},{deep:!0}),setTimeout(()=>{(()=>{const e=B.value;if(!e)return;G.value&&(G.value(),G.value=null);const t=$e(e,"ticket-reply",e=>{ne.info("[ADMIN TICKET] Nouvelle réponse reçue via canal ticket",{data:e}),ee(e,"reply")}),s=$e(e,"ticket-status-change",e=>{ne.info("[ADMIN TICKET] Changement statut reçu via canal ticket",{data:e}),ee(e,"status_change")}),a=$e(e,"ticket-update",e=>{ne.info("[ADMIN TICKET] Mise à jour reçue via canal ticket",{data:e}),ee(e,"update")});G.value=()=>{t(),s(),a()},ne.info("[ADMIN TICKET] Abonnement canal ticket activé",{ticketId:e})})()},1e3),ne.info("[admin-frontend] Vue détails ticket initialisée")}),n(()=>{G.value&&(G.value(),G.value=null)}),(e,t)=>{const s=m("router-link");return g(),o("div",wZ,[l("div",SZ,[l("div",EZ,[l("div",CZ,[u(s,{to:"/tickets",class:"breadcrumb-link"},{default:p(()=>[t[3]||(t[3]=l("i",{class:"fas fa-arrow-left"},null,-1)),d(" "+c(_(r)("tickets.title")),1)]),_:1,__:[3]}),t[4]||(t[4]=l("span",{class:"breadcrumb-separator"},"/",-1)),l("span",TZ,c(_(r)("tickets.details_title",{id:B.value})),1)]),l("h1",AZ,c(_(r)("tickets.details_title",{id:B.value})),1),l("span",IZ,c(_(r)("tickets.details_description")),1)]),l("div",RZ,[!H.value||"closed"!==H.value.status&&"resolved"!==H.value.status?H.value&&"closed"!==H.value.status?(g(),o("button",{key:1,class:"btn btn-warning",onClick:K},[t[6]||(t[6]=l("i",{class:"fas fa-check"},null,-1)),d(" "+c(_(r)("tickets.actions.close")),1)])):v("",!0):(g(),o("button",{key:0,class:"btn btn-success",onClick:J},[t[5]||(t[5]=l("i",{class:"fas fa-redo"},null,-1)),d(" "+c(_(r)("tickets.actions.reopen")),1)])),u(s,{to:`/tickets/${B.value}/edit`,class:"btn btn-primary"},{default:p(()=>[t[7]||(t[7]=l("i",{class:"fas fa-edit"},null,-1)),d(" "+c(_(r)("tickets.actions.edit")),1)]),_:1,__:[7]},8,["to"])])]),N.value?(g(),o("div",xZ,[t[8]||(t[8]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(r)("common.loading")),1)])):H.value?(g(),o("div",MZ,[l("div",DZ,[l("h3",LZ,c(_(r)("tickets.details.main_info")),1),l("div",UZ,[l("div",qZ,[l("label",VZ,c(_(r)("tickets.details.id")),1),l("span",$Z,"#"+c(H.value.id),1)]),l("div",jZ,[l("label",FZ,c(_(r)("tickets.details.status")),1),l("div",{class:y(["status-badge",H.value.status])},c(X(H.value.status)),3)]),l("div",GZ,[l("span",BZ,c(_(r)("tickets.details.priority"))+":",1),l("div",{class:y(["priority-badge",H.value.priority])},c(Q(H.value.priority)),3)]),l("div",HZ,[l("label",WZ,c(_(r)("tickets.details.created_at")),1),l("span",zZ,c(Y(H.value.created_at)),1)])])]),l("div",KZ,[l("h3",JZ,c(_(r)("tickets.details.client_assignment")),1),l("div",YZ,[l("div",XZ,[l("label",QZ,c(_(r)("tickets.details.client")),1),u(s,{to:`/clients/${H.value.client_id}`,class:"info-link"},{default:p(()=>[d(c(H.value.client_name),1)]),_:1},8,["to"])]),H.value.department_name?(g(),o("div",ZZ,[l("label",e1,c(_(r)("tickets.details.department")),1),l("span",t1,c(H.value.department_name),1)])):v("",!0),H.value.assigned_to_name?(g(),o("div",s1,[l("label",a1,c(_(r)("tickets.details.assigned_to")),1),l("span",i1,c(H.value.assigned_to_name),1)])):v("",!0),H.value.service_name?(g(),o("div",n1,[l("label",r1,c(_(r)("tickets.details.related_service")),1),l("span",o1,c(H.value.service_name),1)])):v("",!0)])]),l("div",l1,[l("h3",c1,c(_(r)("tickets.details.subject")),1),l("div",u1,[l("h4",d1,c(H.value.subject),1),l("div",p1,[l("div",m1,[l("span",v1,c(H.value.client_name),1),l("span",h1,c(Y(H.value.created_at)),1)]),l("div",f1,[l("p",null,c(H.value.message),1)])])])]),H.value.replies&&H.value.replies.length?(g(),o("div",g1,[l("h3",y1,c(_(r)("tickets.details.replies"))+" ("+c(H.value.replies.length)+")",1),l("div",b1,[(g(!0),o(h,null,f(H.value.replies,e=>(g(),o("div",{key:e.id,class:"reply-item"},[l("div",_1,[l("div",k1,[l("i",{class:y(e.is_staff?"fas fa-user-tie":"fas fa-user")},null,2),l("span",w1,c(e.author_name),1),e.is_staff?(g(),o("span",S1,c(_(r)("tickets.staff")),1)):v("",!0)]),l("span",E1,c(Y(e.created_at)),1)]),l("div",C1,[l("p",null,c(e.message),1)])]))),128))]),$.value>1?(g(),R(kZ,{key:0,"current-page":V.value,"total-pages":$.value,total:j.value,"per-page":F.value,onPageChange:Z},null,8,["current-page","total-pages","total","per-page"])):v("",!0)])):v("",!0),l("div",T1,[l("h3",A1,c(_(r)("tickets.details.add_reply")),1),l("form",{class:"reply-form",onSubmit:k(z,["prevent"])},[l("div",I1,[w(l("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>D.value=e),class:"form-input",rows:"4",placeholder:_(r)("tickets.details.reply_placeholder"),required:""},null,8,R1),[[S,D.value]])]),l("div",x1,[l("div",O1,[l("label",P1,[w(l("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>L.value=e),type:"checkbox",class:"form-checkbox"},null,512),[[C,L.value]]),l("span",N1,c(_(r)("tickets.details.notify_client")),1)]),l("label",M1,[w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>q.value=e),type:"checkbox",class:"form-checkbox"},null,512),[[C,q.value]]),l("span",D1,c(_(r)("tickets.details.close_after_reply")),1)])]),l("button",{type:"submit",class:"btn btn-primary",disabled:!D.value.trim()||M.value},[t[10]||(t[10]=l("i",{class:"fas fa-reply"},null,-1)),d(" "+c(_(r)("tickets.details.send_reply")),1)],8,L1)])],32)]),H.value.tags&&H.value.tags.length?(g(),o("div",U1,[l("h3",q1,c(_(r)("tickets.details.tags")),1),l("div",V1,[(g(!0),o(h,null,f(H.value.tags,e=>(g(),o("span",{key:e,class:"tag-item"},c(e),1))),128))])])):v("",!0),H.value.internal_notes?(g(),o("div",$1,[l("h3",j1,c(_(r)("tickets.details.internal_notes")),1),l("div",F1,[l("p",null,c(H.value.internal_notes),1)])])):v("",!0),l("div",G1,[l("h3",B1,c(_(r)("tickets.details.history")),1),l("div",H1,[l("div",W1,[t[11]||(t[11]=l("div",{class:"timeline-marker created"},null,-1)),l("div",z1,[l("h4",null,c(_(r)("tickets.history.created")),1),l("p",null,c(Y(H.value.created_at)),1)])]),H.value.updated_at!==H.value.created_at?(g(),o("div",K1,[t[12]||(t[12]=l("div",{class:"timeline-marker updated"},null,-1)),l("div",J1,[l("h4",null,c(_(r)("tickets.history.updated")),1),l("p",null,c(Y(H.value.updated_at)),1)])])):v("",!0),H.value.last_reply?(g(),o("div",Y1,[t[13]||(t[13]=l("div",{class:"timeline-marker replied"},null,-1)),l("div",X1,[l("h4",null,c(_(r)("tickets.history.last_reply")),1),l("p",null,c(Y(H.value.last_reply)),1)])])):v("",!0),"closed"===H.value.status&&H.value.closed_at?(g(),o("div",Q1,[t[14]||(t[14]=l("div",{class:"timeline-marker closed"},null,-1)),l("div",Z1,[l("h4",null,c(_(r)("tickets.history.closed")),1),l("p",null,c(Y(H.value.closed_at)),1)])])):v("",!0)])])])):(g(),o("div",OZ,[t[9]||(t[9]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-exclamation-triangle"})],-1)),l("h3",PZ,c(_(r)("tickets.not_found.title")),1),l("p",NZ,c(_(r)("tickets.not_found.description")),1)]))])}}}),[["__scopeId","data-v-bb0573aa"]]),t0={class:"ticket-departments-view view-container"},s0={class:"header-box"},a0={class:"page-title"},i0={class:"page-description"},n0={key:0,class:"loading-state box"},r0={key:1,class:"empty-state box"},o0={class:"empty-title"},l0={class:"empty-description"},c0={key:2,class:"table-box"},u0={class:"data-table"},d0={class:"actions-cell"},p0=["onClick"],m0=["onClick"],v0={class:"modal-header"},h0={class:"modal-title"},f0={class:"modal-body"},g0={class:"form-group"},y0={class:"form-label required"},b0=["placeholder"],_0={class:"form-group"},k0={class:"form-label"},w0=["placeholder"],S0={class:"form-group"},E0={class:"form-label"},C0=["placeholder"],T0={class:"form-group"},A0={class:"form-label"},I0={class:"toggle-switch"},R0={class:"toggle-text"},x0={class:"modal-footer"},O0=["disabled"],P0={key:0,class:"fas fa-spinner fa-spin"},N0={class:"modal-header"},M0={class:"modal-title"},D0={class:"modal-body"},L0={class:"confirmation-message"},U0={class:"confirmation-warning"},q0={class:"modal-footer"},V0=["disabled"],$0={key:0,class:"fas fa-spinner fa-spin"},j0=Vt(r({__name:"TicketDepartmentsView",setup(t){const{t:s}=b(),a=He(),n=e(!0),r=e(!1),u=e(!1),p=e([]),m=e(!1),E=e(!1),T=e(!1),A=e(null),I=e({id:null,name:"",description:"",email:"",active:!0}),R=async()=>{n.value=!0;try{const e=await _e.routes.admin.ticket.departments.list();ne.debug("Structure de la réponse des départements:",e.data),e.data&&(void 0!==e.data.departments?p.value=e.data.departments||[]:e.data.data&&void 0!==e.data.data.departments?p.value=e.data.data.departments||[]:(ne.error("Format de réponse inattendu pour les départements",{data:e.data}),p.value=[],a.showError(s("tickets.departments.errors.fetch"))))}catch(e){ne.error("Erreur lors du chargement des départements:",{error:e}),a.showError(s("tickets.departments.errors.fetch"))}finally{n.value=!1}},x=()=>{T.value=!1,I.value={id:null,name:"",description:"",email:"",active:!0},m.value=!0},O=()=>{m.value=!1},P=async()=>{var e,t;r.value=!0;try{T.value&&null!==I.value.id?(await _e.routes.admin.ticket.departments.update(I.value.id.toString(),I.value),a.showSuccess(s("tickets.departments.success.updated"))):(await _e.routes.admin.ticket.departments.create(I.value),a.showSuccess(s("tickets.departments.success.created"))),O(),R()}catch(i){const n=(null==(t=null==(e=i.response)?void 0:e.data)?void 0:t.message)||s("tickets.departments.errors.save");a.showError(n),ne.error("[TicketDepartments] Erreur lors de la sauvegarde du département",{error:i.message,department_id:I.value.id})}finally{r.value=!1}},N=async()=>{var e,t;if(A.value){u.value=!0;try{await _e.routes.admin.ticket.departments.delete(A.value.id.toString()),a.showSuccess(s("tickets.departments.success.deleted")),E.value=!1,R()}catch(i){const n=(null==(t=null==(e=i.response)?void 0:e.data)?void 0:t.message)||s("tickets.departments.errors.delete");a.showError(n)}finally{u.value=!1}}},M=e=>{if(!e)return"-";return new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})};return i(()=>{R()}),(e,t)=>{var a;return g(),o("div",t0,[l("div",s0,[l("div",null,[l("h1",a0,c(e.$t("tickets.departments.title")),1),l("span",i0,c(e.$t("tickets.departments.description")),1)]),l("button",{class:"btn btn-gradient",onClick:x},[t[9]||(t[9]=l("i",{class:"fas fa-plus"},null,-1)),d(" "+c(e.$t("tickets.departments.actions.add")),1)])]),n.value?(g(),o("div",n0,[t[10]||(t[10]=l("div",{class:"spinner"},null,-1)),l("p",null,c(_(s)("common.loading")),1)])):0===p.value.length?(g(),o("div",r0,[t[11]||(t[11]=l("div",{class:"empty-icon"},[l("i",{class:"fas fa-sitemap"})],-1)),l("h3",o0,c(_(s)("tickets.departments.empty.title")),1),l("p",l0,c(_(s)("tickets.departments.empty.description")),1)])):(g(),o("div",c0,[l("table",u0,[l("thead",null,[l("tr",null,[t[12]||(t[12]=l("th",null,"ID",-1)),l("th",null,c(_(s)("tickets.departments.table.name")),1),l("th",null,c(_(s)("tickets.departments.table.email")),1),l("th",null,c(_(s)("tickets.departments.table.status")),1),l("th",null,c(_(s)("tickets.departments.table.created_at")),1),l("th",null,c(_(s)("tickets.departments.table.actions")),1)])]),l("tbody",null,[(g(!0),o(h,null,f(p.value,e=>(g(),o("tr",{key:e.id},[l("td",null,"#"+c(e.id),1),l("td",null,c(e.name),1),l("td",null,c(e.email||"-"),1),l("td",null,[l("span",{class:y("status-badge "+(e.active?"status-active":"status-inactive"))},c(e.active?_(s)("common.active"):_(s)("common.inactive")),3)]),l("td",null,c(M(e.created_at)),1),l("td",d0,[l("button",{class:"btn btn-icon btn-sm btn-primary",onClick:t=>(e=>{T.value=!0,I.value={id:e.id,name:e.name,description:e.description||"",email:e.email||"",active:1===e.active||!0===e.active},m.value=!0})(e)},t[13]||(t[13]=[l("i",{class:"fas fa-edit"},null,-1)]),8,p0),l("button",{class:"btn btn-icon btn-sm btn-danger",onClick:t=>(e=>{A.value=e,E.value=!0})(e)},t[14]||(t[14]=[l("i",{class:"fas fa-trash"},null,-1)]),8,m0)])]))),128))])])])),m.value?(g(),o("div",{key:3,class:"modal-overlay",onClick:O},[l("div",{class:"modal-container",onClick:t[4]||(t[4]=k(()=>{},["stop"]))},[l("div",v0,[l("h3",h0,c(T.value?_(s)("tickets.departments.modal.edit_title"):_(s)("tickets.departments.modal.create_title")),1),l("button",{class:"modal-close",onClick:O},t[15]||(t[15]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",f0,[l("form",{onSubmit:k(P,["prevent"])},[l("div",g0,[l("label",y0,c(_(s)("tickets.departments.form.name")),1),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>I.value.name=e),type:"text",class:"form-input",required:"",placeholder:_(s)("tickets.departments.form.name_placeholder")},null,8,b0),[[S,I.value.name]])]),l("div",_0,[l("label",k0,c(_(s)("tickets.departments.form.description")),1),w(l("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>I.value.description=e),class:"form-input",placeholder:_(s)("tickets.departments.form.description_placeholder")},null,8,w0),[[S,I.value.description]])]),l("div",S0,[l("label",E0,c(_(s)("tickets.departments.form.email")),1),w(l("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>I.value.email=e),type:"email",class:"form-input",placeholder:_(s)("tickets.departments.form.email_placeholder")},null,8,C0),[[S,I.value.email]])]),l("div",T0,[l("label",A0,c(_(s)("tickets.departments.form.active")),1),l("div",I0,[w(l("input",{id:"active-toggle","onUpdate:modelValue":t[3]||(t[3]=e=>I.value.active=e),type:"checkbox",class:"toggle-input"},null,512),[[C,I.value.active]]),t[16]||(t[16]=l("label",{for:"active-toggle",class:"toggle-label"},null,-1)),l("span",R0,c(I.value.active?_(s)("common.yes"):_(s)("common.no")),1)])]),l("div",x0,[l("button",{type:"button",class:"btn btn-secondary",onClick:O},c(_(s)("common.cancel")),1),l("button",{type:"submit",class:"btn btn-primary",disabled:r.value},[r.value?(g(),o("i",P0)):v("",!0),d(" "+c(T.value?_(s)("common.update"):_(s)("common.create")),1)],8,O0)])],32)])])])):v("",!0),E.value?(g(),o("div",{key:4,class:"modal-overlay",onClick:t[8]||(t[8]=e=>E.value=!1)},[l("div",{class:"modal-container confirmation-modal",onClick:t[7]||(t[7]=k(()=>{},["stop"]))},[l("div",N0,[l("h3",M0,c(_(s)("tickets.departments.delete.title")),1),l("button",{class:"modal-close",onClick:t[5]||(t[5]=e=>E.value=!1)},t[17]||(t[17]=[l("i",{class:"fas fa-times"},null,-1)]))]),l("div",D0,[l("p",L0,c(_(s)("tickets.departments.delete.message",{name:null==(a=A.value)?void 0:a.name})),1),l("p",U0,c(_(s)("tickets.departments.delete.warning")),1)]),l("div",q0,[l("button",{type:"button",class:"btn btn-secondary",onClick:t[6]||(t[6]=e=>E.value=!1)},c(_(s)("common.cancel")),1),l("button",{type:"button",class:"btn btn-danger",disabled:u.value,onClick:N},[u.value?(g(),o("i",$0)):v("",!0),d(" "+c(_(s)("common.delete")),1)],8,V0)])])])):v("",!0)])}}}),[["__scopeId","data-v-2a95fd9a"]]),F0=q({history:V("/admin"),routes:[{path:"/",redirect:"/dashboard"},{path:"/login",name:"login",component:ks,meta:{public:!0,onlyWhenLoggedOut:!0,requiresAuth:!1}},{path:"/dashboard",name:"dashboard",component:$t,meta:{public:!1,requiresAuth:!0}},{path:"/clients",name:"clients",component:va,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/clients/create",name:"create-client",component:TF,meta:{requiresAuth:!0}},{path:"/clients/:id/edit",name:"edit-client",component:TF,meta:{requiresAuth:!0}},{path:"/clients/:id",name:"client-details",component:rB,meta:{requiresAuth:!0}},{path:"/products",name:"products",component:xi,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/products/create",redirect:"/products/create/type"},{path:"/products/:idOrAction",component:vn,props:e=>({productId:"create"!==e.params.idOrAction?parseInt(e.params.idOrAction):null,productType:e.query.type||"shared_hosting"}),meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1},children:[{path:"",redirect:e=>e.params.idOrAction&&"create"!==e.params.idOrAction&&!isNaN(Number(e.params.idOrAction))?{name:"product-details",params:{idOrAction:e.params.idOrAction}}:{name:"product-type",params:{idOrAction:e.params.idOrAction}}},{path:"details",name:"product-details",component:Er,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"type",name:"product-type",component:wn,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"pricing",name:"product-pricing",component:no,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"module",name:"product-module",component:ul,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"custom-fields",name:"product-custom-fields",component:pc,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"configurable-options",name:"product-configurable-options",component:xu,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"upgrades",name:"product-upgrades",component:dd,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"freedomain",name:"product-freedomain",component:tp,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"cross-sells",name:"product-cross-sells",component:Yp,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"other",name:"product-other",component:zm,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"links",name:"product-links",component:Iv,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}}]},{path:"/invoices",name:"invoices",component:fh,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/invoices/create",name:"create-invoice",component:vz,meta:{requiresAuth:!0}},{path:"/invoices/:id/edit",name:"edit-invoice",component:vz,meta:{requiresAuth:!0}},{path:"/invoices/:id",name:"invoice-details",component:LK,meta:{requiresAuth:!0}},{path:"/payments",name:"payments",component:af,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/payments/create",name:"create-payment",component:zB,meta:{requiresAuth:!0}},{path:"/payments/:id/edit",name:"edit-payment",component:zB,meta:{requiresAuth:!0}},{path:"/payments/:id",name:"payment-details",component:YH,meta:{requiresAuth:!0}},{path:"/subscriptions",name:"subscriptions",component:Kf,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/subscriptions/create",name:"create-subscription",component:rY,meta:{requiresAuth:!0}},{path:"/subscriptions/:id/edit",name:"edit-subscription",component:rY,meta:{requiresAuth:!0}},{path:"/subscriptions/:id",name:"subscription-details",component:qX,meta:{requiresAuth:!0}},{path:"/tickets",name:"tickets",component:ay,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/tickets/create",name:"create-ticket",component:dZ,meta:{requiresAuth:!0}},{path:"/tickets/:id/edit",name:"edit-ticket",component:dZ,meta:{requiresAuth:!0}},{path:"/tickets/:id",name:"ticket-details",component:e0,meta:{requiresAuth:!0}},{path:"/ticket-departments",name:"ticket-departments",component:j0,meta:{requiresAuth:!0}},{path:"/settings",name:"settings",component:by,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/settings/servers",name:"settings-servers",component:R_,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/settings/general",name:"settings-general",component:ck,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/settings/security",name:"settings-security",component:ww,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/settings/notifications",name:"settings-notifications",component:fS,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/settings/billing",name:"settings-billing",component:IE,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/settings/integrations",name:"settings-integrations",component:VC,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/settings/modules",name:"settings-modules",component:_A,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/settings/license",name:"settings-license",component:PT,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/settings/automation",name:"settings-automation",component:zx,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/system/updates",name:"system-updates",component:JM,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/license",name:"invalid-license",component:oD,meta:{public:!0,requiresAuth:!1,onlyWhenLoggedOut:!1}},{path:"/notifications",name:"notifications",component:rL,meta:{public:!1,requiresAuth:!0,onlyWhenLoggedOut:!1}},{path:"/services",name:"services",component:uU,meta:{requiresAuth:!0}},{path:"/services/create",name:"create-service",component:hV,meta:{requiresAuth:!0}},{path:"/services/:id/edit",name:"edit-service",component:hV,meta:{requiresAuth:!0}},{path:"/services/:id",name:"service-details",component:pj,meta:{requiresAuth:!0}},{path:"/:pathMatch(.*)*",name:"not-found",component:yD,meta:{public:!0,requiresAuth:!1,onlyWhenLoggedOut:!1}},{path:"/products/create",redirect:e=>"/products/create"},{path:"/products/:id/edit",redirect:e=>`/products/${e.params.id}`},{path:"/products/details/:type",redirect:e=>"/products/create"},{path:"/products/pricing/:type",redirect:e=>"/products/create/pricing"},{path:"/products/module/:type",redirect:e=>"/products/create/module"},{path:"/products/custom-fields/:type",redirect:e=>"/products/create/custom-fields"},{path:"/products/configurable-options/:type",redirect:e=>"/products/create/configurable-options"},{path:"/products/upgrades/:type",redirect:e=>"/products/create/upgrades"},{path:"/products/freedomain/:type",redirect:e=>"/products/create/freedomain"},{path:"/products/cross-sells/:type",redirect:e=>"/products/create/cross-sells"},{path:"/products/other/:type",redirect:e=>"/products/create/other"},{path:"/products/links/:type",redirect:e=>"/products/create/links"}]});F0.beforeEach(async(e,t,s)=>{const a=G0();if(ne.debug("[ROUTER] Navigation",{from:t.path,to:e.path,name:e.name}),a.initialized||await a.init(),e.meta.requiresAuth&&(ne.debug("[ROUTER] Route protégée, vérification auth",{isAuthenticated:a.isAuthenticated}),!a.isAuthenticated))try{ne.debug("[ROUTER] Vérification de l'authentification avec le serveur");if(!(await a.checkAuth()))return ne.info("[ROUTER] Redirection vers login - Authentification requise"),s({name:"login",query:{redirect:e.fullPath}});ne.debug("[ROUTER] Authentification confirmée par le serveur")}catch(i){return ne.error("[ROUTER] Erreur lors de la vérification de l'authentification",{error:i}),s({name:"login",query:{redirect:e.fullPath}})}return e.meta.onlyWhenLoggedOut&&a.isAuthenticated?(ne.info("[ROUTER] Redirection vers dashboard - Déjà authentifié"),s({name:"dashboard"})):0===e.matched.length?(ne.warn("[ROUTER] Route non trouvée, redirection vers dashboard",{path:e.path}),s({name:"dashboard"})):(ne.debug("[ROUTER] Navigation autorisée vers",{path:e.path}),void s())}),ne.info("[AUTH STORE] Initialisation du store d'authentification");const G0=t("auth",{persist:!0,state:()=>({user:null,loading:!1,error:null,initialized:!1}),getters:{isAuthenticated:e=>!!e.user,userFullName:e=>e.user?`${e.user.firstName} ${e.user.lastName}`:""},actions:{async init(){var e;if(this.initialized)ne.info("[AUTH STORE] Déjà initialisé");else{ne.info("[AUTH STORE] Initialisation...");try{const t=await _e.routes.auth.me();(null==(e=t.data)?void 0:e.user)&&(ne.info("[AUTH STORE] Utilisateur authentifié",{user:t.data.user}),this.user=t.data.user)}catch{ne.info("[AUTH STORE] Non authentifié"),this.user=null}finally{this.initialized=!0}}},async login(e,t,s=!1){var a;ne.info("[AUTH STORE] Tentative de connexion",{email:e});try{this.loading=!0,this.error=null;const s=await _e.routes.auth.login(e,t);if(!(null==(a=s.data)?void 0:a.user))throw new Error("Réponse invalide du serveur");return this.user=s.data.user,F0.push("/dashboard"),!0}catch(i){return ne.error("[AUTH STORE] Erreur de connexion",{error:i}),this.error=i.message,!1}finally{this.loading=!1}},async logout(){if(this.user){ne.info("[AUTH STORE] Déconnexion...");try{await _e.routes.auth.logout()}catch(e){ne.error("[AUTH STORE] Erreur de déconnexion",{error:e})}finally{this.user=null,this.initialized=!1,F0.push("/login")}}else ne.info("[AUTH STORE] Utilisateur déjà déconnecté")},async checkAuth(){var e;ne.info("[AUTH STORE] Vérification de l'authentification...");try{const t=await _e.routes.auth.me();return(null==(e=t.data)?void 0:e.user)?(ne.info("[AUTH STORE] Utilisateur authentifié"),this.user=t.data.user,!0):(ne.info("[AUTH STORE] Utilisateur non authentifié"),!1)}catch(t){return ne.error("[AUTH STORE] Erreur lors de la vérification de l'authentification",{error:t}),this.user=null,!1}},async forgotPassword(e){ne.info("[AUTH STORE] Demande de réinitialisation",{email:e});try{const t=await _e.routes.auth.forgotPassword(e);return ne.info("[AUTH STORE] Email de réinitialisation envoyé"),t.data}catch(t){throw ne.error("[AUTH STORE] Erreur lors de la demande",{error:t}),t}},async resetPassword(e,t){try{return this.loading=!0,this.error=null,await _e.routes.auth.resetPassword(e,t,t),!0}catch(s){return this.error=s.message,!1}finally{this.loading=!1}},async updateLanguage(e){ne.info(`[AUTH STORE] Changement de langue vers: ${e}`);try{this.user&&(this.user={...this.user,language:e})}catch(t){ne.error("[AUTH STORE] Erreur lors du changement de langue",{error:t}),this.error=(null==t?void 0:t.message)||"Erreur lors du changement de langue"}}}}),B0=t("theme",()=>{const t=e("true"===localStorage.getItem("darkMode"));return a(t,e=>{ne.info("[THEME STORE] Application du thème: "+(e?"sombre":"clair")),e?(document.documentElement.classList.add("dark"),document.body.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.body.classList.remove("dark"))},{immediate:!0}),{darkMode:t,toggleDarkMode:()=>{ne.info("[THEME STORE] Basculement du mode sombre"),t.value=!t.value,localStorage.setItem("darkMode",t.value.toString())}}}),H0=t("language",{state:()=>({currentLanguage:localStorage.getItem("language")||"fr"}),actions:{setLanguage(e){return ne.info(`[LANGUAGE STORE] Changement de langue vers: ${e}`),this.currentLanguage=e,localStorage.setItem("language",e),!0}},persist:{key:"language-state",storage:localStorage}});var W0=te();const z0={md5:e=>W0.MD5(e).toString()},K0={class:"top-bar","data-component":"topbar"},J0={class:"top-bar-actions"},Y0={class:"search-bar"},X0=["placeholder"],Q0={class:"current-lang"},Z0={class:"menu-header"},e2={class:"menu-items"},t2={class:"label"},s2={key:0,class:"fas fa-check"},a2={class:"label"},i2={key:0,class:"fas fa-check"},n2=["aria-label"],r2={key:0,class:"badge"},o2={class:"notifications-header"},l2={id:"notification-title"},c2=["aria-label"],u2={class:"notifications-list"},d2={key:0,class:"empty-notifications"},p2={class:"notification-icon"},m2={class:"notification-content"},v2={class:"notification-title"},h2={class:"notification-message"},f2={class:"notification-time"},g2=["onClick"],y2={class:"notifications-footer"},b2=["src"],_2={class:"username"},k2={class:"menu-header"},w2={class:"user-info"},S2=["src"],E2={class:"user-details"},C2={class:"username"},T2={class:"email"},A2={class:"menu-items"},I2=Vt(r({__name:"AppHeader",setup(t){const{locale:a}=b(),r=T(),_=G0(),E=He(),C=B0(),A=H0(),I=e(""),R=e(!1),x=e(!1),O=e(!1),P=e(null),N=e(null),M=e(null),D=s(()=>A.currentLanguage),L=s(()=>C.darkMode),U=s(()=>E.unreadCount),q=s(()=>E.notifications),V=s(()=>{var e;return(null==(e=_.user)?void 0:e.username)||""}),$=s(()=>{var e;return(null==(e=_.user)?void 0:e.email)||""}),j=s(()=>{var e;return`https://www.gravatar.com/avatar/${(null==(e=_.user)?void 0:e.email)?z0.md5(_.user.email.toLowerCase().trim()):""}?s=40&d=identicon`}),F=()=>{},G=()=>{R.value=!R.value,x.value=!1,O.value=!1},B=async e=>{await _.updateLanguage(e),A.setLanguage(e),a.value=e,R.value=!1},H=()=>{C.toggleDarkMode()},W=()=>{x.value=!x.value,R.value=!1,O.value=!1},z=()=>{E.markAllAsRead()},K=()=>{O.value=!O.value,R.value=!1,x.value=!1},J=async()=>{await _.logout(),r.push("/login")},Y=e=>{if(!e)return"";const t="string"==typeof e?new Date(e):e;return se(t,{addSuffix:!0,locale:"fr"===a.value?NE:ae})},X=()=>{x.value=!1},Q=e=>{P.value&&!P.value.contains(e.target)&&(R.value=!1),N.value&&!N.value.contains(e.target)&&(x.value=!1),M.value&&!M.value.contains(e.target)&&(O.value=!1)};return i(()=>{document.addEventListener("click",Q)}),n(()=>{document.removeEventListener("click",Q)}),(e,t)=>{const s=m("router-link");return g(),o("div",K0,[t[16]||(t[16]=l("div",{class:"top-bar-title"},null,-1)),l("div",J0,[l("div",Y0,[t[3]||(t[3]=l("i",{class:"fas fa-search"},null,-1)),w(l("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>I.value=e),type:"text",placeholder:e.$t("common.search"),onInput:F},null,40,X0),[[S,I.value]])]),l("div",{ref_key:"languageDropdown",ref:P,class:"dropdown"},[l("button",{class:"btn-icon dropdown-toggle lang-btn",onClick:G},[l("span",Q0,c(D.value.toUpperCase()),1)]),l("div",{class:y(["dropdown-menu",{show:R.value}])},[l("div",Z0,[l("h3",null,c(e.$t("common.language.select")),1)]),l("div",e2,[l("a",{href:"#",class:y(["menu-item",{active:"fr"===D.value}]),onClick:t[1]||(t[1]=k(e=>B("fr"),["prevent"]))},[t[4]||(t[4]=l("span",{class:"flag"},"🇫🇷",-1)),l("span",t2,c(e.$t("common.language.fr")),1),"fr"===D.value?(g(),o("i",s2)):v("",!0)],2),l("a",{href:"#",class:y(["menu-item",{active:"en"===D.value}]),onClick:t[2]||(t[2]=k(e=>B("en"),["prevent"]))},[t[5]||(t[5]=l("span",{class:"flag"},"🇬🇧",-1)),l("span",a2,c(e.$t("common.language.en")),1),"en"===D.value?(g(),o("i",i2)):v("",!0)],2)])],2)],512),l("button",{class:"btn-icon",onClick:H},[l("i",{class:y(L.value?"fas fa-sun":"fas fa-moon")},null,2)]),l("div",{ref_key:"notificationsDropdown",ref:N,class:"notifications-container"},[l("button",{type:"button",class:"btn-icon notification-btn","aria-label":e.$t("topbar.notifications.toggle"),onClick:W},[t[6]||(t[6]=l("i",{class:"fas fa-bell"},null,-1)),U.value>0?(g(),o("span",r2,c(U.value),1)):v("",!0)],8,n2),l("div",{class:y(["notification-panel",{show:x.value}]),role:"dialog","aria-labelledby":"notification-title"},[l("div",o2,[l("h3",l2,c(e.$t("topbar.notifications.title")),1),l("button",{type:"button",class:"mark-all-read","aria-label":e.$t("topbar.notifications.mark_all_read"),onClick:z},[t[7]||(t[7]=l("i",{class:"fas fa-check-double"},null,-1)),l("span",null,c(e.$t("topbar.notifications.mark_all_read")),1)],8,c2)]),l("div",u2,[0===q.value.length?(g(),o("div",d2,[t[8]||(t[8]=l("i",{class:"fas fa-bell-slash"},null,-1)),l("p",null,c(e.$t("topbar.notifications.empty")),1)])):(g(!0),o(h,{key:1},f(q.value,e=>(g(),o("div",{key:e.id,class:y(["notification-item",{unread:!e.read}])},[l("div",p2,[l("i",{class:y(e.icon)},null,2)]),l("div",m2,[l("div",v2,c(e.title),1),l("div",h2,c(e.message),1),l("div",f2,c(Y(e.time)),1)]),e.read?v("",!0):(g(),o("button",{key:0,class:"notification-action",onClick:t=>{return s=e.id,void E.markAsRead(s);var s}},t[9]||(t[9]=[l("i",{class:"fas fa-check"},null,-1)]),8,g2))],2))),128))]),l("div",y2,[u(s,{to:"/notifications",onClick:X},{default:p(()=>[d(c(e.$t("topbar.notifications.view_all"))+" ",1),t[10]||(t[10]=l("i",{class:"fas fa-arrow-right"},null,-1))]),_:1,__:[10]})])],2)],512),l("div",{ref_key:"profileDropdown",ref:M,class:"profile-container"},[l("button",{class:"profile-btn",onClick:K},[l("img",{src:j.value,alt:"Avatar",class:"avatar"},null,8,b2),l("span",_2,c(V.value),1),t[11]||(t[11]=l("i",{class:"fas fa-chevron-down"},null,-1))]),l("div",{class:y(["profile-menu",{show:O.value}])},[l("div",k2,[l("div",w2,[l("img",{src:j.value,alt:"Avatar",class:"avatar"},null,8,S2),l("div",E2,[l("div",C2,c(V.value),1),l("div",T2,c($.value),1)])])]),l("div",A2,[u(s,{to:"/profile",class:"menu-item"},{default:p(()=>[t[12]||(t[12]=l("i",{class:"fas fa-user"},null,-1)),l("span",null,c(e.$t("topbar.profile.my_profile")),1)]),_:1,__:[12]}),u(s,{to:"/settings",class:"menu-item"},{default:p(()=>[t[13]||(t[13]=l("i",{class:"fas fa-cog"},null,-1)),l("span",null,c(e.$t("topbar.profile.settings")),1)]),_:1,__:[13]}),t[15]||(t[15]=l("div",{class:"menu-divider"},null,-1)),l("a",{href:"#",class:"menu-item text-red-600",onClick:k(J,["prevent"])},[t[14]||(t[14]=l("i",{class:"fas fa-sign-out-alt"},null,-1)),l("span",null,c(e.$t("topbar.profile.logout")),1)])])],2)],512)])])}}}),[["__scopeId","data-v-040314f8"]]),R2={class:"sidebar-header"},x2={class:"sidebar-nav"},O2={key:0,class:"badge"},P2=r({__name:"AppSidebar",setup(t){const a=I(),n=He(),r=e([]),d=s(()=>n.unreadCount),h=e=>{const t=r.value.indexOf(e);r.value=-1===t?[e]:[],ne.debug("État des sous-menus après toggle",{submenus:r.value})};i(()=>{var e;ne.debug("Route actuelle",{route:a.name});const t=(null==(e=a.name)?void 0:e.toString())||"";let s="";"products"===t?s="catalogue":"invoices"===t||"payments"===t||"subscriptions"===t?s="billing":"tickets"!==t&&"kb"!==t||(s="support"),s&&!r.value.includes(s)&&r.value.push(s),document.addEventListener("click",w)}),x(()=>{document.removeEventListener("click",w)});const f=e(!1),b=()=>{f.value=!f.value,document.body.classList.toggle("sidebar-collapsed")},w=e=>{if(document.body.classList.contains("sidebar-open")&&window.innerWidth<=768){const t=document.querySelector(".sidebar"),s=document.querySelector(".sidebar-toggle"),a=e.target;t&&!t.contains(a)&&s&&!s.contains(a)&&document.body.classList.remove("sidebar-open")}};return(e,t)=>{const s=m("router-link");return g(),o("aside",{class:y(["sidebar",{"sidebar-collapsed":f.value}]),"data-component":"sidebar"},[l("div",R2,[u(s,{to:"/dashboard",class:"logo"},{default:p(()=>t[3]||(t[3]=[l("img",{src:"/admin/dist/assets/logo-Bg22NIcH.png",alt:"TechCMS"},null,-1)])),_:1,__:[3]}),l("button",{class:"sidebar-toggle",onClick:b},t[4]||(t[4]=[l("i",{class:"fas fa-bars"},null,-1)]))]),l("nav",x2,[l("ul",null,[l("li",{class:y({active:"dashboard"===_(a).name})},[u(s,{to:"/dashboard"},{default:p(()=>[t[5]||(t[5]=l("i",{class:"fas fa-home"},null,-1)),l("span",null,c(e.$t("sidebar.menu.dashboard")),1)]),_:1,__:[5]})],2),l("li",{class:y({active:"clients"===_(a).name})},[u(s,{to:"/clients"},{default:p(()=>[t[6]||(t[6]=l("i",{class:"fas fa-users"},null,-1)),l("span",null,c(e.$t("sidebar.menu.clients")),1)]),_:1,__:[6]})],2),l("li",{class:y({active:_(a).name&&_(a).name.toString().includes("service")})},[u(s,{to:"/services"},{default:p(()=>[t[7]||(t[7]=l("i",{class:"fas fa-server"},null,-1)),l("span",null,c(e.$t("sidebar.menu.services")),1)]),_:1,__:[7]})],2),l("li",{class:y(["has-submenu",{"submenu-open":r.value.includes("catalogue")}])},[l("a",{href:"#",class:y(["menu-toggle",{active:"products"===_(a).name}]),onClick:t[0]||(t[0]=k(e=>h("catalogue"),["prevent"]))},[t[8]||(t[8]=l("i",{class:"fas fa-cube"},null,-1)),l("span",null,c(e.$t("sidebar.menu.catalog.title")),1),t[9]||(t[9]=l("i",{class:"fas fa-chevron-right menu-arrow"},null,-1))],2),l("ul",{class:y(["submenu",{show:r.value.includes("catalogue")}])},[l("li",{class:y({active:"products"===_(a).name})},[u(s,{to:"/products"},{default:p(()=>[t[10]||(t[10]=l("i",{class:"fas fa-cogs"},null,-1)),l("span",null,c(e.$t("sidebar.menu.catalog.products_services")),1)]),_:1,__:[10]})],2)],2)],2),l("li",{class:y(["has-submenu",{"submenu-open":r.value.includes("billing")}])},[l("a",{href:"#",class:y(["menu-toggle",{active:"invoices"===_(a).name||"payments"===_(a).name||"subscriptions"===_(a).name}]),onClick:t[1]||(t[1]=k(e=>h("billing"),["prevent"]))},[t[11]||(t[11]=l("i",{class:"fas fa-file-invoice-dollar"},null,-1)),l("span",null,c(e.$t("sidebar.menu.billing.title")),1),t[12]||(t[12]=l("i",{class:"fas fa-chevron-right menu-arrow"},null,-1))],2),l("ul",{class:y(["submenu",{show:r.value.includes("billing")}])},[l("li",{class:y({active:"invoices"===_(a).name})},[u(s,{to:"/invoices"},{default:p(()=>[t[13]||(t[13]=l("i",{class:"fas fa-file-invoice"},null,-1)),l("span",null,c(e.$t("sidebar.menu.billing.invoices")),1)]),_:1,__:[13]})],2),l("li",{class:y({active:"payments"===_(a).name})},[u(s,{to:"/payments"},{default:p(()=>[t[14]||(t[14]=l("i",{class:"fas fa-credit-card"},null,-1)),l("span",null,c(e.$t("sidebar.menu.billing.payments")),1)]),_:1,__:[14]})],2),l("li",{class:y({active:"subscriptions"===_(a).name})},[u(s,{to:"/subscriptions"},{default:p(()=>[t[15]||(t[15]=l("i",{class:"fas fa-sync"},null,-1)),l("span",null,c(e.$t("sidebar.menu.billing.subscriptions")),1)]),_:1,__:[15]})],2)],2)],2),l("li",{class:y(["has-submenu",{"submenu-open":r.value.includes("support")}])},[l("a",{href:"#",class:y(["menu-toggle",{active:"tickets"===_(a).name||"kb"===_(a).name}]),onClick:t[2]||(t[2]=k(e=>h("support"),["prevent"]))},[t[16]||(t[16]=l("i",{class:"fas fa-headset"},null,-1)),l("span",null,c(e.$t("sidebar.menu.support.title")),1),d.value>0?(g(),o("span",O2,c(d.value),1)):v("",!0),t[17]||(t[17]=l("i",{class:"fas fa-chevron-right menu-arrow"},null,-1))],2),l("ul",{class:y(["submenu",{show:r.value.includes("support")}])},[l("li",{class:y({active:"tickets"===_(a).name})},[u(s,{to:"/tickets"},{default:p(()=>[t[18]||(t[18]=l("i",{class:"fas fa-ticket-alt"},null,-1)),l("span",null,c(e.$t("sidebar.menu.support.tickets")),1)]),_:1,__:[18]})],2),l("li",{class:y({active:"kb"===_(a).name})},[u(s,{to:"/kb"},{default:p(()=>[t[19]||(t[19]=l("i",{class:"fas fa-book"},null,-1)),l("span",null,c(e.$t("sidebar.menu.support.kb")),1)]),_:1,__:[19]})],2)],2)],2),l("li",{class:y({active:"system-updates"===_(a).name})},[u(s,{to:"/system/updates"},{default:p(()=>[t[20]||(t[20]=l("i",{class:"fas fa-download"},null,-1)),l("span",null,c(e.$t("sidebar.menu.system_updates")),1)]),_:1,__:[20]})],2),l("li",{class:y({active:"settings"===_(a).name})},[u(s,{to:"/settings"},{default:p(()=>[t[21]||(t[21]=l("i",{class:"fas fa-cog"},null,-1)),l("span",null,c(e.$t("sidebar.menu.settings")),1)]),_:1,__:[21]})],2)])])],2)}}}),N2={class:"app-container"},M2={class:"app-content"},D2={key:1},L2=Vt(r({__name:"AppLayout",setup(t){const a=I(),i=B0(),n=s(()=>a.meta.public),r=s(()=>i.darkMode),c=e(!1),d=()=>{c.value=!c.value};return(e,t)=>n.value?(g(),o("div",D2,[$(e.$slots,"default",{},void 0)])):(g(),o("div",{key:0,class:y(["app-layout",{dark:r.value,"sidebar-collapsed-layout":c.value}])},[l("header",null,[u(I2)]),l("div",N2,[u(P2,{collapsed:c.value,onSidebarToggle:d},null,8,["collapsed"]),l("main",M2,[$(e.$slots,"default",{},void 0)])])],2))}}),[["__scopeId","data-v-48450974"]]),U2={class:"notifications-wrapper"},q2={class:"fixed-notifications"},V2={class:"notification-content"},$2={class:"notification-icon"},j2={class:"notification-text"},F2={class:"notification-title"},G2={class:"notification-message"},B2=["onClick"],H2=Vt({__name:"NotificationsContainer",setup(e){const t=He();i(()=>{});const s=e=>{switch(e){case"success":return"success-toast";case"error":return"error-toast";case"warning":return"warning-toast";default:return"info-toast"}},a=e=>{switch(e){case"success":return"fas fa-check-circle";case"error":return"fas fa-exclamation-circle";case"warning":return"fas fa-exclamation-triangle";default:return"fas fa-info-circle"}};return(e,i)=>(g(),o("div",U2,[l("div",q2,[(g(!0),o(h,null,f(_(t).activeToasts,e=>(g(),o("div",{key:e.id,class:y(["notification-toast",[s(e.type),{closing:e.closing}]])},[l("div",V2,[l("div",$2,[l("i",{class:y(a(e.type))},null,2)]),l("div",j2,[l("div",F2,c(e.title),1),l("div",G2,c(e.message),1)]),l("button",{class:"notification-close",onClick:s=>{return a=e.id,void t.removeToast(a);var a}},i[0]||(i[0]=[l("i",{class:"fas fa-times"},null,-1)]),8,B2)])],2))),128))])]))}},[["__scopeId","data-v-e8bc1fda"]]),W2={key:0,class:"realtime-error-banner"},z2={class:"realtime-error-content"},K2=r({__name:"App",setup(e){const t=G0(),n=B0(),r=Be(),d=s(()=>n.darkMode),h=s(()=>r.hasError&&t.isAuthenticated);i(async()=>{ne.info("TechCMS Admin - Initialisation..."),await t.init(),t.isAuthenticated&&(ne.info("TechCMS Admin - Initialisation du temps réel..."),f())}),a(()=>t.isAuthenticated,e=>{e?(ne.info("TechCMS Admin - Utilisateur authentifié, initialisation du temps réel..."),f()):(ne.info("TechCMS Admin - Utilisateur déconnecté, déconnexion du temps réel..."),r.disconnect())});const f=async()=>{try{await r.init()}catch(e){ne.error("TechCMS Admin - Erreur d'initialisation du temps réel:",{error:e})}},b=async()=>{ne.info("TechCMS Admin - Tentative de reconnexion au service temps réel..."),await r.retry()};return(e,t)=>{const s=m("router-view");return g(),o("div",{id:"app",class:y(["tech-cms-app",{dark:d.value}])},[u(L2,null,{default:p(()=>[u(s,null,{default:p(({Component:e})=>[u(j,{name:"fade",mode:"out-in"},{default:p(()=>[(g(),R(F(e)))]),_:2},1024)]),_:1})]),_:1}),u(H2),h.value?(g(),o("div",W2,[l("div",z2,[l("span",null,c(e.$t("errors.realtime_connection")),1),l("button",{class:"retry-button",onClick:b},c(e.$t("common.retry")),1)])])):v("",!0)],2)}}}),J2={common:{select:"Sélectionner",search:"Rechercher",view_all:"Voir tout",client:"Client",email:"Email",status:"Statut",date:"Date",back:"Retour",success:"Succès",error:"Erreur",loading:"Chargement...",save:"Enregistrer",cancel:"Annuler",delete:"Supprimer",edit:"Modifier",add:"Ajouter",create:"Créer",update:"Mettre à jour",confirm:"Confirmer",yes:"Oui",no:"Non",name:"Nom",description:"Description",price:"Prix",actions:"Actions",retry:"Réessayer",configure:"Configurer",errorLoading:"Erreur lors du chargement",close:"Fermer",noData:"Aucune donnée disponible",active:"Actif",inactive:"Inactif",online:"En ligne",offline:"Hors ligne",minutes:"minutes",minute:"minute",hour:"heure",hours:"heures",day:"jour",days:"jours",confirmDelete:"Confirmer la suppression",activate:"Activer",deactivate:"Désactiver",never:"Jamais",saving:"Sauvegarde...",error_occurred:"Une erreur s'est produite",language:{select:"Choisir la langue",fr:"Français",en:"English"},simple:"Simple",advanced:"Avancé"},notFound:{title:"404 - Page Non Trouvée",description:"La page que vous recherchez n'existe pas ou a été déplacée.",whatHappened:"Que s'est-il passé ?",urlNotFound:"L'URL que vous avez saisie n'a pas été trouvée sur ce serveur.",suggestions:"Suggestions :",checkUrl:"Vérifiez que l'URL est correctement saisie",goBack:"Retournez à la page précédente",goToDashboard:"Accédez au tableau de bord",backButton:"Retour",dashboardButton:"Tableau de bord"},dashboard:{title:"Tableau de bord",subtitle:"Vue d'ensemble de votre activité",refresh:"Actualiser",viewMore:"Voir plus",stats:{active_clients:"Clients actifs",active_services:"Services actifs",active_tickets:"Tickets actifs",monthly_revenue:"Revenus mensuels"},recent_clients:{title:"Clients récents"},recent_tickets:{title:"Tickets récents"},chart:{today:"Aujourd'hui",week:"7 Jours",month:"30 Jours",year:"Cette année",revenue:"Revenus",evolution:"Évolution des revenus"}},login:{title:"Connexion",email:"Adresse email",password:"Mot de passe",rememberMe:"Se souvenir de moi",forgotPassword:"Mot de passe oublié ?",signIn:"Se connecter",errorFields:"Veuillez remplir tous les champs",resetTitle:"Réinitialiser le mot de passe",resetDescription:"Entrez votre adresse email pour recevoir un lien de réinitialisation",sendReset:"Envoyer le lien",copyright:"© {year} TechCMS. Tous droits réservés."},clients:{title:"Clients",description:"Gérer les clients et leurs informations",add_new:"Nouveau client",confirm_delete:"Êtes-vous sûr de vouloir supprimer ce client ?",filters:{search:"Rechercher",search_placeholder:"Rechercher par nom, email, entreprise...",status:"Statut",service_type:"Type de service"},table:{client:"Client",company:"Entreprise",name:"Nom",email:"Email",phone:"Téléphone",services:"Services",status:"Statut",created:"Créé le",actions:"Actions"},status:{all:"Tous les statuts",active:"Actif",inactive:"Inactif",suspended:"Suspendu",pending:"En attente"},services:{all:"Tous les types",hosting:"Hébergement",domain:"Domaine",ssl:"SSL"},no_services:"Aucun service",actions:{view:"Voir",edit:"Modifier",delete:"Supprimer"},add:{title:"Nouveau client",description:"Créer un nouveau compte client"},edit:{title:"Modifier le client",description:"Modifier les informations du client"},details:{title:"Détails du client",description:"Informations détaillées du client",error_loading:"Erreur lors du chargement des détails du client",personal_info:"Informations personnelles",contact_info:"Informations de contact",billing_info:"Informations de facturation",services_info:"Services",notes_info:"Notes",activity_info:"Activité récente",no_services:"Aucun service actif",no_notes:"Aucune note",no_activity:"Aucune activité récente",delete_confirm:"Êtes-vous sûr de vouloir supprimer ce client ?",delete_warning:"Cette action est irréversible et supprimera toutes les données associées."},form:{personal_info:"Informations personnelles",contact_info:"Informations de contact",billing_info:"Informations de facturation",account_info:"Informations du compte",address_title:"Adresse",firstname:"Prénom",firstname_placeholder:"Entrez le prénom",lastname:"Nom",lastname_placeholder:"Entrez le nom de famille",email:"Email",email_placeholder:"Entrez l'email",phone:"Téléphone",phone_placeholder:"+33 1 23 45 67 89",company:"Entreprise",company_placeholder:"Nom de l'entreprise (optionnel)",address:"Adresse",address_placeholder:"123 Rue de la Paix",city:"Ville",city_placeholder:"Paris",state:"État/Province",postal_code:"Code postal",postal_code_placeholder:"75001",postcode:"Code postal",country:"Pays",country_placeholder:"France",password:"Mot de passe",password_placeholder:"Mot de passe sécurisé",password_optional:"(optionnel)",password_leave_empty:"Laissez vide pour ne pas modifier",confirm_password:"Confirmer le mot de passe",status:"Statut",notes:"Notes",firstname_required:"Le prénom est requis",lastname_required:"Le nom est requis",email_required:"L'email est requis",email_invalid:"Format d'email invalide",phone_required:"Le téléphone est requis",password_required:"Le mot de passe est requis",password_min:"Le mot de passe doit contenir au moins 8 caractères",password_mismatch:"Les mots de passe ne correspondent pas",country_required:"Le pays est requis",save:"Enregistrer",saving:"Enregistrement...",saved_successfully:"Client sauvegardé avec succès",save_error:"Erreur lors de la sauvegarde du client"},empty:{title:"Aucun client trouvé",description:"Aucun client ne correspond aux critères de recherche"}},products_services:JSON.parse('{"title":"Produits & Services","description":"Gérer les produits et services disponibles","add_new":"Nouveau produit","create_title":"Créer un nouveau produit","type_selection_help":"Sélectionnez le type de produit que vous souhaitez créer. Chaque type a ses propres options de configuration.","confirm_delete":"Êtes-vous sûr de vouloir supprimer ce produit ?","filters":{"search":"Rechercher","type":"Type","status":"Statut","group":"Groupe","price_range":"Gamme de prix","all_types":"Tous les types","all_prices":"Tous les prix","price_low":"0€ - 50€","price_medium":"50€ - 200€","price_high":"200€ - 1000€"},"types":{"reseller":"Hébergement revendeur","dedicated":"Serveur dédié","vps":"VPS","shared":"Hébergement partagé"},"types_descriptions":{"shared_hosting":"Hébergement abordable et simple d\'utilisation pour les petits sites web.","reseller_hosting":"Hébergez vos propres clients avec nos plans revendeur.","server_vps":"Un serveur privé virtuel pour plus de puissance et de flexibilité.","domain":"Enregistrez ou transférez votre nom de domaine.","other":"Autres types de produits et services."},"table":{"name":"Nom","type":"Type","price":"Prix","status":"Statut","clients":"Clients","actions":"Actions"},"status":{"all":"Tous","active":"Actif","inactive":"Inactif","maintenance":"Maintenance"},"errors":{"fetch":"Erreur lors de la récupération des produits","delete":"Erreur lors de la suppression du produit","load_failed":"Échec du chargement des produits","modules_load":"Erreur lors du chargement des modules de serveurs","type_required":"Veuillez sélectionner un type de produit","save_failed":"Erreur lors de la sauvegarde","name_required":"Le nom du produit est requis"},"error_loading_data":"Erreur lors du chargement des données","error_saving_data":"Erreur lors de la sauvegarde des données","no_products_found":"Aucun produit trouvé","try_different_filter":"Essayez un filtre différent","module":{"configuration":"Configuration du module","loading_config":"Chargement de la configuration...","select_plan":"Plan/Template","select_plan_option":"Sélectionnez un plan","operating_system":"Système d\'exploitation","select_os":"Sélectionnez un OS","no_config_available":"Aucune configuration spécifique disponible pour ce module","disk_space":"Espace disque","disk_space_hint":"En MB (0 pour illimité)","bandwidth":"Bande passante","bandwidth_hint":"En MB (0 pour illimité)","allow_subdomains":"Autoriser les sous-domaines","allow_php":"Autoriser PHP","max_email_accounts":"Comptes email maximum","max_databases":"Bases de données maximum","module_required":"Un module doit être sélectionné","provision_option_required":"Une option de provisionnement doit être sélectionnée","server_group_required":"Un groupe de serveurs doit être sélectionné","saved_successfully":"Configuration du module sauvegardée avec succès","cpanel_description":"Module de provisionnement pour cPanel/WHM","plesk_description":"Module de provisionnement pour Plesk","directadmin_description":"Module de provisionnement pour DirectAdmin","proxmox_description":"Module de provisionnement pour Proxmox VE","solusvm_description":"Module de provisionnement pour SolusVM","tab_general":"Général","tab_features":"Fonctionnalités","tab_limits":"Limites","description":"Configurez le module de provisionnement pour ce produit","select_module":"Sélectionner un module","select_module_placeholder":"Choisissez un module de provisionnement","provision_options":"Options de provisionnement","server_group":"Groupe de serveurs","select_server_group":"Sélectionner un groupe de serveurs","select_server":"Sélectionner un serveur","select_server_is_required":"La sélection d\'un serveur est requise.","automation":"Automatisation","auto_setup_on_order":"Configuration automatique à la commande","auto_setup_on_payment":"Configuration automatique au paiement","auto_setup_on_pending":"Configuration automatique en attente","no_auto_setup":"Pas de configuration automatique","welcome_email":"Email de bienvenue","select_welcome_email":"Sélectionner un template d\'email","custom_module":"Module personnalisé","custom_description":"Configuration personnalisée du module","provision_settings":"Paramètres de provisionnement","auto_provision":"Provisionnement automatique","auto_provision_description":"Provisionner automatiquement le service lors de la commande","manual_provision":"Provisionnement manuel","manual_provision_description":"Provisionner manuellement le service après la commande"},"modules":{"provisioning_options":"Options de provisionnement"},"tabs":{"type":"Type","details":"Détails","pricing":"Tarification","module":"Module","custom_fields":"Champs personnalisés","configurable_options":"Options configurables","upgrades":"Mises à niveau","freedomain":"Domaine gratuit","cross_sells":"Ventes croisées","other":"Autres options","links":"Liens utiles"},"all_categories":"Toutes les catégories","upgrades":{"description":"Configurez les mises à niveau disponibles pour ce produit","select_products":"Sélectionner les produits","no_products_selected":"Aucun produit sélectionné","select_products_description":"Sélectionnez les produits vers lesquels les clients peuvent effectuer une mise à niveau"},"details":{"description":"Description","basic_info":"Informations de base","name":"Nom du produit","name_placeholder":"Entrez le nom du produit","name_required":"Le nom du produit est requis","slug":"Slug (URL)","slug_placeholder":"slug-du-produit","slug_hint":"Utilisé dans l\'URL du produit. Laissez vide pour générer automatiquement.","category":"Catégorie","select_category":"Sélectionnez une catégorie","category_required":"La catégorie est requise","description_placeholder":"Description détaillée du produit","short_description":"Description courte","short_description_placeholder":"Résumé du produit","display_options":"Options d\'affichage","welcome_email":"Email de bienvenue","select_welcome_email":"Sélectionnez un email","color":"Couleur","image":"Image du produit","remove_image":"Supprimer l\'image","hidden":"Produit masqué","hidden_hint":"Le produit ne sera pas visible dans la boutique","featured":"Produit mis en avant","featured_hint":"Le produit sera affiché en priorité","additional_info":"Informations supplémentaires","tag_line":"Slogan","tag_line_placeholder":"Slogan accrocheur","order_link":"Lien de commande personnalisé","order_link_placeholder":"https://example.com/order","order_link_hint":"Lien externe pour commander ce produit","saved_successfully":"Détails du produit sauvegardés avec succès"},"columns":{"name":"Nom","description":"Description","type":"Type","price":"Prix","status":"Statut","group":"Groupe","clients":"Clients"},"groups":{"all":"Tous les groupes","none":"Aucun groupe"},"actions":{"edit":"Modifier","delete":"Supprimer"},"empty":{"title":"Aucun produit trouvé","description":"Aucun produit ne correspond aux critères de recherche"},"product_created_successfully":"Produit créé avec succès","product_updated_successfully":"Produit mis à jour avec succès","search":"Rechercher un produit...","add":"Nouveau produit","pricing":{"description":"Configurez les prix et options de facturation de votre produit","setup_fee":"Frais d\'installation","setup_fee_hint":"Frais unique facturé lors de la première commande","base_price":"Prix de base","base_price_hint":"Prix principal du produit","recurring_options":"Options de facturation récurrente","recurring_pricing":"Facturation récurrente","monthly":"Mensuel","quarterly":"Trimestriel","semiannually":"Semestriel","annually":"Annuel","biennially":"Bisannuel","triennially":"Trisannuel","default_cycle":"Cycle de facturation par défaut","allow_cycle_change":"Autoriser le changement de cycle","allow_cycle_change_hint":"Permettre aux clients de changer leur cycle de facturation","tax_options":"Options de taxation","tax_included":"Taxes incluses","tax_included_hint":"Les prix affichés incluent les taxes","tax_exempt":"Exonéré de taxes","tax_exempt_hint":"Ce produit est exonéré de taxes","price_not_negative":"Les prix ne peuvent pas être négatifs","saved_successfully":"Tarification sauvegardée avec succès"},"custom_fields":{"description":"Configurez les champs personnalisés pour ce produit","add_field":"Ajouter un champ","field_name":"Nom du champ","field_name_placeholder":"Nom du champ personnalisé","field_type":"Type de champ","field_description":"Description","field_description_placeholder":"Description du champ","required":"Requis","admin_only":"Admin uniquement","show_on_order":"Afficher à la commande","show_on_invoice":"Afficher sur la facture","field_types":{"text":"Texte","password":"Mot de passe","dropdown":"Liste déroulante","textarea":"Zone de texte","checkbox":"Case à cocher","radio":"Bouton radio"},"options":"Options","options_placeholder":"Option 1|Option 2|Option 3","options_hint":"Séparez les options par |","validation":"Validation","regex_pattern":"Pattern regex","error_message":"Message d\'erreur","saved_successfully":"Champs personnalisés sauvegardés avec succès","no_fields":"Aucun champ personnalisé","no_fields_description":"Aucun champ personnalisé n\'a été configuré pour ce produit"},"configurable_options":{"description":"Configurez les options configurables pour ce produit","add_option":"Ajouter une option","option_name":"Nom de l\'option","option_name_placeholder":"Nom de l\'option configurable","option_type":"Type d\'option","option_description":"Description","option_description_placeholder":"Description de l\'option","option_types":{"dropdown":"Liste déroulante","radio":"Bouton radio","checkbox":"Cases à cocher","quantity":"Quantité","slider":"Curseur"},"sub_options":"Sous-options","add_sub_option":"Ajouter une sous-option","sub_option_name":"Nom","sub_option_price":"Prix","sub_option_setup_fee":"Frais d\'installation","monthly_price":"Prix mensuel","quarterly_price":"Prix trimestriel","semiannual_price":"Prix semestriel","annual_price":"Prix annuel","min_quantity":"Quantité minimum","max_quantity":"Quantité maximum","saved_successfully":"Options configurables sauvegardées avec succès","no_options":"Aucune option configurable","no_options_description":"Aucune option configurable n\'a été configurée pour ce produit"},"freedomain":{"description":"Configurez les options de domaine gratuit pour ce produit","enable_freedomain":"Activer le domaine gratuit","enable_freedomain_hint":"Offrir un domaine gratuit avec ce produit","domain_types":"Types de domaines","register_domain":"Enregistrer un nouveau domaine","transfer_domain":"Transférer un domaine existant","subdomain":"Sous-domaine","allowed_tlds":"Extensions autorisées","allowed_tlds_placeholder":".com,.net,.org","allowed_tlds_hint":"Extensions de domaine autorisées, séparées par des virgules","subdomain_options":"Options de sous-domaine","subdomain_prefix":"Préfixe du sous-domaine","subdomain_prefix_placeholder":"client","subdomain_domain":"Domaine principal","subdomain_domain_placeholder":"mondomaine.com","saved_successfully":"Options de domaine gratuit sauvegardées avec succès"},"cross_sells":{"description":"Configurez les produits de vente croisée pour ce produit","add_product":"Ajouter un produit","search_products":"Rechercher des produits","selected_products":"Produits sélectionnés","no_products_selected":"Aucun produit sélectionné","product_name":"Nom du produit","product_price":"Prix","remove_product":"Retirer le produit","saved_successfully":"Ventes croisées sauvegardées avec succès","tab_cross_sells":"Ventes croisées","tab_related":"Produits liés","no_related":"Aucun produit lié","no_related_description":"Aucun produit lié n\'a été configuré pour ce produit","no_cross_sells":"Aucune vente croisée","no_cross_sells_description":"Aucune vente croisée n\'a été configurée pour ce produit","available_products":"Produits disponibles"},"other":{"description":"Configurez les autres options pour ce produit","configuration_title":"Configuration","require_domain":"Domaine requis","require_domain_help":"Un domaine est requis pour commander ce produit","auto_setup":"Configuration automatique","auto_setup_help":"Configurer automatiquement le service après la commande","stock_control":"Contrôle du stock","enable_stock_control":"Activer le contrôle du stock","stock_quantity":"Quantité en stock","stock_quantity_hint":"Nombre d\'unités disponibles","low_stock_threshold":"Seuil de stock faible","low_stock_threshold_hint":"Alerte quand le stock atteint ce niveau","stock_control_help":"Gérer le stock disponible pour ce produit","auto_provisioning":"Provisionnement automatique","enable_auto_provisioning":"Activer le provisionnement automatique","provisioning_delay":"Délai de provisionnement","provisioning_delay_hint":"Délai en minutes avant le provisionnement","retirement_options":"Options de retrait","retirement_date":"Date de retrait","retirement_date_hint":"Date à partir de laquelle le produit ne sera plus disponible","replacement_product":"Produit de remplacement","select_replacement":"Sélectionner un produit de remplacement","hidden":"Produit masqué","hidden_help":"Masquer ce produit dans la boutique","welcome_email":"Email de bienvenue","welcome_email_none":"Aucun email","welcome_email_help":"Email envoyé après l\'activation du service","notes":"Notes","notes_placeholder":"Notes sur le produit...","notes_help":"Notes internes sur ce produit","saved_successfully":"Autres options sauvegardées avec succès"},"links":{"description":"Configurez les liens utiles pour ce produit","add_link":"Ajouter un lien","link_title":"Titre du lien","link_title_placeholder":"Documentation","link_url":"URL du lien","link_url_placeholder":"https://example.com/docs","link_description":"Description","link_description_placeholder":"Description du lien","link_target":"Cible du lien","target_self":"Même fenêtre","target_blank":"Nouvelle fenêtre","link_icon":"Icône","link_icon_placeholder":"fas fa-book","remove_link":"Supprimer le lien","saved_successfully":"Liens utiles sauvegardés avec succès","direct_links_title":"Liens directs","direct_cart_link":"Lien panier direct","direct_cart_link_placeholder":"ex: https://votreboutique.com/cart.php?a=add&pid=1","direct_cart_link_template":"Template de lien panier","direct_cart_link_template_placeholder":"ex: cart.php?a=add&pid={PRODUCT_ID}","direct_cart_link_domain":"Domaine de lien panier","direct_cart_link_domain_placeholder":"ex: votreboutique.com","group_cart_link":"Lien panier de groupe","group_cart_link_placeholder":"ex: https://votreboutique.com/cart.php?gid=1","product_links_title":"Liens du produit","url":"URL","url_placeholder":"ex: https://example.com/produit/docs","visits":"Visites","actions":"Actions"}}'),product_groups:{add:"Nouveau groupe",success:{create:"Groupe créé avec succès",update:"Groupe mis à jour avec succès",delete:"Groupe supprimé avec succès"},errors:{create:"Erreur lors de la création du groupe",update:"Erreur lors de la mise à jour du groupe",delete:"Erreur lors de la suppression du groupe"},confirm_delete:"Êtes-vous sûr de vouloir supprimer ce groupe ?"},services:{title:"Services",description:"Gérer les services clients",add_new:"Nouveau service",table:{client:"Client",product:"Produit",domain:"Domaine",status:"Statut",next_due_date:"Prochaine échéance",recurring_amount:"Montant récurrent",actions:"Actions"},status:{all:"Tous les statuts",pending:"En attente",active:"Actif",suspended:"Suspendu",cancelled:"Annulé",terminated:"Terminé",fraud:"Fraude"},actions:{view:"Voir",edit:"Modifier",delete:"Supprimer",activate:"Activer",suspend:"Suspendre",cancel:"Annuler",terminate:"Terminer"},create:{title:"Nouveau service",description:"Créer un nouveau service client"},edit:{title:"Modifier le service",description:"Modifier les informations du service"},details:{title:"Détails du service",description:"Informations détaillées du service",unknown_product:"Produit inconnu",client:"Client",client_name:"Nom du client",client_email:"Email du client",unknown:"Inconnu",view_client:"Voir le client",product:"Produit",product_name:"Nom du produit",view_product:"Voir le produit",server:"Serveur",server_name:"Nom du serveur",view_server:"Voir le serveur",no_server:"Aucun serveur assigné",billing:"Facturation",billing_cycle:"Cycle de facturation",next_due_date:"Prochaine échéance",not_set:"Non défini",recurring_amount:"Montant récurrent",setup_fee:"Frais d'installation",important_dates:"Dates importantes",created_at:"Créé le",suspension_date:"Date de suspension",cancellation_date:"Date d'annulation",termination_date:"Date de résiliation",login_details:"Identifiants de connexion",username:"Nom d'utilisateur",password:"Mot de passe",no_login_details:"Aucun identifiant de connexion",configuration:"Configuration",notes:"Notes",error_loading:"Erreur lors du chargement du service"},filters:{search:"Rechercher",search_placeholder:"Rechercher par client, produit, domaine...",status:"Statut",client:"Client",product:"Produit",all_clients:"Tous les clients",all_products:"Tous les produits"},empty:{title:"Aucun service trouvé",message:"Aucun service ne correspond aux critères de recherche"},delete_modal:{title:"Supprimer le service",confirmation:"Êtes-vous sûr de vouloir supprimer ce service ?",warning:"Cette action est irréversible et supprimera toutes les données associées."},status_change:{activate_title:"Activer le service",suspend_title:"Suspendre le service",cancel_title:"Annuler le service",terminate_title:"Terminer le service",activate_confirmation:"Êtes-vous sûr de vouloir activer ce service ?",suspend_confirmation:"Êtes-vous sûr de vouloir suspendre ce service ?",cancel_confirmation:"Êtes-vous sûr de vouloir annuler ce service ?",terminate_confirmation:"Êtes-vous sûr de vouloir terminer ce service ? Cette action est irréversible.",notes:"Notes (optionnel)",notes_placeholder:"Raison du changement de statut...",success_title:"Statut modifié",activate_success:"Le service a été activé avec succès",suspend_success:"Le service a été suspendu avec succès",cancel_success:"Le service a été annulé avec succès",terminate_success:"Le service a été terminé avec succès",error:"Erreur lors du changement de statut",invalid_action:"Action invalide"},billing_cycles:{monthly:"Mensuel",quarterly:"Trimestriel",semi_annually:"Semestriel",annually:"Annuel",biennially:"Bisannuel",triennially:"Trisannuel"},form:{section:{client_product:"Client et produit",service_details:"Détails du service",details:"Détails du service",billing:"Facturation",configuration:"Configuration",configurations:"Configurations",notes:"Notes"},client:"Client",select_client:"Sélectionner un client",product:"Produit",select_product:"Sélectionner un produit",domain:"Domaine",domain_placeholder:"exemple.com",username:"Nom d'utilisateur",username_placeholder:"Nom d'utilisateur du service",password:"Mot de passe",password_placeholder:"Mot de passe du service",server:"Serveur",select_server:"Sélectionner un serveur",status:"Statut",billing_cycle:"Cycle de facturation",next_due_date:"Prochaine échéance",recurring_amount:"Montant récurrent",amount_placeholder:"0.00",setup_fee:"Frais d'installation",fee_placeholder:"0.00",notes:"Notes",notes_placeholder:"Notes sur le service...",config_name:"Nom de configuration",config_value:"Valeur",action:"Action",add_config:"Ajouter une configuration",calculate_due_date:"Recalculer la date d'échéance",error_loading:"Erreur lors du chargement des données",error_submit:"Erreur lors de la soumission du formulaire",success_create_title:"Service créé",success_create_message:"Le service a été créé avec succès",success_update_title:"Service mis à jour",success_update_message:"Le service a été mis à jour avec succès",errors:{client_required:"Le client est requis",product_required:"Le produit est requis",status_required:"Le statut est requis",invalid_date:"Format de date invalide",negative_amount:"Le montant ne peut pas être négatif",negative_fee:"Les frais ne peuvent pas être négatifs"}}},invoices:{title:"Factures",description:"Gérer les factures et la facturation",add_new:"Nouvelle facture",create_title:"Nouvelle facture",create_description:"Créer une nouvelle facture",edit_title:"Modifier la facture",edit_description:"Modifier les informations de la facture",details_title:"Facture #{id}",details_description:"Détails de la facture",actions:{add:"Nouvelle facture",edit:"Modifier",mark_paid:"Marquer comme payée",download_pdf:"Télécharger PDF"},search:{placeholder:"Rechercher par numéro, client..."},filters:{search:"Rechercher",status:"Statut",date_range:"Période",all_time:"Toutes les périodes",this_month:"Ce mois",last_month:"Le mois dernier",this_year:"Cette année",last_year:"L'année dernière"},table:{number:"Numéro",client:"Client",amount:"Montant",status:"Statut",date:"Date",due_date:"Échéance",actions:"Actions"},columns:{service:"Service",amount:"Montant",due_date:"Date d'échéance",status:"Statut",paid_date:"Date de paiement",created_at:"Créé le"},status:{all:"Tous les statuts",draft:"Brouillon",unpaid:"Impayée",paid:"Payée",overdue:"En retard",cancelled:"Annulée"},empty:{title:"Aucune facture trouvée",description:"Aucune facture ne correspond aux critères de recherche"},not_found:{title:"Facture introuvable",description:"La facture demandée n'existe pas ou a été supprimée."},details:{main_info:"Informations principales",id:"Numéro",status:"Statut",date:"Date",due_date:"Date d'échéance",amount:"Montant",client_info:"Informations client",client:"Client",email:"Email",service:"Service",items:"Éléments de facturation",description:"Description",quantity:"Quantité",unit_price:"Prix unitaire",total:"Total",subtotal:"Sous-total",tax:"Taxe",payments:"Paiements associés",notes:"Notes",history:"Historique"},history:{created:"Facture créée",updated:"Facture modifiée",paid:"Facture payée"},form:{client_info:"Informations client",client:"Client",select_client:"Sélectionner un client",service:"Service",select_service:"Sélectionner un service",invoice_details:"Détails de la facture",date:"Date",due_date:"Date d'échéance",status:"Statut",amount:"Montant",items:"Éléments de facturation",item_description:"Description",item_description_placeholder:"Description de l'élément...",quantity:"Quantité",unit_price:"Prix unitaire",total:"Total",add_item:"Ajouter un élément",notes:"Notes",notes_placeholder:"Notes sur la facture...",subtotal:"Sous-total",tax:"Taxe"},modal:{add_title:"Nouvelle facture",edit_title:"Modifier la facture",view_title:"Détails de la facture"},confirm_mark_paid:"Êtes-vous sûr de vouloir marquer cette facture comme payée ?",success:{created:"Facture créée avec succès",updated:"Facture mise à jour avec succès",marked_paid:"Facture marquée comme payée"},errors:{load_failed:"Erreur lors du chargement de la facture",create_failed:"Erreur lors de la création de la facture",update_failed:"Erreur lors de la mise à jour de la facture",mark_paid_failed:"Erreur lors du marquage comme payée",download_failed:"Erreur lors du téléchargement"}},payments:{title:"Paiements",description:"Gérer les paiements et transactions",add_new:"Nouveau paiement",create_title:"Nouveau paiement",create_description:"Créer un nouveau paiement",edit_title:"Modifier le paiement",edit_description:"Modifier les informations du paiement",details_title:"Paiement #{id}",details_description:"Détails du paiement",actions:{add:"Nouveau paiement",edit:"Modifier",refund:"Rembourser"},search:{placeholder:"Rechercher par transaction, client..."},filters:{search:"Rechercher",status:"Statut",method:"Méthode",gateway:"Passerelle",date_range:"Période",all_time:"Toutes les périodes",this_month:"Ce mois",last_month:"Le mois dernier",this_year:"Cette année",last_year:"L'année dernière"},table:{transaction_id:"ID Transaction",client:"Client",invoice:"Facture",amount:"Montant",method:"Méthode",gateway:"Passerelle",status:"Statut",date:"Date",actions:"Actions"},status:{all:"Tous les statuts",pending:"En attente",completed:"Complété",failed:"Échoué",refunded:"Remboursé"},methods:{all:"Toutes les méthodes",bank_transfer:"Virement bancaire",cash:"Espèces"},empty:{title:"Aucun paiement trouvé",description:"Aucun paiement ne correspond aux critères de recherche"},not_found:{title:"Paiement introuvable",description:"Le paiement demandé n'existe pas ou a été supprimé."},details:{main_info:"Informations principales",id:"Numéro",status:"Statut",amount:"Montant",method:"Méthode",date:"Date",transaction_id:"ID Transaction",client_invoice:"Client et facture",client:"Client",invoice:"Facture",invoice_total:"Total facture",notes:"Notes",history:"Historique"},history:{created:"Paiement créé",updated:"Paiement modifié",refunded:"Paiement remboursé"},form:{basic_info:"Informations de base",invoice:"Facture",select_invoice:"Sélectionner une facture",amount:"Montant",method:"Méthode de paiement",select_method:"Sélectionner une méthode",status:"Statut",additional_info:"Informations additionnelles",transaction_id:"ID Transaction",transaction_id_placeholder:"Identifiant de la transaction...",notes:"Notes",notes_placeholder:"Notes sur le paiement..."},modal:{add_title:"Nouveau paiement",edit_title:"Modifier le paiement",view_title:"Détails du paiement"},confirm_refund:"Êtes-vous sûr de vouloir rembourser ce paiement ?",success:{created:"Paiement créé avec succès",updated:"Paiement mis à jour avec succès",refunded:"Paiement remboursé avec succès"},errors:{load_failed:"Erreur lors du chargement du paiement",create_failed:"Erreur lors de la création du paiement",update_failed:"Erreur lors de la mise à jour du paiement",refund_failed:"Erreur lors du remboursement"}},tickets:{title:"Tickets de support",description:"Gérer les demandes de support client",add_new:"Nouveau ticket",create_title:"Nouveau ticket",create_description:"Créer un nouveau ticket de support",edit_title:"Modifier le ticket",edit_description:"Modifier les informations du ticket",details_title:"Ticket #{id}",details_description:"Détails du ticket de support",actions:{add:"Nouveau ticket",create:"Créer le ticket",update:"Mettre à jour",reply:"Répondre",edit:"Modifier",close:"Fermer",reopen:"Rouvrir",assign:"Assigner"},filters:{search:"Rechercher",status:"Statut",priority:"Priorité",department:"Département",assigned_to:"Assigné à",all_time:"Toutes les périodes",this_month:"Ce mois",last_month:"Le mois dernier",this_year:"Cette année",last_year:"L'année dernière"},search:{placeholder:"Rechercher par sujet, client..."},table:{subject:"Sujet",client:"Client",status:"Statut",priority:"Priorité",department:"Département",assigned_to:"Assigné à",last_reply:"Dernière réponse",created_at:"Créé le",created:"Créé le",updated:"Mis à jour",actions:"Actions"},status:{all:"Tous les statuts",open:"Ouvert",pending:"En attente",answered:"Répondu","customer-reply":"Réponse client",resolved:"Résolu",closed:"Fermé"},priority:{all:"Toutes les priorités",low:"Faible",medium:"Moyen",high:"Élevé",urgent:"Urgent"},departments:{all:"Tous les départements",technical:"Technique",billing:"Facturation",sales:"Ventes",general:"Général"},empty:{title:"Aucun ticket trouvé",description:"Aucun ticket ne correspond aux critères de recherche"},not_found:{title:"Ticket introuvable",description:"Le ticket demandé n'existe pas ou a été supprimé."},details:{main_info:"Informations principales",id:"Numéro",subject:"Sujet",status:"Statut",priority:"Priorité",department:"Département",client:"Client",assigned_to:"Assigné à",created_at:"Créé le",updated_at:"Mis à jour le",last_reply:"Dernière réponse",service:"Service associé",messages:"Messages",internal_notes:"Notes internes",attachments:"Pièces jointes",history:"Historique"},form:{basic_info:"Informations de base",client:"Client",select_client:"Sélectionner un client",department:"Département",select_department:"Sélectionner un département",subject:"Sujet",subject_placeholder:"Sujet du ticket...",priority_status:"Priorité et statut",priority:"Priorité",status:"Statut",description:"Description",assignment:"Assignation",assigned_to:"Assigné à",select_assignee:"Sélectionner un assigné",unassigned:"Non assigné",service_related:"Service associé",service:"Service associé",select_service:"Sélectionner un service",no_service:"Aucun service",message:"Message",message_placeholder:"Décrivez votre demande...",advanced_options:"Options avancées",internal_notes:"Notes internes",internal_notes_placeholder:"Notes internes (non visibles par le client)...",options:"Options",notify_client:"Notifier le client",notify_client_description:"Envoyer une notification par email au client",auto_close:"Fermeture automatique",auto_close_description:"Fermer automatiquement le ticket après résolution",tags_label:"Tags",tags:"Tags",tags_placeholder:"Ajouter des tags...",notes:"Notes",notes_placeholder:"Notes additionnelles...",notes_help:"Notes visibles uniquement par l'équipe de support",attachments:"Pièces jointes"},reply:{title:"Répondre au ticket",message:"Message",message_placeholder:"Votre réponse...",internal:"Note interne",notify_client:"Notifier le client",change_status:"Changer le statut",submit:"Envoyer la réponse"},confirm_delete:"Êtes-vous sûr de vouloir supprimer ce ticket ?",confirm_close:"Êtes-vous sûr de vouloir fermer ce ticket ?",confirm_reopen:"Êtes-vous sûr de vouloir rouvrir ce ticket ?",success:{created:"Ticket créé avec succès",updated:"Ticket mis à jour avec succès",replied:"Réponse ajoutée avec succès",closed:"Ticket fermé avec succès",reopened:"Ticket rouvert avec succès",assigned:"Ticket assigné avec succès"},errors:{load_failed:"Erreur lors du chargement du ticket",create_failed:"Erreur lors de la création du ticket",update_failed:"Erreur lors de la mise à jour du ticket",reply_failed:"Erreur lors de l'ajout de la réponse",close_failed:"Erreur lors de la fermeture du ticket",reopen_failed:"Erreur lors de la réouverture du ticket",assign_failed:"Erreur lors de l'assignation du ticket"},modal:{add_title:"Nouveau ticket",edit_title:"Modifier le ticket",view_title:"Détails du ticket"},noMessages:"Aucun message"},settings:{title:"Paramètres",description:"Configuration du système",loadError:"Erreur lors du chargement des paramètres",saveError:"Erreur lors de la sauvegarde des paramètres",saveSuccess:"Paramètres sauvegardés avec succès",general:{title:"Paramètres généraux",description:"Configuration générale du système",siteName:"Nom du site",siteUrl:"URL du site",adminEmail:"Email administrateur",language:"Langue par défaut",timezone:"Fuseau horaire",dateFormat:"Format de date",timeFormat:"Format d'heure",currency:"Devise",maintenanceMode:"Mode maintenance",maintenanceMessage:"Message de maintenance"},security:{title:"Sécurité",description:"Configuration de la sécurité du système",authentication:"Authentification",enableTwoFactor:"Activer l'authentification à deux facteurs",twoFactorHelp:"Ajoute une couche de sécurité supplémentaire",sessionTimeout:"Délai d'expiration de session (minutes)",maxLoginAttempts:"Tentatives de connexion maximum",lockoutTime:"Durée de verrouillage (minutes)",passwordPolicy:"Politique de mot de passe",minPasswordLength:"Longueur minimum du mot de passe",requireUppercase:"Exiger des majuscules",requireNumber:"Exiger des chiffres",requireSpecialChar:"Exiger des caractères spéciaux",passwordExpiryDays:"Expiration du mot de passe (jours)",apiAccess:"Accès API",enableApiAccess:"Activer l'accès API",apiTokenExpiry:"Expiration du token API (jours)",passwords:"Mots de passe",api:"API",never:"Jamais"},servers:{online:"En ligne",title:"Serveurs",description:"Gérer les serveurs et modules",add:"Ajouter un serveur",edit:"Modifier le serveur",delete:"Supprimer le serveur",name:"Nom",hostname:"Nom d'hôte",type:"Type",ip:"Adresse IP",port:"Port",username:"Nom d'utilisateur",password:"Mot de passe",passwordHint:"Laissez vide si vous ne souhaitez pas modifier",apiToken:"Token API",apiTokenHint:"Laissez vide si vous ne souhaitez pas modifier",secure:"Connexion sécurisée (SSL/TLS)",active:"Actif",maxAccounts:"Nombre maximum de comptes",nameservers:"Serveurs de noms (un par ligne)",status:"Statut",noServers:"Aucun serveur configuré",confirmDelete:"Êtes-vous sûr de vouloir supprimer ce serveur ?",details:"Détails",refresh:"Actualiser",refreshing:"Actualisation en cours...",load:"Charge CPU",memory:"Mémoire",disk:"Disque",uptime:"Temps de fonctionnement",info:"Informations",lastRefresh:"Dernière actualisation",lastCheck:"Dernière vérification",last_updated:"Dernière mise à jour",apiTokenInputHint:"Laissez vide si vous ne souhaitez pas modifier",nameserversHint:"Un serveur de noms par ligne",maxAccountsHint:"0 pour illimité",fillRequiredFields:"Veuillez remplir tous les champs requis",testConnection:"Tester la connexion",deleteConfirm:"Êtes-vous sûr de vouloir supprimer le serveur {name} ?"},modules:{title:"Modules",description:"Gérer les modules du système",searchPlaceholder:"Rechercher un module...",filterByStatus:"Filtrer par statut",statusAll:"Tous",statusActive:"Actifs",statusInactive:"Inactifs",filterByType:"Type de module",typeAll:"Tous les types",types:{servers:"Serveurs",gateways:"Passerelles de paiement",addons:"Extensions",fraud:"Anti-fraude",registrars:"Registraires",reports:"Rapports",widgets:"Widgets"},by:"par",active:"Actif",inactive:"Inactif",noModulesFound:"Aucun module trouvé",noModulesMatchSearch:"Aucun module ne correspond à votre recherche",noModulesMatchFilter:"Aucun module ne correspond au filtre sélectionné",noModulesAvailable:"Aucun module disponible",configTitle:"Configuration du module",noConfigAvailable:"Aucune configuration disponible pour ce module",loadError:"Erreur lors du chargement des modules",refreshSuccess:"Modules actualisés avec succès"},billing:{title:"Facturation",description:"Configurez les paramètres de facturation et les méthodes de paiement",general:"Général",invoicePrefix:"Préfixe des factures",nextInvoiceNumber:"Prochain numéro de facture",defaultDueDays:"Délai de paiement par défaut (jours)",autoSendInvoices:"Envoyer automatiquement les factures",autoSendReceipts:"Envoyer automatiquement les reçus",taxes:"Taxes",enableTaxes:"Activer les taxes",defaultTaxName:"Nom de la taxe par défaut",defaultTaxRate:"Taux de taxe par défaut",taxNumberRequired:"Numéro de taxe requis",paymentMethods:"Méthodes de paiement",stripePublicKey:"Clé publique Stripe",stripeSecretKey:"Clé secrète Stripe",paypalClientId:"ID client PayPal",paypalClientSecret:"Secret client PayPal",paypalSandbox:"Mode sandbox PayPal",bankDetails:"Détails bancaires",bankTransfer:"Virement bancaire",cash:"Espèces"},integrations:{title:"Intégrations",description:"Gérez les intégrations API et les webhooks",apiKeys:"Clés API",apiKeysDescription:"Gérez les clés API pour l'accès externe à votre système",generateKey:"Générer une nouvelle clé",newKeyGenerated:"Nouvelle clé API générée",copyKeyWarning:"Copiez cette clé maintenant. Elle ne sera plus affichée.",keyName:"Nom de la clé",createdAt:"Créée le",lastUsed:"Dernière utilisation",expiresAt:"Expire le",noKeysFound:"Aucune clé API trouvée",webhooks:"Webhooks",webhooksDescription:"Configurez les webhooks pour recevoir des notifications d'événements",addWebhook:"Ajouter un webhook",editWebhook:"Modifier le webhook",webhookName:"Nom du webhook",webhookUrl:"URL du webhook",webhookEvents:"Événements",webhookStatus:"Statut",webhookActive:"Webhook actif",sendTestEvent:"Envoyer un événement de test",noWebhooksFound:"Aucun webhook trouvé",events:{clientCreated:"Client créé",clientUpdated:"Client mis à jour",invoiceCreated:"Facture créée",invoicePaid:"Facture payée",paymentReceived:"Paiement reçu",ticketCreated:"Ticket créé",ticketReplied:"Réponse au ticket",ticketClosed:"Ticket fermé",serviceCreated:"Service créé",serviceUpdated:"Service mis à jour",serviceExpired:"Service expiré"},confirmDeleteKey:"Êtes-vous sûr de vouloir supprimer cette clé API ?",confirmDeleteWebhook:"Êtes-vous sûr de vouloir supprimer ce webhook ?",keyGeneratedSuccess:"Clé API générée avec succès",keyGenerationError:"Erreur lors de la génération de la clé API",keyDeletedSuccess:"Clé API supprimée avec succès",keyDeletionError:"Erreur lors de la suppression de la clé API",keyCopiedSuccess:"Clé API copiée dans le presse-papiers",keyCopyError:"Erreur lors de la copie de la clé API",webhookSavedSuccess:"Webhook sauvegardé avec succès",webhookSaveError:"Erreur lors de la sauvegarde du webhook",webhookDeletedSuccess:"Webhook supprimé avec succès",webhookDeletionError:"Erreur lors de la suppression du webhook",webhookActivatedSuccess:"Webhook activé avec succès",webhookDeactivatedSuccess:"Webhook désactivé avec succès"},license:{title:"Licence",description:"Gérer la licence du système",information:"Informations sur la licence",valid:"Licence valide",invalid:"Licence invalide",licenseKey:"Clé de licence",registeredTo:"Enregistré à",email:"Email",plan:"Plan",expiresAt:"Expire le",supportUntil:"Support jusqu'au",noLicense:"Aucune licence configurée",update:"Mettre à jour la licence",activate:"Activer la licence",check:"Vérifier le statut",features:{multipleUsers:"Utilisateurs multiples",multipleUsersDesc:"Gérer plusieurs utilisateurs administrateurs",api:"Accès API",apiDesc:"Accès complet à l'API REST",whiteLabel:"Marque blanche",whiteLabelDesc:"Personnaliser l'interface avec votre marque",multipleServers:"Serveurs multiples",multipleServersDesc:"Gérer plusieurs serveurs de provisioning",advancedReporting:"Rapports avancés",advancedReportingDesc:"Rapports détaillés et analytics",prioritySupport:"Support prioritaire",prioritySupportDesc:"Support technique prioritaire"},updateLicense:"Mettre à jour la licence",activateLicense:"Activer la licence",licenseKeyHelp:"Entrez votre clé de licence fournie par TechCMS",activationSuccess:"Licence activée avec succès",activationError:"Erreur lors de l'activation de la licence",checkSuccess:"Statut de la licence vérifié",checkError:"Erreur lors de la vérification de la licence"},notifications:{title:"Notifications",description:"Configurer les notifications système",email:"Email",enableEmailNotifications:"Activer les notifications par email",smtpHost:"Serveur SMTP",smtpPort:"Port SMTP",smtpSecurity:"Sécurité SMTP",none:"Aucune",smtpUsername:"Nom d'utilisateur SMTP",smtpPassword:"Mot de passe SMTP",emailFrom:"Email expéditeur",emailFromName:"Nom expéditeur",testConnection:"Tester la connexion",notificationTypes:"Types de notifications",inApp:"Dans l'application",types:{newClient:"Nouveau client",newInvoice:"Nouvelle facture",paymentReceived:"Paiement reçu",invoiceReminder:"Rappel de facture",newTicket:"Nouveau ticket",ticketReply:"Réponse au ticket",serviceExpiry:"Expiration de service",systemAlert:"Alerte système"},testSuccess:"Test de connexion email réussi",testError:"Erreur lors du test de connexion email"}},subscriptions:{title:"Abonnements",description:"Gérer les abonnements récurrents",add_new:"Nouvel abonnement",create_title:"Nouvel abonnement",create_description:"Créer un nouvel abonnement",edit_title:"Modifier l'abonnement",edit_description:"Modifier les informations de l'abonnement",details_title:"Abonnement #{id}",details_description:"Détails de l'abonnement",actions:{add:"Nouvel abonnement",edit:"Modifier",cancel:"Annuler",renew:"Renouveler",view:"Voir"},search:{placeholder:"Rechercher par client, produit..."},filters:{search:"Rechercher",status:"Statut",product:"Produit",billing_cycle:"Cycle de facturation",all_cycles:"Tous les cycles",all_time:"Toutes les périodes",this_month:"Ce mois",last_month:"Le mois dernier",this_year:"Cette année",last_year:"L'année dernière"},table:{client:"Client",product:"Produit",price:"Prix",cycle:"Cycle",next_billing:"Prochaine facturation",status:"Statut",actions:"Actions"},status:{all:"Tous les statuts",active:"Actif",pending:"En attente",cancelled:"Annulé",expired:"Expiré",suspended:"Suspendu"},cycles:{monthly:"Mensuel",quarterly:"Trimestriel",semi_annual:"Semestriel",annual:"Annuel"},empty:{title:"Aucun abonnement trouvé",description:"Aucun abonnement ne correspond aux critères de recherche"},not_found:{title:"Abonnement introuvable",description:"L'abonnement demandé n'existe pas ou a été supprimé."},details:{main_info:"Informations principales",id:"Numéro",status:"Statut",client:"Client",product:"Produit",price:"Prix",billing_cycle:"Cycle de facturation",start_date:"Date de début",end_date:"Date de fin",next_billing_date:"Prochaine facturation",auto_renew:"Renouvellement automatique",server:"Serveur",domain:"Domaine",username:"Nom d'utilisateur",notes:"Notes",history:"Historique",billing_info:"Informations de facturation",service_info:"Informations du service"},form:{client_product:"Client et produit",client:"Client",select_client:"Sélectionner un client",product:"Produit",select_product:"Sélectionner un produit",subscription_details:"Détails de l'abonnement",billing_info:"Informations de facturation",start_date:"Date de début",end_date:"Date de fin",billing_cycle:"Cycle de facturation",next_billing:"Prochaine facturation",next_billing_date:"Prochaine facturation",price:"Prix",status:"Statut",service_details:"Détails du service",service_config:"Configuration du service",server:"Serveur",select_server:"Sélectionner un serveur",domain:"Domaine",domain_placeholder:"exemple.com",username:"Nom d'utilisateur",username_placeholder:"Nom d'utilisateur du service",advanced_options:"Options avancées",options:"Options",auto_renew:"Renouvellement automatique",auto_renew_description:"Renouveler automatiquement cet abonnement à l'expiration",send_notifications:"Envoyer des notifications",send_notifications_description:"Envoyer des notifications par email pour cet abonnement",notes:"Notes",notes_placeholder:"Notes sur l'abonnement..."},modal:{add_title:"Nouvel abonnement",edit_title:"Modifier l'abonnement",view_title:"Détails de l'abonnement",cancel_title:"Annuler l'abonnement",cancel_reason:"Raison de l'annulation",cancel_reason_placeholder:"Pourquoi annulez-vous cet abonnement ?",confirm_cancel:"Êtes-vous sûr de vouloir annuler cet abonnement ?",confirm_renew:"Êtes-vous sûr de vouloir renouveler cet abonnement ?"},history:{created:"Abonnement créé",updated:"Abonnement modifié",cancelled:"Abonnement annulé",renewed:"Abonnement renouvelé",suspended:"Abonnement suspendu",reactivated:"Abonnement réactivé"},success:{created:"Abonnement créé avec succès",updated:"Abonnement mis à jour avec succès",cancelled:"Abonnement annulé avec succès",renewed:"Abonnement renouvelé avec succès"},errors:{load_failed:"Erreur lors du chargement de l'abonnement",create_failed:"Erreur lors de la création de l'abonnement",update_failed:"Erreur lors de la mise à jour de l'abonnement",cancel_failed:"Erreur lors de l'annulation de l'abonnement",renew_failed:"Erreur lors du renouvellement de l'abonnement"}},topbar:{notifications:{title:"Notifications",toggle:"Basculer les notifications",mark_all_read:"Marquer tout comme lu",markAllRead:"Marquer tout comme lu",empty:"Aucune notification",noNotifications:"Aucune notification",view_all:"Voir toutes les notifications"},profile:{my_profile:"Mon profil",system_updates:"Mises à jour",settings:"Paramètres",logout:"Déconnexion"}},sidebar:{menu:{dashboard:"Tableau de bord",clients:"Clients",services:"Services",products:"Produits & Services",catalog:{title:"Catalogue",prod:"Produits",products_services:"Produits & Services"},billing:{title:"Facturation",invoices:"Factures",payments:"Paiements",subscriptions:"Abonnements"},support:{title:"Support",tickets:"Tickets",kb:"Base de connaissances"},settings:"Paramètres"}},errors:{realtime_connection:"Erreur de connexion temps réel"},navigation:{dashboard:"Tableau de bord",clients:"Clients",products:"Produits & Services",services:"Services",billing:"Facturation",invoices:"Factures",payments:"Paiements",subscriptions:"Abonnements",support:"Support",tickets:"Tickets",settings:"Paramètres",general:"Général",security:"Sécurité",servers:"Serveurs",modules:"Modules",license:"Licence"},notifications:{title:"Notifications",description:"Gérer les notifications système",markAllAsRead:"Marquer tout comme lu",clearAll:"Tout effacer",search:"Rechercher dans les notifications",filterByType:"Filtrer par type",markAsRead:"Marquer comme lu",delete:"Supprimer",stats:{total:"Total",unread:"Non lues",today:"Aujourd'hui"},status:{all:"Toutes",unread:"Non lues",read:"Lues"},types:{ticket:"Ticket",invoice:"Facture",payment:"Paiement",client:"Client",system:"Système"},columns:{type:"Type",title:"Titre",message:"Message",date:"Date",status:"Statut"},empty:{title:"Aucune notification",description:"Vous n'avez aucune notification pour le moment"}},updates:{title:"Mises à jour système",description:"Gérer les mises à jour automatiques du système TechCMS",check_now:"Vérifier maintenant",settings:"Paramètres",system_status:"Statut du système",current_version:"Version actuelle",available_updates:"Mises à jour disponibles",last_check:"Dernière vérification",last_update:"Dernière mise à jour",automation_status:"Statut de l'automatisation",auto_check:"Vérification automatique",auto_download:"Téléchargement automatique",auto_install:"Installation automatique",up_to_date:"À jour",updates_available_count:"{count} mise(s) à jour disponible(s)",checking:"Vérification en cours...",never:"Jamais",just_now:"À l'instant",hours_ago:"{count} heure(s)",days_ago:"{count} jour(s)",download_latest:"Télécharger la dernière",available_versions:"Versions disponibles",version:"Version",status:{stable:"Stable",beta:"Bêta",pending:"En attente",downloading:"Téléchargement",installing:"Installation",completed:"Terminé",failed:"Échoué",rolled_back:"Annulé"},changelog:"Notes de version",download:"Télécharger",not_available:"Non disponible",history:"Historique",cleanup:"Nettoyer",no_history:"Aucun historique",date:"Date",duration:"Durée",size:"Taille",view_changelog:"Voir les notes",view_error:"Voir l'erreur",retry:"Réessayer",filter_status:"Filtrer par statut",filter_version:"Filtrer par version",filter_version_placeholder:"Rechercher une version...",filter_date_from:"Date de début",filter_date_to:"Date de fin",clear_filters:"Effacer les filtres",showing_results:"Affichage de {from} à {to} sur {total} résultats",changelog_title:"Notes de version {version}",no_changelog:"Aucune note de version disponible",error_details:"Détails de l'erreur",update_context:"Contexte de la mise à jour",started_at:"Démarré le",failed_at:"Échoué le",check_success:"Vérification réussie",updates_found:"{count} mise(s) à jour trouvée(s)",no_updates:"Aucune mise à jour disponible",check_error:"Erreur de vérification",downloading_version:"Téléchargement de la version {version}",download_success:"Téléchargement réussi",download_completed:"Téléchargement de la version {version} terminé",download_error:"Erreur de téléchargement",cleanup_success:"Nettoyage réussi",cleanup_completed:"{files} fichier(s) et {records} enregistrement(s) supprimés",cleanup_error:"Erreur de nettoyage",settings_title:"Paramètres des mises à jour",automatic_checking:"Vérification automatique",enable_auto_check:"Activer la vérification automatique",auto_check_description:"Vérifier automatiquement les nouvelles versions selon l'intervalle défini",check_interval:"Intervalle de vérification",check_interval_description:"Fréquence de vérification des mises à jour",interval_1h:"Toutes les heures",interval_6h:"Toutes les 6 heures",interval_12h:"Toutes les 12 heures",interval_24h:"Toutes les 24 heures",interval_48h:"Toutes les 48 heures",interval_7d:"Toutes les semaines",automatic_download:"Téléchargement automatique",enable_auto_download:"Activer le téléchargement automatique",auto_download_description:"Télécharger automatiquement les mises à jour disponibles",requires_auto_check:"Nécessite la vérification automatique",automatic_installation:"Installation automatique",enable_auto_install:"Activer l'installation automatique",auto_install_description:"Installer automatiquement les mises à jour téléchargées",requires_auto_download:"Nécessite le téléchargement automatique",backup_settings:"Paramètres de sauvegarde",backup_before_update:"Sauvegarder avant mise à jour",backup_description:"Créer automatiquement une sauvegarde avant chaque mise à jour",notification_settings:"Paramètres de notification",notification_email:"Email de notification",notification_email_placeholder:"admin@example.com",notification_email_description:"Adresse email pour recevoir les notifications de mise à jour",configuration_preview:"Aperçu de la configuration",check_frequency:"Fréquence de vérification",backup_enabled:"Sauvegarde activée",reset_defaults:"Réinitialiser",settings_saved:"Paramètres sauvegardés",settings_updated:"Paramètres mis à jour avec succès",settings_error:"Erreur de sauvegarde",invalid_email:"Format d'email invalide",interval_too_short:"L'intervalle doit être d'au moins 1 heure",auto_install_requires_download:"L'installation automatique nécessite le téléchargement automatique",auto_download_requires_check:"Le téléchargement automatique nécessite la vérification automatique",minutes:"{count} minute(s)",hours:"{count} heure(s)",days:"{count} jour(s)",preparing_download:"Préparation du téléchargement...",preparing_install:"Préparation de l'installation...",preparing:"Préparation...",downloading:"Téléchargement en cours...",installing:"Installation en cours...",completed:"Terminé",failed:"Échoué",processing:"Traitement en cours...",step_validate_token:"Validation du token",step_validate_token_desc:"Vérification de l'autorisation de téléchargement",step_download_file:"Téléchargement du fichier",step_download_file_desc:"Téléchargement de la mise à jour depuis le serveur",step_verify_integrity:"Vérification de l'intégrité",step_verify_integrity_desc:"Contrôle de l'intégrité du fichier téléchargé",step_complete:"Finalisation",step_complete_desc:"Finalisation du téléchargement",step_backup:"Sauvegarde",step_backup_desc:"Création d'une sauvegarde du système actuel",step_extract:"Extraction",step_extract_desc:"Extraction des fichiers de mise à jour",step_apply:"Application",step_apply_desc:"Application de la mise à jour au système",step_cleanup:"Nettoyage",step_cleanup_desc:"Nettoyage des fichiers temporaires",version_details:"Détails de la version",update_id:"ID de mise à jour",unknown_error:"Erreur inconnue",install:"Installer",installing_version:"Installation de la version {version}",install_success:"Installation réussie",install_completed:"Installation de la version {version} terminée",install_error:"Erreur d'installation",no_downloaded_version:"Aucune version téléchargée trouvée",requirements_not_met:"Prérequis non satisfaits",check_requirements_first:"Veuillez vérifier les prérequis d'installation",requirements_check_error:"Erreur de vérification des prérequis",rollback_success:"Rollback réussi",rollback_completed:"Rollback vers la version {version} terminé",rollback_error:"Erreur de rollback",no_backup_available:"Aucune sauvegarde disponible",confirm_rollback:"Êtes-vous sûr de vouloir revenir à la version {version} ?",backup_id:"ID de sauvegarde",update_to_version:"Mettre à jour vers cette version"}},Y2={common:{select:"Select",search:"Search",view_all:"View all",client:"Client",email:"Email",status:"Status",date:"Date",back:"Back",success:"Success",error:"Error",loading:"Loading...",save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",add:"Add",create:"Create",update:"Update",confirm:"Confirm",yes:"Yes",no:"No",name:"Name",description:"Description",price:"Price",actions:"Actions",retry:"Retry",configure:"Configure",errorLoading:"Error loading",close:"Close",noData:"No data available",active:"Active",inactive:"Inactive",online:"Online",offline:"Offline",minutes:"minutes",minute:"minute",hour:"hour",hours:"hours",day:"day",days:"days",confirmDelete:"Confirm deletion",activate:"Activate",deactivate:"Deactivate",never:"Never",saving:"Saving...",error_occurred:"An error occurred",language:{select:"Choose language",fr:"Français",en:"English"},simple:"Simple",advanced:"Advanced"},notFound:{title:"404 - Page Not Found",description:"The page you are looking for does not exist or has been moved.",whatHappened:"What happened?",urlNotFound:"The URL you entered was not found on this server.",suggestions:"Suggestions:",checkUrl:"Check that the URL is correctly entered",goBack:"Go back to the previous page",goToDashboard:"Go to the dashboard",backButton:"Back",dashboardButton:"Dashboard"},dashboard:{title:"Dashboard",subtitle:"Overview of your activity",refresh:"Refresh",viewMore:"View more",stats:{active_clients:"Active clients",active_services:"Active services",active_tickets:"Active tickets",monthly_revenue:"Monthly revenue"},recent_clients:{title:"Recent clients"},recent_tickets:{title:"Recent tickets"},chart:{today:"Today",week:"7 Days",month:"30 Days",year:"This year",revenue:"Revenue",evolution:"Revenue evolution"}},login:{title:"Login",email:"Email address",password:"Password",rememberMe:"Remember me",forgotPassword:"Forgot password?",signIn:"Sign in",errorFields:"Please fill in all fields",resetTitle:"Reset password",resetDescription:"Enter your email address to receive a reset link",sendReset:"Send reset link",copyright:"© {year} TechCMS. All rights reserved."},clients:{title:"Clients",description:"Manage clients and their information",add_new:"New client",confirm_delete:"Are you sure you want to delete this client?",filters:{search:"Search",search_placeholder:"Search by name, email, company...",status:"Status",service_type:"Service type"},table:{client:"Client",company:"Company",name:"Name",email:"Email",phone:"Phone",services:"Services",status:"Status",created:"Created",actions:"Actions"},status:{all:"All statuses",active:"Active",inactive:"Inactive",suspended:"Suspended",pending:"Pending"},services:{all:"All types",hosting:"Hosting",domain:"Domain",ssl:"SSL"},no_services:"No services",actions:{view:"View",edit:"Edit",delete:"Delete"},add:{title:"New client",description:"Create a new client account"},edit:{title:"Edit client",description:"Edit client information"},details:{title:"Client details",description:"Detailed client information",error_loading:"Error loading client details",personal_info:"Personal information",contact_info:"Contact information",billing_info:"Billing information",services_info:"Services",notes_info:"Notes",activity_info:"Recent activity",no_services:"No active services",no_notes:"No notes",no_activity:"No recent activity",delete_confirm:"Are you sure you want to delete this client?",delete_warning:"This action is irreversible and will delete all associated data."},form:{personal_info:"Personal information",contact_info:"Contact information",billing_info:"Billing information",account_info:"Account information",address_title:"Address",firstname:"First name",firstname_placeholder:"Enter first name",lastname:"Last name",lastname_placeholder:"Enter last name",email:"Email",email_placeholder:"Enter email address",phone:"Phone",phone_placeholder:"+1 234 567 8900",company:"Company",company_placeholder:"Company name (optional)",address:"Address",address_placeholder:"123 Main Street",city:"City",city_placeholder:"New York",state:"State/Province",postal_code:"Postal code",postal_code_placeholder:"10001",postcode:"Postal code",country:"Country",country_placeholder:"United States",password:"Password",password_placeholder:"Secure password",password_optional:"(optional)",password_leave_empty:"Leave empty to keep unchanged",confirm_password:"Confirm password",status:"Status",notes:"Notes",firstname_required:"First name is required",lastname_required:"Last name is required",email_required:"Email is required",email_invalid:"Invalid email format",phone_required:"Phone is required",password_required:"Password is required",password_min:"Password must be at least 8 characters",password_mismatch:"Passwords do not match",country_required:"Country is required",save:"Save",saving:"Saving...",saved_successfully:"Client saved successfully",save_error:"Error saving client"},empty:{title:"No clients found",description:"No clients match the search criteria"}},products_services:JSON.parse('{"title":"Products & Services","description":"Manage available products and services","add_new":"New product","create_title":"Create new product","type_selection_help":"Select the type of product you want to create. Each type has its own configuration options.","confirm_delete":"Are you sure you want to delete this product?","filters":{"search":"Search","type":"Type","status":"Status","group":"Group","price_range":"Price range","all_types":"All types","all_prices":"All prices","price_low":"€0 - €50","price_medium":"€50 - €200","price_high":"€200 - €1000"},"types":{"reseller":"Reseller hosting","dedicated":"Dedicated server","vps":"VPS","shared":"Shared hosting"},"types_descriptions":{"shared_hosting":"Affordable and easy-to-use hosting for small websites.","reseller_hosting":"Host your own clients with our reseller hosting plans.","server_vps":"A virtual private server for more power and flexibility.","domain":"Register or transfer your domain name.","other":"Other types of products and services."},"table":{"name":"Name","type":"Type","price":"Price","status":"Status","clients":"Clients","actions":"Actions"},"status":{"all":"All","active":"Active","inactive":"Inactive","maintenance":"Maintenance"},"errors":{"fetch":"Error fetching products","delete":"Error deleting product","load_failed":"Failed to load products","modules_load":"Error loading server modules","type_required":"Please select a product type","save_failed":"Error saving data","name_required":"Product name is required"},"error_loading_data":"Error loading data","error_saving_data":"Error saving data","no_products_found":"No products found","try_different_filter":"Try a different filter","module":{"configuration":"Module configuration","loading_config":"Loading configuration...","select_plan":"Plan/Template","select_plan_option":"Select a plan","operating_system":"Operating system","select_os":"Select an OS","no_config_available":"No specific configuration available for this module","disk_space":"Disk space","disk_space_hint":"In MB (0 for unlimited)","bandwidth":"Bandwidth","bandwidth_hint":"In MB (0 for unlimited)","allow_subdomains":"Allow subdomains","allow_php":"Allow PHP","max_email_accounts":"Maximum email accounts","max_databases":"Maximum databases","module_required":"A module must be selected","provision_option_required":"A provisioning option must be selected","server_group_required":"A server group must be selected","saved_successfully":"Module configuration saved successfully","cpanel_description":"Provisioning module for cPanel/WHM","plesk_description":"Provisioning module for Plesk","directadmin_description":"Provisioning module for DirectAdmin","proxmox_description":"Provisioning module for Proxmox VE","solusvm_description":"Provisioning module for SolusVM","tab_general":"General","tab_features":"Features","tab_limits":"Limits","description":"Configure the provisioning module for this product","select_module":"Select a module","select_module_placeholder":"Choose a provisioning module","provision_options":"Provisioning options","server_group":"Server group","select_server_group":"Select a server group","select_server":"Select a server","select_server_is_required":"Selecting a server is required.","automation":"Automation","auto_setup_on_order":"Auto setup on order","auto_setup_on_payment":"Auto setup on payment","auto_setup_on_pending":"Auto setup on pending","no_auto_setup":"No auto setup","welcome_email":"Welcome email","select_welcome_email":"Select an email template","custom_module":"Custom module","custom_description":"Custom module configuration","provision_settings":"Provisioning settings","auto_provision":"Auto provision","auto_provision_description":"Automatically provision the service on order","manual_provision":"Manual provision","manual_provision_description":"Manually provision the service after order"},"modules":{"provisioning_options":"Provisioning options"},"tabs":{"type":"Type","details":"Details","pricing":"Pricing","module":"Module","custom_fields":"Custom fields","configurable_options":"Configurable options","upgrades":"Upgrades","freedomain":"Free domain","cross_sells":"Cross sells","other":"Other options","links":"Useful links"},"all_categories":"All categories","upgrades":{"description":"Configure available upgrades for this product","select_products":"Select products","no_products_selected":"No products selected","select_products_description":"Select products that clients can upgrade to"},"details":{"description":"Description","basic_info":"Basic information","name":"Product name","name_placeholder":"Enter product name","name_required":"Product name is required","slug":"Slug (URL)","slug_placeholder":"product-slug","slug_hint":"Used in the product URL. Leave empty to auto-generate.","category":"Category","select_category":"Select a category","category_required":"Category is required","description_placeholder":"Detailed product description","short_description":"Short description","short_description_placeholder":"Product summary","display_options":"Display options","welcome_email":"Welcome email","select_welcome_email":"Select an email","color":"Color","image":"Product image","remove_image":"Remove image","hidden":"Hidden product","hidden_hint":"Product will not be visible in the store","featured":"Featured product","featured_hint":"Product will be displayed with priority","additional_info":"Additional information","tag_line":"Tag line","tag_line_placeholder":"Catchy slogan","order_link":"Custom order link","order_link_placeholder":"https://example.com/order","order_link_hint":"External link to order this product","saved_successfully":"Product details saved successfully"},"columns":{"name":"Name","description":"Description","type":"Type","price":"Price","status":"Status","group":"Group","clients":"Clients"},"groups":{"all":"All groups","none":"No group"},"actions":{"edit":"Edit","delete":"Delete"},"empty":{"title":"No products found","description":"No products match the search criteria"},"product_created_successfully":"Product created successfully","product_updated_successfully":"Product updated successfully","search":"Search for a product...","add":"New product","pricing":{"description":"Configure pricing and billing options for your product","setup_fee":"Setup fee","setup_fee_hint":"One-time fee charged on first order","base_price":"Base price","base_price_hint":"Main product price","recurring_options":"Recurring billing options","recurring_pricing":"Recurring billing","monthly":"Monthly","quarterly":"Quarterly","semiannually":"Semi-annually","annually":"Annually","biennially":"Biennially","triennially":"Triennially","default_cycle":"Default billing cycle","allow_cycle_change":"Allow cycle change","allow_cycle_change_hint":"Allow customers to change their billing cycle","tax_options":"Tax options","tax_included":"Tax included","tax_included_hint":"Displayed prices include tax","tax_exempt":"Tax exempt","tax_exempt_hint":"This product is exempt from tax","price_not_negative":"Prices cannot be negative","saved_successfully":"Pricing saved successfully"},"custom_fields":{"description":"Configure custom fields for this product","add_field":"Add field","field_name":"Field name","field_name_placeholder":"Custom field name","field_type":"Field type","field_description":"Description","field_description_placeholder":"Field description","required":"Required","admin_only":"Admin only","show_on_order":"Show on order","show_on_invoice":"Show on invoice","field_types":{"text":"Text","password":"Password","dropdown":"Dropdown","textarea":"Textarea","checkbox":"Checkbox","radio":"Radio button"},"options":"Options","options_placeholder":"Option 1|Option 2|Option 3","options_hint":"Separate options with |","validation":"Validation","regex_pattern":"Regex pattern","error_message":"Error message","saved_successfully":"Custom fields saved successfully","no_fields":"No custom fields","no_fields_description":"No custom fields have been configured for this product"},"configurable_options":{"description":"Configure configurable options for this product","add_option":"Add option","option_name":"Option name","option_name_placeholder":"Configurable option name","option_type":"Option type","option_description":"Description","option_description_placeholder":"Option description","option_types":{"dropdown":"Dropdown","radio":"Radio button","checkbox":"Checkboxes","quantity":"Quantity","slider":"Slider"},"sub_options":"Sub-options","add_sub_option":"Add sub-option","sub_option_name":"Name","sub_option_price":"Price","sub_option_setup_fee":"Setup fee","monthly_price":"Monthly price","quarterly_price":"Quarterly price","semiannual_price":"Semi-annual price","annual_price":"Annual price","min_quantity":"Minimum quantity","max_quantity":"Maximum quantity","saved_successfully":"Configurable options saved successfully","no_options":"No configurable options","no_options_description":"No configurable options have been configured for this product"},"freedomain":{"description":"Configure free domain options for this product","enable_freedomain":"Enable free domain","enable_freedomain_hint":"Offer a free domain with this product","domain_types":"Domain types","register_domain":"Register new domain","transfer_domain":"Transfer existing domain","subdomain":"Subdomain","allowed_tlds":"Allowed extensions","allowed_tlds_placeholder":".com,.net,.org","allowed_tlds_hint":"Allowed domain extensions, separated by commas","subdomain_options":"Subdomain options","subdomain_prefix":"Subdomain prefix","subdomain_prefix_placeholder":"client","subdomain_domain":"Main domain","subdomain_domain_placeholder":"mydomain.com","saved_successfully":"Free domain options saved successfully"},"cross_sells":{"description":"Configure cross-sell products for this product","add_product":"Add product","search_products":"Search products","selected_products":"Selected products","no_products_selected":"No products selected","product_name":"Product name","product_price":"Price","remove_product":"Remove product","saved_successfully":"Cross sells saved successfully","tab_cross_sells":"Cross sells","tab_related":"Related products","no_related":"No related products","no_related_description":"No related products have been configured for this product","no_cross_sells":"No cross sells","no_cross_sells_description":"No cross sells have been configured for this product","available_products":"Available products"},"other":{"description":"Configure other options for this product","configuration_title":"Configuration","require_domain":"Require domain","require_domain_help":"A domain is required to order this product","auto_setup":"Auto setup","auto_setup_help":"Automatically setup the service after order","stock_control":"Stock control","enable_stock_control":"Enable stock control","stock_quantity":"Stock quantity","stock_quantity_hint":"Number of units available","low_stock_threshold":"Low stock threshold","low_stock_threshold_hint":"Alert when stock reaches this level","stock_control_help":"Manage available stock for this product","auto_provisioning":"Auto provisioning","enable_auto_provisioning":"Enable auto provisioning","provisioning_delay":"Provisioning delay","provisioning_delay_hint":"Delay in minutes before provisioning","retirement_options":"Retirement options","retirement_date":"Retirement date","retirement_date_hint":"Date from which the product will no longer be available","replacement_product":"Replacement product","select_replacement":"Select a replacement product","hidden":"Hidden product","hidden_help":"Hide this product from the store","welcome_email":"Welcome email","welcome_email_none":"No email","welcome_email_help":"Email sent after service activation","notes":"Notes","notes_placeholder":"Product notes...","notes_help":"Internal notes about this product","saved_successfully":"Other options saved successfully"},"links":{"description":"Configure useful links for this product","add_link":"Add link","link_title":"Link title","link_title_placeholder":"Documentation","link_url":"Link URL","link_url_placeholder":"https://example.com/docs","link_description":"Description","link_description_placeholder":"Link description","link_target":"Link target","target_self":"Same window","target_blank":"New window","link_icon":"Icon","link_icon_placeholder":"fas fa-book","remove_link":"Remove link","saved_successfully":"Useful links saved successfully","direct_links_title":"Direct links","direct_cart_link":"Direct cart link","direct_cart_link_placeholder":"e.g., https://yourstore.com/cart.php?a=add&pid=1","direct_cart_link_template":"Cart link template","direct_cart_link_template_placeholder":"e.g., cart.php?a=add&pid={PRODUCT_ID}","direct_cart_link_domain":"Cart link domain","direct_cart_link_domain_placeholder":"e.g., yourstore.com","group_cart_link":"Group cart link","group_cart_link_placeholder":"e.g., https://yourstore.com/cart.php?gid=1","product_links_title":"Product links","url":"URL","url_placeholder":"e.g., https://example.com/product/docs","visits":"Visits","actions":"Actions"}}'),product_groups:{add:"New group",success:{create:"Group created successfully",update:"Group updated successfully",delete:"Group deleted successfully"},errors:{create:"Error creating group",update:"Error updating group",delete:"Error deleting group"},confirm_delete:"Are you sure you want to delete this group?"},services:{title:"Services",description:"Manage client services",add_new:"New service",table:{client:"Client",product:"Product",domain:"Domain",status:"Status",next_due_date:"Next due date",recurring_amount:"Recurring amount",actions:"Actions"},status:{all:"All statuses",pending:"Pending",active:"Active",suspended:"Suspended",cancelled:"Cancelled",terminated:"Terminated",fraud:"Fraud"},actions:{view:"View",edit:"Edit",delete:"Delete",activate:"Activate",suspend:"Suspend",cancel:"Cancel",terminate:"Terminate"},create:{title:"New service",description:"Create a new client service"},edit:{title:"Edit service",description:"Edit service information"},details:{title:"Service details",description:"Detailed service information",unknown_product:"Unknown product",client:"Client",client_name:"Client name",client_email:"Client email",unknown:"Unknown",view_client:"View client",product:"Product",product_name:"Product name",view_product:"View product",server:"Server",server_name:"Server name",view_server:"View server",no_server:"No server assigned",billing:"Billing",billing_cycle:"Billing cycle",next_due_date:"Next due date",not_set:"Not set",recurring_amount:"Recurring amount",setup_fee:"Setup fee",important_dates:"Important dates",created_at:"Created at",suspension_date:"Suspension date",cancellation_date:"Cancellation date",termination_date:"Termination date",login_details:"Login details",username:"Username",password:"Password",no_login_details:"No login details",configuration:"Configuration",notes:"Notes",error_loading:"Error loading service"},filters:{search:"Search",search_placeholder:"Search by client, product, domain...",status:"Status",client:"Client",product:"Product",all_clients:"All clients",all_products:"All products"},empty:{title:"No services found",message:"No services match the search criteria"},delete_modal:{title:"Delete service",confirmation:"Are you sure you want to delete this service?",warning:"This action is irreversible and will delete all associated data."},status_change:{activate_title:"Activate service",suspend_title:"Suspend service",cancel_title:"Cancel service",terminate_title:"Terminate service",activate_confirmation:"Are you sure you want to activate this service?",suspend_confirmation:"Are you sure you want to suspend this service?",cancel_confirmation:"Are you sure you want to cancel this service?",terminate_confirmation:"Are you sure you want to terminate this service? This action is irreversible.",notes:"Notes (optional)",notes_placeholder:"Reason for status change...",success_title:"Status changed",activate_success:"Service has been activated successfully",suspend_success:"Service has been suspended successfully",cancel_success:"Service has been cancelled successfully",terminate_success:"Service has been terminated successfully",error:"Error changing status",invalid_action:"Invalid action"},billing_cycles:{monthly:"Monthly",quarterly:"Quarterly",semi_annually:"Semi-annually",annually:"Annually",biennially:"Biennially",triennially:"Triennially"},form:{section:{client_product:"Client and product",service_details:"Service details",details:"Service details",billing:"Billing",configuration:"Configuration",configurations:"Configurations",notes:"Notes"},client:"Client",select_client:"Select a client",product:"Product",select_product:"Select a product",domain:"Domain",domain_placeholder:"example.com",username:"Username",username_placeholder:"Service username",password:"Password",password_placeholder:"Service password",server:"Server",select_server:"Select a server",status:"Status",billing_cycle:"Billing cycle",next_due_date:"Next due date",recurring_amount:"Recurring amount",amount_placeholder:"0.00",setup_fee:"Setup fee",fee_placeholder:"0.00",notes:"Notes",notes_placeholder:"Service notes...",config_name:"Configuration name",config_value:"Value",action:"Action",add_config:"Add configuration",calculate_due_date:"Recalculate due date",error_loading:"Error loading data",error_submit:"Error submitting form",success_create_title:"Service created",success_create_message:"Service has been created successfully",success_update_title:"Service updated",success_update_message:"Service has been updated successfully",errors:{client_required:"Client is required",product_required:"Product is required",status_required:"Status is required",invalid_date:"Invalid date format",negative_amount:"Amount cannot be negative",negative_fee:"Fee cannot be negative"}}},invoices:{title:"Invoices",description:"Manage invoices and billing",add_new:"New invoice",create_title:"New invoice",create_description:"Create a new invoice",edit_title:"Edit invoice",edit_description:"Edit invoice information",details_title:"Invoice #{id}",details_description:"Invoice details",actions:{add:"New invoice",edit:"Edit",mark_paid:"Mark as paid",download_pdf:"Download PDF"},search:{placeholder:"Search by number, client..."},filters:{search:"Search",status:"Status",date_range:"Date range",all_time:"All time",this_month:"This month",last_month:"Last month",this_year:"This year",last_year:"Last year"},table:{number:"Number",client:"Client",amount:"Amount",status:"Status",date:"Date",due_date:"Due date",actions:"Actions"},columns:{service:"Service",amount:"Amount",due_date:"Due date",status:"Status",paid_date:"Paid date",created_at:"Created at"},status:{all:"All statuses",draft:"Draft",unpaid:"Unpaid",paid:"Paid",overdue:"Overdue",cancelled:"Cancelled"},empty:{title:"No invoices found",description:"No invoices match the search criteria"},not_found:{title:"Invoice not found",description:"The requested invoice does not exist or has been deleted."},details:{main_info:"Main information",id:"Number",status:"Status",date:"Date",due_date:"Due date",amount:"Amount",client_info:"Client information",client:"Client",email:"Email",service:"Service",items:"Invoice items",description:"Description",quantity:"Quantity",unit_price:"Unit price",total:"Total",subtotal:"Subtotal",tax:"Tax",payments:"Associated payments",notes:"Notes",history:"History"},history:{created:"Invoice created",updated:"Invoice updated",paid:"Invoice paid"},form:{client_info:"Client information",client:"Client",select_client:"Select a client",service:"Service",select_service:"Select a service",invoice_details:"Invoice details",date:"Date",due_date:"Due date",status:"Status",amount:"Amount",items:"Invoice items",item_description:"Description",item_description_placeholder:"Item description...",quantity:"Quantity",unit_price:"Unit price",total:"Total",add_item:"Add item",notes:"Notes",notes_placeholder:"Invoice notes...",subtotal:"Subtotal",tax:"Tax"},modal:{add_title:"New invoice",edit_title:"Edit invoice",view_title:"Invoice details"},confirm_mark_paid:"Are you sure you want to mark this invoice as paid?",success:{created:"Invoice created successfully",updated:"Invoice updated successfully",marked_paid:"Invoice marked as paid"},errors:{load_failed:"Error loading invoice",create_failed:"Error creating invoice",update_failed:"Error updating invoice",mark_paid_failed:"Error marking as paid",download_failed:"Error downloading"}},payments:{title:"Payments",description:"Manage payments and transactions",add_new:"New payment",create_title:"New payment",create_description:"Create a new payment",edit_title:"Edit payment",edit_description:"Edit payment information",details_title:"Payment #{id}",details_description:"Payment details",actions:{add:"New payment",edit:"Edit",refund:"Refund"},search:{placeholder:"Search by transaction, client..."},filters:{search:"Search",status:"Status",method:"Method",gateway:"Gateway",date_range:"Date range",all_time:"All time",this_month:"This month",last_month:"Last month",this_year:"This year",last_year:"Last year"},table:{transaction_id:"Transaction ID",client:"Client",invoice:"Invoice",amount:"Amount",method:"Method",gateway:"Gateway",status:"Status",date:"Date",actions:"Actions"},status:{all:"All statuses",pending:"Pending",completed:"Completed",failed:"Failed",refunded:"Refunded"},methods:{all:"All methods",bank_transfer:"Bank transfer",cash:"Cash"},empty:{title:"No payments found",description:"No payments match the search criteria"},not_found:{title:"Payment not found",description:"The requested payment does not exist or has been deleted."},details:{main_info:"Main information",id:"Number",status:"Status",amount:"Amount",method:"Method",date:"Date",transaction_id:"Transaction ID",client_invoice:"Client and invoice",client:"Client",invoice:"Invoice",invoice_total:"Invoice total",notes:"Notes",history:"History"},history:{created:"Payment created",updated:"Payment updated",refunded:"Payment refunded"},form:{basic_info:"Basic information",invoice:"Invoice",select_invoice:"Select an invoice",amount:"Amount",method:"Payment method",select_method:"Select a method",status:"Status",additional_info:"Additional information",transaction_id:"Transaction ID",transaction_id_placeholder:"Transaction identifier...",notes:"Notes",notes_placeholder:"Payment notes..."},modal:{add_title:"New payment",edit_title:"Edit payment",view_title:"Payment details"},confirm_refund:"Are you sure you want to refund this payment?",success:{created:"Payment created successfully",updated:"Payment updated successfully",refunded:"Payment refunded successfully"},errors:{load_failed:"Error loading payment",create_failed:"Error creating payment",update_failed:"Error updating payment",refund_failed:"Error processing refund"}},tickets:{title:"Support tickets",description:"Manage client support requests",add_new:"New ticket",create_title:"New ticket",create_description:"Create a new support ticket",edit_title:"Edit ticket",edit_description:"Edit ticket information",details_title:"Ticket #{id}",details_description:"Support ticket details",actions:{add:"New ticket",create:"Create ticket",update:"Update",reply:"Reply",edit:"Edit",close:"Close",reopen:"Reopen",assign:"Assign"},filters:{search:"Search",status:"Status",priority:"Priority",department:"Department",assigned_to:"Assigned to",all_time:"All time",this_month:"This month",last_month:"Last month",this_year:"This year",last_year:"Last year"},search:{placeholder:"Search by subject, client..."},table:{subject:"Subject",client:"Client",status:"Status",priority:"Priority",department:"Department",assigned_to:"Assigned to",last_reply:"Last reply",created_at:"Created at",created:"Created",updated:"Updated",actions:"Actions"},status:{all:"All statuses",open:"Open",pending:"Pending",answered:"Answered","customer-reply":"Customer reply",resolved:"Resolved",closed:"Closed"},priority:{all:"All priorities",low:"Low",medium:"Medium",high:"High",urgent:"Urgent"},departments:{all:"All departments",technical:"Technical",billing:"Billing",sales:"Sales",general:"General"},empty:{title:"No tickets found",description:"No tickets match the search criteria"},not_found:{title:"Ticket not found",description:"The requested ticket does not exist or has been deleted."},details:{main_info:"Main information",id:"Number",subject:"Subject",status:"Status",priority:"Priority",department:"Department",client:"Client",assigned_to:"Assigned to",created_at:"Created at",updated_at:"Updated at",last_reply:"Last reply",service:"Associated service",messages:"Messages",internal_notes:"Internal notes",attachments:"Attachments",history:"History"},form:{basic_info:"Basic information",client:"Client",select_client:"Select a client",department:"Department",select_department:"Select a department",subject:"Subject",subject_placeholder:"Ticket subject...",priority_status:"Priority and status",priority:"Priority",status:"Status",description:"Description",assignment:"Assignment",assigned_to:"Assigned to",select_assignee:"Select an assignee",unassigned:"Unassigned",service_related:"Associated service",service:"Associated service",select_service:"Select a service",no_service:"No service",message:"Message",message_placeholder:"Describe your request...",advanced_options:"Advanced options",internal_notes:"Internal notes",internal_notes_placeholder:"Internal notes (not visible to client)...",options:"Options",notify_client:"Notify client",notify_client_description:"Send email notification to client",auto_close:"Auto-close",auto_close_description:"Automatically close ticket after resolution",tags_label:"Tags",tags:"Tags",tags_placeholder:"Add tags...",notes:"Notes",notes_placeholder:"Additional notes...",notes_help:"Notes visible only to support team",attachments:"Attachments"},reply:{title:"Reply to ticket",message:"Message",message_placeholder:"Your reply...",internal:"Internal note",notify_client:"Notify client",change_status:"Change status",submit:"Send reply"},confirm_delete:"Are you sure you want to delete this ticket?",confirm_close:"Are you sure you want to close this ticket?",confirm_reopen:"Are you sure you want to reopen this ticket?",success:{created:"Ticket created successfully",updated:"Ticket updated successfully",replied:"Reply added successfully",closed:"Ticket closed successfully",reopened:"Ticket reopened successfully",assigned:"Ticket assigned successfully"},errors:{load_failed:"Error loading ticket",create_failed:"Error creating ticket",update_failed:"Error updating ticket",reply_failed:"Error adding reply",close_failed:"Error closing ticket",reopen_failed:"Error reopening ticket",assign_failed:"Error assigning ticket"},modal:{add_title:"New ticket",edit_title:"Edit ticket",view_title:"Ticket details"},noMessages:"No messages"},settings:{title:"Settings",description:"System configuration",loadError:"Error loading settings",saveError:"Error saving settings",saveSuccess:"Settings saved successfully",general:{title:"General settings",description:"General system configuration",siteName:"Site name",siteUrl:"Site URL",adminEmail:"Administrator email",language:"Default language",timezone:"Timezone",dateFormat:"Date format",timeFormat:"Time format",currency:"Currency",maintenanceMode:"Maintenance mode",maintenanceMessage:"Maintenance message"},security:{title:"Security",description:"System security configuration",authentication:"Authentication",enableTwoFactor:"Enable two-factor authentication",twoFactorHelp:"Adds an extra layer of security",sessionTimeout:"Session timeout (minutes)",maxLoginAttempts:"Maximum login attempts",lockoutTime:"Lockout duration (minutes)",passwordPolicy:"Password policy",minPasswordLength:"Minimum password length",requireUppercase:"Require uppercase",requireNumber:"Require numbers",requireSpecialChar:"Require special characters",passwordExpiryDays:"Password expiry (days)",apiAccess:"API Access",enableApiAccess:"Enable API access",apiTokenExpiry:"API token expiry (days)",passwords:"Passwords",api:"API",never:"Never"},servers:{online:"Online",title:"Servers",description:"Manage servers and modules",add:"Add server",edit:"Edit server",delete:"Delete server",name:"Name",hostname:"Hostname",type:"Type",ip:"IP Address",port:"Port",username:"Username",password:"Password",passwordHint:"Leave empty if you don't want to modify",apiToken:"API Token",apiTokenHint:"Leave empty if you don't want to modify",secure:"Secure connection (SSL/TLS)",active:"Active",maxAccounts:"Maximum number of accounts",nameservers:"Nameservers (one per line)",status:"Status",noServers:"No servers configured",confirmDelete:"Are you sure you want to delete this server?",details:"Details",refresh:"Refresh",refreshing:"Refreshing...",load:"CPU Load",memory:"Memory",disk:"Disk",uptime:"Uptime",info:"Information",lastRefresh:"Last refresh",lastCheck:"Last check",last_updated:"Last updated",apiTokenInputHint:"Leave empty if you don't want to modify",nameserversHint:"One nameserver per line",maxAccountsHint:"0 for unlimited",fillRequiredFields:"Please fill in all required fields",testConnection:"Test connection",deleteConfirm:"Are you sure you want to delete server {name}?"},modules:{title:"Modules",description:"Manage system modules",searchPlaceholder:"Search for a module...",filterByStatus:"Filter by status",statusAll:"All",statusActive:"Active",statusInactive:"Inactive",filterByType:"Module type",typeAll:"All types",types:{servers:"Servers",gateways:"Payment gateways",addons:"Add-ons",fraud:"Anti-fraud",registrars:"Registrars",reports:"Reports",widgets:"Widgets"},by:"by",active:"Active",inactive:"Inactive",noModulesFound:"No modules found",noModulesMatchSearch:"No modules match your search",noModulesMatchFilter:"No modules match the selected filter",noModulesAvailable:"No modules available",configTitle:"Module configuration",noConfigAvailable:"No configuration available for this module",loadError:"Error loading modules",refreshSuccess:"Modules refreshed successfully"},billing:{title:"Billing",description:"Configure billing settings and payment methods",general:"General",invoicePrefix:"Invoice prefix",nextInvoiceNumber:"Next invoice number",defaultDueDays:"Default due days",autoSendInvoices:"Automatically send invoices",autoSendReceipts:"Automatically send receipts",taxes:"Taxes",enableTaxes:"Enable taxes",defaultTaxName:"Default tax name",defaultTaxRate:"Default tax rate",taxNumberRequired:"Tax number required",paymentMethods:"Payment methods",stripePublicKey:"Stripe public key",stripeSecretKey:"Stripe secret key",paypalClientId:"PayPal client ID",paypalClientSecret:"PayPal client secret",paypalSandbox:"PayPal sandbox mode",bankDetails:"Bank details",bankTransfer:"Bank transfer",cash:"Cash"},integrations:{title:"Integrations",description:"Manage API integrations and webhooks",apiKeys:"API Keys",apiKeysDescription:"Manage API keys for external access to your system",generateKey:"Generate new key",newKeyGenerated:"New API key generated",copyKeyWarning:"Copy this key now. It will not be shown again.",keyName:"Key name",createdAt:"Created at",lastUsed:"Last used",expiresAt:"Expires at",noKeysFound:"No API keys found",webhooks:"Webhooks",webhooksDescription:"Configure webhooks to receive event notifications",addWebhook:"Add webhook",editWebhook:"Edit webhook",webhookName:"Webhook name",webhookUrl:"Webhook URL",webhookEvents:"Events",webhookStatus:"Status",webhookActive:"Webhook active",sendTestEvent:"Send test event",noWebhooksFound:"No webhooks found",events:{clientCreated:"Client created",clientUpdated:"Client updated",invoiceCreated:"Invoice created",invoicePaid:"Invoice paid",paymentReceived:"Payment received",ticketCreated:"Ticket created",ticketReplied:"Ticket replied",ticketClosed:"Ticket closed",serviceCreated:"Service created",serviceUpdated:"Service updated",serviceExpired:"Service expired"},confirmDeleteKey:"Are you sure you want to delete this API key?",confirmDeleteWebhook:"Are you sure you want to delete this webhook?",keyGeneratedSuccess:"API key generated successfully",keyGenerationError:"Error generating API key",keyDeletedSuccess:"API key deleted successfully",keyDeletionError:"Error deleting API key",keyCopiedSuccess:"API key copied to clipboard",keyCopyError:"Error copying API key",webhookSavedSuccess:"Webhook saved successfully",webhookSaveError:"Error saving webhook",webhookDeletedSuccess:"Webhook deleted successfully",webhookDeletionError:"Error deleting webhook",webhookActivatedSuccess:"Webhook activated successfully",webhookDeactivatedSuccess:"Webhook deactivated successfully"},license:{title:"License",description:"Manage system license",information:"License information",valid:"Valid license",invalid:"Invalid license",licenseKey:"License key",registeredTo:"Registered to",email:"Email",plan:"Plan",expiresAt:"Expires at",supportUntil:"Support until",noLicense:"No license configured",update:"Update license",activate:"Activate license",check:"Check status",features:{multipleUsers:"Multiple users",multipleUsersDesc:"Manage multiple admin users",api:"API access",apiDesc:"Full REST API access",whiteLabel:"White label",whiteLabelDesc:"Customize interface with your brand",multipleServers:"Multiple servers",multipleServersDesc:"Manage multiple provisioning servers",advancedReporting:"Advanced reporting",advancedReportingDesc:"Detailed reports and analytics",prioritySupport:"Priority support",prioritySupportDesc:"Priority technical support"},updateLicense:"Update license",activateLicense:"Activate license",licenseKeyHelp:"Enter your license key provided by TechCMS",activationSuccess:"License activated successfully",activationError:"Error activating license",checkSuccess:"License status checked",checkError:"Error checking license"},notifications:{title:"Notifications",description:"Configure system notifications",email:"Email",enableEmailNotifications:"Enable email notifications",smtpHost:"SMTP host",smtpPort:"SMTP port",smtpSecurity:"SMTP security",none:"None",smtpUsername:"SMTP username",smtpPassword:"SMTP password",emailFrom:"From email",emailFromName:"From name",testConnection:"Test connection",notificationTypes:"Notification types",inApp:"In-app",types:{newClient:"New client",newInvoice:"New invoice",paymentReceived:"Payment received",invoiceReminder:"Invoice reminder",newTicket:"New ticket",ticketReply:"Ticket reply",serviceExpiry:"Service expiry",systemAlert:"System alert"},testSuccess:"Email connection test successful",testError:"Error testing email connection"}},subscriptions:{title:"Subscriptions",description:"Manage recurring subscriptions",add_new:"New subscription",create_title:"New subscription",create_description:"Create a new subscription",edit_title:"Edit subscription",edit_description:"Edit subscription information",details_title:"Subscription #{id}",details_description:"Subscription details",actions:{add:"New subscription",edit:"Edit",cancel:"Cancel",renew:"Renew",view:"View"},search:{placeholder:"Search by client, product..."},filters:{search:"Search",status:"Status",product:"Product",billing_cycle:"Billing cycle",all_cycles:"All cycles",all_time:"All time",this_month:"This month",last_month:"Last month",this_year:"This year",last_year:"Last year"},table:{client:"Client",product:"Product",price:"Price",cycle:"Cycle",next_billing:"Next billing",status:"Status",actions:"Actions"},status:{all:"All statuses",active:"Active",pending:"Pending",cancelled:"Cancelled",expired:"Expired",suspended:"Suspended"},cycles:{monthly:"Monthly",quarterly:"Quarterly",semi_annual:"Semi-annually",annual:"Annually"},empty:{title:"No subscriptions found",description:"No subscriptions match the search criteria"},not_found:{title:"Subscription not found",description:"The requested subscription does not exist or has been deleted."},details:{main_info:"Main information",id:"Number",status:"Status",client:"Client",product:"Product",price:"Price",billing_cycle:"Billing cycle",start_date:"Start date",end_date:"End date",next_billing_date:"Next billing date",auto_renew:"Auto-renewal",server:"Server",domain:"Domain",username:"Username",notes:"Notes",history:"History",billing_info:"Billing information",service_info:"Service information"},form:{client_product:"Client and product",client:"Client",select_client:"Select a client",product:"Product",select_product:"Select a product",subscription_details:"Subscription details",billing_info:"Billing information",start_date:"Start date",end_date:"End date",billing_cycle:"Billing cycle",next_billing:"Next billing",next_billing_date:"Next billing date",price:"Price",status:"Status",service_details:"Service details",service_config:"Service configuration",server:"Server",select_server:"Select a server",domain:"Domain",domain_placeholder:"example.com",username:"Username",username_placeholder:"Service username",advanced_options:"Advanced options",options:"Options",auto_renew:"Auto-renewal",auto_renew_description:"Automatically renew this subscription when it expires",send_notifications:"Send notifications",send_notifications_description:"Send email notifications for this subscription",notes:"Notes",notes_placeholder:"Subscription notes..."},modal:{add_title:"New subscription",edit_title:"Edit subscription",view_title:"Subscription details",cancel_title:"Cancel subscription",cancel_reason:"Cancellation reason",cancel_reason_placeholder:"Why are you cancelling this subscription?",confirm_cancel:"Are you sure you want to cancel this subscription?",confirm_renew:"Are you sure you want to renew this subscription?"},history:{created:"Subscription created",updated:"Subscription updated",cancelled:"Subscription cancelled",renewed:"Subscription renewed",suspended:"Subscription suspended",reactivated:"Subscription reactivated"},success:{created:"Subscription created successfully",updated:"Subscription updated successfully",cancelled:"Subscription cancelled successfully",renewed:"Subscription renewed successfully"},errors:{load_failed:"Error loading subscription",create_failed:"Error creating subscription",update_failed:"Error updating subscription",cancel_failed:"Error cancelling subscription",renew_failed:"Error renewing subscription"}},topbar:{notifications:{title:"Notifications",toggle:"Toggle notifications",mark_all_read:"Mark all as read",markAllRead:"Mark all as read",empty:"No notifications",noNotifications:"No notifications",view_all:"View all notifications"},profile:{my_profile:"My profile",system_updates:"System Updates",settings:"Settings",logout:"Logout"}},sidebar:{menu:{dashboard:"Dashboard",clients:"Clients",services:"Services",products:"Products & Services",catalog:{title:"Catalog",prod:"Products",products_services:"Products & Services"},billing:{title:"Billing",invoices:"Invoices",payments:"Payments",subscriptions:"Subscriptions"},support:{title:"Support",tickets:"Tickets",kb:"Knowledge base"},settings:"Settings"}},errors:{realtime_connection:"Real-time connection error"},navigation:{dashboard:"Dashboard",clients:"Clients",products:"Products & Services",services:"Services",billing:"Billing",invoices:"Invoices",payments:"Payments",subscriptions:"Subscriptions",support:"Support",tickets:"Tickets",settings:"Settings",general:"General",security:"Security",servers:"Servers",modules:"Modules",license:"License"},notifications:{title:"Notifications",description:"Manage system notifications",markAllAsRead:"Mark all as read",clearAll:"Clear all",search:"Search notifications",filterByType:"Filter by type",markAsRead:"Mark as read",delete:"Delete",stats:{total:"Total",unread:"Unread",today:"Today"},status:{all:"All",unread:"Unread",read:"Read"},types:{ticket:"Ticket",invoice:"Invoice",payment:"Payment",client:"Client",system:"System"},columns:{type:"Type",title:"Title",message:"Message",date:"Date",status:"Status"},empty:{title:"No notifications",description:"You have no notifications at the moment"}},updates:{title:"System Updates",description:"Manage TechCMS automatic system updates",check_now:"Check Now",settings:"Settings",system_status:"System Status",current_version:"Current Version",available_updates:"Available Updates",last_check:"Last Check",last_update:"Last Update",automation_status:"Automation Status",auto_check:"Automatic Check",auto_download:"Automatic Download",auto_install:"Automatic Installation",up_to_date:"Up to Date",updates_available_count:"{count} update(s) available",checking:"Checking...",never:"Never",just_now:"Just now",hours_ago:"{count} hour(s) ago",days_ago:"{count} day(s) ago",download_latest:"Download Latest",available_versions:"Available Versions",version:"Version",status:{stable:"Stable",beta:"Beta",pending:"Pending",downloading:"Downloading",installing:"Installing",completed:"Completed",failed:"Failed",rolled_back:"Rolled Back"},changelog:"Changelog",download:"Download",not_available:"Not Available",history:"History",cleanup:"Cleanup",no_history:"No history",date:"Date",duration:"Duration",size:"Size",view_changelog:"View changelog",view_error:"View error",retry:"Retry",filter_status:"Filter by status",filter_version:"Filter by version",filter_version_placeholder:"Search for a version...",filter_date_from:"From date",filter_date_to:"To date",clear_filters:"Clear filters",showing_results:"Showing {from} to {to} of {total} results",changelog_title:"Changelog for version {version}",no_changelog:"No changelog available",error_details:"Error Details",update_context:"Update Context",started_at:"Started at",failed_at:"Failed at",check_success:"Check successful",updates_found:"{count} update(s) found",no_updates:"No updates available",check_error:"Check error",downloading_version:"Downloading version {version}",download_success:"Download successful",download_completed:"Download of version {version} completed",download_error:"Download error",cleanup_success:"Cleanup successful",cleanup_completed:"{files} file(s) and {records} record(s) deleted",cleanup_error:"Cleanup error",settings_title:"Update Settings",automatic_checking:"Automatic Checking",enable_auto_check:"Enable automatic checking",auto_check_description:"Automatically check for new versions at defined intervals",check_interval:"Check interval",check_interval_description:"Frequency of update checks",interval_1h:"Every hour",interval_6h:"Every 6 hours",interval_12h:"Every 12 hours",interval_24h:"Every 24 hours",interval_48h:"Every 48 hours",interval_7d:"Every week",automatic_download:"Automatic Download",enable_auto_download:"Enable automatic download",auto_download_description:"Automatically download available updates",requires_auto_check:"Requires automatic checking",automatic_installation:"Automatic Installation",enable_auto_install:"Enable automatic installation",auto_install_description:"Automatically install downloaded updates",requires_auto_download:"Requires automatic download",backup_settings:"Backup Settings",backup_before_update:"Backup before update",backup_description:"Automatically create a backup before each update",notification_settings:"Notification Settings",notification_email:"Notification email",notification_email_placeholder:"admin@example.com",notification_email_description:"Email address to receive update notifications",configuration_preview:"Configuration Preview",check_frequency:"Check frequency",backup_enabled:"Backup enabled",reset_defaults:"Reset to Defaults",settings_saved:"Settings saved",settings_updated:"Settings updated successfully",settings_error:"Settings error",invalid_email:"Invalid email format",interval_too_short:"Interval must be at least 1 hour",auto_install_requires_download:"Automatic installation requires automatic download",auto_download_requires_check:"Automatic download requires automatic checking",minutes:"{count} minute(s)",hours:"{count} hour(s)",days:"{count} day(s)",preparing_download:"Preparing download...",preparing_install:"Preparing installation...",preparing:"Preparing...",downloading:"Downloading...",installing:"Installing...",completed:"Completed",failed:"Failed",processing:"Processing...",step_validate_token:"Token validation",step_validate_token_desc:"Verifying download authorization",step_download_file:"File download",step_download_file_desc:"Downloading update from server",step_verify_integrity:"Integrity verification",step_verify_integrity_desc:"Checking downloaded file integrity",step_complete:"Completion",step_complete_desc:"Finalizing download",step_backup:"Backup",step_backup_desc:"Creating backup of current system",step_extract:"Extraction",step_extract_desc:"Extracting update files",step_apply:"Application",step_apply_desc:"Applying update to system",step_cleanup:"Cleanup",step_cleanup_desc:"Cleaning up temporary files",version_details:"Version Details",update_id:"Update ID",unknown_error:"Unknown error",install:"Install",installing_version:"Installing version {version}",install_success:"Installation successful",install_completed:"Installation of version {version} completed",install_error:"Installation error",no_downloaded_version:"No downloaded version found",requirements_not_met:"Requirements not met",check_requirements_first:"Please check installation requirements first",requirements_check_error:"Requirements check error",rollback_success:"Rollback successful",rollback_completed:"Rollback to version {version} completed",rollback_error:"Rollback error",no_backup_available:"No backup available",confirm_rollback:"Are you sure you want to rollback to version {version}?",backup_id:"Backup ID",update_to_version:"Update to this version"}},X2=G({legacy:!1,locale:localStorage.getItem("language")||"fr",fallbackLocale:"en",messages:{fr:J2,en:Y2}});ne.info("Démarrage de l'application"),ne.info("Création de l'application Vue");const Q2=B(K2);Q2.config.errorHandler=(e,t,s)=>{const a=t?t.$.type.name:"UnknownComponent";ne.error(`Erreur non capturée dans le composant: ${a}`,{error:e.toString(),stack:e.stack,info:s})},ne.info("Initialisation de Pinia");const Z2=H();Z2.use(ge),Q2.use(Z2),ne.info("Initialisation du Router"),Q2.use(F0),ne.info("Initialisation de i18n"),Q2.use(X2),ne.info("FormKit a été retiré car nous utilisons maintenant des composants standard"),ne.info("Montage de l'application"),Q2.mount("#vue-app"),ne.info("Application montée avec succès");
